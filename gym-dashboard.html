<!DOCTYPE html>
<html lang="en">
<head>
<!-- OPTIMIZED FONT LOADING -->
<!-- Replace existing Google Fonts link in <head> with this -->

<!-- Preconnect to Google Fonts (improves performance) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="css/core-styles.css">
    <link rel="stylesheet" href="css/dark-mode.css">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Load fonts with font-display: swap (prevents blocking) - OPTIMIZED -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'; this.onload=null;">
    <link rel="stylesheet" href="css/core-styles.css">

<!-- Fallback for no JavaScript -->
<noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/core-styles.css">
</noscript>

<!-- System font fallback CSS -->
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://tap-in-platform.netlify.app/temp.html">
<meta property="og:title" content="The Gym - TAP-IN Personal Development">
<meta property="og:description" content="Track your progress, continue your training, and level up your leadership skills.">
<meta property="og:image" content="/og-image.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://tap-in-platform.netlify.app/temp.html">
<meta property="twitter:title" content="The Gym - TAP-IN Personal Development">
<meta property="twitter:description" content="Track your progress, continue your training, and level up your leadership skills.">
<meta property="twitter:image" content="/og-image.png">

    <!-- CACHE BUSTER - Load FIRST, before anything else -->
    <script src="cache-buster.js"></script>

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>THE GYM | TAP-IN Personal Development</title>
    
    <!-- Supabase & Auth -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/auth-system.js"></script>
    
    <!-- Avatar System -->
    <link rel="stylesheet" href="avatar-styles.css">
    <script src="js/avatar-system.js"></script>
    
    <!-- Gamification Systems -->
    <link rel="stylesheet" href="css/xp-level-system.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="js/xp-level-system.js"></script>
    <script src="js/daily-streak.js"></script>
    <script src="js/gamification-celebrations.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-navy: #1a365d;
            --navy-light: #2d4a7c;
            --navy-dark: #0f2744;
            --accent-red: #b91c1c;
            --accent-gold: #f6e05e;
            --success-green: #38a169;
            --warning-orange: #dd6b20;
            --bg-dark: #0a0a0a;
            --bg-card: #141414;
            --bg-card-hover: #1a1a1a;
            --border-subtle: #2d2d2d;
            --text-white: #ffffff;
            --text-muted: #a0aec0;
            --text-dim: #718096;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-white);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Top Navigation */
        .top-nav {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-subtle);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo span {
            color: var(--accent-gold);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .streak-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .xp-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--border-subtle);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-navy) 0%, var(--navy-light) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            cursor: pointer;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Welcome Section */
        .welcome-section {
            margin-bottom: 2rem;
        }

        .welcome-greeting {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .welcome-date {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Card Base */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .card:hover {
            border-color: #3d3d3d;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-action {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.2s;
        }

        .card-action:hover {
            color: var(--text-white);
        }

        /* Belt Progress Card */
        .belt-progress-card {
            background: linear-gradient(135deg, var(--primary-navy) 0%, var(--navy-dark) 100%);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .belt-progress-card::before {
            content: 'ü•ã';
            position: absolute;
            right: -20px;
            bottom: -20px;
            font-size: 120px;
            opacity: 0.1;
        }

        .belt-current {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .belt-icon-large {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .belt-info h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .belt-info p {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        .belt-progress-bar {
            background: rgba(255,255,255,0.1);
            height: 12px;
            border-radius: 6px;
            margin-bottom: 0.75rem;
            overflow: hidden;
        }

        .belt-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-gold) 0%, #ecc94b 100%);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .belt-progress-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.7);
        }

        .belt-path {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .belt-step {
            text-align: center;
            flex: 1;
        }

        .belt-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            margin: 0 auto 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .belt-dot.active {
            background: var(--accent-gold);
            color: var(--bg-dark);
        }

        .belt-dot.completed {
            background: var(--success-green);
        }

        .belt-step-label {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.5);
        }

        .belt-step-label.active {
            color: var(--accent-gold);
            font-weight: 600;
        }

        /* Daily Practice Card */
        .daily-practice-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid #2d3748;
        }

        .practice-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .practice-item:hover {
            background: rgba(255,255,255,0.06);
        }

        .practice-item:last-child {
            margin-bottom: 0;
        }

        .practice-icon {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .practice-icon.completed {
            background: var(--success-green);
        }

        .practice-info {
            flex: 1;
        }

        .practice-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .practice-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .practice-action {
            padding: 0.5rem 1rem;
            background: var(--primary-navy);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .practice-action:hover {
            background: var(--navy-light);
        }

        .practice-action.done {
            background: var(--success-green);
        }

        /* Training Modules */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .module-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .module-card:hover {
            border-color: var(--primary-navy);
            transform: translateY(-2px);
        }

        .module-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .module-card.locked:hover {
            transform: none;
            border-color: var(--border-subtle);
        }

        .module-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .module-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .module-progress {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .module-bar {
            height: 4px;
            background: var(--border-subtle);
            border-radius: 2px;
            overflow: hidden;
        }

        .module-bar-fill {
            height: 100%;
            background: var(--success-green);
            border-radius: 2px;
        }

        .module-lock {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1rem;
        }

        /* Open Mat Section */
        .open-mat-section {
            margin-top: 1rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-subtitle {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .open-mat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .open-mat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .open-mat-card:hover {
            border-color: var(--primary-navy);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .open-mat-card.featured {
            border-color: var(--accent-gold);
        }

        .open-mat-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .open-mat-badge.new {
            background: var(--accent-red);
        }

        .open-mat-badge.popular {
            background: var(--accent-gold);
            color: var(--bg-dark);
        }

        .open-mat-badge.quick {
            background: var(--success-green);
        }

        .open-mat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .open-mat-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .open-mat-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .open-mat-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .open-mat-meta span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Team Assessments Section */
        .team-assessments-card {
            background: linear-gradient(135deg, var(--primary-navy) 0%, #2d4a7c 100%);
            border: 2px solid var(--navy-light);
            margin-top: 1.5rem;
        }

        .team-assessments-card .card-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .team-assessments-card .card-title {
            font-size: 1.25rem;
            color: white;
        }

        .team-assessments-card .card-subtitle {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .team-assessment-card {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .team-assessment-card:hover {
            background: rgba(255,255,255,0.15);
            border-color: var(--accent-gold);
            transform: translateY(-2px);
        }

        .team-assessment-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .team-assessment-title {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .team-assessment-desc {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .team-assessment-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .team-btn {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            text-align: center;
        }

        .team-btn-primary {
            background: var(--accent-red);
            color: white;
        }

        .team-btn-primary:hover {
            background: #991b1b;
        }

        .team-btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .team-btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .team-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.6);
            margin-top: 0.5rem;
        }

        /* Toolbox Section */
        .toolbox-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        .tool-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tool-card:hover {
            border-color: var(--primary-navy);
            background: var(--bg-card-hover);
        }

        .tool-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .tool-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .tool-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Sidebar Cards */
        .quote-card {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-left: 4px solid var(--accent-red);
        }

        .quote-text {
            font-style: italic;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .quote-author {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .refresh-quote {
            display: block;
            margin-top: 1rem;
            padding: 0.5rem;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .refresh-quote:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text-white);
        }

        /* Recent Activity */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            background: var(--border-subtle);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .activity-info {
            flex: 1;
        }

        .activity-title {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .activity-xp {
            font-size: 0.8rem;
            color: var(--accent-gold);
            font-weight: 600;
        }

        /* Assessments Card */
        .assessment-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .assessment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .assessment-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .assessment-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .assessment-icon {
            font-size: 1.25rem;
        }

        .assessment-name {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .assessment-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .assessment-status.completed {
            background: rgba(56, 161, 105, 0.2);
            color: var(--success-green);
        }

        .assessment-status.available {
            background: rgba(26, 54, 93, 0.3);
            color: var(--text-muted);
        }

        /* Weekly Challenge */
        .challenge-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1f1f 100%);
            border: 1px solid #4a3030;
        }

        .challenge-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .challenge-badge {
            background: var(--accent-red);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .challenge-timer {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .challenge-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .challenge-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .challenge-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .challenge-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .challenge-bar-fill {
            height: 100%;
            background: var(--accent-red);
            border-radius: 4px;
        }

        .challenge-count {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Library Section */
        .library-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .library-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            color: var(--text-muted);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .library-tab:hover {
            border-color: var(--primary-navy);
        }

        .library-tab.active {
            background: var(--primary-navy);
            border-color: var(--primary-navy);
            color: white;
        }

        .library-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .library-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.02);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .library-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .library-thumb {
            width: 60px;
            height: 60px;
            background: var(--border-subtle);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .library-info h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .library-info p {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .library-info .duration {
            font-size: 0.7rem;
            color: var(--text-dim);
            margin-top: 0.25rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .open-mat-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .team-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .toolbox-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            
        /* Mobile font size fix - ensure readable text */
        body {
            font-size: 16px !important;
        }
        p, li, span {
            font-size: 14px !important;
        }
}

            .top-nav {
                padding: 1rem;
            }

            .nav-right {
                gap: 0.75rem;
            }

            .streak-badge, .xp-badge {
                padding: 0.4rem 0.75rem;
                font-size: 0.8rem;
            }

            .modules-grid,
            .open-mat-grid,
            .library-grid,
            .team-grid {
                grid-template-columns: 1fr;
            }

            .toolbox-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .sidebar {
                grid-template-columns: 1fr;
            }

            .belt-path {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .belt-step {
                flex: 0 0 18%;
            }
        }
    
/* Enhanced Focus Styles for Accessibility */
button:focus,
a:focus,
input:focus,
textarea:focus,
select:focus,
.stripe-item:focus,
.module-card:focus,
.entry-card:focus {
    outline: 3px solid #6366f1;
    outline-offset: 2px;
    box-shadow: 0 0 0 6px rgba(99, 102, 241, 0.2);
}

/* Screen reader only class */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* Empty States */
.empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: rgba(255, 255, 255, 0.6);
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: rgba(255, 255, 255, 0.8);
}

.empty-state-description {
    font-size: 1rem;
    margin-bottom: 1.5rem;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
}

.empty-state-action {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: #6366f1;
    color: white;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: background 0.2s;
}

.empty-state-action:hover {
    background: #4f46e5;
}
</style>
    
    <!-- Gamification System -->
    <!-- Performance Optimizer - Load First -->
    <script src="js/performance-optimizer.js"></script>
    
    <!-- Core scripts - deferred -->
    <script src="js/gamification.js" defer></script>
    <script src="js/gym-dashboard-init.js" defer></script>
    <script src="js/belt-progression.js" defer></script>

<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#4a7c9c">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Tap-In">
<link rel="apple-touch-icon" href="/icons/icon-192.png">

    <link rel="canonical" href="https://tap-in-platform.netlify.app/gym-dashboard.html">

<body>
    <a href="#main-content" class="skip-link" style="position: absolute; top: -40px; left: 0; background: #6366f1; color: white; padding: 8px 16px; text-decoration: none; z-index: 9999; border-radius: 0 0 4px 0; font-weight: 600;"
    onfocus="this.style.top='0';" onblur="this.style.top='-40px';">Skip to main content</a>
<!-- LOADING SCREEN COMPONENT -->
<!-- Add this at the START of <body> tag -->

<style>
    /* Loading Screen - Critical CSS */
    #loadingScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #1a1d2e;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 99999;
        transition: opacity 0.3s ease;
    }
    
    #loadingScreen.hidden {
        opacity: 0;
        pointer-events: none;
    }
    
    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid #3d4466;
        border-top-color: #6366f1;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .loading-text {
        margin-top: 20px;
        color: #94a3b8;
        font-size: 16px;
        font-weight: 500;
    }
    
    .loading-logo {
        font-size: 32px;
        font-weight: 800;
        color: #ffffff;
        margin-bottom: 30px;
        letter-spacing: -0.5px;
    }
</style>

<div id="loadingScreen">
    <div class="loading-logo">TAP-IN</div>
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading...</div>
</div>

<!-- Loading screen script moved to end of body for performance -->



    <!-- Top Navigation -->
    <nav class="top-nav" role="navigation">
        <div class="logo">
            ü•ã TAP-IN <span>GYM</span>
        </div>
        <div class="nav-center" style="display: flex; gap: 1rem; align-items: center;">
            <a href="gym-dashboard.html" style="color: white; background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 6px; text-decoration: none; font-weight: 600;">ü•ã The Gym</a>
            <a href="learning-hub.html" style="color: rgba(255,255,255,0.7); padding: 0.5rem 1rem; border-radius: 6px; text-decoration: none; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)';this.style.color='white';" onmouseout="this.style.background='transparent';this.style.color='rgba(255,255,255,0.7)';">üè¢ The Hub</a>
        </div>
        <div class="nav-right">
            <a href="account.html" style="color: rgba(255,255,255,0.7); text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; transition: all 0.2s; font-weight: 600;" onmouseover="this.style.background='rgba(255,255,255,0.1)';this.style.color='white';" onmouseout="this.style.background='transparent';this.style.color='rgba(255,255,255,0.7)';">üîê Account</a>
            <a href="leaderboard.html" style="color: rgba(255,255,255,0.7); text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; transition: all 0.2s; font-weight: 600;" onmouseover="this.style.background='rgba(255,255,255,0.1)';this.style.color='white';" onmouseout="this.style.background='transparent';this.style.color='rgba(255,255,255,0.7)';">üèÜ Leaderboard</a>
            <a href="achievements.html" style="color: rgba(255,255,255,0.7); text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; transition: all 0.2s; font-weight: 600;" onmouseover="this.style.background='rgba(255,255,255,0.1)';this.style.color='white';" onmouseout="this.style.background='transparent';this.style.color='rgba(255,255,255,0.7)';">üèÖ View Achievements</a>
            <div class="streak-badge" data-streak-display>
                üî• 0 days
            </div>
            <div class="xp-badge" id="navXPBadge">
                ‚≠ê <span id="navXP">0</span> XP ‚Ä¢ <span data-level-display>Level 1: Beginner</span>
            </div>
            <div class="user-avatar">M</div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
    
<!-- Empty State Template (for achievements) -->
<div id="empty-achievements" class="empty-state" style="display: none;">
    <div class="empty-state-icon">üèÜ</div>
    <div class="empty-state-title">No Achievements Yet</div>
    <div class="empty-state-description">
        Start your leadership journey to unlock achievements and track your progress!
    </div>
    <a href="/gym-dashboard.html" class="empty-state-action">Start Training</a>
</div>

<!-- Empty State Template (for progress) -->
<div id="empty-progress" class="empty-state" style="display: none;">
    <div class="empty-state-icon">üìä</div>
    <div class="empty-state-title">Welcome to TAP-IN!</div>
    <div class="empty-state-description">
        Begin your leadership development journey. Complete your first assessment or start a belt stripe to see your progress here.
    </div>
    <a href="/belt-assessment-v2.html" class="empty-state-action">Take Assessment</a>
</div>

        <!-- User Avatar Component -->
        <div id="dashboardAvatar" style="margin-bottom: 2rem;"></div>
        
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-greeting">Welcome back, Marco üëã</h1>
            <p class="welcome-date">Monday, November 25, 2024 ‚Ä¢ White Belt Training</p>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Main Content -->
            <div class="main-content">
                <!-- Resume Card - shows when partial progress exists -->
                <div class="card current-progress" id="resumeCard" style="display: none; margin-bottom: 1.5rem;">
                    <div class="card-header">
                        <div class="card-title">‚è∏Ô∏è Continue Where You Left Off</div>
                    </div>
                    <div class="resume-content" style="padding: 1.5rem;">
                        <div class="resume-stripe" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div class="resume-icon" style="font-size: 2rem;" id="resumeIcon">‚ö™</div>
                            <div class="resume-info">
                                <div class="resume-title" style="font-weight: 600; margin-bottom: 0.25rem; color: var(--text-white);" id="resumeTitle">
                                    White Belt Stripe 1: Who Are You?
                                </div>
                                <div class="resume-meta" style="color: var(--text-muted); font-size: 0.9rem;" id="resumeMeta">
                                    Question 7 of 15 ‚Ä¢ Saved 2 hours ago
                                </div>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="resumeStripe()" style="width: 100%; padding: 1rem; font-size: 1.1em; font-weight: 600;" aria-label="Resume ‚Üí">
                            Resume ‚Üí
                        </button>
                    </div>
                </div>
                
                <!-- Belt Progress Card -->
                <div class="card belt-progress-card">
                    <div class="belt-current">
                        <div class="belt-icon-large">ü§ç</div>
                        <div class="belt-info">
                            <h2>White Belt</h2>
                            <p>Know Thyself</p>
                        </div>
                    </div>
                    <div class="belt-progress-bar">
                        <div class="belt-progress-fill" style="width: 45%"></div>
                    </div>
                    <div class="belt-progress-stats">
                        <span>45% Complete</span>
                        <span>520 / 1000 XP to Blue Belt</span>
                    </div>
                    <div class="belt-path" id="whiteBeltPath">
                        <div class="belt-step" id="stripe1-step">
                            <div class="belt-dot completed">‚úì</div>
                            <div class="belt-step-label">Who Are You?</div>
                        </div>
                        <div class="belt-step" id="stripe2-step">
                            <div class="belt-dot completed">‚úì</div>
                            <div class="belt-step-label">How You Operate</div>
                        </div>
                        <div class="belt-step" id="stripe3-step">
                            <div class="belt-dot active">3</div>
                            <div class="belt-step-label active">What You Value</div>
                        </div>
                        <div class="belt-step" id="stripe4-step">
                            <div class="belt-dot">4</div>
                            <div class="belt-step-label">How You Show Up</div>
                        </div>
                    </div>
                </div>

                <!-- Daily Practice -->
                <div class="card daily-practice-card">
                    <div class="card-header">
                        <div class="card-title">‚òÄÔ∏è Today's Practice</div>
                        <span style="color: var(--text-muted); font-size: 0.85rem;">2 of 3 complete</span>
                    </div>
                    <div class="practice-item" onclick="window.location.href='open-mat-5-minute-morning-routine.html'" style="cursor: pointer;">
                        <div class="practice-icon completed">‚úì</div>
                        <div class="practice-info">
                            <div class="practice-title">Morning Intention</div>
                            <div class="practice-meta">Set your focus for the day ‚Ä¢ 2 min</div>
                        </div>
                        <button class="practice-action done" aria-label="Done">Done</button>
                    </div>
                    <div class="practice-item" onclick="window.location.href='white-belt-stripe1-carousel-NEW.html'" style="cursor: pointer;">
                        <div class="practice-icon completed">‚úì</div>
                        <div class="practice-info">
                            <div class="practice-title">Who Are You? Assessment</div>
                            <div class="practice-meta">Worker Type Discovery ‚Ä¢ 5-7 min</div>
                        </div>
                        <button class="practice-action done" aria-label="Done">Done</button>
                    </div>
                    <div class="practice-item" onclick="window.location.href='evening-reflection.html'" style="cursor: pointer;">
                        <div class="practice-icon">üåô</div>
                        <div class="practice-info">
                            <div class="practice-title">Evening Reflection</div>
                            <div class="practice-meta">Process your day ‚Ä¢ 3 min</div>
                        </div>
                        <button class="practice-action" aria-label="Start">Start</button>
                    </div>
                </div>

                <!-- Training Modules -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìö White Belt Modules</div>
                        <a href="white-belt.html" class="card-action">View All ‚Üí</a>
                    </div>
                    <div class="modules-grid">
                        <div class="module-card" data-target="white-belt-stripe1-carousel-NEW.html" id="module-stripe1">
                            <div class="module-icon">üèÉ</div>
                            <div class="module-title">Who Are You?</div>
                            <div class="module-progress" id="module-stripe1-progress">Worker Type Assessment</div>
                            <div class="module-bar">
                                <div class="module-bar-fill" id="module-stripe1-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="module-card" data-target="white-belt-stripe2-carousel-NEW.html" id="module-stripe2">
                            <div class="module-icon">üß†</div>
                            <div class="module-title">How Do You Operate?</div>
                            <div class="module-progress" id="module-stripe2-progress">Mental Health & Energy</div>
                            <div class="module-bar">
                                <div class="module-bar-fill" id="module-stripe2-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="module-card" data-target="white-belt-stripe3-carousel-NEW.html" id="module-stripe3">
                            <div class="module-icon">üíé</div>
                            <div class="module-title">What Do You Value?</div>
                            <div class="module-progress" id="module-stripe3-progress">Values & Alignment</div>
                            <div class="module-bar">
                                <div class="module-bar-fill" id="module-stripe3-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="module-card" data-target="white-belt-stripe4-carousel-NEW.html" id="module-stripe4">
                            <div class="module-icon">üéØ</div>
                            <div class="module-title">How Do You Show Up?</div>
                            <div class="module-progress" id="module-stripe4-progress">Mission & Purpose</div>
                            <div class="module-bar">
                                <div class="module-bar-fill" id="module-stripe4-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 1.5rem; text-align: center;">
                        <button onclick="continueWhiteBelt()" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1em;" aria-label="Continue Your Journey ‚Üí">
                            Continue Your Journey ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Open Mat Section -->
                <div class="open-mat-section">
                    <div class="section-header">
                        <div>
                            <h2 class="section-title">ü•ã Open Mat</h2>
                            <p class="section-subtitle">Extra training, deep dives, and discovery</p>
                        </div>
                        <a href="white-belt.html" class="card-action">Browse All ‚Üí</a>
                    </div>
                    <div class="open-mat-grid">
                        <div class="open-mat-card featured" onclick="window.location.href='open-mat-inner-game-leadership.html'" style="cursor: pointer;">
                            <span class="open-mat-badge new">New</span>
                            <div class="open-mat-icon">üéôÔ∏è</div>
                            <div class="open-mat-title">The Inner Game of Leadership</div>
                            <div class="open-mat-desc">Why your self-talk determines your ceiling. Based on Timothy Gallwey's research.</div>
                            <div class="open-mat-meta">
                                <span>üìñ Article</span>
                                <span>‚è±Ô∏è 8 min</span>
                                <span>‚≠ê +25 XP</span>
                            </div>
                        </div>
                        <div class="open-mat-card" onclick="window.location.href='open-mat-box-breathing.html'" style="cursor: pointer;">
                            <span class="open-mat-badge popular">Popular</span>
                            <div class="open-mat-icon">üßò</div>
                            <div class="open-mat-title">Box Breathing for Pressure</div>
                            <div class="open-mat-desc">The Navy SEAL technique for staying calm when everything's on fire.</div>
                            <div class="open-mat-meta">
                                <span>üé• Exercise</span>
                                <span>‚è±Ô∏è 5 min</span>
                                <span>‚≠ê +15 XP</span>
                            </div>
                        </div>
                        <div class="open-mat-card" onclick="window.location.href='open-mat-reframe-60.html'" style="cursor: pointer;">
                            <span class="open-mat-badge quick">Quick Win</span>
                            <div class="open-mat-icon">üí≠</div>
                            <div class="open-mat-title">Reframe in 60 Seconds</div>
                            <div class="open-mat-desc">A micro-practice for shifting perspective when you're stuck.</div>
                            <div class="open-mat-meta">
                                <span>‚ö° Micro</span>
                                <span>‚è±Ô∏è 1 min</span>
                                <span>‚≠ê +10 XP</span>
                            </div>
                        </div>
                        <div class="open-mat-card" onclick="window.location.href='open-mat-energy-audit.html'" style="cursor: pointer;">
                            <div class="open-mat-icon">üìä</div>
                            <div class="open-mat-title">Energy Mapping Exercise</div>
                            <div class="open-mat-desc">Track your energy for a week and discover your hidden patterns.</div>
                            <div class="open-mat-meta">
                                <span>üìù Worksheet</span>
                                <span>‚è±Ô∏è 15 min</span>
                                <span>‚≠ê +40 XP</span>
                            </div>
                        </div>
                        <div class="open-mat-card" onclick="window.location.href='open-mat-jiu-jitsu.html'" style="cursor: pointer;">
                            <div class="open-mat-icon">üé¨</div>
                            <div class="open-mat-title">Jiu-Jitsu Philosophy</div>
                            <div class="open-mat-desc">How the gentle art teaches us to lead without force.</div>
                            <div class="open-mat-meta">
                                <span>üé• Video</span>
                                <span>‚è±Ô∏è 12 min</span>
                                <span>‚≠ê +30 XP</span>
                            </div>
                        </div>
                        <div class="open-mat-card" onclick="window.location.href='open-mat-weekly-experiment.html'" style="cursor: pointer;">
                            <div class="open-mat-icon">üß™</div>
                            <div class="open-mat-title">Weekly Experiment Lab</div>
                            <div class="open-mat-desc">This week: Say "I don't know" at least once per day.</div>
                            <div class="open-mat-meta">
                                <span>üî¨ Experiment</span>
                                <span>‚è±Ô∏è 7 days</span>
                                <span>‚≠ê +100 XP</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Research Articles Section -->
                <div class="open-mat-section">
                    <div class="section-header">
                        <div>
                            <h2 class="section-title">üìö Research Articles</h2>
                            <p class="section-subtitle">Deep dives into the science behind leadership and performance</p>
                        </div>
                    </div>
                    <div class="open-mat-grid">
                        <div class="open-mat-card featured" id="article-inner-game-card" onclick="window.location.href='article-inner-game-leadership.html'" style="cursor: pointer;">
                            <span class="open-mat-badge" id="article-inner-game-badge">Research</span>
                            <div class="open-mat-icon">üß†</div>
                            <div class="open-mat-title">The Inner Game of Leadership</div>
                            <div class="open-mat-desc">How Timothy Gallwey's tennis research explains leadership performance</div>
                            <div class="open-mat-meta">
                                <span>üìñ Research</span>
                                <span>‚è±Ô∏è 8-10 min</span>
                                <span>‚≠ê +25 XP</span>
                            </div>
                            <div id="article-inner-game-status" style="display: none; margin-top: 0.5rem; font-size: 0.85rem; color: var(--success-green);">‚úÖ Completed</div>
                        </div>
                        <div class="open-mat-card" id="article-energy-card" onclick="window.location.href='article-energy-management.html'" style="cursor: pointer;">
                            <span class="open-mat-badge" id="article-energy-badge">Research</span>
                            <div class="open-mat-icon">‚ö°</div>
                            <div class="open-mat-title">The Science of Energy Management</div>
                            <div class="open-mat-desc">Why time management fails and what high performers do instead</div>
                            <div class="open-mat-meta">
                                <span>üìñ Research</span>
                                <span>‚è±Ô∏è 10-12 min</span>
                                <span>‚≠ê +25 XP</span>
                            </div>
                            <div id="article-energy-status" style="display: none; margin-top: 0.5rem; font-size: 0.85rem; color: var(--success-green);">‚úÖ Completed</div>
                        </div>
                        <div class="open-mat-card" id="article-decision-card" onclick="window.location.href='article-decision-fatigue.html'" style="cursor: pointer;">
                            <span class="open-mat-badge" id="article-decision-badge">Research</span>
                            <div class="open-mat-icon">üéØ</div>
                            <div class="open-mat-title">Decision Fatigue</div>
                            <div class="open-mat-desc">The Baumeister research on willpower depletion and how to protect it</div>
                            <div class="open-mat-meta">
                                <span>üìñ Research</span>
                                <span>‚è±Ô∏è 8 min</span>
                                <span>‚≠ê +20 XP</span>
                            </div>
                            <div id="article-decision-status" style="display: none; margin-top: 0.5rem; font-size: 0.85rem; color: var(--success-green);">‚úÖ Completed</div>
                        </div>
                        <div class="open-mat-card" id="article-boundaries-card" onclick="window.location.href='article-boundaries-at-work.html'" style="cursor: pointer;">
                            <span class="open-mat-badge" id="article-boundaries-badge">Research</span>
                            <div class="open-mat-icon">üõ°Ô∏è</div>
                            <div class="open-mat-title">Boundaries at Work</div>
                            <div class="open-mat-desc">Bren√© Brown's research on boundaries plus scripts for setting them</div>
                            <div class="open-mat-meta">
                                <span>üìñ Research</span>
                                <span>‚è±Ô∏è 10 min</span>
                                <span>‚≠ê +25 XP</span>
                            </div>
                            <div id="article-boundaries-status" style="display: none; margin-top: 0.5rem; font-size: 0.85rem; color: var(--success-green);">‚úÖ Completed</div>
                        </div>
                        <div class="open-mat-card featured" id="article-flow-card" onclick="window.location.href='article-flow-state.html'" style="cursor: pointer;">
                            <span class="open-mat-badge" id="article-flow-badge">Research</span>
                            <div class="open-mat-icon">üåä</div>
                            <div class="open-mat-title">Flow State</div>
                            <div class="open-mat-desc">Csikszentmihalyi's flow research and Cal Newport's deep work protocols</div>
                            <div class="open-mat-meta">
                                <span>üìñ Research</span>
                                <span>‚è±Ô∏è 12 min</span>
                                <span>‚≠ê +30 XP</span>
                            </div>
                            <div id="article-flow-status" style="display: none; margin-top: 0.5rem; font-size: 0.85rem; color: var(--success-green);">‚úÖ Completed</div>
                        </div>
                    </div>
                </div>

                <!-- Belt Progression Section -->
                <div class="open-mat-section">
                    <div class="section-header">
                        <div>
                            <h2 class="section-title">ü•ã Belt Progression</h2>
                            <p class="section-subtitle">Continue your leadership development journey</p>
                        </div>
                    </div>
                    <div class="open-mat-grid">
                        <div class="open-mat-card featured" id="purple-belt-card">
                            <span class="open-mat-badge new">New</span>
                            <div class="open-mat-icon">üü£</div>
                            <div class="open-mat-title">Purple Belt: Team Alignment</div>
                            <div class="open-mat-desc">From personal mastery to collective excellence. Transform communication skills into team results.</div>
                            <div class="open-mat-meta">
                                <span>üìö 4 Stripes</span>
                                <span>‚è±Ô∏è 6-8 weeks</span>
                                <span>‚≠ê Advanced</span>
                            </div>
                            <div class="belt-progress-bar" style="width: 100%; background: #e2e8f0; border-radius: 8px; height: 8px; margin: 1rem 0; overflow: hidden;">
                                <div id="purple-progress-fill" style="height: 100%; background: linear-gradient(135deg, #581c87 0%, #7c3aed 100%); width: 0%; transition: width 0.5s;"></div>
                            </div>
                            <div id="purple-progress-text" style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">0% Complete</div>
                            <button class="practice-action" onclick="window.location.href='purple-belt.html'" style="margin-top: 0.5rem; width: 100%;" aria-label="Start Purple Belt ‚Üí">Start Purple Belt ‚Üí</button>
                        </div>
                        <div class="open-mat-card featured" id="brown-belt-card">
                            <span class="open-mat-badge new">New</span>
                            <div class="open-mat-icon">üü§</div>
                            <div class="open-mat-title">Brown Belt: Systems & Strategy</div>
                            <div class="open-mat-desc">Master organizational systems, culture design, and strategic leadership thinking.</div>
                            <div class="open-mat-meta">
                                <span>üìö 4 Stripes</span>
                                <span>‚è±Ô∏è 8-10 weeks</span>
                                <span>‚≠ê Expert</span>
                            </div>
                            <div class="belt-progress-bar" style="width: 100%; background: #e2e8f0; border-radius: 8px; height: 8px; margin: 1rem 0; overflow: hidden;">
                                <div id="brown-progress-fill" style="height: 100%; background: linear-gradient(135deg, #78350f 0%, #92400e 100%); width: 0%; transition: width 0.5s;"></div>
                            </div>
                            <div id="brown-progress-text" style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">0% Complete</div>
                            <button class="practice-action" onclick="window.location.href='brown-belt.html'" style="margin-top: 0.5rem; width: 100%;" aria-label="Start Brown Belt ‚Üí">Start Brown Belt ‚Üí</button>
                        </div>
                        <div class="open-mat-card featured" id="black-belt-card">
                            <span class="open-mat-badge new">New</span>
                            <div class="open-mat-icon">‚¨õ</div>
                            <div class="open-mat-title">Black Belt: Mastery & Integration</div>
                            <div class="open-mat-desc">The final journey: Integration, Teaching, Philosophy, and Legacy. Where the real learning begins.</div>
                            <div class="open-mat-meta">
                                <span>üìö 4 Stripes</span>
                                <span>‚è±Ô∏è 10+ weeks</span>
                                <span>‚≠ê Mastery</span>
                            </div>
                            <div class="belt-progress-bar" style="width: 100%; background: #e2e8f0; border-radius: 8px; height: 8px; margin: 1rem 0; overflow: hidden;">
                                <div id="black-progress-fill" style="height: 100%; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%); width: 0%; transition: width 0.5s;"></div>
                            </div>
                            <div id="black-progress-text" style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">0% Complete</div>
                            <button class="practice-action" onclick="window.location.href='black-belt.html'" style="margin-top: 0.5rem; width: 100%;" aria-label="Start Black Belt ‚Üí">Start Black Belt ‚Üí</button>
                        </div>
                    </div>
                </div>

                <!-- Team Assessments Card -->
                <div class="card team-assessments-card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">üë• Team Assessments</div>
                            <div class="card-subtitle">Send assessments to candidates, team members, or run team-wide diagnostics</div>
                        </div>
                    </div>
                    <div class="team-grid">
                        <div class="team-assessment-card">
                            <div class="team-assessment-icon">üß≠</div>
                            <div class="team-assessment-title">Worker Type Assessment</div>
                            <div class="team-assessment-desc">Understand how someone works best: Maker, Manager, or Mechanic</div>
                            <div class="team-stat">
                                <span>‚è±Ô∏è 8-10 min</span>
                                <span>üìä Individual</span>
                            </div>
                            <div class="team-assessment-actions">
                                <button class="team-btn team-btn-primary" onclick="window.location.href='worker-type-assessment.html'" aria-label="Take Assessment">Take Assessment</button>
                                <button class="team-btn team-btn-secondary" onclick="navigator.clipboard.writeText(window.location.origin + '/worker-type-assessment.html').then(() = aria-label="{ this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share"> { this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share</button>
                            </div>
                        </div>
                        
                        <div class="team-assessment-card">
                            <div class="team-assessment-icon">üéØ</div>
                            <div class="team-assessment-title">Team Dynamics Scan</div>
                            <div class="team-assessment-desc">Enhanced team assessment based on Lencioni's 5 Dysfunctions framework</div>
                            <div class="team-stat">
                                <span>‚è±Ô∏è 12-15 min</span>
                                <span>üë• Team-wide</span>
                            </div>
                            <div class="team-assessment-actions">
                                <button class="team-btn team-btn-primary" onclick="window.location.href='team-assessment-enhanced-v2.html'" aria-label="Start Team Scan">Start Team Scan</button>
                                <button class="team-btn team-btn-secondary" onclick="navigator.clipboard.writeText(window.location.origin + '/team-assessment-enhanced-v2.html').then(() = aria-label="{ this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share"> { this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share</button>
                            </div>
                        </div>
                        
                        <div class="team-assessment-card">
                            <div class="team-assessment-icon">üéØ</div>
                            <div class="team-assessment-title">Complete Team Profile</div>
                            <div class="team-assessment-desc">4D assessment: Worker Type + Team Dynamic + Impact Type + Communication Style</div>
                            <div class="team-stat">
                                <span>‚è±Ô∏è 10-12 min</span>
                                <span>üåü Multi-Dimensional</span>
                            </div>
                            <div class="team-assessment-actions">
                                <button class="team-btn team-btn-primary" onclick="window.location.href='team-profile-complete.html'" aria-label="Discover My Profile">Discover My Profile</button>
                                <button class="team-btn team-btn-secondary" onclick="navigator.clipboard.writeText(window.location.origin + '/team-profile-complete.html').then(() = aria-label="{ this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share"> { this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share</button>
                            </div>
                        </div>
                        
                        <div class="team-assessment-card">
                            <div class="team-assessment-icon">üî¨</div>
                            <div class="team-assessment-title">Leadership Profile</div>
                            <div class="team-assessment-desc">Combined assessment for hiring or development - see the full picture</div>
                            <div class="team-stat">
                                <span>‚è±Ô∏è 20-25 min</span>
                                <span>üéØ Comprehensive</span>
                            </div>
                            <div class="team-assessment-actions">
                                <button class="team-btn team-btn-primary" onclick="window.location.href='combined-profile-carousel.html'" aria-label="Full Profile">Full Profile</button>
                                <button class="team-btn team-btn-secondary" onclick="navigator.clipboard.writeText(window.location.origin + '/combined-profile-carousel.html').then(() = aria-label="{ this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share"> { this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share</button>
                            </div>
                        </div>
                        
                        <div class="team-assessment-card" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%); border: 2px solid rgba(168, 85, 247, 0.3);">
                            <div class="team-assessment-icon">üîç</div>
                            <div class="team-assessment-title">Team Composition Analyzer</div>
                            <div class="team-assessment-desc">Manager tool: Visualize your team's profile mix and identify gaps or strengths</div>
                            <div class="team-stat">
                                <span>üëî Manager Tool</span>
                                <span>üìä Team Analysis</span>
                            </div>
                            <div class="team-assessment-actions">
                                <button class="team-btn team-btn-primary" onclick="window.location.href='team-composition-analyzer.html'" aria-label="Analyze Team">Analyze Team</button>
                                <button class="team-btn team-btn-secondary" onclick="navigator.clipboard.writeText(window.location.origin + '/team-composition-analyzer.html').then(() = aria-label="{ this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share"> { this.textContent = '‚úì Copied!'; setTimeout(() => this.textContent = 'üì§ Share', 2000); })">üì§ Share</button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 0.9rem; color: rgba(255,255,255,0.9); font-weight: 600; margin-bottom: 0.25rem;">üíº For Organizations</div>
                                <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">Bulk send, track completion, export results, and get team insights dashboard</div>
                            </div>
                            <button class="team-btn team-btn-secondary" style="flex: 0 0 auto; padding: 0.75rem 1.5rem;" onclick="window.location.href='business-portal.html'" aria-label="Learn More ‚Üí">Learn More ‚Üí</button>
                        </div>
                    </div>
                </div>

                <!-- Toolbox -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üß∞ Your Toolbox</div>
                        <a href="learning-hub.html" class="card-action">See All Tools ‚Üí</a>
                    </div>
                    <div class="toolbox-grid">
                        <a href="tool-journal.html" class="tool-card" style="text-decoration: none; color: inherit;">
                            <div class="tool-icon">üìì</div>
                            <div class="tool-name">Journal</div>
                            <div class="tool-desc">Free-write anytime</div>
                        </a>
                        <a href="tool-goal-tracker.html" class="tool-card" style="text-decoration: none; color: inherit;">
                            <div class="tool-icon">üéØ</div>
                            <div class="tool-name">Goal Tracker</div>
                            <div class="tool-desc">3 active goals</div>
                        </a>
                        <a href="tool-mood-tracker.html" class="tool-card" style="text-decoration: none; color: inherit;">
                            <div class="tool-icon">üìä</div>
                            <div class="tool-name">Mood Tracker</div>
                            <div class="tool-desc">28 day history</div>
                        </a>
                        <a href="open-mat-box-breathing.html" class="tool-card" style="text-decoration: none; color: inherit;">
                            <div class="tool-icon">üßò</div>
                            <div class="tool-name">Breathing</div>
                            <div class="tool-desc">Guided exercises</div>
                        </a>
                        <a href="open-mat-inner-game-leadership.html" class="tool-card" style="text-decoration: none; color: inherit;">
                            <div class="tool-icon">‚è±Ô∏è</div>
                            <div class="tool-name">Focus Timer</div>
                            <div class="tool-desc">Deep work tools</div>
                        </a>
                        <a href="open-mat-reframe-60.html" class="tool-card" style="text-decoration: none; color: inherit;">
                            <div class="tool-icon">üé≤</div>
                            <div class="tool-name">Random Prompt</div>
                            <div class="tool-desc">Quick reflection</div>
                        </a>
                        <a href="open-mat-weekly-review.html" class="tool-card" style="text-decoration: none; color: inherit;">
                            <div class="tool-icon">üìà</div>
                            <div class="tool-name">Progress Report</div>
                            <div class="tool-desc">Weekly insights</div>
                        </a>
                        <a href="open-mat-decision-framework.html" class="tool-card" style="text-decoration: none; color: inherit;">
                            <div class="tool-icon">ü§ñ</div>
                            <div class="tool-name">Decision Helper</div>
                            <div class="tool-desc">Clarity tools</div>
                        </a>
                    </div>
                </div>

                <!-- Resource Library -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìö Resource Library</div>
                        <a href="white-belt.html" class="card-action">Browse All ‚Üí</a>
                    </div>
                    <div class="library-tabs">
                        <button class="library-tab active" aria-label="All">All</button>
                        <button class="library-tab" aria-label="Videos">Videos</button>
                        <button class="library-tab" aria-label="Articles">Articles</button>
                        <button class="library-tab" aria-label="Worksheets">Worksheets</button>
                        <button class="library-tab" aria-label="Audio">Audio</button>
                    </div>
                    <div class="library-grid">
                        <div class="library-item">
                            <div class="library-thumb">üé•</div>
                            <div class="library-info">
                                <h4>5 Dysfunctions Deep Dive</h4>
                                <p>Patrick Lencioni's framework explained</p>
                                <span class="duration">Video ‚Ä¢ 18 min</span>
                            </div>
                        </div>
                        <div class="library-item">
                            <div class="library-thumb">üìñ</div>
                            <div class="library-info">
                                <h4>Google's Project Aristotle</h4>
                                <p>What makes teams successful</p>
                                <span class="duration">Article ‚Ä¢ 10 min read</span>
                            </div>
                        </div>
                        <div class="library-item">
                            <div class="library-thumb">üìù</div>
                            <div class="library-info">
                                <h4>Values Discovery Worksheet</h4>
                                <p>Clarify what truly matters</p>
                                <span class="duration">Worksheet ‚Ä¢ 20 min</span>
                            </div>
                        </div>
                        <div class="library-item">
                            <div class="library-thumb">üéß</div>
                            <div class="library-info">
                                <h4>Stoic Morning Meditation</h4>
                                <p>Start your day grounded</p>
                                <span class="duration">Audio ‚Ä¢ 7 min</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Quote Card -->
                <div class="card quote-card">
                    <div class="quote-text">"The obstacle is the way. What stands in the path becomes the path."</div>
                    <div class="quote-author">‚Äî Marcus Aurelius</div>
                    <button class="refresh-quote" onclick="refreshQuote()" aria-label="‚Üª New Quote">‚Üª New Quote</button>
                </div>

                <!-- Weekly Challenge -->
                <div class="card challenge-card">
                    <div class="challenge-header">
                        <span class="challenge-badge">Weekly Challenge</span>
                        <span class="challenge-timer">4 days left</span>
                    </div>
                    <div class="challenge-title">üî• 7 Days of Vulnerability</div>
                    <div class="challenge-desc">Share one honest thing about yourself with someone each day this week.</div>
                    <div class="challenge-progress">
                        <div class="challenge-bar">
                            <div class="challenge-bar-fill" style="width: 43%"></div>
                        </div>
                        <span class="challenge-count">3/7</span>
                    </div>
                </div>

                <!-- Assessments -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìã Assessments</div>
                    </div>
                    <div class="assessment-list">
                        <div class="assessment-item" onclick="window.location.href='mental-health-assessment.html'" style="cursor: pointer;">
                            <div class="assessment-left">
                                <span class="assessment-icon">ü•ã</span>
                                <span class="assessment-name">Belt Assessment</span>
                            </div>
                            <span class="assessment-status completed">‚úì Done</span>
                        </div>
                        <div class="assessment-item" onclick="window.location.href='mental-health-assessment.html'" style="cursor: pointer;">
                            <div class="assessment-left">
                                <span class="assessment-icon">‚ö°</span>
                                <span class="assessment-name">Worker Type</span>
                            </div>
                            <span class="assessment-status completed">‚úì Done</span>
                        </div>
                        <div class="assessment-item" onclick="window.location.href='mental-health-assessment.html'" style="cursor: pointer;">
                            <div class="assessment-left">
                                <span class="assessment-icon">‚ù§Ô∏è</span>
                                <span class="assessment-name">Mental Health</span>
                            </div>
                            <span class="assessment-status available">Take Now</span>
                        </div>
                        <div class="assessment-item" onclick="window.location.href='work-life-balance-assessment.html'" style="cursor: pointer;">
                            <div class="assessment-left">
                                <span class="assessment-icon">‚öñÔ∏è</span>
                                <span class="assessment-name">Work-Life Balance</span>
                            </div>
                            <span class="assessment-status available">Take Now</span>
                        </div>
                        <div class="assessment-item" onclick="window.location.href='team-assessment-enhanced-v2.html'" style="cursor: pointer;">
                            <div class="assessment-left">
                                <span class="assessment-icon">üë•</span>
                                <span class="assessment-name">Team Dynamics</span>
                            </div>
                            <span class="assessment-status available">Take Now</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">‚ö° Recent Activity</div>
                    </div>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon">‚úÖ</div>
                            <div class="activity-info">
                                <div class="activity-title">Completed Morning Intention</div>
                                <div class="activity-time">Today, 7:32 AM</div>
                            </div>
                            <span class="activity-xp">+10 XP</span>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üìñ</div>
                            <div class="activity-info">
                                <div class="activity-title">Trust Lesson 3 Complete</div>
                                <div class="activity-time">Today, 8:15 AM</div>
                            </div>
                            <span class="activity-xp">+25 XP</span>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üî•</div>
                            <div class="activity-info">
                                <div class="activity-title">12-Day Streak!</div>
                                <div class="activity-time">Yesterday</div>
                            </div>
                            <span class="activity-xp">+50 XP</span>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üåô</div>
                            <div class="activity-info">
                                <div class="activity-title">Evening Reflection</div>
                                <div class="activity-time">Yesterday, 9:45 PM</div>
                            </div>
                            <span class="activity-xp">+10 XP</span>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üéØ</div>
                            <div class="activity-info">
                                <div class="activity-title">Weekly Challenge: Day 3</div>
                                <div class="activity-time">Yesterday</div>
                            </div>
                            <span class="activity-xp">+15 XP</span>
                        </div>
                    </div>
                </div>

                <!-- Level Progress Card -->
                <div class="card level-display">
                    <div class="card-header">
                        <div class="card-title">üìä Your Level</div>
                    </div>
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <div style="font-size: 2rem; font-weight: 800; color: var(--accent-gold); margin-bottom: 0.5rem;" data-level-number>1</div>
                        <div style="font-size: 1.1rem; font-weight: 600; color: var(--text-white); margin-bottom: 0.75rem;" data-level-title>Beginner</div>
                    </div>
                    <div class="level-progress-bar" style="background: var(--border-subtle); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem;">
                        <div class="level-progress-fill" data-level-progress style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent-gold) 0%, #ecc94b 100%); border-radius: 4px; transition: width 0.5s ease;"></div>
                    </div>
                    <div style="text-align: center;">
                        <small style="font-size: 0.85rem; color: var(--text-muted);" data-next-level-xp>100 XP to Level 2</small>
                    </div>
                </div>

                <!-- Quick Stats - Dynamic -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìä Your Stats</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                            <div style="font-size: 1.75rem; font-weight: 700; color: var(--accent-gold);" data-streak-count>0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Day Streak üî•</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                            <div style="font-size: 1.75rem; font-weight: 700; color: var(--success-green);" id="totalXP">0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Total XP ‚ö°</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                            <div style="font-size: 1.75rem; font-weight: 700; color: var(--primary-navy);" id="modulesComplete">0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Modules Done</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                            <div style="font-size: 1.75rem; font-weight: 700;" id="badgesEarned">0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Badges Earned üèÜ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
        // ULTRA-OPTIMIZED INITIALIZATION - SINGLE BATCH READ
        // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
        
        // Use performance optimizer if available, otherwise fallback
        const getBatchRead = (keys) => {
            if (window.PerfOpt) {
                return window.PerfOpt.batchRead(keys);
            }
            // Fallback: single read
            const results = {};
            keys.forEach(key => {
                try {
                    results[key] = localStorage.getItem(key);
                } catch (e) {
                    results[key] = null;
                }
            });
            return results;
        };
        
        // Single batch read of ALL localStorage data
        const storageKeys = [
            'totalXP', 'currentBelt', 'beltLevel', 'currentStripe',
            'completedLessons', 'userName', 'streakCount', 'lastVisit',
            'tapinGamification', 'tapinTotalXP', 'tapinCurrentStreak',
            'tapinLongestStreak', 'tapinLastVisit', 'tapinCurrentBelt',
            'tapinCompletedStripes', 'tapinCompletedLessons'
        ];
        
        const storageData = getBatchRead(storageKeys);
        
        // Build appState from batched read
        const appState = {
            totalXP: parseInt(storageData.totalXP || storageData.tapinTotalXP || '0'),
            currentBelt: storageData.currentBelt || storageData.tapinCurrentBelt || storageData.beltLevel || 'white',
            currentStripe: parseInt(storageData.currentStripe || '1'),
            completedLessons: (() => {
                try {
                    return JSON.parse(storageData.completedLessons || storageData.tapinCompletedLessons || '[]');
                } catch { return []; }
            })(),
            userName: storageData.userName || 'Warrior',
            streakCount: parseInt(storageData.streakCount || storageData.tapinCurrentStreak || '0'),
            lastVisit: storageData.lastVisit || storageData.tapinLastVisit,
            gamificationData: (() => {
                try {
                    return storageData.tapinGamification ? JSON.parse(storageData.tapinGamification) : null;
                } catch { return null; }
            })()
        };
        
        // Quotes array
        const quotes = [
            { text: "The obstacle is the way. What stands in the path becomes the path.", author: "Marcus Aurelius" },
            { text: "We suffer more in imagination than in reality.", author: "Seneca" },
            { text: "No man is free who is not master of himself.", author: "Epictetus" },
            { text: "The best time to plant a tree was 20 years ago. The second best time is now.", author: "Chinese Proverb" },
            { text: "You have power over your mind, not outside events. Realize this, and you will find strength.", author: "Marcus Aurelius" },
            { text: "A black belt is a white belt who never quit.", author: "Brazilian Proverb" },
            { text: "In the middle of difficulty lies opportunity.", author: "Albert Einstein" },
            { text: "The only way out is through.", author: "Robert Frost" },
            { text: "What lies behind us and what lies before us are tiny matters compared to what lies within us.", author: "Ralph Waldo Emerson" },
            { text: "Be the change you wish to see in the world.", author: "Mahatma Gandhi" },
            { text: "Fall seven times, stand up eight.", author: "Japanese Proverb" },
            { text: "The man who moves a mountain begins by carrying away small stones.", author: "Confucius" }
        ];

        function refreshQuote() {
            const quoteCard = document.querySelector('.quote-card');
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            quoteCard.querySelector('.quote-text').textContent = `"${randomQuote.text}"`;
            quoteCard.querySelector('.quote-author').textContent = `‚Äî ${randomQuote.author}`;
        }

        // Library tabs
        document.querySelectorAll('.library-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.library-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Tool cards - now using direct links instead of JavaScript handlers

        // Open Mat cards click - only handle cards without onclick
        document.querySelectorAll('.open-mat-card:not([onclick])').forEach(card => {
            card.addEventListener('click', function() {
                // Check if card has a link or data attribute
                const link = this.querySelector('a');
                if (link) {
                    window.location.href = link.href;
                } else {
                    // Default: link to inner game leadership
                    window.location.href = 'open-mat-inner-game-leadership.html';
                }
            });
        });

        // Module cards click
        document.querySelectorAll('.module-card:not(.locked)').forEach(card => {
            card.addEventListener('click', function() {
                const target = this.dataset.target;
                if (target) {
                    window.location.href = target;
                } else {
                    // Fallback: link to white belt page
                    window.location.href = 'white-belt.html';
                }
            });
        });

        // Assessment items click - use data attributes for links
        document.querySelectorAll('.assessment-item').forEach(item => {
            item.addEventListener('click', function() {
                const assessmentLink = this.dataset.assessmentLink;
                if (assessmentLink) {
                    window.location.href = assessmentLink;
                } else {
                    // Fallback: try to find link in the item
                    const link = this.querySelector('a');
                    if (link && link.href !== '#') {
                        window.location.href = link.href;
                    }
                }
            });
        });

        // Library items click - link to relevant content
        document.querySelectorAll('.library-item').forEach(item => {
            item.style.cursor = 'pointer';
            item.addEventListener('click', function() {
                const title = this.querySelector('h4').textContent;
                // Map library items to existing content
                if (title.includes('5 Dysfunctions')) {
                    window.location.href = 'team-dynamics-assessment.html';
                } else if (title.includes('Project Aristotle')) {
                    window.location.href = 'learning-hub.html';
                } else if (title.includes('Values Discovery')) {
                    window.location.href = 'values-discovery-assessment.html';
                } else if (title.includes('Stoic')) {
                    window.location.href = 'open-mat-inner-game-leadership.html';
                } else {
                    // Default to learning hub
                    window.location.href = 'learning-hub.html';
                }
            });
        });

        // Simulate real-time date
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('en-US', options);
            document.querySelector('.welcome-date').textContent = `${dateStr} ‚Ä¢ White Belt Training`;
        }
        updateDate();

        // Dynamic Belt Progress Tracking
        function updateBeltProgress() {
            const belts = [
                { name: 'purple', color: 'Purple', stripes: 4 },
                { name: 'brown', color: 'Brown', stripes: 4 },
                { name: 'black', color: 'Black', stripes: 4 }
            ];

            belts.forEach(belt => {
                let completedStripes = 0;
                
                // Count completed stripes
                for (let i = 1; i <= belt.stripes; i++) {
                    const key = `${belt.name}BeltStripe${i}Complete`;
                    if (localStorage.getItem(key) === 'true') {
                        completedStripes++;
                    }
                }

                // Calculate percentage
                const percentage = (completedStripes / belt.stripes) * 100;
                
                // Update progress bar
                const fillElement = document.getElementById(`${belt.name}-progress-fill`);
                const textElement = document.getElementById(`${belt.name}-progress-text`);
                const cardElement = document.getElementById(`${belt.name}-belt-card`);
                const badgeElement = cardElement?.querySelector('.open-mat-badge');
                
                if (fillElement) {
                    fillElement.style.width = `${percentage}%`;
                }
                
                if (textElement) {
                    if (percentage === 100) {
                        textElement.textContent = `‚úÖ ${belt.color} Belt Complete!`;
                        textElement.style.color = '#38a169';
                        textElement.style.fontWeight = '600';
                        if (badgeElement) {
                            badgeElement.textContent = 'Complete';
                            badgeElement.style.background = 'linear-gradient(135deg, #38a169 0%, #2f855a 100%)';
                        }
                    } else if (percentage > 0) {
                        textElement.textContent = `${Math.round(percentage)}% Complete (${completedStripes}/${belt.stripes} stripes)`;
                        if (badgeElement) {
                            badgeElement.textContent = 'In Progress';
                            badgeElement.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                        }
                    } else {
                        textElement.textContent = '0% Complete';
                    }
                }
            });

            // Check for entire program completion
            if (localStorage.getItem('entireProgramComplete') === 'true') {
                console.log('üéâ Entire TAP-IN program completed!');
            }
        }

        // Run on page load
        updateBeltProgress();
        updateWhiteBeltProgress();
        checkResumeAvailable();
        
        // Resume functionality
        function checkResumeAvailable() {
            const progress = localStorage.getItem('currentProgress');
            if (!progress) return;
            
            try {
                const data = JSON.parse(progress);
                
                // Check if recent (within 7 days)
                const hoursSince = (Date.now() - data.timestamp) / (1000 * 60 * 60);
                if (hoursSince > 168) {
                    localStorage.removeItem('currentProgress');
                    return;
                }
                
                // Show resume card
                const resumeCard = document.getElementById('resumeCard');
                if (resumeCard) {
                    resumeCard.style.display = 'block';
                    
                    // Update details
                    const timeAgo = formatTimeAgo(data.timestamp);
                    const metaEl = document.getElementById('resumeMeta');
                    if (metaEl) {
                        metaEl.textContent = `Question ${data.currentQuestion} of ${data.totalQuestions || 15} ‚Ä¢ Saved ${timeAgo}`;
                    }
                    
                    // Update stripe name
                    const stripeNames = {
                        'whiteBeltStripe1': 'White Belt Stripe 1: Who Are You?',
                        'whiteBeltStripe2': 'White Belt Stripe 2: How You Operate',
                        'whiteBeltStripe3': 'White Belt Stripe 3: What You Value',
                        'whiteBeltStripe4': 'White Belt Stripe 4: How You Show Up',
                        'blueBeltStripe1': 'Blue Belt Stripe 1: Difficult Conversations',
                        'blueBeltStripe2': 'Blue Belt Stripe 2: Active Listening',
                        'blueBeltStripe3': 'Blue Belt Stripe 3: Feedback Systems',
                        'blueBeltStripe4': 'Blue Belt Stripe 4: Boundaries',
                        'purpleBeltStripe1': 'Purple Belt Stripe 1: Team Alignment',
                        'purpleBeltStripe2': 'Purple Belt Stripe 2: Healthy Conflict',
                        'purpleBeltStripe3': 'Purple Belt Stripe 3: Collective Accountability',
                        'purpleBeltStripe4': 'Purple Belt Stripe 4: Results Focus',
                        'brownBeltStripe1': 'Brown Belt Stripe 1: Accountability Foundation',
                        'brownBeltStripe2': 'Brown Belt Stripe 2: Accountability Depth',
                        'brownBeltStripe3': 'Brown Belt Stripe 3: Accountability Systems',
                        'brownBeltStripe4': 'Brown Belt Stripe 4: Accountability Mastery',
                        'blackBeltStripe1': 'Black Belt Stripe 1: Integration',
                        'blackBeltStripe2': 'Black Belt Stripe 2: Teaching Others',
                        'blackBeltStripe3': 'Black Belt Stripe 3: Leadership Philosophy',
                        'blackBeltStripe4': 'Black Belt Stripe 4: Legacy'
                    };
                    
                    const titleEl = document.getElementById('resumeTitle');
                    if (titleEl) {
                        titleEl.textContent = stripeNames[data.stripe] || 'Continue Your Journey';
                    }
                    
                    // Update icon based on belt
                    const iconEl = document.getElementById('resumeIcon');
                    if (iconEl) {
                        if (data.stripe.startsWith('white')) iconEl.textContent = '‚ö™';
                        else if (data.stripe.startsWith('blue')) iconEl.textContent = 'üîµ';
                        else if (data.stripe.startsWith('purple')) iconEl.textContent = 'üü£';
                        else if (data.stripe.startsWith('brown')) iconEl.textContent = 'üü§';
                        else if (data.stripe.startsWith('black')) iconEl.textContent = '‚ö´';
                    }
                }
            } catch (e) {
                if(typeof showToast === 'function') { showToast('Something went wrong. Please try again.', 'error'); } console.error('Error checking resume:', e);
            }
        }
        
        function resumeStripe() {
            const progress = localStorage.getItem('currentProgress');
            if (!progress) return;
            
            try {
                const data = JSON.parse(progress);
                
                // Route to correct stripe page
                const stripePages = {
                    'whiteBeltStripe1': 'white-belt-stripe1-carousel-NEW.html',
                    'whiteBeltStripe2': 'white-belt-stripe2-carousel-NEW.html',
                    'whiteBeltStripe3': 'white-belt-stripe3-carousel-NEW.html',
                    'whiteBeltStripe4': 'white-belt-stripe4-carousel-NEW.html',
                    'blueBeltStripe1': 'blue-belt-stripe1-gamified.html',
                    'blueBeltStripe2': 'blue-belt-stripe2-gamified.html',
                    'blueBeltStripe3': 'blue-belt-stripe3-gamified.html',
                    'blueBeltStripe4': 'blue-belt-stripe4-gamified.html',
                    'purpleBeltStripe1': 'purple-belt-stripe1-gamified.html',
                    'purpleBeltStripe2': 'purple-belt-stripe2-gamified.html',
                    'purpleBeltStripe3': 'purple-belt-stripe3-gamified.html',
                    'purpleBeltStripe4': 'purple-belt-stripe4-gamified.html',
                    'brownBeltStripe1': 'brown-belt-stripe1-gamified.html',
                    'brownBeltStripe2': 'brown-belt-stripe2-gamified.html',
                    'brownBeltStripe3': 'brown-belt-stripe3-gamified.html',
                    'brownBeltStripe4': 'brown-belt-stripe4-gamified.html',
                    'blackBeltStripe1': 'black-belt-stripe1-gamified.html',
                    'blackBeltStripe2': 'black-belt-stripe2-gamified.html',
                    'blackBeltStripe3': 'black-belt-stripe3-gamified.html',
                    'blackBeltStripe4': 'black-belt-stripe4-gamified.html'
                };
                
                const targetPage = stripePages[data.stripe];
                if (targetPage) {
                    window.location.href = targetPage;
                } else {
                    alert('Stripe page not found. Starting fresh.');
                    localStorage.removeItem('currentProgress');
                }
            } catch (e) {
                if(typeof showToast === 'function') { showToast('Something went wrong. Please try again.', 'error'); } console.error('Error resuming stripe:', e);
                alert('Error loading saved progress. Starting fresh.');
                localStorage.removeItem('currentProgress');
            }
        }
        
        function formatTimeAgo(timestamp) {
            const hours = Math.floor((Date.now() - timestamp) / (1000 * 60 * 60));
            if (hours < 1) return 'just now';
            if (hours === 1) return '1 hour ago';
            if (hours < 24) return hours + ' hours ago';
            const days = Math.floor(hours / 24);
            if (days === 1) return '1 day ago';
            return days + ' days ago';
        }
        
        // White Belt Progress Tracking
        function updateWhiteBeltProgress() {
            const stripe1 = localStorage.getItem('whiteBeltStripe1Complete') === 'true';
            const stripe2 = localStorage.getItem('whiteBeltStripe2Complete') === 'true';
            const stripe3 = localStorage.getItem('whiteBeltStripe3Complete') === 'true';
            const stripe4 = localStorage.getItem('whiteBeltStripe4Complete') === 'true';
            
            const completed = [stripe1, stripe2, stripe3, stripe4].filter(Boolean).length;
            const percentage = (completed / 4) * 100;
            
            // Update progress bar
            const progressFill = document.querySelector('.belt-progress-fill');
            if (progressFill) {
                progressFill.style.width = percentage + '%';
            }
            
            // Update progress stats
            const progressStats = document.querySelector('.belt-progress-stats');
            if (progressStats) {
                progressStats.innerHTML = `
                    <span>${Math.round(percentage)}% Complete</span>
                    <span>${completed}/4 Stripes</span>
                `;
            }
            
            // Update belt path steps
            if (stripe1) {
                const step1 = document.getElementById('stripe1-step');
                if (step1) {
                    step1.querySelector('.belt-dot').textContent = '‚úì';
                    step1.querySelector('.belt-dot').classList.add('completed');
                    step1.querySelector('.belt-dot').classList.remove('active');
                }
                updateModuleCard('module-stripe1', true);
            }
            
            if (stripe2) {
                const step2 = document.getElementById('stripe2-step');
                if (step2) {
                    step2.querySelector('.belt-dot').textContent = '‚úì';
                    step2.querySelector('.belt-dot').classList.add('completed');
                    step2.querySelector('.belt-dot').classList.remove('active');
                }
                updateModuleCard('module-stripe2', true);
            }
            
            if (stripe3) {
                const step3 = document.getElementById('stripe3-step');
                if (step3) {
                    step3.querySelector('.belt-dot').textContent = '‚úì';
                    step3.querySelector('.belt-dot').classList.add('completed');
                    step3.querySelector('.belt-dot').classList.remove('active');
                }
                updateModuleCard('module-stripe3', true);
            }
            
            if (stripe4) {
                const step4 = document.getElementById('stripe4-step');
                if (step4) {
                    step4.querySelector('.belt-dot').textContent = '‚úì';
                    step4.querySelector('.belt-dot').classList.add('completed');
                    step4.querySelector('.belt-dot').classList.remove('active');
                }
                updateModuleCard('module-stripe4', true);
            }
            
            // Set active step
            if (!stripe1) {
                setActiveStep('stripe1-step');
            } else if (!stripe2) {
                setActiveStep('stripe2-step');
            } else if (!stripe3) {
                setActiveStep('stripe3-step');
            } else if (!stripe4) {
                setActiveStep('stripe4-step');
            } else {
                // All complete - ready for Blue Belt
                const progressStats = document.querySelector('.belt-progress-stats');
                if (progressStats) {
                    progressStats.innerHTML = `
                        <span>‚úÖ White Belt Complete!</span>
                        <span>Ready for Blue Belt ‚Üí</span>
                    `;
                }
            }
        }
        
        function setActiveStep(stepId) {
            // Remove active from all steps
            document.querySelectorAll('.belt-step').forEach(step => {
                const dot = step.querySelector('.belt-dot');
                const label = step.querySelector('.belt-step-label');
                if (dot) dot.classList.remove('active');
                if (label) label.classList.remove('active');
            });
            
            // Set active
            const step = document.getElementById(stepId);
            if (step) {
                const dot = step.querySelector('.belt-dot');
                const label = step.querySelector('.belt-step-label');
                if (dot) {
                    dot.classList.add('active');
                    if (!dot.classList.contains('completed')) {
                        dot.textContent = stepId.replace('stripe', '').replace('-step', '');
                    }
                }
                if (label) label.classList.add('active');
            }
        }
        
        function updateModuleCard(moduleId, isComplete) {
            const module = document.getElementById(moduleId);
            if (!module) return;
            
            if (isComplete) {
                const progressEl = module.querySelector('.module-progress');
                const barEl = module.querySelector('.module-bar-fill');
                if (progressEl) progressEl.textContent = 'Complete ‚úì';
                if (barEl) barEl.style.width = '100%';
            }
        }
        
        function continueWhiteBelt() {
            // Find next incomplete stripe
            if (!localStorage.getItem('whiteBeltStripe1Complete')) {
                window.location.href = 'white-belt-stripe1-carousel-NEW.html';
            } else if (!localStorage.getItem('whiteBeltStripe2Complete')) {
                window.location.href = 'white-belt-stripe2-carousel-NEW.html';
            } else if (!localStorage.getItem('whiteBeltStripe3Complete')) {
                window.location.href = 'white-belt-stripe3-carousel-NEW.html';
            } else if (!localStorage.getItem('whiteBeltStripe4Complete')) {
                window.location.href = 'white-belt-stripe4-carousel-NEW.html';
            } else {
                // All complete - go to Blue Belt
                if (confirm('White Belt Complete! Ready to start Blue Belt?')) {
                    window.location.href = 'blue-belt.html';
                }
            }
        }

        // ============================================
        // GAMIFICATION SYSTEM - XP, Streaks, Badges
        // ============================================

        // XP Configuration
        const XP_VALUES = {
            stripeComplete: 50,      // Complete a stripe module
            assessmentComplete: 100, // Complete an assessment
            openMatComplete: 25,     // Complete an open mat exercise
            dailyLogin: 10,          // Login bonus
            weekStreak: 50,          // 7-day streak bonus
            beltComplete: 250        // Complete entire belt
        };

        // Initialize or get gamification data (OPTIMIZED - uses cached appState)
        function getGamificationData() {
            const defaultData = {
                totalXP: appState.totalXP || 0,
                level: 1,
                badges: [],
                lastVisit: appState.lastVisit || null,
                streakCount: appState.streakCount || 0,
                modulesComplete: 0,
                assessmentsComplete: 0,
                history: []
            };
            
            // Use cached gamification data if available
            if (appState.gamificationData) {
                return { ...defaultData, ...appState.gamificationData };
            }
            
            // Fallback to localStorage (should rarely happen)
            const stored = localStorage.getItem('tapinGamification');
            if (stored) {
                try {
                    const parsed = JSON.parse(stored);
                    appState.gamificationData = parsed; // Cache it
                    return { ...defaultData, ...parsed };
                } catch (e) {
                    return defaultData;
                }
            }
            return defaultData;
        }

        function saveGamificationData(data) {
            localStorage.setItem('tapinGamification', JSON.stringify(data));
        }

        // Award XP function
        function awardXP(amount, reason) {
            const data = getGamificationData();
            data.totalXP += amount;
            data.history.push({
                amount,
                reason,
                timestamp: new Date().toISOString()
            });
            saveGamificationData(data);
            updateGamificationDisplay();
            
            // Check for level up
            const newLevel = Math.floor(data.totalXP / 500) + 1;
            if (newLevel > data.level) {
                data.level = newLevel;
                saveGamificationData(data);
                showLevelUpNotification(newLevel);
            }
        }

        // Check and update streak
        function updateStreak() {
            const data = getGamificationData();
            const today = new Date().toDateString();
            const lastVisit = data.lastVisit ? new Date(data.lastVisit).toDateString() : null;
            
            if (lastVisit === today) {
                // Already visited today
                return data.streakCount;
            }
            
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toDateString();
            
            if (lastVisit === yesterdayStr) {
                // Continuing streak
                data.streakCount += 1;
                awardXP(XP_VALUES.dailyLogin, 'Daily login bonus üî•');
                
                // Week streak bonus
                if (data.streakCount % 7 === 0) {
                    awardXP(XP_VALUES.weekStreak, `${data.streakCount}-day streak bonus! üèÜ`);
                    awardBadge(`streak_${data.streakCount}`, `${data.streakCount} Day Warrior`, `Maintained ${data.streakCount} consecutive days`);
                }
            } else if (lastVisit !== null) {
                // Streak broken
                data.streakCount = 1;
                awardXP(XP_VALUES.dailyLogin, 'Daily login bonus');
            } else {
                // First visit
                data.streakCount = 1;
                awardXP(XP_VALUES.dailyLogin, 'First visit! üéâ');
            }
            
            data.lastVisit = new Date().toISOString();
            saveGamificationData(data);
            return data.streakCount;
        }

        // Badge system
        function awardBadge(badgeId, badgeName, badgeDesc) {
            const data = getGamificationData();
            
            // Check if already has badge
            if (data.badges.find(b => b.id === badgeId)) {
                return false;
            }
            
            data.badges.push({
                id: badgeId,
                name: badgeName,
                description: badgeDesc,
                earnedDate: new Date().toISOString()
            });
            
            saveGamificationData(data);
            showBadgeNotification(badgeName, badgeDesc);
            return true;
        }

        // Count completed modules
        function countCompletedModules() {
            let count = 0;
            const belts = ['white', 'blue', 'purple', 'brown', 'black'];
            
            belts.forEach(belt => {
                for (let i = 1; i <= 4; i++) {
                    const key = `${belt}BeltStripe${i}Complete`;
                    if (localStorage.getItem(key) === 'true') {
                        count++;
                    }
                }
            });
            
            return count;
        }

        // Update all gamification displays
        function updateGamificationDisplay() {
            const data = getGamificationData();
            
            // Update streak (using new daily streak system)
            if (typeof DAILY_STREAK !== 'undefined') {
                const streak = DAILY_STREAK.getCurrentStreak();
                const streakCountEl = document.querySelector('[data-streak-count]');
                if (streakCountEl) streakCountEl.textContent = streak;
                
                // Update streak display in nav
                const streakDisplay = document.querySelector('[data-streak-display]');
                if (streakDisplay) {
                    streakDisplay.innerHTML = `üî• ${streak} day${streak !== 1 ? 's' : ''}`;
                }
            } else {
                const streak = updateStreak();
                const streakCountEl = document.querySelector('[data-streak-count]');
                if (streakCountEl) streakCountEl.textContent = streak;
            }
            
            // Update XP
            document.getElementById('totalXP').textContent = data.totalXP.toLocaleString();
            
            // Update XP in nav
            const navXP = document.getElementById('navXP');
            if (navXP) navXP.textContent = data.totalXP.toLocaleString();
            
            // Update modules complete
            const modulesComplete = countCompletedModules();
            data.modulesComplete = modulesComplete;
            saveGamificationData(data);
            document.getElementById('modulesComplete').textContent = modulesComplete;
            
            // Update badges
            document.getElementById('badgesEarned').textContent = data.badges.length;
            
            // Update level displays (XP level system will handle this automatically)
            if (typeof XP_LEVEL_SYSTEM !== 'undefined') {
                XP_LEVEL_SYSTEM.updateLevelDisplays();
            }
            
            // Update XP badge in nav (if it exists)
            const xpBadge = document.getElementById('navXPBadge');
            if (xpBadge && typeof XP_LEVEL_SYSTEM !== 'undefined') {
                const levelData = XP_LEVEL_SYSTEM.getCurrentLevel(data.totalXP);
                const navXPEl = document.getElementById('navXP');
                const levelDisplayEl = xpBadge.querySelector('[data-level-display]');
                if (navXPEl) navXPEl.textContent = data.totalXP.toLocaleString();
                if (levelDisplayEl) levelDisplayEl.textContent = `Level ${levelData.level}: ${levelData.title}`;
            } else if (xpBadge) {
                xpBadge.innerHTML = `‚≠ê <span id="navXP">${data.totalXP.toLocaleString()}</span> XP`;
            }
        }

        // Show level up notification
        function showLevelUpNotification(level) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, var(--accent-gold) 0%, #ecc94b 100%);
                color: var(--bg-dark);
                padding: 3rem;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(246, 224, 94, 0.5);
                z-index: 10000;
                text-align: center;
                animation: scaleIn 0.5s ease;
            `;
            notification.innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 1rem;">üéâ</div>
                <h2 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;">LEVEL UP!</h2>
                <p style="font-size: 1.5rem; font-weight: 600;">You reached Level ${level}</p>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'scaleOut 0.5s ease';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // Show badge notification
        function showBadgeNotification(badgeName, badgeDesc) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: linear-gradient(135deg, var(--primary-navy) 0%, var(--navy-light) 100%);
                color: white;
                padding: 1.5rem;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 350px;
                animation: slideInRight 0.5s ease;
            `;
            notification.innerHTML = `
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <div style="font-size: 2.5rem;">üèÜ</div>
                    <div>
                        <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">Badge Unlocked!</div>
                        <div style="font-weight: 600; color: var(--accent-gold);">${badgeName}</div>
                        <div style="font-size: 0.85rem; opacity: 0.9; margin-top: 0.25rem;">${badgeDesc}</div>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }

        // Add animations to head
        const style = document.createElement('style');
        style.textContent = `
            @keyframes scaleIn {
                from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            }
            @keyframes scaleOut {
                from { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                to { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            }
            @keyframes slideInRight {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize gamification on page load
        updateGamificationDisplay();

        // Track Open Mat article completion status
        function updateArticleCompletionStatus() {
            const completed = JSON.parse(localStorage.getItem('tapinOpenMatCompleted') || '[]');
            
            const articles = [
                { id: 'article-inner-game-leadership', cardId: 'article-inner-game-card', badgeId: 'article-inner-game-badge', statusId: 'article-inner-game-status' },
                { id: 'article-energy-management', cardId: 'article-energy-card', badgeId: 'article-energy-badge', statusId: 'article-energy-status' },
                { id: 'article-decision-fatigue', cardId: 'article-decision-card', badgeId: 'article-decision-badge', statusId: 'article-decision-status' },
                { id: 'article-boundaries-at-work', cardId: 'article-boundaries-card', badgeId: 'article-boundaries-badge', statusId: 'article-boundaries-status' },
                { id: 'article-flow-state', cardId: 'article-flow-card', badgeId: 'article-flow-badge', statusId: 'article-flow-status' }
            ];
            
            articles.forEach(article => {
                const card = document.getElementById(article.cardId);
                const badge = document.getElementById(article.badgeId);
                const status = document.getElementById(article.statusId);
                
                if (card && completed.includes(article.id)) {
                    // Mark as completed
                    card.style.opacity = '0.7';
                    card.style.border = '2px solid var(--success-green)';
                    if (badge) {
                        badge.textContent = '‚úÖ Completed';
                        badge.style.background = 'linear-gradient(135deg, var(--success-green) 0%, #2f855a 100%)';
                    }
                    if (status) {
                        status.style.display = 'block';
                    }
                }
            });
        }

        // Initialize article completion status on page load
        updateArticleCompletionStatus();

        // Expose functions globally for other pages to award XP
        window.tapinGamification = {
            awardXP,
            awardBadge,
            getGamificationData,
            XP_VALUES
        };
    </script>

<!-- Language Switcher Component -->
<!-- Include this at the top of every page -->

<style>
    .language-switcher {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }
    
    .lang-toggle {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 8px 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s;
        color: #ffffff;
        font-weight: 600;
        font-size: 14px;
    }
    
    .lang-toggle:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
    }
    
    .lang-flag {
        font-size: 18px;
    }
    
    .lang-code {
        font-weight: 700;
        letter-spacing: 0.5px;
    }
    
    .lang-arrow {
        font-size: 12px;
        opacity: 0.7;
    }
    
    .lang-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        background: rgba(30, 30, 50, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        overflow: hidden;
        display: none;
        min-width: 150px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }
    
    .lang-dropdown.show {
        display: block;
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .lang-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        color: #ffffff;
        text-decoration: none;
        transition: all 0.2s;
        font-weight: 500;
        font-size: 14px;
    }
    
    .lang-option:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .lang-option.active {
        background: rgba(99, 102, 241, 0.2);
        color: #a5b4fc;
    }
    
    .lang-option .lang-flag {
        font-size: 20px;
    }
    
    @media (max-width: 768px) {
        .language-switcher {
            top: 10px;
            right: 10px;
        }
        
        .lang-toggle {
            padding: 6px 12px;
            font-size: 14px;
        }
    }
</style>

<div class="language-switcher">
    <button class="lang-toggle" id="langToggle">
        <span class="lang-flag" id="currentFlag">üá¨üáß</span>
        <span class="lang-code" id="currentLang">EN</span>
        <span class="lang-arrow">‚ñº</span>
    </button>
    <div class="lang-dropdown" id="langDropdown">
        <a href="#" class="lang-option" data-lang="en" data-file="">
            <span class="lang-flag">üá¨üáß</span> English
        </a>
        <a href="#" class="lang-option" data-lang="de" data-file="-de">
            <span class="lang-flag">üá©üá™</span> Deutsch
        </a>
    </div>
</div>

<script>
(function() {
    // Language Switcher Logic
    const toggle = document.getElementById('langToggle');
    const dropdown = document.getElementById('langDropdown');
    const currentFlag = document.getElementById('currentFlag');
    const currentLang = document.getElementById('currentLang');
    
    // Detect current language from URL
    const isGerman = window.location.pathname.includes('-de.html');
    const currentLanguage = isGerman ? 'de' : 'en';
    
    // Update UI to show current language
    if (isGerman) {
        currentFlag.textContent = 'üá©üá™';
        currentLang.textContent = 'DE';
    }
    
    // Mark active language option
    document.querySelectorAll('.lang-option').forEach(option => {
        if (option.dataset.lang === currentLanguage) {
            option.classList.add('active');
        }
    });
    
    // Toggle dropdown
    toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdown.classList.toggle('show');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', () => {
        dropdown.classList.remove('show');
    });
    
    // Language switch handler
    document.querySelectorAll('.lang-option').forEach(option => {
        option.addEventListener('click', (e) => {
            e.preventDefault();
            const targetLang = option.dataset.lang;
            const fileSuffix = option.dataset.file;
            
            // Don't switch if already on that language
            if (targetLang === currentLanguage) {
                dropdown.classList.remove('show');
                return;
            }
            
            // Store preference
            localStorage.setItem('preferredLanguage', targetLang);
            
            // Get current page without language suffix
            let currentPath = window.location.pathname;
            let basePath = currentPath.replace('-de.html', '.html');
            
            // Build new path
            let newPath = basePath.replace('.html', fileSuffix + '.html');
            
            // Navigate to new language version
            window.location.href = newPath;
        });
    });
    
    // Auto-redirect based on stored preference (optional)
    // Uncomment if you want automatic redirects
    /*
    const storedLang = localStorage.getItem('preferredLanguage');
    if (storedLang && storedLang !== currentLanguage) {
        const fileSuffix = storedLang === 'de' ? '-de' : '';
        let basePath = window.location.pathname.replace('-de.html', '.html');
        let newPath = basePath.replace('.html', fileSuffix + '.html');
        window.location.href = newPath;
    }
    */
})();
</script>



    <script>
    // Global error handler - prevents silent failures
    window.addEventListener('error', function(e) {
        if(typeof showToast === 'function') { showToast('Something went wrong. Please try again.', 'error'); } console.error('Resource failed to load:', e.target.src || e.target.href || e.message);
        // Don't break the page, just log
        e.preventDefault();
    });
    
    // Handle promise rejections
    window.addEventListener('unhandledrejection', function(e) {
        if(typeof showToast === 'function') { showToast('Unhandled promise rejection:', 'error'); } console.error('Unhandled promise rejection:', e.reason);
        e.preventDefault();
    });
    
    // ‚ö° OPTIMIZED LOADING SCREEN - Non-blocking, fast hiding
    (function() {
        function hideLoading() {
            const loader = document.getElementById('loadingScreen');
            if (loader && loader.style.display !== 'none') {
                loader.classList.add('hidden');
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 300);
            }
        }
        
        // Hide on window load
        if (document.readyState === 'complete') {
            hideLoading();
        } else {
            window.addEventListener('load', hideLoading);
        }
        
        // Fallback timeout (3 seconds max)
        setTimeout(hideLoading, 3000);
    })();
    </script>


<!-- Wisdom Tracker & Hub Unlock Systems -->
<script src="js/wisdom-tracker.js" defer></script>
<script src="js/hub-unlock-system.js" defer></script>
<script src="js/progress-sync-init.js" defer></script>

<!-- Initialize Systems -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize Wisdom Tracker
    if (typeof WisdomTracker !== 'undefined') {
      WisdomTracker.init();
      console.log('‚úÖ Wisdom Tracker initialized');
    }
    
    // Initialize Hub Unlock System  
    if (typeof HubUnlockSystem !== 'undefined') {
      HubUnlockSystem.init();
      console.log('‚úÖ Hub Unlock System initialized');
    }
    
    // Update article completion status
    if (typeof updateArticleCompletionStatus === 'function') {
      updateArticleCompletionStatus();
    }
  });
</script>


<!-- Global Error Handling -->
<script>
// Global error handling
window.addEventListener('error', (event) => {
  if(typeof showToast === 'function') { showToast('Something went wrong. Please try again.', 'error'); } console.error('üí• Error:', event.error);
  showErrorToast('Something went wrong. Please refresh the page.');
});

window.addEventListener('unhandledrejection', (event) => {
  // FIXED: Suppress Service Worker errors during uninstall
  const reason = event.reason?.toString() || '';
  if (reason.includes('Service Worker') || reason.includes('serviceWorker') || reason.includes('sw.js')) {
    console.log('‚úì SW error suppressed (expected during uninstall)');
    event.preventDefault(); // Prevent the notification
    return;
  }
  
  if(typeof showToast === 'function') { showToast('üí• Unhandled promise rejection:', 'error'); } console.error('üí• Unhandled promise rejection:', event.reason);
  showErrorToast('A background process failed. Everything else should work fine.');
});

function showErrorToast(message) {
  const toast = document.createElement('div');
  toast.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(255,107,107,0.4);
    z-index: 100000;
    animation: slideUp 0.3s ease-out;
    max-width: 300px;
  `;
  toast.innerHTML = `
    <div style="display: flex; align-items: center; gap: 0.5rem;">
      <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
      <span>${message}</span>
    </div>
  `;
  
  const style = document.createElement('style');
  style.textContent = `
    @keyframes slideUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  `;
  document.head.appendChild(style);
  
  document.body.appendChild(toast);
  setTimeout(() => {
    toast.style.animation = 'slideUp 0.3s ease-out reverse';
    setTimeout(() => toast.remove(), 300);
  }, 5000);
}

window.showErrorToast = showErrorToast;
</script>

<!-- ============================================
     AUTH & SYNC INTEGRATION
     ============================================ -->
<script>
async function initAuthSync() {
    // Wait for auth to initialize
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    if (!window.tapInAuth || !window.tapInAuth.isAuthenticated()) {
        console.log('Auth not ready yet');
        return;
    }
    
    console.log('‚úÖ Auth initialized:', window.tapInAuth.getUserId());
    
    // Load progress from cloud
    const cloudProgress = await window.tapInAuth.loadProgress();
    
    if (cloudProgress) {
        // Merge cloud data with local
        const localXP = parseInt(localStorage.getItem('totalXP') || '0');
        
        if (cloudProgress.total_xp > localXP) {
            // Cloud has more recent data
            localStorage.setItem('totalXP', cloudProgress.total_xp);
            localStorage.setItem('currentBelt', cloudProgress.current_belt);
            
            // Update UI if updateDashboard function exists
            if (typeof updateDashboard === 'function') {
                updateDashboard();
            }
            
            console.log('‚úÖ Synced from cloud');
        }
    }
}

// Sync progress to cloud (call this after XP changes)
async function syncProgressToCloud() {
    if (!window.tapInAuth || !window.tapInAuth.isAuthenticated()) {
        return;
    }
    
    const progressData = {
        currentBelt: localStorage.getItem('currentBelt') || 'White',
        stripesCompleted: getStripesCompleted(),
        totalXP: parseInt(localStorage.getItem('totalXP') || '0'),
        completedLessons: getCompletedLessons()
    };
    
    await window.tapInAuth.saveProgress(progressData);
    console.log('‚úÖ Synced to cloud');
}

function getStripesCompleted() {
    // Get all completed stripes
    const stripes = {};
    ['white', 'blue', 'purple', 'brown', 'black'].forEach(belt => {
        for (let i = 1; i <= 4; i++) {
            const key = `${belt}BeltStripe${i}Complete`;
            if (localStorage.getItem(key) === 'true') {
                if (!stripes[belt]) stripes[belt] = [];
                stripes[belt].push(i);
            }
        }
    });
    return stripes;
}

function getCompletedLessons() {
    // Get all completed lessons
    const lessons = [];
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.includes('Complete') && localStorage.getItem(key) === 'true') {
            lessons.push(key);
        }
    }
    return lessons;
}

// Initialize auth sync
initAuthSync();

// Override existing awardXP to add cloud sync
const originalAwardXP = window.awardXP || function() {};
window.awardXP = async function(amount, reason) {
    // Call original function if it exists
    if (originalAwardXP && typeof originalAwardXP === 'function') {
        originalAwardXP(amount, reason);
    }
    
    // Sync to cloud
    await syncProgressToCloud();
};
</script>

<!-- Service Worker Registration -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .catch(err => console.log('SW uninstalling'));
    });
  }
</script>


    <!-- Performance Optimizer - Load First -->
    <script src="js/performance-optimizer.js"></script>
    
    <!-- Defer all non-critical scripts -->
    <script src="js/loading-states.js" defer></script>
    <script src="js/error-handler.js" defer></script>
    
<!-- Avatar System Loader -->
<script>
// Load avatar component
document.addEventListener('DOMContentLoaded', function() {
    const avatarContainer = document.getElementById('dashboardAvatar');
    if (avatarContainer) {
        fetch('components/user-avatar.html')
            .then(r => r.text())
            .then(html => {
                avatarContainer.innerHTML = html;
                // Avatar system JS is already loaded in head, just initialize
                setTimeout(function() {
                    if (typeof AVATAR_SYSTEM !== 'undefined') {
                        AVATAR_SYSTEM.init();
                    }
                }, 100);
            })
            .catch(err => {
                console.warn('Avatar component not found, skipping:', err);
                avatarContainer.style.display = 'none';
            });
    }
});
</script>

<!-- TAP-IN Utilities -->
<script src="js/shared-utilities.js"></script>
<script src="js/global-error-handler.js"></script>
<script src="js/storage-health.js"></script>
<!-- Core Modules -->
<script src="js/core-gamification.js"></script>
<script src="js/core-progress-tracker.js"></script>
<script src="js/storage-manager.js"></script>
<script src="js/keyboard-nav.js"></script>
    <!-- TAP-IN Core Modules -->
    <script src="js/language-switcher.js"></script>
    <script src="js/meta-tags-manager.js"></script>
    <script src="js/achievement-badges.js"></script>
    <script src="js/structured-data.js"></script>
    <script src="js/performance-monitor.js"></script>

<!-- Toast Notification System -->
<div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px;"></div>

<script>
(function() {
    'use strict';
    
    window.showToast = function(message, type = 'info', duration = 3000) {
        const container = document.getElementById('toast-container');
        if (!container) return;
        
        const toast = document.createElement('div');
        toast.style.cssText = `
            background: ${type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6'};
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            min-width: 300px;
            max-width: 500px;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
        `;
        
        const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
        toast.innerHTML = `<span style="font-size: 1.25rem;">${icon}</span><span>${message}</span>`;
        
        container.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => toast.remove(), 300);
        }, duration);
    };
    
    // Add animations if not present
    if (!document.getElementById('toast-animations')) {
        const style = document.createElement('style');
        style.id = 'toast-animations';
        style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    }
})();
</script>

</html>


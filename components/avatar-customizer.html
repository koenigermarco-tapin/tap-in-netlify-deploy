<!-- Avatar Customization Modal -->
<div id="avatarCustomizerModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; background: #1f2937; color: white;">
        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <h2 style="margin: 0; color: white;">ğŸ¥‹ Customize Your Avatar</h2>
            <button onclick="closeAvatarCustomizer()" class="close-btn" style="background: none; border: none; color: white; font-size: 2rem; cursor: pointer; padding: 0; width: 40px; height: 40px; border-radius: 50%; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">&times;</button>
        </div>

        <div class="modal-body">
            <!-- Avatar Preview -->
            <div class="avatar-preview-section" style="display: flex; justify-content: center; margin: 2rem 0;">
                <div id="avatarPreview" class="avatar-container medium" style="width: 200px; height: 200px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); border-radius: 20px; border: 2px solid rgba(255,255,255,0.1);">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Customization Options -->
            <div class="customization-tabs" style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                <button class="tab-btn active" data-tab="background" onclick="switchTab('background')" style="padding: 0.75rem 1rem; background: #374151; border: none; color: white; border-radius: 8px; cursor: pointer; transition: background 0.3s;">Background</button>
                <button class="tab-btn" data-tab="gi" onclick="switchTab('gi')" style="padding: 0.75rem 1rem; background: #374151; border: none; color: white; border-radius: 8px; cursor: pointer; transition: background 0.3s;">Gi Color</button>
                <button class="tab-btn" data-tab="belt" onclick="switchTab('belt')" style="padding: 0.75rem 1rem; background: #374151; border: none; color: white; border-radius: 8px; cursor: pointer; transition: background 0.3s;">Belt</button>
                <button class="tab-btn" data-tab="face" onclick="switchTab('face')" style="padding: 0.75rem 1rem; background: #374151; border: none; color: white; border-radius: 8px; cursor: pointer; transition: background 0.3s;">Face</button>
                <button class="tab-btn" data-tab="hair" onclick="switchTab('hair')" style="padding: 0.75rem 1rem; background: #374151; border: none; color: white; border-radius: 8px; cursor: pointer; transition: background 0.3s;">Hair</button>
            </div>

            <!-- Background Options -->
            <div class="tab-content active" id="tab-background" data-content="background">
                <div class="options-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem;">
                    <button class="option-btn" data-value="garage" onclick="selectOption('background', 'garage')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">ğŸ­ Garage</button>
                    <button class="option-btn" data-value="dojo" onclick="selectOption('background', 'dojo')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">ğŸ¯ Dojo</button>
                    <button class="option-btn" data-value="arena" onclick="selectOption('background', 'arena')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">ğŸŸï¸ Arena</button>
                    <button class="option-btn" data-value="japan" onclick="selectOption('background', 'japan')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">ğŸ—¾ Japan</button>
                    <button class="option-btn" data-value="temple" onclick="selectOption('background', 'temple')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">â›©ï¸ Temple</button>
                </div>
            </div>

            <!-- Gi Options -->
            <div class="tab-content" id="tab-gi" data-content="gi" style="display: none;">
                <div class="options-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem;">
                    <button class="option-btn" data-value="white" onclick="selectOption('gi', 'white')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">âšª White Gi</button>
                    <button class="option-btn" data-value="blue" onclick="selectOption('gi', 'blue')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">ğŸ”µ Blue Gi</button>
                    <button class="option-btn" data-value="black" onclick="selectOption('gi', 'black')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">âš« Black Gi</button>
                    <button class="option-btn" data-value="purple" onclick="selectOption('gi', 'purple')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">ğŸŸ£ Purple Gi</button>
                    <button class="option-btn" data-value="gold" onclick="selectOption('gi', 'gold')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">ğŸŸ¡ Gold Gi</button>
                </div>
            </div>

            <!-- Belt (Auto from progress) -->
            <div class="tab-content" id="tab-belt" data-content="belt" style="display: none;">
                <p style="text-align: center; color: #9ca3af; padding: 2rem;">
                    Your belt is determined by your progress.<br>
                    Current: <strong id="currentBeltDisplay" style="color: white;">White Belt</strong>
                </p>
            </div>

            <!-- Face Options -->
            <div class="tab-content" id="tab-face" data-content="face" style="display: none;">
                <div class="options-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem;">
                    <button class="option-btn" data-value="ğŸ˜Š" onclick="selectOption('face', 'ğŸ˜Š')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 2rem;">ğŸ˜Š Happy</button>
                    <button class="option-btn" data-value="ğŸ˜" onclick="selectOption('face', 'ğŸ˜')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 2rem;">ğŸ˜ Cool</button>
                    <button class="option-btn" data-value="ğŸ¤”" onclick="selectOption('face', 'ğŸ¤”')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 2rem;">ğŸ¤” Thoughtful</button>
                    <button class="option-btn" data-value="ğŸ˜¤" onclick="selectOption('face', 'ğŸ˜¤')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 2rem;">ğŸ˜¤ Determined</button>
                    <button class="option-btn" data-value="ğŸ§˜" onclick="selectOption('face', 'ğŸ§˜')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 2rem;">ğŸ§˜ Zen</button>
                    <button class="option-btn" data-value="ğŸ’ª" onclick="selectOption('face', 'ğŸ’ª')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 2rem;">ğŸ’ª Strong</button>
                    <button class="option-btn" data-value="ğŸ¥‹" onclick="selectOption('face', 'ğŸ¥‹')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 2rem;">ğŸ¥‹ Martial Artist</button>
                </div>
            </div>

            <!-- Hair Options -->
            <div class="tab-content" id="tab-hair" data-content="hair" style="display: none;">
                <div class="options-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem;">
                    <button class="option-btn" data-value="none" onclick="selectOption('hair', 'none')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">None</button>
                    <button class="option-btn" data-value="short" onclick="selectOption('hair', 'short')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">Short</button>
                    <button class="option-btn" data-value="long" onclick="selectOption('hair', 'long')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">Long</button>
                    <button class="option-btn" data-value="ponytail" onclick="selectOption('hair', 'ponytail')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">Ponytail</button>
                    <button class="option-btn" data-value="bald" onclick="selectOption('hair', 'bald')" style="padding: 1rem; background: #374151; border: 2px solid transparent; color: white; border-radius: 12px; cursor: pointer; transition: all 0.3s;">Bald</button>
                </div>
            </div>
        </div>

        <div class="modal-footer" style="margin-top: 2rem; display: flex; gap: 1rem;">
            <button onclick="saveAvatarCustomization()" class="btn-primary" style="flex: 1; padding: 1rem; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; transition: transform 0.3s; background: #48bb78; color: white;">
                ğŸ’¾ Save Avatar
            </button>
            <button onclick="closeAvatarCustomizer()" class="btn-secondary" style="flex: 1; padding: 1rem; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; background: #6b7280; color: white;">
                Cancel
            </button>
        </div>
    </div>
</div>

<style>
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.tab-btn.active {
    background: #667eea !important;
}

.option-btn:hover {
    background: #4b5563 !important;
    border-color: #667eea !important;
}

.option-btn.selected {
    border-color: #48bb78 !important;
    background: #065f46 !important;
}

.btn-primary:hover {
    transform: translateY(-2px);
}
</style>

<script>
// Tab switching
function switchTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Remove active class from buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    const tabContent = document.getElementById('tab-' + tabName);
    if (tabContent) {
        tabContent.style.display = 'block';
    }
    
    // Add active class to button
    const btn = document.querySelector(`[data-tab="${tabName}"]`);
    if (btn) {
        btn.classList.add('active');
    }
}

// Option selection
function selectOption(type, value) {
    if (window.AvatarSystem) {
        window.AvatarSystem.config[type] = value;
        window.AvatarSystem.render('avatarPreview');
        
        // Update selected state
        document.querySelectorAll(`#tab-${type} .option-btn`).forEach(btn => {
            btn.classList.remove('selected');
        });
        event.target.classList.add('selected');
    }
}

// Close modal
function closeAvatarCustomizer() {
    document.getElementById('avatarCustomizerModal').style.display = 'none';
}

// Save customization
function saveAvatarCustomization() {
    if (window.AvatarSystem) {
        window.AvatarSystem.saveConfig();
        closeAvatarCustomizer();
        
        // Refresh all avatars on page
        document.querySelectorAll('.avatar-container').forEach(container => {
            container.innerHTML = window.AvatarSystem.generateHTML();
        });
    }
}
</script>


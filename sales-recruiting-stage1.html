<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <!-- Performance: Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">

    <!-- Performance: Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">

    <!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:url" content="https://tap-in-platform.netlify.app/worker-type-assessment.html">
<meta property="og:title" content="Sales Recruiting Assessment - Stage 1">
<meta property="og:description" content="Take our leadership assessment to discover your strengths and development areas.">
<meta property="og:image" content="https://tap-in-platform.netlify.app/og-image.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://tap-in-platform.netlify.app/worker-type-assessment.html">
<meta property="twitter:title" content="Leadership Assessment | TAP-IN">
<meta property="twitter:description" content="Take our leadership assessment to discover your strengths and development areas.">
<meta property="twitter:image" content="https://tap-in-platform.netlify.app/og-image.png">
    <meta name="theme-color" content="#2d2d2d">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="3.0.0">
    <title>Sales Profile Assessment - Stage 1 | TAP-IN Recruiting</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; }
        .header { background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .header h1 { color: #1a365d; font-size: clamp(1.8em, 5vw, 2.5em); margin-bottom: 20px; font-weight: 600; letter-spacing: -0.5px; }
        .header .subtitle { color: #64748b; font-size: clamp(1em, 2.5vw, 1.15em); line-height: 1.7; font-weight: 400; }
        .progress-container { background: white; border-radius: 15px; padding: 20px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .progress-bar { background: #e0e0e0; border-radius: 10px; height: 12px; overflow: hidden; margin-bottom: 10px; }
        .progress-fill { background: linear-gradient(90deg, #1a365d 0%, #334155 100%); height: 100%; width: 0%; transition: width 0.3s ease; }
        .progress-text { text-align: center; color: #64748b; font-size: 0.95em; font-variant-numeric: tabular-nums; }
        .assessment-card { background: white; border-radius: 20px; padding: 40px 30px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .question { margin-bottom: 35px; padding: 25px; background: #f8f9fa; border-radius: 12px; transition: all 0.3s ease; }
        .question:hover { background: #f0f2f5; }
        .question-text { color: #1e293b; font-size: clamp(1.1em, 2.5vw, 1.3em); margin-bottom: 20px; font-weight: 600; line-height: 1.5; letter-spacing: -0.2px; }
        .question-number { color: #94a3b8; font-weight: 600; font-size: 0.85em; margin-bottom: 10px; display: block; letter-spacing: 0.5px; font-variant-numeric: tabular-nums; }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .option { display: flex; align-items: center; cursor: pointer; padding: 18px 22px; border-left: 3px solid #e2e8f0; border-top: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; border-radius: 8px; transition: all 0.2s; background: white; }
        .option:hover { border-left-color: #1a365d; border-left-width: 3px; background: #f8fafc; }
        .option.selected { border-left-color: #1a365d; border-left-width: 4px; background: #f1f5f9; }
        .option input[type="radio"] { display: none; }
        .option-label { font-size: 1em; color: #334155; font-weight: 400; }
        .option.selected .option-label { color: #1e293b; font-weight: 500; }
        .nav-buttons { display: flex; justify-content: space-between; gap: 12px; margin-top: 40px; padding-top: 30px; border-top: 1px solid #e2e8f0; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; font-size: 0.95em; font-weight: 600; cursor: pointer; transition: all 0.2s; text-decoration: none; display: inline-block; text-align: center; }
        .btn-primary { background: linear-gradient(135deg, #1a365d 0%, #334155 100%); color: white; }
        .btn-primary:hover:not(:disabled) { box-shadow: 0 4px 12px rgba(26, 54, 93, 0.25); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary:focus { outline: 2px solid #1a365d; outline-offset: 2px; }
        .btn-secondary { background: #f1f5f9; color: #475569; border: 1px solid #cbd5e1; }
        .btn-secondary:hover { background: #e2e8f0; border-color: #94a3b8; }
        .results { display: none; }
        .results.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .result-card { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border-radius: 20px; padding: 50px 40px; text-align: center; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(26, 54, 93, 0.3); }
        .result-card h2 { font-size: clamp(2.5em, 6vw, 4em); margin-bottom: 20px; }
        .result-card .subtitle { font-size: clamp(1.2em, 3vw, 1.6em); opacity: 0.95; margin-bottom: 30px; }
        
        /* Flippable Detail Cards */
        .details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin: 30px 0; }
        .flip-card { perspective: 1000px; height: 350px; cursor: pointer; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .flip-card-front { background: white; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; }
        .flip-card-back { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); transform: rotateY(180deg); overflow-y: auto; }
        .flip-card-front h3 { color: #1a365d; margin-bottom: 20px; font-size: 1.5em; display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .flip-card-front .summary { color: #64748b; line-height: 1.7; font-size: 1.05em; margin-bottom: 20px; }
        .flip-card-front .flip-hint { color: #94a3b8; font-size: 0.85em; margin-top: auto; display: flex; align-items: center; gap: 5px; }
        .flip-card-back h3 { color: #1a365d; margin-bottom: 20px; font-size: 1.4em; border-bottom: 2px solid #1a365d; padding-bottom: 10px; font-weight: 600; }
        .flip-card-back .detail-section { margin-bottom: 20px; }
        .flip-card-back .detail-section h4 { color: #1e293b; font-size: 1em; margin-bottom: 10px; font-weight: 600; }
        .flip-card-back ul { list-style: none; padding-left: 0; }
        .flip-card-back li { color: #64748b; font-size: 0.95em; line-height: 1.6; margin-bottom: 10px; padding-left: 20px; position: relative; }
        .flip-card-back li:before { content: "‚úì"; position: absolute; left: 0; color: #1a365d; font-weight: bold; }
        
        .details-card { background: white; border-radius: 15px; padding: 30px; margin-bottom: 20px; }
        .details-card h3 { color: #1a365d; margin-bottom: 15px; font-size: 1.4em; font-weight: 600; }
        .details-card p, .details-card ul { color: #64748b; line-height: 1.8; font-size: 1.05em; }
        .details-card ul { list-style-position: inside; padding-left: 0; }
        .details-card li { margin-bottom: 10px; }
        .insight-card { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-left: 4px solid #1a365d; padding: 20px; margin-top: 25px; border-radius: 10px; animation: slideIn 0.4s ease; }
        .insight-icon { font-size: 2rem; margin-bottom: 10px; }
        .insight-title { color: #1a365d; font-size: 1.1em; font-weight: bold; margin-bottom: 12px; }
        .insight-content { color: #475569; line-height: 1.7; margin-bottom: 12px; }
        .insight-quote { font-style: italic; color: #64748b; font-size: 0.95em; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 3px solid #1a365d; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .cta-box { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border-radius: 15px; padding: 30px; text-align: center; margin-top: 30px; }
        .cta-box h3 { margin-bottom: 15px; font-size: 1.6em; }
        .cta-box p { margin-bottom: 20px; opacity: 0.95; }
        .hidden { display: none; }
        
        /* Hide email capture by default - only show after results */
        #email-capture-container {
            display: none !important;
        }
        #email-capture-container.visible {
            display: block !important;
        }
        
        @media (max-width: 768px) { .header, .assessment-card { padding: 25px 20px; } .nav-buttons { flex-direction: column; } .btn { width: 100%; } .result-card { padding: 30px 20px; } }

        /* üéÆ GAMIFICATION STYLES */
        .achievement-toast { position: fixed; top: 80px; right: 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 20px 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4); z-index: 2000; display: none; animation: slideInRight 0.5s ease-out; max-width: 300px; }
        .achievement-toast.show { display: block; }
        .achievement-toast .icon { font-size: 2em; margin-bottom: 10px; }
        .achievement-toast .title { font-weight: bold; font-size: 1.1em; margin-bottom: 5px; }
        .achievement-toast .description { font-size: 0.9em; opacity: 0.95; }
        @keyframes slideInRight { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .confetti { position: fixed; width: 10px; height: 10px; background: #f0f; position: absolute; animation: confetti-fall 3s linear forwards; }
        @keyframes confetti-fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
        .xp-bar { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: white; padding: 12px 20px; border-radius: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); z-index: 1100; display: none; min-width: 250px; }
        .xp-bar.show { display: block; }
        .xp-bar .level { font-weight: bold; color: #f59e0b; margin-bottom: 5px; font-size: 0.9em; }
        .xp-bar .progress-container { height: 8px; background: #e5e7eb; border-radius: 10px; overflow: hidden; position: relative; }
        .xp-bar .progress-fill { height: 100%; background: linear-gradient(90deg, #f59e0b, #fbbf24); border-radius: 10px; transition: width 0.5s ease-out; }
        .xp-bar .xp-text { font-size: 0.8em; color: #64748b; margin-top: 5px; text-align: center; }
        .achievements-section { background: white; border-radius: 20px; padding: 30px; margin-top: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .achievements-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 20px; }
        .badge { background: #f8fafc; border-radius: 15px; padding: 20px; text-align: center; transition: all 0.3s; border: 2px solid transparent; }
        .badge.unlocked { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-color: #f59e0b; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.2); }
        .badge.locked { opacity: 0.5; filter: grayscale(1); }
        .badge .icon { font-size: 3em; margin-bottom: 10px; }
        .badge .name { font-weight: bold; font-size: 0.9em; color: #1a365d; margin-bottom: 5px; }
        .badge .description { font-size: 0.75em; color: #64748b; }
        .streak-badge { position: fixed; top: 80px; left: 20px; background: white; padding: 15px 20px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); z-index: 1100; display: none; }
        .streak-badge.show { display: block; }
        .streak-badge .fire { font-size: 2em; margin-bottom: 5px; }
        .streak-badge .count { font-size: 1.5em; font-weight: bold; color: #f59e0b; }
        .streak-badge .label { font-size: 0.8em; color: #64748b; }
        
        /* Belt Journey Teaser */
        .belt-teaser { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 20px; padding: 2.5rem; margin: 2rem 0; border-left: 5px solid #f59e0b; }
        .belt-teaser h3 { color: #1a365d; font-size: 1.6rem; margin-bottom: 1rem; }
        .belt-teaser .subtitle { color: #64748b; font-size: 1.05rem; margin-bottom: 1.5rem; line-height: 1.7; }
        .belt-preview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin: 1.5rem 0; }
        .belt-mini { text-align: center; padding: 1rem; background: white; border-radius: 12px; transition: transform 0.2s; }
        .belt-mini:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .belt-mini .icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .belt-mini .name { font-size: 0.85rem; font-weight: 600; color: #1e293b; }
        .belt-mini .focus { font-size: 0.75rem; color: #64748b; }
        .teaser-cta { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; margin-top: 1.5rem; }
        .teaser-cta h4 { margin-bottom: 0.75rem; }
        .teaser-cta p { opacity: 0.95; margin-bottom: 1rem; font-size: 0.95rem; }
        .teaser-cta a { display: inline-block; background: white; color: #1a365d; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s; }
        .teaser-cta a:hover { background: #f8fafc; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255,255,255,0.3); }
    
        /* Hide email capture by default - only show after results */
        #email-capture-container {
            display: none !important;
        }
        
        /* Only show when explicitly shown via JavaScript */
        #email-capture-container.visible {
            display: block !important;
        }
    
    </style>
    <link rel="canonical" href="https://tap-in-platform.netlify.app/worker-type-assessment.html">

<body>
    <!-- language switcher (EN / DE) -->
    <div id="lang-switch" style="position:fixed;top:16px;right:16px;z-index:1200;font-family:inherit;">
        <div style="background:white;border-radius:999px;padding:8px 12px;box-shadow:0 6px 20px rgba(0,0,0,0.15);font-size:0.95em;">
            <a href="worker-type-assessment.html" style="color:#1a365d;text-decoration:none;font-weight:700;margin-right:10px;">EN</a>
            <a href="worker-type-assessment.de.html" style="color:#64748b;text-decoration:none;font-weight:700;border-left:1px solid #eee;padding-left:10px;margin-left:10px;">DE</a>
        </div>
    </div>

    <!-- üéÆ GAMIFICATION ELEMENTS -->
    <div class="xp-bar" id="xpBar">
        <div class="level" id="levelText">Level 1: Worker Explorer</div>
        <div class="progress-container"><div class="progress-fill" id="xpProgress" style="width: 0%"></div></div>
        <div class="xp-text" id="xpText">0 / 100 XP</div>
    </div>
    <div class="streak-badge" id="streakBadge">
        <div class="fire">üî•</div>
        <div class="count" id="streakCount">0</div>
        <div class="label">day streak</div>
    </div>
    <div class="achievement-toast" id="achievementToast">
        <div class="icon" id="achievementIcon">üèÜ</div>
        <div class="title" id="achievementTitle">Achievement Unlocked!</div>
        <div class="description" id="achievementDesc">You earned a new badge</div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 data-i18n="worker_header">üéØ Sales Profile Assessment - Stage 1</h1>
        </div>

        <!-- Context Section -->
        <div class="intro-section" id="introSection" style="background: #f8fafc; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #1a365d;">
            <h3 style="color: #1e293b; margin-bottom: 15px; font-weight: 600;">üìã What to Expect</h3>
            <p style="color: #64748b; line-height: 1.7; margin-bottom: 15px;">
                This brief assessment helps us determine if there's a strong initial match 
                between your natural work style and our sales role. Takes 3 minutes.
            </p>
            <p style="color: #64748b; line-height: 1.7; margin-bottom: 20px;">
                <strong>Qualified candidates proceed to Stage 2</strong> (10-minute detailed profile).
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin: 20px 0;">
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border-top: 3px solid #1a365d;">
                    <div style="font-size: 2em; margin-bottom: 5px;">‚ö°</div>
                    <strong style="color: #1a365d;">Sprinter</strong><br>
                    <span style="font-size: 0.85em; color: #64748b;">High intensity, short bursts</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border-top: 3px solid #1a365d;">
                    <div style="font-size: 2em; margin-bottom: 5px;">üèÉ</div>
                    <strong style="color: #1a365d;">Jogger</strong><br>
                    <span style="font-size: 0.85em; color: #64748b;">Steady, consistent pace</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border-top: 3px solid #1a365d;">
                    <div style="font-size: 2em; margin-bottom: 5px;">üéØ</div>
                    <strong style="color: #1a365d;">Ultrarunner</strong><br>
                    <span style="font-size: 0.85em; color: #64748b;">Marathon mindset, long vision</span>
                </div>
            </div>

            <p style="margin-top: 15px; font-style: italic; color: #94a3b8; font-size: 0.9em; text-align: center;">"The key is not to prioritize what's on your schedule, but to schedule your priorities." ‚Äî Stephen Covey</p>
            
            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="startAssessment()" style="font-size: 1.2em; padding: 18px 40px;">
                    Start Assessment ‚Üí
                </button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Question 1 of 10</div>
        </div>

        <!-- Assessment Form -->
        <div id="assessmentForm" style="display: none;">
            <div class="assessment-card" id="questionCard">
                <!-- Questions will be dynamically inserted here -->
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;" data-i18n="prev_btn">‚Üê Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled data-i18n="next_btn">Next ‚Üí</button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="results" style="display: none;">
            <div class="assessment-card">
                <div id="resultContent"></div>
                
                <!-- CTA -->
                <div class="cta-box">
                    <h3>Want to Optimize Your Team?</h3>
                    <p>Discover how to build balanced teams with the right mix of Sprinters, Joggers, and Ultrarunners.</p>
                    <a href="mailto:contact@tap-in-academy.com?subject=Team%20Optimization%20Strategy%20Session" class="btn" style="background: white; color: #1a365d;" data-i18n="schedule_session">üìÖ Schedule Strategy Session</a>
                    <div style="margin-top: 20px;">
                        <a href="index.html" class="btn" style="background: transparent; border: 2px solid white; color: white;" data-i18n="back_to_assessments">‚Üê Back to Assessments</a>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // Educational insights for each question
        // Insights removed for Stage 1
        

        // Hardcoded English questions for robust static behavior
        const questions = [
            {
                id: 1,
                text: "In sales, I perform best with:",
                type: "choice",
                options: [
                    { text: "Fast-paced, quick wins (sprinter)", value: 7, key: "sprinter" },
                    { text: "Steady rhythm, consistent pipeline (jogger)", value: 10, key: "jogger" },
                    { text: "Long relationship building (ultra)", value: 3, key: "ultra" }
                ]
            },
            {
                id: 2,
                text: "My ideal sales cycle is:",
                type: "choice",
                options: [
                    { text: "1-2 weeks (short)", value: 7, key: "short" },
                    { text: "1-3 months (medium)", value: 10, key: "medium" },
                    { text: "6+ months (long)", value: 3, key: "long" }
                ]
            },
            {
                id: 3,
                text: "When presenting to potential clients, I naturally:",
                type: "choice",
                options: [
                    { text: "Confidently guide the conversation (assertive)", value: 10, key: "assertive" },
                    { text: "Listen carefully and adapt (empathetic)", value: 6, key: "empathetic" },
                    { text: "Present data and facts (analytical)", value: 4, key: "analytical" }
                ]
            },
            {
                id: 4,
                text: "After hearing 'no' from a prospect, I typically:",
                type: "choice",
                options: [
                    { text: "Move to the next opportunity immediately", value: 10, key: "quick" },
                    { text: "Review what went wrong briefly", value: 5, key: "reflect" },
                    { text: "Need time to recharge", value: 2, key: "slow" }
                ]
            },
            {
                id: 5,
                text: "What excites me most about sales is:",
                type: "choice",
                options: [
                    { text: "Hitting targets and winning", value: 10, key: "achievement" },
                    { text: "Helping customers solve problems", value: 7, key: "service" },
                    { text: "Building long-term relationships", value: 6, key: "relationships" }
                ]
            },
            {
                id: 6,
                text: "In a competitive sales environment, I:",
                type: "choice",
                options: [
                    { text: "Thrive and push to be #1", value: 10, key: "competitive" },
                    { text: "Perform well but prefer collaboration", value: 6, key: "collaborative" },
                    { text: "Feel stressed by competition", value: 2, key: "stressed" }
                ]
            },
            {
                id: 7,
                text: "When it's time to close, I:",
                type: "choice",
                options: [
                    { text: "Directly ask for the commitment", value: 10, key: "direct" },
                    { text: "Guide them to the decision gently", value: 6, key: "gentle" },
                    { text: "Present the logical next step", value: 4, key: "logical" }
                ]
            },
            {
                id: 8,
                text: "My ideal prospecting approach is:",
                type: "choice",
                options: [
                    { text: "High volume, many calls daily", value: 8, key: "volume" },
                    { text: "Targeted, consistent outreach", value: 10, key: "targeted" },
                    { text: "Deep research, few perfect calls", value: 4, key: "research" }
                ]
            },
            {
                id: 9,
                text: "My energy at work is typically:",
                type: "choice",
                options: [
                    { text: "High bursts, need variety", value: 7, key: "bursts" },
                    { text: "Steady and predictable", value: 10, key: "steady" },
                    { text: "Deep focus for long periods", value: 5, key: "deep" }
                ]
            },
            {
                id: 10,
                text: "When I lose a big deal to a competitor:",
                type: "choice",
                options: [
                    { text: "Analyze quickly and win the next one", value: 10, key: "resilient" },
                    { text: "Feel frustrated but recover", value: 5, key: "moderate" },
                    { text: "Question my approach", value: 2, key: "sensitive" }
                ]
            }
        ];

        let currentQuestion = 0;
        let answers = {};
                    // Progress Saving System
                    const STORAGE_KEY = 'worker-type-progress';
                    
                    function saveProgress() {
                        const progressData = {
                            currentQuestion,
                            answers,
                            timestamp: new Date().toISOString(),
                            version: '3.0.0'
                        };
                        try {
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(progressData));
                        } catch (e) {
                            console.log('Could not save progress');
                        }
                    }
                    
                    function loadProgress() {
                        try {
                            const saved = localStorage.getItem(STORAGE_KEY);
                            if (saved) {
                                const data = JSON.parse(saved);
                                const savedDate = new Date(data.timestamp);
                                const daysSince = (new Date() - savedDate) / (1000 * 60 * 60 * 24);
                                if (daysSince < 7 && data.version === '3.0.0') {
                                    return data;
                                }
                            }
                        } catch (e) {
                            console.log('Could not load progress');
                        }
                        return null;
                    }
                    
                    function clearProgress() {
                        try {
                            localStorage.removeItem(STORAGE_KEY);
                        } catch (e) {}
                    }
                    
                    function showResumePrompt() {
                        const saved = loadProgress();
                        if (!saved) return;
                        
                        const completedQuestions = Object.keys(saved.answers).length;
                        const totalQuestions = 12;
                        const percentage = Math.round((completedQuestions / totalQuestions) * 100);
                        
                        const resumeHTML = `
                            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s ease;" id="resumeModal">
                                <div style="background: white; border-radius: 20px; padding: 40px; max-width: 500px; text-align: center; animation: slideUp 0.3s ease;">
                                    <div style="font-size: 3em; margin-bottom: 20px;">üéØ</div>
                                    <h2 style="color: #1a365d; margin-bottom: 15px;">Welcome Back!</h2>
                                    <p style="color: #64748b; font-size: 1.1em; margin-bottom: 10px;">You've already completed <strong>${completedQuestions} of ${totalQuestions} questions</strong></p>
                                    <div style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 20px; border-radius: 12px; margin: 20px 0;">
                                        <div style="font-size: 2.5em; font-weight: bold; color: #1a365d; margin-bottom: 5px;">${percentage}%</div>
                                        <div style="color: #64748b;">Progress Complete</div>
                                    </div>
                                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                                        <button onclick="resumeAssessment()" style="flex: 1; background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border: none; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer;">
                                            ‚ñ∂Ô∏è Resume
                                        </button>
                                        <button onclick="startFresh()" style="flex: 1; background: white; color: #64748b; border: 2px solid #e2e8f0; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer;">
                                            üîÑ Start Over
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        document.body.insertAdjacentHTML('beforeend', resumeHTML);
                    }
                    
                    function resumeAssessment() {
                        const saved = loadProgress();
                        if (saved) {
                            currentQuestion = saved.currentQuestion;
                            answers = saved.answers;
                            document.getElementById('resumeModal')?.remove();
                            document.getElementById('introSection').style.display = 'none';
                            document.querySelector('.progress-container').style.display = 'block';
                            document.getElementById('assessmentForm').style.display = 'block';
                            renderQuestion();
                            updateProgress();
                        }
                    }
                    
                    function startFresh() {
                        clearProgress();
                        currentQuestion = 0;
                        answers = {};
                        document.getElementById('resumeModal')?.remove();
                        document.getElementById('introSection').style.display = 'none';
                        document.querySelector('.progress-container').style.display = 'block';
                        document.getElementById('assessmentForm').style.display = 'block';
                        renderQuestion();
                        updateProgress();
                    }
                
            function startAssessment() {
                // Reset to first question
                currentQuestion = 0;
                answers = {};
                
                // Hide intro, show assessment form
                document.getElementById('introSection').style.display = 'none';
                document.querySelector('.progress-container').style.display = 'block';
                const assessmentForm = document.getElementById('assessmentForm');
                if (assessmentForm) {
                    assessmentForm.style.display = 'block';
                    assessmentForm.classList.remove('hidden');
                }
                
                // Hide results
                const results = document.getElementById('results');
                if (results) {
                    results.style.display = 'none';
                    results.classList.remove('active');
                }
                
                // Render first question
                renderQuestion();
                updateProgress();
            }

        function renderQuestion() {
            const q = questions[currentQuestion];
            const card = document.getElementById('questionCard');
            
            const introSection = document.getElementById('introSection');
            if (introSection) {
                introSection.style.display = 'none';
            }
            
            let html = '';
            html += `
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">${currentQuestion + 1}.</span>
                        ${q.text}
                    </div>
                    <div class="options">
            `;
            q.options.forEach((opt) => {
                const answer = answers[currentQuestion];
                const isSelected = answer && (answer.value === opt.value || answer === opt.value);
                const selected = isSelected ? 'selected' : '';
                html += `
                    <label class="option ${selected}" onclick="selectOption(this, ${opt.value}, '${opt.key}')">
                        <input type="radio" name="q${currentQuestion}" value="${opt.value}">
                        <div class="option-label">${opt.text}</div>
                    </label>
                `;
            });
            html += `
                    </div>
                </div>
            `;
            if (!card) {
                console.error('[Assessment] questionCard element not found!');
                return;
            }
            
            if (!q) {
                console.error('[Assessment] Question not found at index:', currentQuestion);
                return;
            }
            
            card.innerHTML = html;
            card.style.display = 'block';
            
            // Scroll to question
            setTimeout(() => {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
            updateProgress();
            updateButtons();
        }
        function selectOption(el, value, key) {
                answers[currentQuestion] = { value: value, key: key };
                saveProgress();
                document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                if (el && el.classList) el.classList.add('selected');
                const input = el.querySelector('input[type="radio"]');
                if (input) input.checked = true;
                document.getElementById('nextBtn').disabled = false;
            }

            function updateProgress() {
                const progress = ((currentQuestion + 1) / questions.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressText').textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
            }

            function updateButtons() {
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const prevText = '‚Üê Previous';
                const nextText = 'Next ‚Üí';
                const seeResultsText = 'See Results ‚Üí';
                prevBtn.style.display = currentQuestion > 0 ? 'block' : 'none';
                prevBtn.textContent = prevText;
                nextBtn.textContent = currentQuestion === questions.length - 1 ? seeResultsText : nextText;
                nextBtn.disabled = !answers.hasOwnProperty(currentQuestion);
            }

            function nextQuestion() {
                if (currentQuestion < questions.length - 1) {
                    currentQuestion++;
                    renderQuestion();
                    window.scrollTo(0, 0);
                } else {
                    showResults();
                }
            }

            function previousQuestion() {
                if (currentQuestion > 0) {
                    currentQuestion--;
                    renderQuestion();
                    window.scrollTo(0, 0);
                }
            }

            
        function calculateStage1Score() {
            let totalScore = 0;
            Object.keys(answers).forEach(idx => {
                const answer = answers[parseInt(idx)];
                if (answer && typeof answer === 'object' && answer.value) {
                    totalScore += answer.value;
                } else if (answer && typeof answer === 'number') {
                    totalScore += answer;
                }
            });
            
            let recommendation, action, color, message, nextStep;
            
            if (totalScore >= 85) {
                recommendation = "EXCELLENT FIT";
                action = "SEND_STAGE_2";
                color = "green";
                message = "Strong potential match! Please proceed to Stage 2.";
                nextStep = "stage2";
            } else if (totalScore >= 70) {
                recommendation = "GOOD FIT";
                action = "REVIEW_CV";
                color = "yellow";
                message = "Promising profile. We'll review your CV and be in touch.";
                nextStep = "review";
            } else if (totalScore >= 55) {
                recommendation = "MAYBE";
                action = "REVIEW_CV";
                color = "yellow";
                message = "Some strengths shown. We'll review carefully.";
                nextStep = "review";
            } else {
                recommendation = "NOT RECOMMENDED";
                action = "POLITE_REJECT";
                color = "red";
                message = "Thank you for your interest. Your profile doesn't closely match this role.";
                nextStep = "reject";
            }
            
            return { totalScore, recommendation, action, color, message, nextStep };
        }
        
        function calculateCategoryScores() {
            const getAnswerValue = (qId) => {
                const answer = answers[qId - 1];
                if (!answer) return 0;
                return typeof answer === 'object' ? answer.value : answer;
            };
            
            return {
                workStyle: getAnswerValue(1) + getAnswerValue(2) + getAnswerValue(8) + getAnswerValue(9),
                communication: getAnswerValue(3) + getAnswerValue(7),
                motivation: getAnswerValue(5) + getAnswerValue(6),
                resilience: getAnswerValue(4) + getAnswerValue(10)
            };
        }
        
        function saveStage1Results(results) {
            const categoryScores = calculateCategoryScores();
            const data = {
                assessmentType: 'sales-recruiting-stage1',
                completedDate: new Date().toISOString(),
                totalScore: results.totalScore,
                recommendation: results.recommendation,
                action: results.action,
                questionScores: Object.keys(answers).map(idx => {
                    const answer = answers[parseInt(idx)];
                    const q = questions[parseInt(idx)];
                    return {
                        questionId: q.id,
                        value: typeof answer === 'object' ? answer.value : answer,
                        key: typeof answer === 'object' ? answer.key : null
                    };
                }),
                categoryScores: categoryScores
            };
            
            localStorage.setItem('salesRecruitingStage1', JSON.stringify(data));
        }
        
    function showResults() {
                clearProgress();
                
                const results = calculateStage1Score();
                saveStage1Results(results);
                
                document.getElementById('assessmentForm').classList.add('hidden');
                document.getElementById('introSection').style.display = 'none';
                document.getElementById('results').classList.add('active');
                
                // Initialize email capture after results are shown
                if (typeof window.initEmailCapture === 'function') {
                    setTimeout(() => {
                        window.initEmailCapture();
                    }, 1000);
                }
                
                const badgeColor = results.color === 'green' ? '#10b981' :
                                  results.color === 'yellow' ? '#f59e0b' : '#ef4444';
                
                const categoryScores = calculateCategoryScores();
                
                document.getElementById('resultContent').innerHTML = `
                    <div class="result-card" style="background: linear-gradient(135deg, ${badgeColor} 0%, ${badgeColor}dd 100%);">
                        <h2>üéØ Your Stage 1 Results</h2>
                        <div style="margin: 2rem 0;">
                            <div style="font-size: 4em; font-weight: bold; margin-bottom: 0.5rem;">${results.totalScore}</div>
                            <div style="font-size: 1.2em; opacity: 0.9;">out of 100</div>
                        </div>
                    </div>
                    
                    <div class="assessment-card" style="margin-top: 2rem;">
                        <div class="recommendation-badge" style="background: ${badgeColor}; color: white; padding: 1.5rem; border-radius: 12px; text-align: center; margin-bottom: 2rem;">
                            <h2 style="color: white; margin: 0; font-size: 1.8em;">${results.recommendation}</h2>
                        </div>
                        
                        <div class="next-steps-card" style="background: #f8fafc; padding: 2rem; border-radius: 12px; margin-bottom: 2rem;">
                            <h3 style="color: #1a365d; margin-bottom: 1rem;">üìç Next Steps</h3>
                            <p style="color: #64748b; line-height: 1.7; margin-bottom: 1.5rem;">${results.message}</p>
                            ${results.nextStep === 'stage2' ? `
                                <button class="btn btn-primary" onclick="window.location.href='sales-recruiting-stage2.html'" style="font-size: 1.1em; padding: 1rem 2rem;">
                                    Proceed to Stage 2 Assessment ‚Üí
                                </button>
                            ` : ''}
                        </div>
                        
                        <div class="score-breakdown" style="margin-top: 2rem;">
                            <h3 style="color: #1a365d; margin-bottom: 1.5rem;">Score Breakdown</h3>
                            <div class="category-scores" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="category-score" style="background: #f8fafc; padding: 1.5rem; border-radius: 8px;">
                                    <div style="color: #64748b; font-size: 0.9em; margin-bottom: 0.5rem;">Work Style</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #1a365d;">${categoryScores.workStyle}/30</div>
                                </div>
                                <div class="category-score" style="background: #f8fafc; padding: 1.5rem; border-radius: 8px;">
                                    <div style="color: #64748b; font-size: 0.9em; margin-bottom: 0.5rem;">Communication</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #1a365d;">${categoryScores.communication}/30</div>
                                </div>
                                <div class="category-score" style="background: #f8fafc; padding: 1.5rem; border-radius: 8px;">
                                    <div style="color: #64748b; font-size: 0.9em; margin-bottom: 0.5rem;">Motivation</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #1a365d;">${categoryScores.motivation}/20</div>
                                </div>
                                <div class="category-score" style="background: #f8fafc; padding: 1.5rem; border-radius: 8px;">
                                    <div style="color: #64748b; font-size: 0.9em; margin-bottom: 0.5rem;">Resilience</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #1a365d;">${categoryScores.resilience}/20</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <a href="business-portal.html" class="btn btn-secondary">‚Üê Back to Business Portal</a>
                        </div>
                    </div>
                `;
                
                window.scrollTo(0, 0);
            }                document.querySelector('.result-card').focus?.();
                
                // Initialize social sharing
                const workerType = type.toLowerCase();
                const percentage = type === 'Sprinter' ? sprintPct : (type === 'Jogger' ? jogPct : ultraPct);
                setTimeout(() => initializeSocialSharing(workerType, percentage), 500);
            }

            // Social Sharing Functions
            let currentProfile = {};

            function initializeSocialSharing(workerType, percentage) {
                currentProfile = { workerType, percentage };
                generateShareCard();
            }

            function generateShareCard() {
                const canvas = document.createElement('canvas');
                canvas.width = 1200;
                canvas.height = 630;
                const ctx = canvas.getContext('2d');

                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#1a365d');
                gradient.addColorStop(1, '#0f1f3d');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
                for (let i = 0; i < 20; i++) {
                    ctx.fillRect(i * 60, 0, 30, canvas.height);
                }

                ctx.fillStyle = 'white';
                ctx.font = 'bold 64px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial';
                ctx.textAlign = 'center';
                
                const typeData = {
                    sprinter: { icon: '‚ö°', name: 'SPRINTER' },
                    jogger: { icon: 'üèÉ', name: 'JOGGER' },
                    ultrarunner: { icon: 'üèÉ‚Äç‚ôÄÔ∏è', name: 'ULTRARUNNER' }
                };

                ctx.fillText('My Worker Type:', canvas.width / 2, 200);
                
                ctx.font = 'bold 90px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial';
                ctx.fillText(typeData[currentProfile.workerType].icon + ' ' + typeData[currentProfile.workerType].name, canvas.width / 2, 340);
                
                ctx.font = 'bold 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial';
                ctx.fillText(Math.round(currentProfile.percentage) + '% Match', canvas.width / 2, 430);

                ctx.font = '32px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.fillText('What\'s YOUR Work Type?', canvas.width / 2, 550);

                const shareCanvas = document.getElementById('shareCanvas');
                if (shareCanvas) {
                    shareCanvas.innerHTML = `<img src="${canvas.toDataURL()}" style="width: 100%; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);" alt="Share card" loading="lazy">`;
                }
            }

            function getShareText() {
                const typeNames = {
                    sprinter: 'Sprinter',
                    jogger: 'Jogger',
                    ultrarunner: 'Ultrarunner'
                };

                return `I just discovered I'm a ${typeNames[currentProfile.workerType]} (${Math.round(currentProfile.percentage)}% match)!

My work style:
‚Ä¢ High-intensity bursts or steady consistency?
‚Ä¢ Quick wins or long-term vision?
‚Ä¢ Crisis energy or sustainable pace?

This free assessment revealed how I naturally work best.

What's YOUR worker type?`;
            }

            function shareToLinkedIn() {
                const text = encodeURIComponent(getShareText());
                const url = encodeURIComponent(window.location.href);
                window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&summary=${text}`, '_blank');
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'share', {
                        'event_category': 'Social',
                        'event_label': 'LinkedIn_Worker',
                        'value': 1
                    });
                }
            }

            function shareToTwitter() {
                const text = encodeURIComponent(getShareText());
                const url = encodeURIComponent(window.location.href);
                window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}&hashtags=WorkStyle,Productivity`, '_blank');
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'share', {
                        'event_category': 'Social',
                        'event_label': 'Twitter_Worker',
                        'value': 1
                    });
                }
            }

            function copyShareLink() {
                const shareText = getShareText() + '\n\n' + window.location.href;
                navigator.clipboard.writeText(shareText).then(() => {
                    const btn = event.target;
                    const originalText = btn.textContent;
                    btn.textContent = '‚úì Copied!';
                    btn.style.background = '#10b981';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = 'rgba(255,255,255,0.2)';
                    }, 2000);
                    
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'share', {
                            'event_category': 'Social',
                            'event_label': 'Copy_Link_Worker',
                            'value': 1
                        });
                    }
                });
            }

            document.addEventListener('DOMContentLoaded', function() {
                showResumePrompt();
            });
    
    // Export Functions (Option 1: Client-Side CSV/XLSX)
    function addExportButtons(data) {
        const exportHTML = `
            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 30px; margin: 30px 0; text-align: center; border: 2px solid #e0e0e0;">
                <h3 style="color: #333; margin-bottom: 15px;">üìä Export Your Results</h3>
                <p style="color: #666; margin-bottom: 20px;">Download your complete assessment results for analysis, reporting, or personal records.</p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="exportToCSV()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                        üì• Download CSV
                    </button>
                    <button onclick="exportToExcel()" style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);">
                        üìä Download Excel
                    </button>
                    <button onclick="exportToJSON()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
                        üíæ Download JSON
                    </button>
                </div>
                <p style="color: #999; margin-top: 15px; font-size: 0.9em;">Your data stays private - all exports happen directly in your browser.</p>
            </div>
        `;
        const resultContainer = document.getElementById('resultContent') || document.querySelector('.result-display') || document.querySelector('.results-container');
        if (resultContainer) {
            resultContainer.insertAdjacentHTML('beforeend', exportHTML);
        }
    }
    
    function exportToCSV() {
        const data = gatherExportData();
        const csv = convertToCSV(data);
        downloadFile(csv, 'assessment-results-' + Date.now() + '.csv', 'text/csv');
        trackExport('CSV');
    }
    
    function exportToExcel() {
        const data = gatherExportData();
        const ws = XLSX.utils.json_to_sheet(data.details || [data]);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Assessment Results");
        
        // Add summary sheet if categories exist
        if (data.categories && data.categories.length > 0) {
            const summaryData = [{
                'Assessment Date': data.timestamp,
                'Overall Score': (data.totalScore || data.score) + '/' + (data.maxScore || 100),
                'Level': data.levelText || data.type || ''
            }];
            data.categories.forEach(cat => {
                summaryData[0][cat.name + ' Score'] = cat.score + '/' + cat.maxScore;
            });
            const summaryWs = XLSX.utils.json_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, summaryWs, "Summary");
        }
        
        XLSX.writeFile(wb, 'assessment-results-' + Date.now() + '.xlsx');
        trackExport('Excel');
    }
    
    function exportToJSON() {
        const data = gatherExportData();
        const json = JSON.stringify(data, null, 2);
        downloadFile(json, 'assessment-results-' + Date.now() + '.json', 'application/json');
        trackExport('JSON');
    }
    
    function convertToCSV(data) {
        let csv = (data.assessmentType || 'Assessment') + ' Results\n';
        csv += `Date,${data.timestamp}
`;
        csv += `Score,${(data.totalScore || data.score)}/${(data.maxScore || 100)}
`;
        csv += `Level,${data.levelText || data.type || ''}
`;
        csv += '\n';
        
        if (data.categories && data.categories.length > 0) {
            csv += 'Category Scores\n';
            csv += 'Category,Score,Max,Percentage\n';
            data.categories.forEach(cat => {
                csv += `${cat.name},${cat.score},${cat.maxScore},${cat.percentage}%
`;
            });
            csv += '\n';
        }
        
        if (data.details && data.details.length > 0) {
            csv += 'Detailed Responses\n';
            const headers = Object.keys(data.details[0]);
            csv += headers.join(',') + '\n';
            data.details.forEach(row => {
                const values = headers.map(h => {
                    let v = row[h];
                    if (typeof v === 'string') v = v.replace(/"/g, '""');
                    return `"${v}"`;
                });
                csv += values.join(',') + '\n';
            });
        }
        
        return csv;
    }
    
    function downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }
    
    function trackExport(format) {
        if (typeof gtag !== 'undefined') {
            gtag('event', 'export_data', {
                'event_category': 'Data Export',
                'event_label': format + '_Assessment',
                'value': 1
            });
        }
    }
    
    // Backend data collection (Google Sheets + Database)
    async function saveAssessmentData(data) {
        const GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE';
        
        try {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    ...data,
                    userAgent: navigator.userAgent,
                    language: navigator.language
                })
            });
        } catch (error) {
            console.log('Google Sheets not configured');
        }
        
        try {
            await fetch('/.netlify/functions/save-assessment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
        } catch (error) {
            console.log('Database not configured');
        }
        
        try {
            const existing = JSON.parse(localStorage.getItem('tap-in-assessments') || '[]');
            existing.push({ ...data, id: Date.now() });
            if (existing.length > 10) existing.shift();
            localStorage.setItem('tap-in-assessments', JSON.stringify(existing));
        } catch (e) {}
    }

    // üéÆ GAMIFICATION SYSTEM
    const GAMIFICATION = {
        xp: 0, level: 1, xpPerQuestion: 15, xpForCompletion: 100,
        achievements: {
            'first_start': { icon: 'üéØ', name: 'Worker Explorer', desc: 'Started worker type assessment', unlocked: false },
            'halfway': { icon: 'üí™', name: 'Halfway Hero', desc: 'Answered 5 questions', unlocked: false },
            'complete': { icon: 'üèÜ', name: 'Work Style Master', desc: 'Completed assessment', unlocked: false },
            'speed_demon': { icon: '‚ö°', name: 'Speed Demon', desc: 'Completed in under 3 minutes', unlocked: false }
        },
        load() {
            const saved = localStorage.getItem('tapinGamificationWorker');
            if (saved) {
                const data = JSON.parse(saved);
                this.xp = data.xp || 0;
                this.level = data.level || 1;
                this.achievements = { ...this.achievements, ...data.achievements };
            }
            this.updateXPBar();
            this.showStreak();
        },
        save() {
            localStorage.setItem('tapinGamificationWorker', JSON.stringify({
                xp: this.xp, level: this.level, achievements: this.achievements, lastVisit: new Date().toISOString()
            }));
        },
        addXP(amount) {
            this.xp += amount;
            this.updateXPBar();
            this.checkLevelUp();
            this.save();
        },
        updateXPBar() {
            const xpForNextLevel = this.level * 100;
            const progress = (this.xp / xpForNextLevel) * 100;
            document.getElementById('xpProgress').style.width = Math.min(progress, 100) + '%';
            document.getElementById('xpText').textContent = `${this.xp} / ${xpForNextLevel} XP`;
            document.getElementById('levelText').textContent = `Level ${this.level}: ${this.getLevelName()}`;
            document.getElementById('xpBar').classList.add('show');
        },
        getLevelName() {
            if (this.level === 1) return 'Worker Explorer';
            if (this.level === 2) return 'Work Style Seeker';
            if (this.level === 3) return 'Performance Master';
            return 'Productivity Legend';
        },
        checkLevelUp() {
            const xpForNextLevel = this.level * 100;
            if (this.xp >= xpForNextLevel) {
                this.level++;
                this.xp = this.xp - xpForNextLevel;
                this.showAchievement('üéä', 'Level Up!', `You're now ${this.getLevelName()}!`);
            }
        },
        showAchievement(icon, title, desc) {
            const toast = document.getElementById('achievementToast');
            document.getElementById('achievementIcon').textContent = icon;
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = desc;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        },
        unlockAchievement(key) {
            if (!this.achievements[key].unlocked) {
                this.achievements[key].unlocked = true;
                const ach = this.achievements[key];
                this.showAchievement(ach.icon, ach.name, ach.desc);
                this.addXP(50);
                this.save();
            }
        },
        showStreak() {
            const streak = parseInt(localStorage.getItem('tapinStreakWorker') || '0');
            if (streak > 0) {
                document.getElementById('streakCount').textContent = streak;
                document.getElementById('streakBadge').classList.add('show');
            }
        }
    };

    GAMIFICATION.load();
    GAMIFICATION.unlockAchievement('first_start');

    let questionsAnsweredWorker = 0;
    const originalSelectOption = window.selectOption;
    window.selectOption = function(option) {
        if (originalSelectOption) originalSelectOption(option);
        questionsAnsweredWorker++;
        GAMIFICATION.addXP(GAMIFICATION.xpPerQuestion);
        if (questionsAnsweredWorker === 5) GAMIFICATION.unlockAchievement('halfway');
    };

    function celebrateCompletion() {
        GAMIFICATION.addXP(GAMIFICATION.xpForCompletion);
        GAMIFICATION.unlockAchievement('complete');
        const colors = ['#f59e0b', '#10b981', '#8b5cf6', '#ef4444', '#3b82f6', '#ec4899'];
        for (let i = 0; i < 100; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * window.innerWidth + 'px';
                confetti.style.top = '-10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }, i * 30);
        }
    }

    function addAchievementBadges() {
        const achievementsHtml = `
            <div class="achievements-section">
                <h3>üèÜ Your Achievements</h3>
                <div class="achievements-grid">
                    ${Object.entries(GAMIFICATION.achievements).map(([key, ach]) => `
                        <div class="badge ${ach.unlocked ? 'unlocked' : 'locked'}">
                            <div class="icon">${ach.icon}</div>
                            <div class="name">${ach.name}</div>
                            <div class="description">${ach.desc}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        document.getElementById('results').innerHTML += achievementsHtml;
    }

    const originalShowResults = window.showResults;
    window.showResults = function() {
        if (originalShowResults) originalShowResults();
        celebrateCompletion();
        addAchievementBadges();
    };

    </script>

    <!-- Gamification System -->
    <!-- Performance Optimizer - Load First -->
<script src="js/performance-optimizer.min.js"></script>

    <script src="js/gamification.js" defer></script>
    <script src="js/assessment-completion-helper.js" defer></script>
<!-- TAP-IN Utilities -->
<script src="js/shared-utilities.js"></script>
<script src="js/global-error-handler.min.js"></script>
<script src="js/storage-health.min.js"></script>
    <!-- TAP-IN Core Modules -->
    <script src="js/language-switcher.min.js"></script>
    <script src="js/meta-tags-manager.js"></script>
    <script src="js/achievement-badges.js"></script>
    <script src="js/structured-data.js"></script>

    <!-- Email Capture Component -->
    <script src="js/email-capture-component.js"></script>
    <script>
        // Initialize email capture after results are shown
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for results to be displayed
            function initializeEmailCapture() {
                const resultsContainer = document.querySelector('.results-container') || 
                                       document.querySelector('.assessment-results') ||
                                       document.querySelector('.results-section') ||
                                       document.getElementById('results');
                
                if (resultsContainer && typeof EmailCaptureComponent !== 'undefined') {
                    // Extract results data
                    const assessmentType = 'worker-type-assessment';
                    
                    // Try to get results from common patterns
                    let results = {};
                    let scores = {};
                    
                    // Check for belt assessment results
                    const beltElement = document.querySelector('[data-belt]') || 
                                      document.querySelector('.belt-result');
                    if (beltElement) {
                        results.belt = beltElement.textContent.match(/(White|Blue|Purple|Brown|Black)/)?.[1] || 'White';
                    }
                    
                    // Check for score displays
                    const scoreElements = document.querySelectorAll('[data-score], .score');
                    scoreElements.forEach(el => {
                        const key = el.dataset.score || el.className.replace('score', '').trim();
                        const value = parseInt(el.textContent) || 0;
                        if (key) scores[key] = value;
                    });
                    
                    // Initialize email capture
                    EmailCaptureComponent.init({
                        assessmentType: assessmentType,
                        results: results,
                        scores: scores,
                        showDelay: 3000 // Show form 3 seconds after results
                    });
                } else {
                    // Retry after a short delay
                    
                }
            }
            
            // Initialize after results function runs
            // This will be called by the assessment's showResults function
            window.initEmailCapture = initializeEmailCapture;
            
            // CRITICAL: Do NOT auto-initialize email capture on page load
            // It will only be initialized when showResults() calls initEmailCapture()
            // Email capture should ONLY appear after assessment completion
            
            // DO NOT auto-initialize - only call from showResults() function
            // Email capture will be initialized after assessment completion
            
            // DO NOT auto-initialize on page load - only initialize when results are shown
            // The showResults() function will call initEmailCapture() when ready
        });
    </script>

    <!-- Focus Management for Accessibility -->
    <script src="js/focus-management.js" defer></script>

    <!-- Screen Reader Enhancements for Accessibility -->
    <script src="js/screen-reader-enhancements.js" defer></script>
</body>
</html>
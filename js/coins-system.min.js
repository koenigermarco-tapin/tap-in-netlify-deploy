const CoinsSystem={EXCHANGE_RATE:.8,MIN_CONVERSION_XP:100,getCoins:function(){return parseInt(localStorage.getItem("tapInCoins")||"0")},addCoins:function(n){const t=this.getCoins()+n;return localStorage.setItem("tapInCoins",t.toString()),this.logTransaction(n,"earned",t),t},spendCoins:function(n){const t=this.getCoins();if(t<n)return{success:!1,error:"Insufficient coins"};const o=t-n;return localStorage.setItem("tapInCoins",o.toString()),this.logTransaction(-n,"spent",o),{success:!0,newBalance:o}},convertXPToCoins:function(n){const t=parseInt(localStorage.getItem("totalXP")||"0");if(n<this.MIN_CONVERSION_XP)return{success:!1,error:`Minimum conversion is ${this.MIN_CONVERSION_XP} XP`};if(n>t)return{success:!1,error:"Not enough XP to convert"};const o=Math.floor(n*this.EXCHANGE_RATE),e=t-n;localStorage.setItem("totalXP",e.toString());const s=this.addCoins(o);return this.logConversion(n,o,e,s),window.AVATAR_SYSTEM&&"function"==typeof window.AVATAR_SYSTEM.update&&window.AVATAR_SYSTEM.update(),{success:!0,coinsEarned:o,newXP:e,newCoins:s}},logTransaction:function(n,t,o){const e=JSON.parse(localStorage.getItem("coinTransactions")||"[]");e.push({amount:n,type:t,balance:o,timestamp:(new Date).toISOString()}),e.length>100&&e.shift(),localStorage.setItem("coinTransactions",JSON.stringify(e))},logConversion:function(n,t,o,e){const s=JSON.parse(localStorage.getItem("xpToCoinsConversions")||"[]");s.push({xpAmount:n,coinsEarned:t,exchangeRate:this.EXCHANGE_RATE,newXP:o,newCoins:e,timestamp:(new Date).toISOString()}),s.length>50&&s.shift(),localStorage.setItem("xpToCoinsConversions",JSON.stringify(s))},getConversionPreview:function(n){return n<this.MIN_CONVERSION_XP?null:Math.floor(n*this.EXCHANGE_RATE)},formatCoins:function(n){return n.toLocaleString()+" ðŸª™"},canAfford:function(n){return this.getCoins()>=n}};window.CoinsSystem=CoinsSystem,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){console.log("ðŸª™ Coins System initialized. Balance:",CoinsSystem.getCoins())}):console.log("ðŸª™ Coins System initialized. Balance:",CoinsSystem.getCoins());
class PerformanceOptimizer{constructor(){this.cache={},this.pendingWrites=[],this.batchTimeout=null}batchRead(t){const e={};return t.forEach(t=>{if(void 0===this.cache[t])try{this.cache[t]=localStorage.getItem(t)}catch(e){console.warn("localStorage read failed:",e),this.cache[t]=null}e[t]=this.cache[t]}),e}batchWrite(t,e){this.cache[t]=e,this.pendingWrites.push({key:t,value:e}),this.batchTimeout&&clearTimeout(this.batchTimeout),this.batchTimeout=setTimeout(()=>{this.flushWrites()},100)}flushWrites(){this.pendingWrites.forEach(({key:t,value:e})=>{try{localStorage.setItem(t,e)}catch(t){console.warn("localStorage write failed:",t)}}),this.pendingWrites=[]}clearCache(){this.cache={}}}window.PerfOpt=new PerformanceOptimizer,window.getGamificationDataOptimized=function(){const t=window.PerfOpt.batchRead(["tapinTotalXP","tapinCurrentStreak","tapinLongestStreak","tapinLastVisit","tapinCurrentBelt","tapinCompletedStripes","tapinCompletedLessons"]);return{totalXP:parseInt(t.tapinTotalXP||"0"),currentStreak:parseInt(t.tapinCurrentStreak||"0"),longestStreak:parseInt(t.tapinLongestStreak||"0"),lastVisit:t.tapinLastVisit||null,currentBelt:t.tapinCurrentBelt||"white",completedStripes:JSON.parse(t.tapinCompletedStripes||"[]"),completedLessons:JSON.parse(t.tapinCompletedLessons||"[]")}},"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{window.XPSystem&&window.XPSystem.init()},100)});
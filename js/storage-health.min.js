const StorageHealth={checkHealth(){const t={available:!0,usage:0,quota:0,percentage:0,warnings:[]};try{const e="__tapin_storage_test__";localStorage.setItem(e,"test"),localStorage.removeItem(e);let a=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(a+=localStorage[t].length+t.length);const o=5242880,l=a/o*100;t.usage=a,t.quota=o,t.percentage=Math.round(l),l>80&&t.warnings.push("Storage is nearly full. Consider clearing old data."),l>90&&t.warnings.push("Storage is critically full. Backup recommended.")}catch(e){t.available=!1,t.warnings.push("localStorage is not available or full.")}return t},backup(){const t={timestamp:Date.now(),data:{}};try{for(let e in localStorage)(localStorage.hasOwnProperty(e)&&e.startsWith("tapin")||e.includes("Belt")||e.includes("XP")||e.includes("Streak"))&&(t.data[e]=localStorage.getItem(e));return localStorage.setItem("tapin_backup",JSON.stringify(t)),t}catch(t){return console.error("Backup failed:",t),null}},restore(t=null){try{const e=t||JSON.parse(localStorage.getItem("tapin_backup")||"{}");if(!e.data)return console.warn("No backup data found"),!1;for(let t in e.data)localStorage.setItem(t,e.data[t]);return!0}catch(t){return console.error("Restore failed:",t),!1}},cleanup(t=30){const e=Date.now()-24*t*60*60*1e3;let a=0;try{for(let t in localStorage)if(localStorage.hasOwnProperty(t)){const o=localStorage.getItem(t);try{const l=JSON.parse(o);l.timestamp&&l.timestamp<e&&(localStorage.removeItem(t),a++)}catch(t){}}return a}catch(t){return console.error("Cleanup failed:",t),0}},getStats(){const t={totalKeys:0,tapinKeys:0,totalSize:0,tapinSize:0};try{for(let e in localStorage)if(localStorage.hasOwnProperty(e)){const a=localStorage[e].length+e.length;t.totalKeys++,t.totalSize+=a,(e.startsWith("tapin")||e.includes("Belt")||e.includes("XP")||e.includes("Streak"))&&(t.tapinKeys++,t.tapinSize+=a)}}catch(t){console.error("Stats calculation failed:",t)}return t}};"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",()=>{const t=localStorage.getItem("tapin_last_backup"),e=Date.now();(!t||e-parseInt(t)>864e5)&&(StorageHealth.backup(),localStorage.setItem("tapin_last_backup",e.toString()))}),window.StorageHealth=StorageHealth;
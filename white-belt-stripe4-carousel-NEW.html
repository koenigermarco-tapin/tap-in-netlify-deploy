<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#1a365d">
    <title>ü§ç White Belt Stripe 4: Mission & Purpose - How You Show Up - TAP-IN</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a365d 0%, #7c3aed 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 25px; border-bottom: 3px solid #f0f0f0; }
        .header h1 { color: #1a365d; font-size: 2.3em; margin-bottom: 15px; }
        .header .subtitle { color: #666; font-size: 1.1em; margin-bottom: 10px; }
        .header .duration { color: #999; font-size: 0.9em; font-style: italic; }
        
        .progress-bar { position: sticky; top: 10px; background: white; padding: 15px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; }
        .progress-text { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 8px; }
        .progress-fill { height: 8px; background: #e0e0e0; border-radius: 10px; overflow: hidden; }
        .progress-fill-bar { background: linear-gradient(90deg, #1a365d 0%, #7c3aed 100%); height: 100%; width: 0%; transition: width 0.3s ease; }
        
        .section-header { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; }
        .section-header h3 { font-size: 1.2em; margin-bottom: 5px; }
        .section-header .section-desc { font-size: 0.9em; opacity: 0.95; font-style: italic; }
        
        .question-card { background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 20px; }
        .question-number { color: #1a365d; font-weight: bold; font-size: 0.9em; margin-bottom: 10px; }
        .question-text { font-size: 1.2em; color: #333; margin-bottom: 25px; font-weight: 500; line-height: 1.5; }
        
        .scale-options { display: flex; justify-content: space-between; align-items: flex-end; gap: 2px; flex-wrap: nowrap; height: 140px; position: relative; background: linear-gradient(to top right, rgba(26, 54, 93, 0.1) 0%, rgba(124, 58, 237, 0.05) 50%, transparent 50%); border-radius: 8px; padding: 5px; cursor: pointer; user-select: none; }
        .scale-option { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; background: linear-gradient(135deg, rgba(26, 54, 93, 0.15) 0%, rgba(124, 58, 237, 0.1) 100%); border: 3px solid #cbd5e1; border-radius: 6px; transition: all 0.15s ease; position: relative; z-index: 1; padding: 10px 5px; }
        .scale-option:nth-child(1) { height: 50px; opacity: 0.15; }
        .scale-option:nth-child(2) { height: 70px; opacity: 0.35; }
        .scale-option:nth-child(3) { height: 90px; opacity: 0.55; }
        .scale-option:nth-child(4) { height: 110px; opacity: 0.75; }
        .scale-option:nth-child(5) { height: 130px; opacity: 0.85; }
        .scale-option span { font-size: 1.3em; font-weight: 800; color: #1e293b; opacity: 1; margin-bottom: 5px; }
        .scale-option small { font-size: 0.7em; color: #475569; font-weight: 600; opacity: 1; text-align: center; line-height: 1.2; }
        .scale-option:hover { transform: scale(1.05); border-color: #1a365d; }
        .scale-option.active, .scale-option.selected { background: linear-gradient(135deg, #1a365d 0%, #7c3aed 100%); color: white; border-color: #0f1f3d; box-shadow: 0 2px 8px rgba(26, 54, 93, 0.4); }
        .scale-option.active ~ .scale-option { background: linear-gradient(135deg, rgba(26, 54, 93, 0.15) 0%, rgba(124, 58, 237, 0.1) 100%); color: #333; }
        .scale-option.active span, .scale-option.selected span { color: white; }
        .scale-option.active small, .scale-option.selected small { color: rgba(255,255,255,0.9); }
        
        .insight-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-left: 4px solid #1a365d; padding: 20px; margin: 20px 0; border-radius: 10px; animation: slideIn 0.4s ease; }
        .insight-icon { font-size: 2rem; margin-bottom: 10px; }
        .insight-title { color: #1a365d; font-size: 1.1em; font-weight: bold; margin-bottom: 12px; }
        .insight-content { color: #555; line-height: 1.7; margin-bottom: 12px; }
        .insight-quote { font-style: italic; color: #666; font-size: 0.95em; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 3px solid #1a365d; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Scenario Question Styles */
        .scenario-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .scenario-option {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .scenario-option:hover {
            border-color: #667eea;
            background: #f0f0ff;
            transform: translateX(5px);
        }
        .scenario-option.selected {
            border-color: #667eea;
            background: #e8e8ff;
        }
        .scenario-option.correct {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        .scenario-option.correct .option-letter {
            background: #10b981;
        }
        .scenario-option.incorrect {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        }
        .scenario-option.incorrect .option-letter {
            background: #ef4444;
        }
        .scenario-option.neutral {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        .scenario-option.neutral .option-letter {
            background: #f59e0b;
        }
        .option-letter {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .option-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            padding-top: 8px;
        }
        .scenario-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .scenario-insight {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid #3b82f6;
        }
        
        /* Multiple Choice Styles */
        .mc-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .mc-option {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .mc-option:hover {
            border-color: #667eea;
            background: #fafbff;
            transform: translateX(3px);
        }
        .mc-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        .mc-radio {
            padding-top: 2px;
        }
        .mc-radio input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            cursor: pointer;
        }
        .mc-content {
            flex: 1;
        }
        .mc-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            margin-bottom: 6px;
        }
        .mc-type {
            color: #667eea;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .mc-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .mc-insight {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid #10b981;
        }
        .mc-type-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg) translateX(200px);
                opacity: 0;
            }
        }
        .milestone-content button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .fun-fact-box {
            animation: slideIn 0.4s ease;
        }
        
        @media (max-width: 768px) {
            .scenario-option {
                padding: 12px 15px;
                gap: 12px;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            .option-text {
                font-size: 0.9rem;
            }
            .mc-option {
                padding: 15px;
            }
            .mc-text {
                font-size: 0.9rem;
            }
        }
        
        .nav-buttons { display: flex; gap: 15px; justify-content: space-between; margin-top: 25px; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.2s; font-weight: 600; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-primary { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(26, 54, 93, 0.4); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .results-container { display: none; }
        .results-container.active { display: block; }
        .overall-score { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border-radius: 20px; padding: 40px; text-align: center; margin-bottom: 30px; }
        .score-number { font-size: 4em; font-weight: bold; margin-bottom: 10px; }
        .score-label { font-size: 1.3em; opacity: 0.95; }
        .type-card { background: #f8f9fa; padding: 30px; border-radius: 15px; margin: 20px 0; border-left: 4px solid #1a365d; }
        .type-card h3 { color: #1a365d; margin-bottom: 15px; font-size: 1.5em; }
        .type-card ul { list-style: none; padding-left: 0; }
        .type-card li { padding: 8px 0; padding-left: 25px; position: relative; color: #555; line-height: 1.7; }
        .type-card li:before { content: "‚Üí"; position: absolute; left: 0; color: #1a365d; font-weight: bold; }
        .cta-box { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border-radius: 15px; padding: 30px; text-align: center; margin-top: 30px; }
        .cta-box h3 { font-size: 1.6em; margin-bottom: 15px; }
        .cta-box p { font-size: 1em; margin-bottom: 20px; opacity: 0.95; }
        .cta-btn { background: white; color: #1a365d; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: bold; display: inline-block; transition: all 0.2s; }
        .cta-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(255,255,255,0.3); }
        
        .tap-out-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
        }
        .tap-out-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.6);
        }
        @media (max-width: 768px) {
            .container { padding: 25px; }
            .header h1 { font-size: 2em; }
            .scale-option small { font-size: 0.65em; }
            .tap-out-button {
                top: 10px;
                right: 10px;
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }
    
        /* ============= NUMBERED OPTION BOX READABILITY FIX ============= */
        .scale-option,
        .rating-option,
        .numbered-option,
        .option-number,
        [data-value="1"],
        [data-value="2"],
        [data-value="3"],
        [data-value="4"],
        [data-value="5"] {
            color: #FFFFFF !important;
            font-weight: 700 !important;
            font-size: 1.1rem !important;
            background: #1e293b !important;
            border: 2px solid #475569 !important;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5) !important;
        }
        .scale-option:hover,
        .rating-option:hover,
        .numbered-option:hover,
        .option-number:hover,
        [data-value]:hover {
            background: #334155 !important;
            border-color: #667eea !important;
            color: #FFFFFF !important;
            transform: scale(1.05) !important;
        }
        .scale-option.selected,
        .rating-option.selected,
        .numbered-option.selected,
        .option-number.selected,
        [data-value].selected {
            background: #667eea !important;
            border-color: #818cf8 !important;
            color: #FFFFFF !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
        }
        .scale-label,
        .rating-label,
        .option-label {
            color: #FFFFFF !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
            text-align: center !important;
            margin-top: 0.5rem !important;
        }
        .scale-container,
        .rating-container,
        .options-row {
            display: flex !important;
            justify-content: space-between !important;
            gap: 0.75rem !important;
            margin: 1.5rem 0 !important;
        }
        .scale-container > *,
        .rating-container > *,
        .options-row > * {
            flex: 1 !important;
            min-width: 60px !important;
            text-align: center !important;
            padding: 1rem 0.5rem !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        @media (max-width: 768px) {
            .scale-option,
            .rating-option,
            .numbered-option,
            .option-number,
            [data-value] {
                font-size: 1rem !important;
                padding: 0.75rem 0.25rem !important;
                min-width: 50px !important;
            }
            .scale-label,
            .rating-label,
            .option-label {
                font-size: 0.75rem !important;
            }
        }
        input[type="range"] {
            -webkit-appearance: none !important;
            width: 100% !important;
            height: 8px !important;
            background: #334155 !important;
            border-radius: 5px !important;
            outline: none !important;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none !important;
            width: 24px !important;
            height: 24px !important;
            background: #667eea !important;
            cursor: pointer !important;
            border-radius: 50% !important;
            border: 3px solid #FFFFFF !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px !important;
            height: 24px !important;
            background: #667eea !important;
            cursor: pointer !important;
            border-radius: 50% !important;
            border: 3px solid #FFFFFF !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
        .slider-value,
        .range-value {
            display: block !important;
            text-align: center !important;
            font-size: 1.5rem !important;
            font-weight: 700 !important;
            color: #667eea !important;
            margin-top: 1rem !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2) !important;
        }
        .slider-labels {
            display: flex !important;
            justify-content: space-between !important;
            margin-top: 0.5rem !important;
        }
        .slider-labels span {
            font-size: 0.85rem !important;
            color: #cbd5e1 !important;
            font-weight: 600 !important;
        }

    </style>
</head>
<body>
    <!-- TAP OUT Button -->
    <button class="tap-out-button" onclick="tapOut()" id="tapOutBtn" style="display: none;">
        <div class="tap-icon">ü•ã</div>
        <div class="tap-text">TAP</div>
    </button>
    
    <!-- Language Switcher -->
    <div style="position:fixed;top:16px;right:16px;z-index:1200;">
        <div style="background:white;border-radius:999px;padding:8px 12px;box-shadow:0 6px 20px rgba(0,0,0,0.15);font-size:0.95em;">
            <a href="white-belt-stripe4-carousel-NEW.html" style="color:#1a365d;text-decoration:none;font-weight:700;margin-right:10px;">EN</a>
            <a href="white-belt-stripe4-carousel-NEW-de.html" style="color:#333;text-decoration:none;font-weight:700;border-left:1px solid #eee;padding-left:10px;margin-left:10px;">DE</a>
        </div>
    </div>

    <div class="container">
        <!-- Assessment Form -->
        <div id="assessmentForm">
            <div class="header">
                <h1>ü§ç White Belt - Stripe 4: Mission & Purpose</h1>
                <p class="subtitle">Discover Your Mission, How You Show Up & Your Legacy</p>
                <p class="duration">‚è±Ô∏è 5-7 Minutes ‚Ä¢ 15 Questions</p>
            </div>

            <!-- Intro Section -->
            <div id="introSection" style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #1a365d;">
                <h3 style="color: #333; margin-bottom: 15px;">üéØ Mission - Your North Star</h3>
                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>You can't lead others if you don't know where you're going.</strong> This assessment reveals your mission clarity, how you want to show up in the world, and what legacy you're building. Understanding your purpose is the foundation for making decisions that matter, not just decisions that work.
                </p>
                
                <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #1a365d;">
                    <p style="font-style: italic; color: #555; margin-bottom: 10px;">
                        "Every gym has a philosophy‚ÄîGracie Jiu-Jitsu emphasizes self-defense, 10th Planet emphasizes creativity. Your mission is your martial arts philosophy."
                    </p>
                    <p style="text-align: right; color: #888; font-size: 0.9em;">‚Äî BJJ Wisdom</p>
                </div>

                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>Research from Harvard Business Review</strong> shows that people with clear mission statements have 50% higher life satisfaction and 40% better decision-making. This assessment helps you:
                </p>
                <ul style="color: #666; line-height: 1.8; margin-left: 20px; margin-bottom: 15px;">
                    <li>Clarify your personal mission and purpose</li>
                    <li>Understand how you want to show up in relationships</li>
                    <li>Define the legacy you're building</li>
                    <li>Make decisions aligned with your deepest values</li>
                </ul>

                <p style="color: #666; line-height: 1.7; margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px; font-size: 0.95em;">
                    <strong>ü•ã In BJJ:</strong> Just like every gym has a philosophy, every leader needs a mission. Your mission is your North Star‚Äîit guides every decision, every relationship, every day. This assessment helps you find yours.
                </p>
                
                <button onclick="startAssessment()" style="background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(26, 54, 93, 0.3); display: block; margin: 20px auto 0; width: auto;">
                    Start Assessment ‚Üí
                </button>
            </div>

            <div class="progress-bar" style="display: none;" id="progressBarContainer">
                <div class="progress-text"><span id="currentSection">Mission & Purpose</span> ‚Ä¢ Question <span id="currentQ">1</span> of 15</div>
                <div class="progress-fill">
                    <div class="progress-fill-bar" id="progressBar"></div>
                </div>
            </div>

            <div id="questionContainer" style="display: none;"></div>

            <div class="nav-buttons" style="display: none;" id="navButtons">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" disabled>‚Üê Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next ‚Üí</button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="results-container">
            <div class="header">
                <h1>ü§ç Your Mission & Purpose Profile</h1>
            </div>

            <div class="overall-score" id="typeResultCard">
                <div class="score-number" id="typeEmoji">üéØ</div>
                <div class="score-label" id="typeLabel">Calculating...</div>
            </div>

            <div id="typeDetails"></div>

            <div class="cta-box">
                <h3>ü§ç White Belt Stripe 4 Complete!</h3>
                <p>You now understand your mission and how you want to show up. Ready to test your White Belt knowledge?</p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                    <a href="white-belt-graduation-assessment.html" class="cta-btn" style="margin: 0;">Take Graduation Assessment ‚Üí</a>
                    <a href="gym-dashboard.html" class="cta-btn" style="background: rgba(255,255,255,0.2); border: 2px solid white; margin: 0;">Back to The Gym</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            // MISSION & PURPOSE (5 questions)
            {
                section: 'Mission & Purpose',
                sectionDesc: 'Your "why" and the impact you want to have',
                question: 'When you think about why you\'re here, you...',
                category: 'mission'
            },
            {
                question: 'The impact I want to have on others is...',
                category: 'impact'
            },
            {
                question: 'I\'m most drawn to solving problems related to...',
                category: 'problems'
            },
            {
                question: 'How often do you think about how you can contribute to others\' growth?',
                category: 'contribution'
            },
            {
                question: 'What drives you most deeply?',
                category: 'drive'
            },
            // HOW YOU SHOW UP (5 questions)
            {
                section: 'How You Show Up',
                sectionDesc: 'Your character, presence, and how you want to be known',
                question: 'I want to be known as someone who...',
                category: 'reputation'
            },
            {
                question: 'The character traits I most consistently demonstrate are...',
                category: 'character'
            },
            {
                question: 'My natural leadership style is...',
                category: 'leadership'
            },
            {
                question: 'I help others most by...',
                category: 'helping'
            },
            {
                question: 'In relationships, I\'m known for being...',
                category: 'presence'
            },
            // LEGACY & LONG-TERM (5 questions)
            {
                section: 'Legacy & Long-term',
                sectionDesc: 'What you\'re building and how you want to be remembered',
                question: 'If people remember one thing about me, I want it to be...',
                category: 'legacy'
            },
            {
                question: 'My 10-year vision is...',
                category: 'vision'
            },
            {
                question: 'At the end of my life, what will matter most is...',
                category: 'endoflife'
            },
            {
                question: 'My time is spent more on...',
                category: 'building'
            },
            {
                question: 'I see myself as someone who...',
                category: 'creating'
            }
        ];

        const insights = [
            // MISSION & PURPOSE INSIGHTS (5)
            { icon: 'üéØ', title: 'Your "Why" is Your North Star', content: 'Your "why" is your North Star‚Äîit guides every decision. <strong>Research shows</strong> that people with clear purpose have 50% higher life satisfaction. In BJJ: Every gym has a philosophy‚ÄîGracie Jiu-Jitsu emphasizes self-defense, 10th Planet emphasizes creativity. Your mission is your martial arts philosophy.', quote: '"Your mission is your martial arts philosophy. It guides every technique, every roll, every day." - BJJ Wisdom' },
            { icon: 'üåü', title: 'Impact Clarity Drives Decisions', content: 'Impact clarity drives daily decisions. <strong>Studies show</strong> that people who know their impact make better choices. In BJJ: Black belts create other black belts. Your legacy is who you help develop.', quote: '"Black belts create other black belts. Your legacy is who you help develop." - BJJ Philosophy' },
            { icon: 'üîß', title: 'Your Problem Space Reveals Your Mission', content: 'Your problem space reveals your mission. <strong>Research shows</strong> that people who focus on specific problems have 40% better outcomes. In BJJ: Some focus on takedowns, some on guard, some on submissions. Specialization comes from knowing what problems fascinate you.', quote: '"Specialization comes from knowing what problems fascinate you." - BJJ Strategy' },
            { icon: 'ü§ù', title: 'Contribution Mindset', content: 'Contribution mindset shifts from "what can I get" to "what can I give". <strong>Research shows</strong> that people with contribution mindsets have 60% better relationships. In BJJ: The best training partners make YOU better. That\'s the ultimate contribution.', quote: '"The best training partners make YOU better. That\'s the ultimate contribution." - BJJ Wisdom' },
            { icon: 'üí™', title: 'Your Deepest Driver', content: 'Your deepest driver reveals your true mission. <strong>Studies show</strong> that people driven by purpose have 50% better resilience. In BJJ: Why do you train? Belt color? Fitness? Self-defense? Competition? Community? Your "why" determines your training approach.', quote: '"Your \'why\' determines your training approach. Same with your mission." - BJJ Philosophy' },
            
            // HOW YOU SHOW UP INSIGHTS (5)
            { icon: 'üèÜ', title: 'Desired Reputation Guides Behavior', content: 'Your desired reputation guides daily behavior. <strong>Research shows</strong> that people who clarify how they want to be known make better decisions. In BJJ: Your reputation on the mat is earned through consistent behavior‚Äîtough, technical, humble, aggressive. How do you want to be known?', quote: '"Your reputation on the mat is earned through consistent behavior." - BJJ Wisdom' },
            { icon: 'üíé', title: 'Character is Consistency', content: 'Character is what you do when no one\'s watching. <strong>Studies show</strong> that people with strong character have 40% better outcomes. In BJJ: You can\'t fake character on the mat. When you\'re exhausted, your true self shows up.', quote: '"You can\'t fake character on the mat. When you\'re exhausted, your true self shows up." - BJJ Philosophy' },
            { icon: 'üëë', title: 'Leadership is Influence', content: 'Leadership isn\'t about title, it\'s about influence. <strong>Research shows</strong> that people who lead by example have 50% better team outcomes. In BJJ: Purple belts lead by example on the mat. They don\'t need to be instructors to lead.', quote: '"Purple belts lead by example. They don\'t need to be instructors to lead." - BJJ Wisdom' },
            { icon: 'üéÅ', title: 'Your Unique Help Signature', content: 'Your unique help signature is your contribution. <strong>Studies show</strong> that people who know their contribution style have 60% better relationships. In BJJ: Some help with technique, some with mindset, some with encouragement. What\'s your signature contribution?', quote: '"What\'s your signature contribution? Technique? Mindset? Encouragement?" - BJJ Philosophy' },
            { icon: 'üéØ', title: 'Presence is the Ultimate Gift', content: 'Presence is the ultimate gift you give others. <strong>Research shows</strong> that people who are present have 50% better relationships. In BJJ: When you roll, you\'re 100% present. That full presence is what relationships need too.', quote: '"When you roll, you\'re 100% present. That full presence is what relationships need too." - BJJ Wisdom' },
            
            // LEGACY & LONG-TERM INSIGHTS (5)
            { icon: 'üìú', title: 'Legacy is Built Daily', content: 'Legacy is built daily through small decisions. <strong>Research shows</strong> that people who think about legacy make better long-term decisions. In BJJ: Legends aren\'t remembered for their win record. They\'re remembered for how they changed the game and treated others.', quote: '"Legends aren\'t remembered for their win record. They\'re remembered for how they changed the game." - BJJ Philosophy' },
            { icon: 'üîÆ', title: 'Long-term Thinking Changes Decisions', content: 'Long-term thinking changes short-term decisions. <strong>Studies show</strong> that people with 10-year visions make better daily choices. In BJJ: Ultrarunners think in decades. Jeff Bezos asked "What won\'t change in 10 years?" and built Amazon around that.', quote: '"What won\'t change in 10 years? Build around that." - Long-term Strategy' },
            { icon: '‚ö∞Ô∏è', title: 'Death-bed Perspective Clarifies', content: 'Death-bed perspective clarifies what truly matters. <strong>Research shows</strong> that people who think about end-of-life make better priorities. In BJJ: No one on their deathbed wishes they spent more time at the office. They wish they trained more, loved more, lived more fully.', quote: '"No one wishes they spent more time at the office. They wish they lived more fully." - Life Wisdom' },
            { icon: 'üèóÔ∏è', title: 'Creators Build Legacy', content: 'Creators build legacy, consumers don\'t. <strong>Studies show</strong> that people who create have 40% better life satisfaction. In BJJ: You can watch BJJ videos all day, but you only get better by getting on the mat and creating your game.', quote: '"You can watch all day, but you only get better by creating your game." - BJJ Philosophy' },
            { icon: 'üõ§Ô∏è', title: 'Leaders Create Paths', content: 'Leaders create paths, managers follow them. Both are needed. <strong>Research shows</strong> that people who create paths have 50% better innovation. In BJJ: Some learn established techniques, some innovate new ones. Eddie Bravo created 10th Planet by asking "what if?" That\'s creation.', quote: '"Eddie Bravo created 10th Planet by asking \'what if?\' That\'s creation." - BJJ Innovation' }
        ];

        const sectionIntros = {
            'Mission & Purpose': `
                <strong>Why mission and purpose matter:</strong> Research from Harvard Business Review shows that <strong>people with clear mission statements have 50% higher life satisfaction</strong>. Your mission is your North Star‚Äîit guides every decision, every relationship, every day.
                <br><br>
                <strong>The key insight:</strong> You can't lead others if you don't know where you're going. You can't make meaningful decisions if you don't know your purpose. Mission isn't what you say‚Äîit's what you do.
                <br><br>
                <strong>ü•ã In BJJ:</strong> Every gym has a philosophy‚ÄîGracie Jiu-Jitsu emphasizes self-defense, 10th Planet emphasizes creativity. Your mission is your martial arts philosophy. It guides every technique, every roll, every day.
            `,
            'How You Show Up': `
                <strong>Why how you show up matters:</strong> Research shows that <strong>people who clarify how they want to be known make 40% better decisions</strong>. Your character, your presence, your reputation‚Äîthese are built daily through small actions.
                <br><br>
                <strong>The key insight:</strong> Character is what you do when no one's watching. Presence is the ultimate gift you give others. Leadership isn't about title‚Äîit's about influence.
                <br><br>
                <strong>ü•ã In BJJ:</strong> Your reputation on the mat is earned through consistent behavior‚Äîtough, technical, humble, aggressive. How do you want to be known? That guides how you show up.
            `,
            'Legacy & Long-term': `
                <strong>Why legacy and long-term thinking matter:</strong> Research shows that <strong>people who think about legacy make 50% better long-term decisions</strong>. Legacy isn't built at the end‚Äîit's built daily through small decisions.
                <br><br>
                <strong>The key insight:</strong> Long-term thinking changes short-term decisions. Death-bed perspective clarifies what truly matters. Creators build legacy, consumers don't.
                <br><br>
                <strong>ü•ã In BJJ:</strong> Legends aren't remembered for their win record. They're remembered for how they changed the game and treated others. That's legacy.
            `
        };

        // TAP OUT Configuration
        const currentStripeName = 'whiteBeltStripe4';
        const totalQuestions = 15;
        
        let currentQuestionIndex = 0;
        let answers = {};
        
        // TAP OUT function
        function tapOut() {
            const confirmed = confirm(
                "ü•ã TAP OUT\n\n" +
                "Your progress will be saved.\n" +
                "You can continue from Question " + (currentQuestionIndex + 1) + " anytime.\n\n" +
                "Return to Gym Dashboard?"
            );
            
            if (!confirmed) return;
            
            // Save progress
            const progressData = {
                stripe: currentStripeName,
                currentQuestion: currentQuestionIndex + 1,
                questionIndex: currentQuestionIndex,
                answers: answers,
                timestamp: Date.now(),
                partialComplete: true,
                totalQuestions: totalQuestions
            };
            
            localStorage.setItem('currentProgress', JSON.stringify(progressData));
            
            // Show toast
            showToast("‚úÖ Progress saved! See you soon.");
            
            // Redirect to gym
            setTimeout(() => {
                window.location.href = 'gym-dashboard.html';
            }, 1000);
        }
        
        // Toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 16px 32px;
                border-radius: 50px;
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
                z-index: 10000;
                font-weight: 600;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }
        
        // Check for saved progress on load
        function checkForSavedProgress() {
            const saved = localStorage.getItem('currentProgress');
            if (!saved) return false;
            
            try {
                const progress = JSON.parse(saved);
                
                // Check if this is the right stripe
                if (progress.stripe !== currentStripeName) return false;
                
                // Check if recent (within 7 days)
                const daysSince = (Date.now() - progress.timestamp) / (1000 * 60 * 60 * 24);
                if (daysSince > 7) {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
                
                // Ask to resume
                const resume = confirm(
                    "ü•ã WELCOME BACK!\n\n" +
                    "You were on Question " + progress.currentQuestion + " of " + (progress.totalQuestions || totalQuestions) + ".\n" +
                    "Resume where you left off?"
                );
                
                if (resume) {
                    currentQuestionIndex = progress.questionIndex || (progress.currentQuestion - 1);
                    answers = progress.answers || {};
                    return true;
                } else {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
            } catch (e) {
                console.error('Error loading saved progress:', e);
                return false;
            }
        }
        
        // Save progress after each answer
        function saveProgress() {
            const progressData = {
                stripe: currentStripeName,
                currentQuestion: currentQuestionIndex + 1,
                questionIndex: currentQuestionIndex,
                answers: answers,
                timestamp: Date.now(),
                partialComplete: true,
                totalQuestions: totalQuestions
            };
            localStorage.setItem('currentProgress', JSON.stringify(progressData));
        }
        
        // Clear progress on completion
        function clearProgress() {
            localStorage.removeItem('currentProgress');
        }
        
        function startAssessment() {
            // Track start time for speed achievements
            localStorage.setItem('assessmentStartTime', Date.now().toString());
            
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('progressBarContainer').style.display = 'block';
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('navButtons').style.display = 'flex';
            document.getElementById('tapOutBtn').style.display = 'flex';
            
            // Check for saved progress
            const resumed = checkForSavedProgress();
            if (resumed) {
                renderQuestion(currentQuestionIndex);
                updateProgress();
            } else {
                currentQuestionIndex = 0;
                answers = {};
                renderQuestion(0);
            }
        }

        let isDragging = false;

        function renderQuestion(index) {
            const q = questions[index];
            
            // Handle different question types
            if (q.type === 'scenario') {
                renderScenario(index, q);
            } else if (q.type === 'multiple-choice') {
                renderMultipleChoice(index, q);
            } else {
                // Existing Likert scale rendering
                renderLikertScale(index, q);
            }
            
            updateProgress();
        }
        
        function renderLikertScale(index, q) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (q.section) {
                html += `
                    <div class="section-header">
                        <h3>${q.section}</h3>
                        <div class="section-desc">${q.sectionDesc}</div>
                    </div>
                `;
                document.getElementById('currentSection').textContent = q.section;
                
                if (sectionIntros[q.section]) {
                    html += `
                        <div class="insight-card" style="margin-bottom: 25px;">
                            <div class="insight-icon">üí°</div>
                            <div class="insight-title">Why This Matters</div>
                            <div class="insight-content">${sectionIntros[q.section]}</div>
                        </div>
                    `;
                }
            }
            
            // Create answer options based on question type
            const options = getOptionsForQuestion(q);
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="scale-options" id="scaleContainer">
                        ${options.map((opt, idx) => `
                            <div class="scale-option ${answers[index] === opt.value ? 'selected' : ''}" data-value="${opt.value}" onclick="selectOption(event, ${opt.value})">
                                <span>${idx + 1}</span>
                                <small>${opt.text}</small>
                            </div>
                        `).join('')}
                    </div>
                    <div id="insightContainer"></div>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('currentQ').textContent = index + 1;
            setupDragHandlers();
            
            if (answers[index]) {
                showInsight(insights[index]);
            }
        }
        
        function renderScenario(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Scenario ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="scenario-options">
                        ${question.options.map((opt, idx) => `
                            <div class="scenario-option" data-option="${idx}" onclick="selectScenario(${index}, ${idx})">
                                <div class="option-letter">${String.fromCharCode(65 + idx)}</div>
                                <div class="option-text">${opt.text}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="scenarioFeedback" class="scenario-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectScenario(index, selectedIdx);
                }
            }
        }
        
        function selectScenario(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback on options
            document.querySelectorAll('.scenario-option').forEach((opt, idx) => {
                opt.classList.remove('selected', 'correct', 'incorrect', 'neutral');
                
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    
                    // Color code based on value
                    if (selectedOption.value >= 4) {
                        opt.classList.add('correct');
                    } else if (selectedOption.value <= 2) {
                        opt.classList.add('incorrect');
                    } else {
                        opt.classList.add('neutral');
                    }
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('scenarioFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card scenario-insight">
                        <div class="insight-content">${selectedOption.feedback}</div>
                        ${selectedOption.insight ? `<div class="insight-quote">${selectedOption.insight}</div>` : ''}
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }
        
        function renderMultipleChoice(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="mc-options">
                        ${question.options.map((opt, idx) => `
                            <div class="mc-option" data-option="${idx}" onclick="selectMultipleChoice(${index}, ${idx})">
                                <div class="mc-radio">
                                    <input type="radio" name="mc${index}" value="${idx}">
                                </div>
                                <div class="mc-content">
                                    <div class="mc-text">${opt.text}</div>
                                    ${opt.type ? `<div class="mc-type">${opt.type}</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="mcFeedback" class="mc-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectMultipleChoice(index, selectedIdx);
                }
            }
        }
        
        function selectMultipleChoice(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback
            document.querySelectorAll('.mc-option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('mcFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card mc-insight">
                        ${selectedOption.type ? `<div class="mc-type-badge">${selectedOption.type}</div>` : ''}
                        <div class="insight-content">${selectedOption.feedback}</div>
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }

        function getOptionsForQuestion(q) {
            const questionText = q.question.toLowerCase();
            
            // Mission & Purpose questions
            if (questionText.includes('why you\'re here')) {
                return [
                    { text: 'Haven\'t thought about it much', value: 1 },
                    { text: 'Have some vague ideas', value: 2 },
                    { text: 'Know generally but not specifically', value: 3 },
                    { text: 'Have clarity on main themes', value: 4 },
                    { text: 'Crystal clear on my purpose', value: 5 }
                ];
            } else if (questionText.includes('impact i want to have')) {
                return [
                    { text: 'Haven\'t considered this', value: 1 },
                    { text: 'Think about it occasionally', value: 2 },
                    { text: 'Have some ideas', value: 3 },
                    { text: 'Clear on specific ways', value: 4 },
                    { text: 'Actively working toward specific impact', value: 5 }
                ];
            } else if (questionText.includes('solving problems related to')) {
                return [
                    { text: 'Don\'t see myself as problem-solver', value: 1 },
                    { text: 'Solve whatever comes up', value: 2 },
                    { text: 'Have preferences but flexible', value: 3 },
                    { text: 'Know my problem space', value: 4 },
                    { text: 'Deeply focused on specific problems', value: 5 }
                ];
            } else if (questionText.includes('contribute to others\' growth')) {
                return [
                    { text: 'Never', value: 1 },
                    { text: 'Rarely', value: 2 },
                    { text: 'Sometimes', value: 3 },
                    { text: 'Often', value: 4 },
                    { text: 'Constantly', value: 5 }
                ];
            } else if (questionText.includes('drives you most deeply')) {
                return [
                    { text: 'External rewards and recognition', value: 1 },
                    { text: 'Combination of external and internal', value: 2 },
                    { text: 'Personal satisfaction and growth', value: 3 },
                    { text: 'Making difference for specific people', value: 4 },
                    { text: 'Contributing to something bigger than myself', value: 5 }
                ];
            
            // How You Show Up questions
            } else if (questionText.includes('want to be known as')) {
                return [
                    { text: 'Haven\'t thought about this', value: 1 },
                    { text: 'Cares what others think', value: 2 },
                    { text: 'Lives according to values', value: 3 },
                    { text: 'Makes specific impact', value: 4 },
                    { text: 'Embodies specific character traits', value: 5 }
                ];
            } else if (questionText.includes('character traits i most consistently')) {
                return [
                    { text: 'Inconsistent, depends on situation', value: 1 },
                    { text: 'Working on consistency', value: 2 },
                    { text: 'Consistent in some areas', value: 3 },
                    { text: 'Very consistent with core traits', value: 4 },
                    { text: 'Known for specific character strengths', value: 5 }
                ];
            } else if (questionText.includes('natural leadership style')) {
                return [
                    { text: 'Don\'t see myself as leader', value: 1 },
                    { text: 'Lead by following', value: 2 },
                    { text: 'Lead when necessary', value: 3 },
                    { text: 'Actively lead in my domains', value: 4 },
                    { text: 'Naturally take leadership roles', value: 5 }
                ];
            } else if (questionText.includes('help others most by')) {
                return [
                    { text: 'Not sure I help much', value: 1 },
                    { text: 'Respond when asked', value: 2 },
                    { text: 'Actively look for opportunities', value: 3 },
                    { text: 'Have specific ways I contribute', value: 4 },
                    { text: 'Known for specific type of help', value: 5 }
                ];
            } else if (questionText.includes('relationships, i\'m known for')) {
                return [
                    { text: 'Distracted, not fully present', value: 1 },
                    { text: 'Present sometimes', value: 2 },
                    { text: 'Working on presence', value: 3 },
                    { text: 'Generally present and engaged', value: 4 },
                    { text: 'Deeply present and attentive', value: 5 }
                ];
            
            // Legacy & Long-term questions
            } else if (questionText.includes('remember one thing about me')) {
                return [
                    { text: 'Haven\'t thought about legacy', value: 1 },
                    { text: 'Accomplishments and achievements', value: 2 },
                    { text: 'How I made them feel', value: 3 },
                    { text: 'Specific impact I had', value: 4 },
                    { text: 'Character and values I lived', value: 5 }
                ];
            } else if (questionText.includes('10-year vision')) {
                return [
                    { text: 'Don\'t think that far ahead', value: 1 },
                    { text: 'Have general direction', value: 2 },
                    { text: 'Know major goals', value: 3 },
                    { text: 'Clear on multiple domains', value: 4 },
                    { text: 'Crystal clear, written, reviewed', value: 5 }
                ];
            } else if (questionText.includes('end of my life')) {
                return [
                    { text: 'Success and achievements', value: 1 },
                    { text: 'Comfortable lifestyle', value: 2 },
                    { text: 'Relationships and experiences', value: 3 },
                    { text: 'Impact and contribution', value: 4 },
                    { text: 'Living aligned with deepest values', value: 5 }
                ];
            } else if (questionText.includes('time is spent more on')) {
                return [
                    { text: 'Mostly consuming (media, entertainment)', value: 1 },
                    { text: 'More consuming than creating', value: 2 },
                    { text: 'Balance of both', value: 3 },
                    { text: 'More creating than consuming', value: 4 },
                    { text: 'Primarily building and creating', value: 5 }
                ];
            } else if (questionText.includes('see myself as someone who')) {
                return [
                    { text: 'Follows established paths', value: 1 },
                    { text: 'Mostly follows, sometimes creates', value: 2 },
                    { text: 'Balance of following and creating', value: 3 },
                    { text: 'Creates within established frameworks', value: 4 },
                    { text: 'Actively creates new paths', value: 5 }
                ];
            } else {
                // Default 5-point scale
                return [
                    { text: 'Not at all', value: 1 },
                    { text: 'Somewhat', value: 2 },
                    { text: 'Moderately', value: 3 },
                    { text: 'Well', value: 4 },
                    { text: 'Perfectly', value: 5 }
                ];
            }
        }

        function setupDragHandlers() {
            const scaleContainer = document.getElementById('scaleContainer');
            if (!scaleContainer) return;
            
            function handleInteraction(e) {
                const rect = scaleContainer.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const relativeX = Math.max(0, Math.min(1, x / rect.width));
                const value = Math.ceil(relativeX * 5) || 1;
                selectOption(e, value);
                updateSliderVisual(value);
            }

            scaleContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                handleInteraction(e);
            });

            scaleContainer.addEventListener('mousemove', (e) => {
                if (isDragging) handleInteraction(e);
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            scaleContainer.addEventListener('touchstart', (e) => {
                isDragging = true;
                handleInteraction(e);
            }, { passive: false });

            scaleContainer.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleInteraction(e);
                }
            }, { passive: false });

            scaleContainer.addEventListener('touchend', () => {
                isDragging = false;
            });
        }

        function updateSliderVisual(value) {
            const options = document.querySelectorAll('.scale-option');
            options.forEach((opt, idx) => {
                if (idx < value) {
                    opt.classList.add('active');
                } else {
                    opt.classList.remove('active');
                }
            });
        }

        function selectOption(e, value) {
            e.stopPropagation();
            answers[currentQuestionIndex] = value;
            
            document.querySelectorAll('.scale-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            const selectedOpt = document.querySelector(`[data-value="${value}"]`);
            if (selectedOpt) {
                selectedOpt.classList.add('selected');
            }
            
            updateSliderVisual(value);
            document.getElementById('nextBtn').disabled = false;
            showInsight(insights[currentQuestionIndex]);
            
            // Save progress after each answer
            saveProgress();
        }

        function showInsight(insight) {
            const container = document.getElementById('insightContainer');
            container.innerHTML = `
                <div class="insight-card">
                    <div class="insight-icon">${insight.icon}</div>
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-content">${insight.content}</div>
                    <div class="insight-quote">${insight.quote}</div>
                </div>
            `;
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = false;
                document.getElementById('nextBtn').disabled = !answers[currentQuestionIndex];
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateProgress() {
            const answered = Object.keys(answers).length;
            const progress = (answered / questions.length) * 100;
            if (document.getElementById('progressBar')) {
                document.getElementById('progressBar').style.width = progress + '%';
            }
            
            // Milestone celebrations
            checkMilestones(progress);
            
            if (currentQuestionIndex === questions.length - 1) {
                if (document.getElementById('nextBtn')) {
                    document.getElementById('nextBtn').textContent = 'See Results üéØ';
                }
            }
        }
        
        // Milestone system
        function checkMilestones(progress) {
            if (!window.milestonesShown) {
                window.milestonesShown = [];
            }
            
            const milestones = [25, 50, 75, 100];
            const currentMilestone = Math.floor(progress / 25) * 25;
            
            if (milestones.includes(currentMilestone) && 
                !window.milestonesShown.includes(currentMilestone) &&
                progress >= currentMilestone) {
                
                window.milestonesShown.push(currentMilestone);
                showMilestoneCelebration(currentMilestone);
            }
        }
        
        function showMilestoneCelebration(percent) {
            const messages = {
                25: {
                    emoji: 'üéØ',
                    title: '25% Complete!',
                    message: 'You\'re building momentum! Great start!',
                    color: 'linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)'
                },
                50: {
                    emoji: 'üî•',
                    title: 'Halfway There!',
                    message: 'You\'re crushing it! Keep going!',
                    color: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'
                },
                75: {
                    emoji: 'üí™',
                    title: '75% Complete!',
                    message: 'Almost done! Finish strong!',
                    color: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)'
                },
                100: {
                    emoji: 'üéâ',
                    title: 'Assessment Complete!',
                    message: 'Amazing work! Time to see your results!',
                    color: 'linear-gradient(135deg, #10b981 0%, #059669 100%)'
                }
            };
            
            const milestone = messages[percent];
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'milestone-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.7); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div class="milestone-content" style="
                    background: ${milestone.color}; color: white;
                    padding: 50px; border-radius: 20px; text-align: center;
                    max-width: 500px; animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">${milestone.emoji}</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800;">${milestone.title}</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.95;">${milestone.message}</p>
                    <button onclick="this.closest('.milestone-modal').remove()" style="
                        background: white; color: #333; padding: 15px 30px;
                        border: none; border-radius: 10px; font-size: 1.1rem;
                        font-weight: 700; cursor: pointer; transition: all 0.2s;
                    ">
                        Continue ‚Üí
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Trigger confetti
            triggerConfetti();
            
            // Auto-close after 3 seconds if not dismissed
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.style.opacity = '0';
                    setTimeout(() => modal.remove(), 300);
                }
            }, 3000);
        }
        
        function triggerConfetti() {
            const emojis = ['üéâ', '‚≠ê', '‚ú®', 'üéä', 'üí´', 'üåü'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.cssText = `
                    position: fixed; font-size: 2rem; z-index: 9999;
                    left: ${Math.random() * 100}vw; top: -50px;
                    pointer-events: none;
                    animation: confettiFall ${2 + Math.random() * 2}s ease-out forwards;
                `;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 4000);
            }
        }
        
        function showAchievementBadge(badgeId, title, description, xpValue) {
            const badge = document.createElement('div');
            badge.className = 'achievement-modal';
            badge.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const badgeEmojis = {
                'first-stripe': 'üë£',
                'perfect-score': 'üéØ',
                'speed-demon': '‚ö°',
                'streak-3': 'üî•',
                'streak-7': 'üî•',
                'streak-30': 'üî•',
                'dedicated': 'üí™',
                'scholar': 'üìö',
                'master': 'üëë'
            };
            
            const emoji = badgeEmojis[badgeId] || 'üèÜ';
            
            badge.innerHTML = `
                <div class="achievement-content" style="
                    background: white; padding: 50px; border-radius: 20px;
                    text-align: center; max-width: 500px;
                    animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 6rem; margin-bottom: 1rem;">${emoji}</div>
                    <div style="
                        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                        color: white; display: inline-block; padding: 8px 20px;
                        border-radius: 20px; font-size: 0.9rem; font-weight: 700;
                        margin-bottom: 1rem; text-transform: uppercase;
                        letter-spacing: 1px;
                    ">Achievement Unlocked!</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800; color: #333;">${title}</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: #666; line-height: 1.6;">${description}</p>
                    <div style="
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white; display: inline-block; padding: 12px 24px;
                        border-radius: 12px; font-size: 1.2rem; font-weight: 700;
                        margin-bottom: 1.5rem;
                    ">+${xpValue} XP</div>
                    <div>
                        <button onclick="this.closest('.achievement-modal').remove()" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white; padding: 15px 30px; border: none;
                            border-radius: 10px; font-size: 1.1rem; font-weight: 700;
                            cursor: pointer; transition: all 0.2s;
                        ">
                            Awesome! ‚ú®
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(badge);
            triggerConfetti();
        }
        
        function checkAchievements() {
            // Perfect Score
            let perfectScore = true;
            for (let i = 0; i < questions.length; i++) {
                if (answers[i] < 4) {
                    perfectScore = false;
                    break;
                }
            }
            if (perfectScore) {
                showAchievementBadge('perfect-score', 'üéØ Perfect Score', 'You answered all questions at mastery level!', 50);
            }
            
            // Speed Demon
            const startTime = parseInt(localStorage.getItem('assessmentStartTime') || '0');
            const completionTime = (Date.now() - startTime) / 1000 / 60; // minutes
            if (completionTime < 5 && startTime > 0) {
                showAchievementBadge('speed-demon', '‚ö° Speed Demon', 'Completed in under 5 minutes!', 25);
            }
            
            // First Stripe
            const completedStripes = Object.keys(localStorage).filter(k => k.includes('Complete')).length;
            if (completedStripes === 1) {
                showAchievementBadge('first-stripe', 'üë£ First Steps', 'You completed your first stripe!', 25);
            }
        }

        function showResults() {
            // Check achievements before showing results
            checkAchievements();
            
            // Calculate mission clarity scores
            let missionScore = 0;
            let showUpScore = 0;
            let legacyScore = 0;
            
            // Mission & Purpose (questions 0-4)
            for (let i = 0; i < 5; i++) {
                if (answers[i]) missionScore += answers[i];
            }
            
            // How You Show Up (questions 5-9)
            for (let i = 5; i < 10; i++) {
                if (answers[i]) showUpScore += answers[i];
            }
            
            // Legacy & Long-term (questions 10-14)
            for (let i = 10; i < 15; i++) {
                if (answers[i]) legacyScore += answers[i];
            }
            
            const avgMission = missionScore / 5;
            const avgShowUp = showUpScore / 5;
            const avgLegacy = legacyScore / 5;
            const overallScore = (avgMission + avgShowUp + avgLegacy) / 3;
            
            let clarityType = '';
            let typeEmoji = '';
            let typeLabel = '';
            let typeColor = '';
            let strengths = [];
            let challenges = [];
            let strategies = [];
            
            if (overallScore <= 2.0) {
                clarityType = 'Discovering';
                typeEmoji = 'üîç';
                typeLabel = 'üîç Discovering Your Mission';
                typeColor = '#f4a261';
                strengths = [
                    'Awareness is the first step to clarity',
                    'You\'re honest about where you are',
                    'Every master was once a beginner',
                    'You have room to build strong foundations',
                    'Growth mindset is already present'
                ];
                challenges = [
                    'Mission clarity needs development',
                    'Purpose definition requires work',
                    'Character consistency needs practice',
                    'Legacy thinking needs cultivation',
                    'Long-term vision needs creation'
                ];
                strategies = [
                    'Start by writing your "why" statement',
                    'Reflect on what problems fascinate you',
                    'Identify how you want to be known',
                    'Think about your 10-year vision',
                    'Practice showing up consistently'
                ];
            } else if (overallScore <= 3.5) {
                clarityType = 'Clarifying';
                typeEmoji = 'üéØ';
                typeLabel = 'üéØ Clarifying Your Mission';
                typeColor = '#457b9d';
                strengths = [
                    'You have some clarity on your mission',
                    'You recognize areas that need work',
                    'You\'re building foundational awareness',
                    'You have some effective strategies',
                    'You\'re committed to growth'
                ];
                challenges = [
                    'Some mission areas still need clarity',
                    'Character consistency could be stronger',
                    'Legacy thinking needs refinement',
                    'Long-term vision needs more detail',
                    'Show up patterns need practice'
                ];
                strategies = [
                    'Refine your mission statement monthly',
                    'Double down on your core purpose',
                    'Practice showing up consistently',
                    'Review your 10-year vision quarterly',
                    'Build daily habits aligned with mission'
                ];
            } else {
                clarityType = 'Clear';
                typeEmoji = 'üåü';
                typeLabel = 'üåü Living Your Mission';
                typeColor = '#2a9d8f';
                strengths = [
                    'High clarity on your mission and purpose',
                    'Strong character consistency',
                    'Clear legacy orientation',
                    'Long-term vision well-defined',
                    'Consistent show up patterns'
                ];
                challenges = [
                    'Maintain clarity during stress',
                    'Continue refining as life changes',
                    'Support others in their mission journey',
                    'Stay aware of mission drift',
                    'Prevent complacency in good times'
                ];
                strategies = [
                    'Share your mission clarity with others',
                    'Continue refining as life evolves',
                    'Stay aware of changing priorities',
                    'Support others in their mission journey',
                    'Use your clarity to help build team mission'
                ];
            }

            document.getElementById('assessmentForm').style.display = 'none';
            document.getElementById('resultsContainer').classList.add('active');
            
            document.getElementById('typeEmoji').textContent = typeEmoji;
            document.getElementById('typeLabel').textContent = typeLabel;
            document.getElementById('typeResultCard').style.background = `linear-gradient(135deg, ${typeColor} 0%, ${typeColor}dd 100%)`;
            
            const typeDetailsHTML = `
                <div class="type-card">
                    <h3>üí™ Your Strengths</h3>
                    <ul>
                        ${strengths.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #fff5f0; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">‚ö†Ô∏è Areas for Growth</h3>
                    <ul>
                        ${challenges.map(c => `<li>${c}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #f0f4ff; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">üéØ Recommended Strategies</h3>
                    <ul>
                        ${strategies.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="insight-card" style="margin-top: 30px;">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-title">The Key Insight</div>
                    <div class="insight-content">
                        <strong>Your mission is your North Star‚Äîit guides every decision.</strong> Just like in BJJ, where every gym has a philosophy, every leader needs a mission. Your mission isn't what you say‚Äîit's what you do. Character is what you do when no one's watching. Legacy is built daily.
                        <br><br>
                        <strong>ü•ã BJJ Wisdom:</strong> "Every gym has a philosophy. Your mission is your martial arts philosophy. It guides every technique, every roll, every day."
                    </div>
                </div>
            `;
            
            document.getElementById('typeDetails').innerHTML = typeDetailsHTML;
            
            // Clear partial progress
            clearProgress();
            
            // Save completion to localStorage
            localStorage.setItem('whiteBeltStripe4Complete', 'true');
            localStorage.setItem('whiteBeltStripe4CompletedDate', new Date().toISOString());
            localStorage.setItem('missionClarity', clarityType);
            
            // Award XP
            const currentXP = parseInt(localStorage.getItem('totalXP') || '0');
            const xpReward = 100; // +100 XP for completing Stripe 4
            localStorage.setItem('totalXP', (currentXP + xpReward).toString());
            
            // Show completion notification
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #38a169 0%, #2f855a 100%); color: white; padding: 1rem 1.5rem; border-radius: 10px; box-shadow: 0 4px 20px rgba(56, 161, 105, 0.4); z-index: 1000; font-weight: 600;';
                notification.innerHTML = `‚úÖ Stripe 4 Complete! +${xpReward} XP`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }, 500);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
<!-- TAP-IN Utilities -->
<script src="js/shared-utilities.js"></script>
<script src="js/global-error-handler.js"></script>
<script src="js/storage-health.js"></script>
</body>
</html>


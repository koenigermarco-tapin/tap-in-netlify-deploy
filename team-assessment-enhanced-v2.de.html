<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#2d2d2d">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="3.0.0">
    <title>Team-Dynamik-Assessment - TAP-IN</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 40px; padding-bottom: 30px; border-bottom: 3px solid #f0f0f0; }
        .header h1 { color: #a93226; font-size: 2.5em; margin-bottom: 15px; }
        .header .subtitle { color: #666; font-size: 1.2em; margin-bottom: 10px; line-height: 1.6; }
        .header .note { color: #999; font-size: 0.95em; }
        .intro-section { background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #a93226; }
        .intro-section h3 { color: #333; margin-bottom: 15px; }
        .intro-section p { color: #666; line-height: 1.7; margin-bottom: 10px; }
        .progress-container { background: white; border-radius: 15px; padding: 20px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 20px; z-index: 100; }
        .progress-bar { background: #e0e0e0; border-radius: 10px; height: 12px; overflow: hidden; margin-bottom: 10px; }
        .progress-fill { background: linear-gradient(90deg, #a93226 0%, #c9513f 100%); height: 100%; width: 0%; transition: width 0.3s ease; }
        .progress-text { text-align: center; color: #666; font-size: 0.95em; }
        .assessment-card { background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 30px; }
        .section-header { background: linear-gradient(135deg, #a93226 0%, #7a241b 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; }
        .section-desc { color: #666; margin-bottom: 25px; font-style: italic; line-height: 1.6; }
        .question { margin-bottom: 30px; }
        .question-text { color: #333; font-size: clamp(1.05em, 2.5vw, 1.2em); margin-bottom: 18px; font-weight: 500; line-height: 1.5; }
        .scale-options { display: flex; justify-content: space-between; align-items: flex-end; gap: 2px; flex-wrap: nowrap; height: 140px; position: relative; background: linear-gradient(to top right, rgba(169, 50, 38, 0.1) 0%, rgba(169, 50, 38, 0.05) 50%, transparent 50%); border-radius: 8px; padding: 5px; cursor: pointer; user-select: none; }
        .scale-option { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; background: linear-gradient(135deg, rgba(169, 50, 38, 0.15) 0%, rgba(169, 50, 38, 0.1) 100%); border: 2px solid transparent; border-radius: 6px; transition: all 0.15s ease; position: relative; z-index: 1; }
        .scale-option:nth-child(1) { height: 50px; }
        .scale-option:nth-child(2) { height: 70px; }
        .scale-option:nth-child(3) { height: 90px; }
        .scale-option:nth-child(4) { height: 110px; }
        .scale-option:nth-child(5) { height: 130px; }
        .scale-option input[type="radio"] { display: none; }
        .scale-option.active, .scale-option.selected { background: linear-gradient(135deg, #a93226 0%, #c9513f 100%); color: white; border-color: #7a241b; box-shadow: 0 2px 8px rgba(169, 50, 38, 0.4); }
        .scale-option.active ~ .scale-option { background: linear-gradient(135deg, rgba(169, 50, 38, 0.15) 0%, rgba(169, 50, 38, 0.1) 100%); color: #333; }
        .scale-options:active { cursor: grabbing; }
        .scale-value { font-size: 1.3em; font-weight: bold; margin-bottom: 4px; pointer-events: none; }
        .scale-label { font-size: 0.7em; opacity: 0.7; text-align: center; padding: 0 3px; margin-bottom: 6px; pointer-events: none; white-space: nowrap; }
        .scale-option.active .scale-label, .scale-option.selected .scale-label { opacity: 1; font-weight: 600; }
        .scale-option.active .scale-value, .scale-option.selected .scale-value { transform: scale(1.1); }
        .scale-option:nth-child(5) .scale-label { opacity: 1; }
        .scale-option.selected .scale-label { opacity: 1; font-weight: 600; }
        .insight-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-left: 4px solid #a93226; padding: 20px; margin: 20px 0; border-radius: 10px; animation: slideIn 0.4s ease; }
        .insight-card .insight-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .insight-card .insight-icon { font-size: 1.5em; }
        .insight-card .insight-title { color: #a93226; font-weight: bold; font-size: 1.1em; }
        .insight-card .insight-content { color: #555; line-height: 1.6; font-size: 0.95em; }
        .insight-card .insight-quote { font-style: italic; color: #666; margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-buttons { display: flex; justify-content: space-between; gap: 15px; margin-top: 30px; }
        .btn { padding: 15px 35px; border: none; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.2s; text-decoration: none; display: inline-block; text-align: center; }
        .btn-primary { background: linear-gradient(135deg, #a93226 0%, #7a241b 100%); color: white; }
        .btn-primary:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 5px 20px rgba(169, 50, 38, 0.4); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .results { display: none; }
        .results.active { display: block; }
        .overall-score { background: linear-gradient(135deg, #a93226 0%, #7a241b 100%); color: white; border-radius: 20px; padding: 40px; text-align: center; margin-bottom: 30px; }
        .overall-score h2 { font-size: clamp(2em, 5vw, 3em); margin-bottom: 15px; }
        .overall-score .score { font-size: clamp(3em, 8vw, 5em); font-weight: bold; margin-bottom: 15px; }
        .score-section { background: #f8f9fa; border-radius: 15px; padding: 25px; margin-bottom: 25px; border-left: 5px solid #a93226; }
        .score-section h3 { color: #a93226; margin-bottom: 15px; font-size: 1.4em; }
        .score-display { font-size: 2em; font-weight: bold; color: #a93226; margin-bottom: 10px; }
        .score-bar { background: #e0e0e0; height: 20px; border-radius: 10px; overflow: hidden; margin-bottom: 15px; }
        .score-bar-fill { background: linear-gradient(90deg, #a93226 0%, #c9513f 100%); height: 100%; transition: width 0.5s ease; }
        .score-interpretation { color: #666; line-height: 1.7; margin-bottom: 15px; }
        .recommendation { background: white; padding: 20px; border-radius: 10px; margin-top: 15px; }
        .recommendation h4 { color: #333; margin-bottom: 10px; }
        .cta-box { background: linear-gradient(135deg, #a93226 0%, #7a241b 100%); color: white; border-radius: 15px; padding: 30px; text-align: center; margin-top: 30px; }
        .cta-box h3 { margin-bottom: 15px; font-size: 1.6em; }
        .cta-box p { margin-bottom: 20px; opacity: 0.95; }
        .hidden { display: none; }
        
        /* Lencioni's 5 Dysfunktionen Banner */
        .stats-banner { 
            background: linear-gradient(135deg, #a93226 0%, #7a241b 100%); 
            color: white; 
            padding: 20px; 
            border-radius: 12px; 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            gap: 15px; 
            margin-bottom: 30px; 
            flex-wrap: wrap;
            box-shadow: 0 4px 15px rgba(169, 50, 38, 0.3);
        }
        .stats-banner .stat-item { 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            gap: 8px;
            text-align: center;
            min-width: 80px;
        }
        .stats-banner .stat-number { 
            font-size: 1.4em; 
            font-weight: bold; 
        }
        .stats-banner .stat-label { 
            opacity: 0.95;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        @media (max-width: 768px) { .header, .assessment-card { padding: 25px 20px; } .scale-options { gap: 8px; } .scale-option { min-width: 60px; padding: 12px 8px; } .nav-buttons { flex-direction: column; } .btn { width: 100%; } .overall-score { padding: 30px 20px; } .stats-banner { gap: 15px; font-size: 0.85em; } }
    </style>
</head>
<body>
    <!-- language switcher (EN / DE) -->
    <div id="lang-switch" style="position:fixed;top:16px;right:16px;z-index:1200;font-family:inherit;">
        <div style="background:white;border-radius:999px;padding:8px 12px;box-shadow:0 6px 20px rgba(0,0,0,0.15);font-size:0.95em;">
            <a href="team-assessment-enhanced-v2.html" style="color:#333;text-decoration:none;font-weight:700;margin-right:10px;">EN</a>
            <a href="team-assessment-enhanced-v2.de.html" style="color:#a93226;text-decoration:none;font-weight:700;border-left:1px solid #eee;padding-left:10px;margin-left:10px;">DE</a>
        </div>
    </div>
    <div class="container">
        <!-- Stats Banner -->
        <!-- Lencioni's 5 Dysfunktionen Framework -->
        <div class="stats-banner">
            <div class="stat-item">
                <span style="font-size: 1.8em;">üõ°Ô∏è</span>
                <div class="stat-label">Vertrauen</div>
            </div>
            <div class="stat-item">
                <span style="font-size: 1.8em;">‚öîÔ∏è</span>
                <div class="stat-label">Konflikt</div>
            </div>
            <div class="stat-item">
                <span style="font-size: 1.8em;">üéØ</span>
                <div class="stat-label">Commitment</div>
            </div>
            <div class="stat-item">
                <span style="font-size: 1.8em;">‚úì</span>
                <div class="stat-label">Verantwortung</div>
            </div>
            <div class="stat-item">
                <span style="font-size: 1.8em;">üèÜ</span>
                <div class="stat-label">Ergebnisse</div>
            </div>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>ü§ù Team-Dynamik-Assessment</h1>
            <p class="subtitle">Entdecke die verborgenen Leistungsblocker deines Teams basierend auf Patrick Lencionis 5-Dysfunktionen-Modell. Antworte ehrlich f√ºr die genauesten Erkenntnisse.</p>
            <div class="note">
                <strong>‚è±Ô∏è 7 Minuten</strong> ‚Ä¢ 20 Fragen zu 5 Schl√ºsselbereichen: Vertrauen, Konflikt, Commitment, Verantwortlichkeit und Ergebnisse
            </div>
        </div>

        <!-- Context Section -->
        <div class="intro-section">
            <h3>üìä Warum das wichtig ist: Die Wissenschaft von Hochleistungsteams</h3>
            <p><strong>Googles Project Aristotle</strong> analysierte 180+ Teams und fand heraus: Psychologische Sicherheit‚Äînicht individuelles Talent‚Äîbestimmt Teamerfolg. Kombiniert mit <strong>Patrick Lencionis 5 Dysfunktionen</strong> zeigt dieses Assessment die verborgenen Dynamiken, die Elite-Teams von durchschnittlichen unterscheiden.</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #a93226;">
                    <div style="font-size: 1.5em; margin-bottom: 5px;">üîí</div>
                    <strong>Vertrauen</strong><br>
                    <span style="font-size: 0.85em; color: #666;">Verletzlichkeitsbasiert</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #d64436;">
                    <div style="font-size: 1.5em; margin-bottom: 5px;">‚ö°</div>
                    <strong>Konflikt</strong><br>
                    <span style="font-size: 0.85em; color: #666;">Gesunde Debatte</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #e87653;">
                    <div style="font-size: 1.5em; margin-bottom: 5px;">üéØ</div>
                    <strong>Commitment</strong><br>
                    <span style="font-size: 0.85em; color: #666;">Klarheit & Zustimmung</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #f5a26f;">
                    <div style="font-size: 1.5em; margin-bottom: 5px;">üëÅÔ∏è</div>
                    <strong>Verantwortlichkeit</strong><br>
                    <span style="font-size: 0.85em; color: #666;">Peer-Druck</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #ffc285;">
                    <div style="font-size: 1.5em; margin-bottom: 5px;">üèÜ</div>
                    <strong>Ergebnisse</strong><br>
                    <span style="font-size: 0.85em; color: #666;">Gemeinsame Ziele</span>
                </div>
            </div>

            <p style="margin-top: 15px; font-style: italic; color: #888; font-size: 0.9em;">
                "Nicht Finanzen. Nicht Strategie. Nicht Technologie. Es ist Teamarbeit, die den ultimativen Wettbewerbsvorteil darstellt." ‚Äî Patrick Lencioni
            </p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Frage 1 von 20</div>
        </div>
        <!-- Assessment Form -->
        <div id="assessmentForm">
            <div class="assessment-card" id="questionCard">
                <!-- Questions will be dynamically inserted here -->
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;">‚Üê Zur√ºck</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled data-i18n="next_btn">Weiter ‚Üí</button>
            </div>
        </div>
        <!-- Results Section -->
        <div id="results" class="results">
            <div class="assessment-card">
                <div id="resultContent"></div>
                <!-- CTA -->
                <div class="cta-box">
                    <h3>Bereit, dein Team zu transformieren?</h3>
                    <p>Buche eine kostenlose 30-min√ºtige Team-Dynamik-Strategie-Session, um deine Ergebnisse zu besprechen und einen 90-Tage-Aktionsplan zu erstellen.</p>
                    <a href="/cdn-cgi/l/email-protection#b9dad6d7cdd8dacdf9cdd8c994d0d794d8dad8dddcd4c097dad6d486caccdbd3dcdacd84eddcd8d499f8cacadccacad4dcd7cd99eacdcbd8cddcdec099eadccacad0d6d7" class="btn" style="background: white; color: #a93226;">üìÖ Strategie-Sitzung buchen</a>
                    <div style="margin-top: 20px;">
                        <a href="index.de.html" class="btn" style="background: transparent; border: 2px solid white; color: white;">‚Üê Zur√ºck zu Assessments</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Wait for i18n to be ready before rendering questions
        function onI18nReady(cb, timeoutMs = 2000) {
            const start = Date.now();
            (function check() {
                if (window.__i18n && typeof window.__i18n.t === 'function') return cb();
                if (Date.now() - start > timeoutMs) return cb();
                setTimeout(check, 30);
            })();
        }
        
        // fallbackQuestions holds the English/default question set. We will try to load questions
        // from the runtime translations (i18n) when available so pages can progressively translate.
        const fallbackQuestions = [
            // TRUST (4 questions)
            {
                section: 'Vertrauen',
                sectionDesc: 'Die Grundlage von Teamarbeit ist vertrauensvolle Offenheit.',
                question: 'Teammitglieder geben offen ihre Fehler und Schw√§chen zu',
                category: 'trust'
            },
            {
                question: 'Personen fragen ohne Z√∂gern um Hilfe',
                category: 'trust'
            },
            {
                question: 'Teammitglieder geben einander das Benefit of the Doubt',
                category: 'trust'
            },
            {
                question: 'Personen entschuldigen sich schnell und aufrichtig, wenn sie Fehler machen',
                category: 'trust'
            },
            // CONFLICT (4 questions)
            {
                section: 'Konflikt',
                sectionDesc: 'Gesunde Teams f√ºhren leidenschaftliche, ungefilterte Debatten.',
                question: 'Team-Meetings beinhalten leidenschaftliche, ungefilterte Debatten',
                category: 'conflict'
            },
            {
                question: 'Personen √§u√üern Meinungsverschiedenheiten w√§hrend Meetings (nicht danach)',
                category: 'conflict'
            },
            {
                question: 'Konflikte werden schnell und konstruktiv gel√∂st',
                category: 'conflict'
            },
            {
                question: 'Teammitglieder hinterfragen respektvoll die Ideen der anderen',
                category: 'conflict'
            },
            // COMMITMENT (4 questions)
            {
                section: 'Commitment',
                sectionDesc: 'Teams, die effektiv debattieren, erreichen echtes Buy-in und Commitment.',
                question: 'Entscheidungen werden mit Klarheit und Buy-in von allen getroffen',
                category: 'commitment'
            },
            {
                question: 'Teammitglieder verlassen Meetings mit Zuversicht √ºber die Richtung',
                category: 'commitment'
            },
            {
                question: 'Personen halten sich an Entscheidungen, auch wenn sie anfangs anderer Meinung waren',
                category: 'commitment'
            },
            {
                question: 'Deadlines und Priorit√§ten sind kristallklar f√ºr alle',
                category: 'commitment'
            },
            // ACCOUNTABILITY (4 questions)
            {
                section: 'Verantwortlichkeit',
                sectionDesc: 'Engagierte Teams nehmen sich gegenseitig f√ºr hohe Standards in die Pflicht.',
                question: 'Teammitglieder sprechen sich gegenseitig auf Performance-Probleme an',
                category: 'accountability'
            },
            {
                question: 'Personen √ºbernehmen Verantwortung, wenn Dinge schiefgehen',
                category: 'accountability'
            },
            {
                question: 'Standards werden eingehalten, auch wenn es unangenehm ist',
                category: 'accountability'
            },
            {
                question: 'Teammitglieder fordern Peers, ihre Verpflichtungen einzuhalten',
                category: 'accountability'
            },
            // RESULTS (4 questions)
            {
                section: 'Ergebnisse',
                sectionDesc: 'Verantwortliche Teams fokussieren sich auf kollektive Ergebnisse √ºber individuelle Ziele.',
                question: 'Das Team feiert kollektive Erfolge √ºber individuelle Leistungen',
                category: 'results'
            },
            {
                question: 'Personen opfern pers√∂nliche Agenden f√ºr Teamziele',
                category: 'results'
            },
            {
                question: 'Erfolgsmetriken sind klar definiert und werden verfolgt',
                category: 'results'
            },
            {
                question: 'Teammitglieder sind wirklich besorgt, Teamkollegen zu entt√§uschen',
                category: 'results'
            }
        ];
        function getQuestionsFromI18n(){
            try{
                const t = window.__i18n && window.__i18n.t ? window.__i18n.t.bind(window.__i18n) : null;
                if(!t) return fallbackQuestions.slice();
                const out = [];
                for(let i=1;i<=20 && i<=fallbackQuestions.length;i++){
                    const key = `team.q${i}`;
                    let txt = t(key);
                    if(typeof txt !== 'string' || !txt.trim()) txt = fallbackQuestions[i-1].question;
                    out.push(Object.assign({}, fallbackQuestions[i-1], { question: txt }));
                }
                return out;
            }catch(e){ return fallbackQuestions.slice(); }
        }
        
        // Dynamic insights that appear after answering questions (German)
        const insights = [
            // VERTRAUEN insights (Q1-4)
            { icon: 'üîç', title: 'Das Verletzlichkeits-Paradox', content: 'Studien zeigen: 75% aller Team-Dysfunktionen stammen von mangelndem Vertrauen. Der Twist: Verletzlichkeit ist keine Schw√§che‚Äîes ist der ultimative St√§rke-Move. Wenn F√ºhrungskr√§fte Fehler zuerst zugeben, steigt die psychologische Sicherheit im Team um 47%.', quote: '"Vertrauen bedeutet zu wissen: Wenn ein Teammitglied dich fordert, tut es das, weil es sich um das Team k√ºmmert." - Patrick Lencioni' },
            { icon: 'ü§ù', title: 'Das Hilfe-Signal', content: 'Hochleistungsteams bitten 3x h√§ufiger um Hilfe als durchschnittliche Teams. Warum? Weil um Hilfe bitten ein Vertrauens-Indikator ist‚Äîes signalisiert "Ich glaube, du unterst√ºtzt mich, anstatt mich zu verurteilen." Googles Project Aristotle identifizierte dies als #1 Pr√§diktor f√ºr Teamerfolg.', quote: 'Fun Fact: Navy SEAL Teams verbringen 80% der Trainingszeit mit Vertrauensaufbau, nur 20% mit Taktik.' },
            { icon: 'üí°', title: 'Benefit of the Doubt', content: 'Teams mit hohem Vertrauen unterstellen standardm√§√üig positive Absichten. Diese einzelne √Ñnderung reduziert die Konfliktl√∂sungszeit um 60%. Statt "Warum hat die Person das gemacht?!" wird es zu "Welcher Herausforderung steht die Person gegen√ºber, die ich nicht sehe?"', quote: 'Die Vertrauens-Gleichung: Glaubw√ºrdigkeit + Zuverl√§ssigkeit + Intimit√§t √∑ Selbstorientierung = Vertrauen' },
            { icon: 'üôè', title: 'Der Entschuldigungs-Vorteil', content: 'F√ºhrungskr√§fte, die sich schnell entschuldigen, werden 23% effektiver bewertet. Warum? Entschuldigungen signalisieren: "Ich sch√§tze diese Beziehung mehr als mein Ego." Bonus: Teams, in denen Entschuldigungen normalisiert sind, l√∂sen Konflikte 4x schneller.', quote: '"Die beste Entschuldigung ist ver√§ndertes Verhalten." - Unbekannt (aber dein Team wei√ü es!)' },
            
            // KONFLIKT insights (Q5-8)
            { icon: '‚öîÔ∏è', title: 'Produktiver Konflikt ‚â† Drama', content: 'Gesunde Teams verbringen 40% mehr Zeit in Meetings mit Ideendiskussionen, aber 50% weniger Zeit mit dysfunktionalem Konflikt danach. Das Geheimnis? Sie streiten √ºber IDEEN, nicht √ºber PERSONEN. Das nennt man "Task Conflict" vs. "Relationship Conflict."', quote: 'Intels Andy Grove: "Disagree and commit" funktioniert nur, wenn man wirklich zuerst widerspricht.' },
            { icon: 'üéØ', title: 'Echtzeit-Meinungsverschiedenheit', content: 'Teams, die Meinungsverschiedenheiten IM Meeting l√∂sen, treffen Entscheidungen 3x schneller als Teams, die Themen "parken". Warum? Weil Parkpl√§tze zu Friedh√∂fen werden. Jetzt ansprechen, gemeinsam weitermachen.', quote: 'Das Meeting nach dem Meeting ist der Ort, wo echte Entscheidungen sterben.' },
            { icon: '‚ö°', title: 'L√∂sungsgeschwindigkeit', content: 'High-Trust-Teams l√∂sen Konflikte in Stunden, nicht in Wochen. Die Formel? Fr√ºh ansprechen + positive Absicht unterstellen + auf L√∂sungen fokussieren. Low-Trust-Teams lassen Groll wie Kreditkartenschulden anwachsen‚Äîbevor man es merkt, ist man bankrott.', quote: 'Vermiedener Konflikt = erodiertes Vertrauen. Engagierter Konflikt = gest√§rktes Vertrauen.' },
            { icon: 'üõ°Ô∏è', title: 'Herausforderungs-Kultur', content: 'Bei Pixar nutzen sie "Plussing"‚Äîman kann jede Idee herausfordern, muss aber etwas HINZUF√úGEN, nicht nur abrei√üen. Ergebnis? Psychologische Sicherheit + kreative Spannung = Meisterwerke. Dein Team kann das auch.', quote: 'Wenn alle gleich denken, denkt jemand nicht.' },
            
            // COMMITMENT insights (Q9-12)
            { icon: 'üé™', title: 'Klarheit = Commitment', content: 'Vage Ziele erzeugen vages Commitment. Teams mit kristallklaren Zielen erreichen 2,5x wahrscheinlicher ihre Targets. Der Test? Frage 3 Teammitglieder nach der #1 Priorit√§t. Wenn du 3 verschiedene Antworten bekommst, hast du kein Commitment.', quote: 'Klar zu sein ist Freundlichkeit. Unklar zu sein ist unfreundlich. - Bren√© Brown' },
            { icon: 'üöÄ', title: 'Zuversicht nach Konflikt', content: 'Teams, die intensiv debattieren aber sich vollst√§ndig committen, √ºbertreffen "Konsens-Sucher" um 40%. Warum? Weil echtes Buy-in davon kommt, GEH√ñRT zu werden, nicht davon, seinen Willen zu bekommen. Nicht jeder wird zustimmen, aber jeder wird sich committen.', quote: 'Commitment bedeutet nicht Zustimmung‚Äîes bedeutet Klarheit und Abschluss.' },
            { icon: 'üîí', title: 'Disagree & Commit', content: 'Netflix-Kultur: Man kann w√§hrend der Diskussion stark widersprechen, aber sobald eine Entscheidung getroffen ist, committet man sich, als w√§re es die eigene Idee. Das schafft Alignment ohne erzwungenen Fake-Konsens. Die Alternative? Passiv-aggressive Umsetzung.', quote: 'Eine Entscheidung zu unterst√ºtzen, der man nicht zustimmt, ist Leadership. Sie zu untergraben ist Sabotage.' },
            { icon: 'üìç', title: 'Deadline-Disziplin', content: 'Teams, die Deadlines √∂ffentlich tracken, schlie√üen Projekte 80% schneller ab. Accountability liebt Sichtbarkeit. Pro-Tipp: Nutze ein gemeinsames Dashboard, wo jeder sieht, wer on track ist. Peer Pressure wird zu Peer Support.', quote: 'Ein Ziel ohne Deadline ist nur ein Wunsch mit extra Schritten.' },
            
            // ACCOUNTABILITY insights (Q13-16)
            { icon: 'üí™', title: 'Peer Accountability > Boss Accountability', content: 'Wenn Teams sich GEGENSEITIG zur Verantwortung ziehen (nicht nur der Manager), verbessert sich die Performance um 30%. Warum? Peer Pressure ist m√§chtig. Niemand m√∂chte Menschen entt√§uschen, die man respektiert. Macht Accountability zum Teamsport, nicht zur Manager-Aufgabe.', quote: 'Wenn nur der Leader Leute zur Verantwortung zieht, hast du kein Team‚Äîdu hast eine Kita.' },
            { icon: 'üéØ', title: 'Ownership Mindset', content: 'High-Accountability-Teams nutzen "Ich/Wir"-Sprache ("Ich habe die Deadline verpasst") vs. Low-Accountability-Teams nutzen "Es/Sie"-Sprache ("Die Timeline war unrealistisch"). Diese winzige linguistische Verschiebung erh√∂ht die Probleml√∂sungsgeschwindigkeit um 50%.', quote: 'Ownership beginnt in dem Moment, in dem du aufh√∂rst zu beschuldigen.' },
            { icon: 'üî•', title: 'Standards unter Druck', content: 'Wahre Teamkultur zeigt sich, wenn es hart wird. Sinken Standards oder versch√§rfen sie sich? Navy SEALs sagen: "Unter Druck steigst du nicht zur Gelegenheit auf‚Äîdu sinkst auf dein Trainingsniveau." Deine Team-Standards sind dein Training.', quote: 'Was du erlaubst, f√∂rderst du. Was du tolerierst, wird dein Standard.' },
            { icon: '‚öñÔ∏è', title: 'Konstruktiver Druck', content: 'Accountability ohne Vertrauen f√ºhlt sich wie Mikromanagement an. Accountability MIT Vertrauen f√ºhlt sich wie F√ºrsorge an. Der Unterschied? Absicht. "Ich checke dich, weil ich dir nicht vertraue" vs. "Ich checke ein, weil ich m√∂chte, dass du erfolgreich bist."', quote: 'Druck ist ein Privileg, wenn er von Menschen kommt, die an dich glauben.' },
            
            // ERGEBNISSE insights (Q17-20)
            { icon: 'üèÜ', title: 'Kollektiv > Individuell', content: 'Teams, die Gruppen-Erfolge √ºber individuelle MVPs feiern, erreichen 60% wahrscheinlicher ihre Ziele. Warum? Weil wenn alle zusammen rudern, geht das Boot schneller. Individuelle Stars schaffen Silos. Team-Erfolge schaffen Momentum.', quote: 'Es gibt kein "Ich" in "Team", aber es gibt eins in "Sieg"... warte, das funktioniert hier nicht.' },
            { icon: 'üé≠', title: 'Ego an der T√ºr abgeben', content: 'Opfer = Erfolg. Wenn Teammitglieder kollektive Ziele √ºber pers√∂nliche Agenden stellen, steigt die Produktivit√§t um 35%. Das Anti-Pattern? "Das ist nicht mein Job"-Syndrom. High Performer fragen "Wie kann ich uns helfen zu gewinnen?" nicht "Wie kann ich gut aussehen?"', quote: 'Ein Spieler, der das Team gro√üartig macht, ist wertvoller als ein gro√üartiger Spieler. - John Wooden' },
            { icon: 'üìä', title: 'Miss, was z√§hlt', content: 'Man kann nicht managen, was man nicht misst. Teams mit sichtbaren, getrackten Metriken performen 2x besser als Teams mit vagen Zielen. Die Regel? Wenn Erfolg nicht messbar ist, ist es nur eine Meinung mit einem schicken Hut.', quote: 'Was gemessen wird, wird gemanagt. Was gemanagt wird, wird erledigt.' },
            { icon: 'ü§≤', title: 'Angst, andere zu entt√§uschen', content: 'Der ultimative Team-Klebstoff? Sich mehr darum zu sorgen, Teamkollegen zu entt√§uschen als den Boss. Wenn das existiert, wird Accountability intern, nicht extern. Du tauchst auf nicht, weil du musst, sondern weil sie auf dich z√§hlen.', quote: 'Die h√∂chste Form von Accountability ist, wenn du dich selbst gegen√ºber deinem Team verantwortlich f√ºhlst.' }
        ];
        
        let questions = [];
        let currentQuestion = 0;
        let answers = {};
                    // Progress Saving System
                    const STORAGE_KEY = 'team-assessment-progress';
                    
                    function saveProgress() {
                        const progressData = {
                            currentQuestion,
                            answers,
                            timestamp: new Date().toISOString(),
                            version: '3.0.0'
                        };
                        try {
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(progressData));
                        } catch (e) {
                            console.log('Could not save progress');
                        }
                    }
                    
                    function loadProgress() {
                        try {
                            const saved = localStorage.getItem(STORAGE_KEY);
                            if (saved) {
                                const data = JSON.parse(saved);
                                const savedDate = new Date(data.timestamp);
                                const daysSince = (new Date() - savedDate) / (1000 * 60 * 60 * 24);
                                if (daysSince < 7 && data.version === '3.0.0') {
                                    return data;
                                }
                            }
                        } catch (e) {
                            console.log('Could not load progress');
                        }
                        return null;
                    }
                    
                    function clearProgress() {
                        try {
                            localStorage.removeItem(STORAGE_KEY);
                        } catch (e) {}
                    }
                    
                    function showResumePrompt() {
                        const saved = loadProgress();
                        if (!saved) return;
                        
                        const completedQuestions = Object.keys(saved.answers).length;
                        const totalQuestions = 20;
                        const percentage = Math.round((completedQuestions / totalQuestions) * 100);
                        
                        const resumeHTML = `
                            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s ease;" id="resumeModal">
                                <div style="background: white; border-radius: 20px; padding: 40px; max-width: 500px; text-align: center; animation: slideUp 0.3s ease;">
                                    <div style="font-size: 3em; margin-bottom: 20px;">üéØ</div>
                                    <h2 style="color: #a93226; margin-bottom: 15px;">Willkommen zur√ºck!</h2>
                                    <p style="color: #666; font-size: 1.1em; margin-bottom: 10px;">Du hast bereits <strong>${completedQuestions} of ${totalQuestions} questions</strong></p>
                                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 12px; margin: 20px 0;">
                                        <div style="font-size: 2.5em; font-weight: bold; color: #a93226; margin-bottom: 5px;">${percentage}%</div>
                                        <div style="color: #666;">Fortschritt abgeschlossen</div>
                                    </div>
                                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                                        <button onclick="resumeAssessment()" style="flex: 1; background: linear-gradient(135deg, #a93226 0%, #7a241b 100%); color: white; border: none; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer;">
                                            ‚ñ∂Ô∏è Fortsetzen
                                        </button>
                                        <button onclick="startFresh()" style="flex: 1; background: white; color: #666; border: 2px solid #e0e0e0; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer;">
                                            üîÑ Neu beginnen
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        document.body.insertAdjacentHTML('beforeend', resumeHTML);
                    }
                    
                    function resumeAssessment() {
                        const saved = loadProgress();
                        if (saved) {
                            currentQuestion = saved.currentQuestion;
                            answers = saved.answers;
                            document.getElementById('resumeModal')?.remove();
                            setTimeout(() => showResumePrompt(), 500);
                    renderQuestion();
                            updateProgress();
                        }
                    }
                    
                    function startFresh() {
                        clearProgress();
                        currentQuestion = 0;
                        answers = {};
                        document.getElementById('resumeModal')?.remove();
                        renderQuestion();
                        updateProgress();
                    }
                    

        onI18nReady(function() {
            questions = getQuestionsFromI18n();
            renderQuestion();
        });
        function renderQuestion() {
            if (!questions.length) return;
            const q = questions[currentQuestion];
            const card = document.getElementById('questionCard');
            let html = '';
            if (q.section) {
                html += `
                    <div class="section-header">
                        <div class="section-title">Abschnitt ${Math.floor(currentQuestion/4) + 1}: ${q.section}</div>
                        <div class="section-description">${q.sectionDesc}</div>
                    </div>
                `;
            }
            html += `
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">${currentQuestion + 1}.</span>
                        ${q.question}
                    </div>
                    <div class="scale-options">
            `;
            const labels = ['Nie', 'Selten', 'Manchmal', 'Oft', 'Immer'];
            for (let i = 1; i <= 5; i++) {
                const selected = answers[currentQuestion] === i ? 'selected' : '';
                const active = answers[currentQuestion] >= i ? 'active' : '';
                html += `
                    <label class="scale-option ${selected} ${active}" data-value="${i}">
                        <input type="radio" name="q${currentQuestion}" value="${i}">
                        <div class="scale-value">${i}</div>
                        <div class="scale-label">${labels[i-1]}</div>
                    </label>
                `;
            }
            html += `
                    </div>
                </div>
            `;
            card.innerHTML = html;
            
            // Add drag/swipe functionality
            const scaleContainer = card.querySelector('.scale-options');
            let isDragging = false;
            
            function handleInteraction(e) {
                const rect = scaleContainer.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const relativeX = Math.max(0, Math.min(1, x / rect.width));
                const value = Math.ceil(relativeX * 5) || 1;
                selectOption(e, value);
                updateSliderVisual(value);
            }
            
            function updateSliderVisual(value) {
                const options = scaleContainer.querySelectorAll('.scale-option');
                options.forEach((opt, idx) => {
                    if (idx < value) {
                        opt.classList.add('active');
                    } else {
                        opt.classList.remove('active');
                    }
                    if (idx === value - 1) {
                        opt.classList.add('selected');
                    } else {
                        opt.classList.remove('selected');
                    }
                });
            }
            
            scaleContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                handleInteraction(e);
            });
            
            scaleContainer.addEventListener('mousemove', (e) => {
                if (isDragging) handleInteraction(e);
            });
            
            scaleContainer.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            scaleContainer.addEventListener('mouseleave', () => {
                isDragging = false;
            });
            
            scaleContainer.addEventListener('touchstart', (e) => {
                handleInteraction(e);
            }, { passive: true });
            
            scaleContainer.addEventListener('touchmove', (e) => {
                handleInteraction(e);
            }, { passive: true });
            
            updateProgress();
            updateButtons();
        }
        function selectOption(e, value) {
            answers[currentQuestion] = value;
                        saveProgress();
            document.querySelectorAll('.scale-option').forEach(opt => opt.classList.remove('selected'));
            try{ e.currentTarget.classList.add('selected'); }catch(err){}
            document.getElementById('nextBtn').disabled = false;
            
            // Show insight after answering
            showInsight();
        }
        
        function showInsight() {
            // Remove any existing insight
            const existingInsight = document.querySelector('.insight-card');
            if (existingInsight) existingInsight.remove();
            
            // Get insight for current question
            const insight = insights[currentQuestion];
            if (!insight) return;
            
            // Create insight card
            const insightHTML = `
                <div class="insight-card">
                    <div class="insight-header">
                        <span class="insight-icon">${insight.icon}</span>
                        <span class="insight-title">${insight.title}</span>
                    </div>
                    <div class="insight-content">${insight.content}</div>
                    <div class="insight-quote">${insight.quote}</div>
                </div>
            `;
            
            // Insert after the question
            const questionCard = document.getElementById('questionCard');
            questionCard.insertAdjacentHTML('beforeend', insightHTML);
            
            // Smooth scroll to keep insight visible
            setTimeout(() => {
                const insightElement = document.querySelector('.insight-card');
                if (insightElement) {
                    insightElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }, 100);
        }
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            const qLabel = 'Frage';
            document.getElementById('progressText').textContent = `${qLabel} ${currentQuestion + 1} von ${questions.length}`;
        }
        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            prevBtn.style.display = currentQuestion > 0 ? 'block' : 'none';
            nextBtn.textContent = currentQuestion === questions.length - 1 ? 'Ergebnisse anzeigen ‚Üí' : 'Weiter ‚Üí';
            nextBtn.disabled = !answers.hasOwnProperty(currentQuestion);
        }
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                renderQuestion();
                window.scrollTo(0, 0);
            } else {
                showResults();
            }
        }
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
                window.scrollTo(0, 0);
            }
        }
        // --- Results logic copied and translated from English version ---
        function getScoreInterpretation(score, category) {
            const interpretations = {
                trust: {
                    high: { level: 'Starke Basis', desc: 'Dein Team hat psychologische Sicherheit und vertrauensvolle Offenheit. Mitglieder f√ºhlen sich sicher, Risiken einzugehen und authentisch zu sein.', color: '#27ae60' },
                    medium: { level: 'Vertrauen im Aufbau', desc: 'Etwas Vertrauen ist vorhanden, aber nicht immer unter Druck. Teammitglieder sind selektiv mit Offenheit.', color: '#f39c12' },
                    low: { level: 'Vertrauensl√ºcken', desc: 'Es gibt deutliche Probleme. Menschen spielen auf Nummer sicher, verstecken Probleme und vermeiden Offenheit.', color: '#e67e22' },
                    critical: { level: 'Kritisch', desc: 'Das Team agiert im √úberlebensmodus. Angst und Selbstschutz dominieren die Interaktionen.', color: '#c0392b' }
                },
                conflict: {
                    high: { level: 'Gesunde Debatte', desc: 'Dein Team hat eine produktive Konfliktkultur. Meinungsverschiedenheiten f√ºhren zu besseren Entscheidungen.', color: '#27ae60' },
                    medium: { level: 'Selektive Beteiligung', desc: 'Einige Debatten finden statt, aber gewisse Themen bleiben tabu. K√ºnstliche Harmonie herrscht gelegentlich.', color: '#f39c12' },
                    low: { level: 'Konfliktvermeidung', desc: 'Wichtige Themen werden unter den Teppich gekehrt. Meinungsverschiedenheiten finden nach, nicht w√§hrend Meetings statt.', color: '#e67e22' },
                    critical: { level: 'Toxische Harmonie', desc: 'Das Team priorisiert Frieden √ºber Fortschritt. Kritische Themen kommen nie auf.', color: '#c0392b' }
                },
                commitment: {
                    high: { level: 'Klare Ausrichtung', desc: 'Jeder kennt seine Rolle und Priorit√§ten. Entscheidungen werden mit echtem Buy-in getroffen.', color: '#27ae60' },
                    medium: { level: 'Allgemeine Zustimmung', desc: 'Meistens ausgerichtet, aber gelegentlich Verwirrung √ºber Richtung und Priorit√§ten.', color: '#f39c12' },
                    low: { level: 'Gemischte Signale', desc: 'Entscheidungen werden unterschiedlich interpretiert. Mangelnde Klarheit f√ºhrt zu Fehlanpassungen.', color: '#e67e22' },
                    critical: { level: 'Chaos', desc: 'Das Team √§ndert st√§ndig die Richtung. Niemand ist sicher bez√ºglich Priorit√§ten.', color: '#c0392b' }
                },
                accountability: {
                    high: { level: 'Peer-Accountability', desc: 'Das Team reguliert die Leistung selbst. Mitglieder nehmen sich gegenseitig in die Pflicht.', color: '#27ae60' },
                    medium: { level: 'Selektive Standards', desc: 'Accountability variiert je nach Person und Situation. Inkonsistente Durchsetzung.', color: '#f39c12' },
                    low: { level: 'Manager-abh√§ngig', desc: 'Nur F√ºhrungskr√§fte sprechen Probleme an. Peers vermeiden schwierige Gespr√§che.', color: '#e67e22' },
                    critical: { level: 'Keine Standards', desc: 'Schlechte Leistung bleibt unadressiert. Niemand h√§lt andere zur Verantwortung.', color: '#c0392b' }
                },
                results: {
                    high: { level: 'Team-First Mindset', desc: 'Kollektiver Erfolg steht im Vordergrund. Das Team feiert und scheitert gemeinsam.', color: '#27ae60' },
                    medium: { level: 'Meist ausgerichtet', desc: 'Die meisten priorisieren Teamziele, aber individuelle Agenden konkurrieren gelegentlich.', color: '#f39c12' },
                    low: { level: 'Konkurrenzierende Priorit√§ten', desc: 'Individueller Erfolg steht oft √ºber Teamzielen. Gemischte Loyalit√§t.', color: '#e67e22' },
                    critical: { level: 'Silos', desc: 'Jeder fokussiert auf eigenen Erfolg. Kein gemeinsames Engagement f√ºr Ergebnisse.', color: '#c0392b' }
                }
            };
            const level = score >= 16 ? 'high' : score >= 11 ? 'medium' : score >= 6 ? 'low' : 'critical';
            return interpretations[category][level];
        }
        function getRecommendation(score, category) {
            const recommendations = {
                trust: {
                    high: 'Halte diese Basis durch kontinuierliche Offenheit und authentische Kommunikation aufrecht.',
                    medium: 'F√∂rdere konsequente Offenheit, besonders unter Druck.',
                    low: 'Starte mit kleinen Vertrauens√ºbungen und schaffe psychologische Sicherheit.',
                    critical: 'Erw√§ge TAP-INs White Belt Fundamentals Programm ‚Äì intensiver Vertrauensaufbau.'
                },
                conflict: {
                    high: 'F√∂rdere weiterhin gesunde Debatten bei gegenseitigem Respekt.',
                    medium: 'Arbeite daran, alle Themen besprechbar zu machen, nicht nur die angenehmen.',
                    low: 'F√ºhre strukturierte Konfliktprotokolle und √ºbe schwierige Gespr√§che.',
                    critical: 'TAP-INs Conflict Sparring Labs k√∂nnen eure Konfliktkultur in 90 Tagen transformieren.'
                },
                commitment: {
                    high: 'Halte Entscheidungsprozesse klar und sorge f√ºr konsequente Umsetzung.',
                    medium: 'Verbessere Dokumentation und √úberpr√ºfung von Entscheidungen.',
                    low: 'Etabliere explizite Entscheidungsprotokolle und Best√§tigungsprozesse.',
                    critical: 'TAP-INs Blue Belt Rhythm Lab schafft klare Entscheidungsroutinen.'
                },
                accountability: {
                    high: 'St√§rke Peer-Accountability durch kontinuierliche Verst√§rkung der Standards.',
                    medium: 'Baue Peer-Feedback-Skills und Accountability-Rituale auf.',
                    low: 'F√ºhre Teamvereinbarungen und Peer-Accountability-Praktiken ein.',
                    critical: 'TAP-INs Purple Belt Sync Programm baut systematische Accountability auf.'
                },
                results: {
                    high: 'Halte die Ausrichtung von individuellen und Teamzielen f√ºr nachhaltigen Erfolg.',
                    medium: 'St√§rke die Verbindung zwischen pers√∂nlichem Erfolg und Teamergebnissen.',
                    low: 'Klare Teammetriken und geteilte Verantwortung f√ºr Ergebnisse schaffen.',
                    critical: 'TAP-INs ergebnisorientiertes Coaching richtet Teampriorit√§ten neu aus.'
                }
            };
            const level = score >= 16 ? 'high' : score >= 11 ? 'medium' : score >= 6 ? 'low' : 'critical';
            return recommendations[category][level];
        }
        function showResults() {
                        clearProgress();
            // Berechne Scores pro Kategorie
            const trustScore = [0,1,2,3].reduce((sum, i) => sum + (answers[i] || 0), 0);
            const conflictScore = [4,5,6,7].reduce((sum, i) => sum + (answers[i] || 0), 0);
            const commitmentScore = [8,9,10,11].reduce((sum, i) => sum + (answers[i] || 0), 0);
            const accountabilityScore = [12,13,14,15].reduce((sum, i) => sum + (answers[i] || 0), 0);
            const resultsScore = [16,17,18,19].reduce((sum, i) => sum + (answers[i] || 0), 0);
            const totalScore = trustScore + conflictScore + commitmentScore + accountabilityScore + resultsScore;
            const categories = [
                { name: 'Vertrauen', score: trustScore, cat: 'trust', icon: 'ü§ù' },
                { name: 'Konfliktnavigation', score: conflictScore, cat: 'conflict', icon: 'üí¨' },
                { name: 'Commitment', score: commitmentScore, cat: 'commitment', icon: 'üéØ' },
                { name: 'Verantwortlichkeit', score: accountabilityScore, cat: 'accountability', icon: '‚úÖ' },
                { name: 'Ergebnisorientierung', score: resultsScore, cat: 'results', icon: 'üèÜ' }
            ];
            const overallLevel = totalScore >= 80 ? 
                { emoji: 'üåü', text: 'High-Performing Team', desc: 'Starke Basis f√ºr Exzellenz mit Chancen zur Skalierung.' } :
                totalScore >= 60 ?
                { emoji: '‚úÖ', text: 'Funktionales Team', desc: 'Solide Grundlagen mit klaren Verbesserungsm√∂glichkeiten.' } :
                totalScore >= 40 ?
                { emoji: '‚ö†Ô∏è', text: 'Struggelndes Team', desc: 'Deutliche Herausforderungen, die gezielte Entwicklung erfordern.' } :
                { emoji: 'üö®', text: 'Kritischer Handlungsbedarf', desc: 'Grundlegende Dysfunktionen erfordern sofortige Transformation.' };
            document.getElementById('assessmentForm').classList.add('hidden');
            document.getElementById('results').classList.add('active');
            let html = `
                <div class="overall-score">
                    <h2>${overallLevel.emoji} ${overallLevel.text}</h2>
                    <div class="score">${totalScore}/100</div>
                    <p>${overallLevel.desc}</p>
                </div>
            `;
            categories.forEach(cat => {
                const interp = getScoreInterpretation(cat.score, cat.cat);
                const recommendation = getRecommendation(cat.score, cat.cat);
                const percentage = (cat.score / 20) * 100;
                html += `
                    <div class="score-section">
                        <h3>${cat.icon} ${cat.name}: ${cat.score}/20</h3>
                        <div class="score-bar">
                            <div class="score-bar-fill" style="width: ${percentage}%; background: ${interp.color};"></div>
                        </div>
                        <div class="score-display" style="color: ${interp.color};">${interp.level}</div>
                        <p class="score-interpretation">${interp.desc}</p>
                        <div class="recommendation">
                            <h4>üí° Empfehlung:</h4>
                            <p>${recommendation}</p>
                        </div>
                    </div>
                `;
            });
            document.getElementById('resultContent').innerHTML = html;
            window.scrollTo(0, 0);
            
            // Initialize social sharing
            setTimeout(() => initializeSocialSharing(totalScore, overallLevel.text), 500);
            
            // Add export buttons after results
            addExportButtons(categories, totalScore, overallLevel);
            
            // Send data to backend (Google Sheets + Database)
            saveAssessmentData(categories, totalScore, overallLevel);
        }
        
        function gatherExportData() {
            const categories = [];
            const details = [];
            
            for (let i = 0; i < questions.length; i++) {
                const q = questions[i];
                const answer = answers[i] || 0;
                details.push({
                    'Frage #': i + 1,
                    'Kategorie': q.cat,
                    'Frage': q.text,
                    'Punktzahl': answer,
                    'Maximum': 5
                });
            }
            
            ['Trust', 'Healthy Conflict', 'Commitment', 'Accountability', 'Results Focus'].forEach(cat => {
                const catQuestions = questions.filter(q => q.cat === cat);
                const catScore = catQuestions.reduce((sum, q) => {
                    const qIdx = questions.indexOf(q);
                    return sum + (answers[qIdx] || 0);
                }, 0);
                categories.push({
                    name: cat,
                    score: catScore,
                    maxScore: catQuestions.length * 5,
                    percentage: Math.round((catScore / (catQuestions.length * 5)) * 100)
                });
            });
            
            const totalScore = answers.reduce((sum, score) => sum + (score || 0), 0);
            
            return {
                timestamp: new Date().toISOString(),
                assessmentType: 'team-dynamics',
                totalScore: totalScore,
                maxScore: 100,
                percentage: totalScore,
                levelText: getOverallLevel(totalScore).text,
                categories: categories,
                details: details,
                framework: 'Patrick Lencioni'
            };
        }
        
        // Load stats from stats.json
        async function loadStats() {
            try {
                const response = await fetch('/stats.json');
                const stats = await response.json();
                document.getElementById('totalUsers').textContent = stats.totalUsers.toLocaleString('de-DE') + '+';
                document.getElementById('totalAssessments').textContent = stats.totalAssessments.toLocaleString('de-DE');
                document.getElementById('countries').textContent = stats.countries;
            } catch (error) {
                console.log('Stats not available yet');
            }
        }
        

        // Social Sharing Functions
        let currentProfile = {};

        function initializeSocialSharing(totalScore, levelText) {
            currentProfile = { totalScore, levelText };
            generateShareCard();
        }

        function generateShareCard() {
            const canvas = document.createElement("canvas");
            canvas.width = 1200;
            canvas.height = 630;
            const ctx = canvas.getContext("2d");

            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, "#a93226");
            gradient.addColorStop(1, "#7a241b");
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "rgba(255, 255, 255, 0.05)";
            for (let i = 0; i < 20; i++) {
                ctx.fillRect(i * 60, 0, 30, canvas.height);
            }

            ctx.fillStyle = "white";
            ctx.font = "bold 56px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Arial";
            ctx.textAlign = "center";

            ctx.fillText("Unser Team-Gesundheitswert:", canvas.width / 2, 180);
            
            ctx.font = "bold 120px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Arial";
            ctx.fillText(currentProfile.totalScore + "/100", canvas.width / 2, 330);
            
            ctx.font = "bold 48px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Arial";
            ctx.fillText(currentProfile.levelText, canvas.width / 2, 420);

            ctx.font = "32px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Arial";
            ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
            ctx.fillText("Wie gesund ist EUER Team?", canvas.width / 2, 550);

            const shareCanvas = document.getElementById("shareCanvas");
            if (shareCanvas) {
                shareCanvas.innerHTML = `<img src="${canvas.toDataURL()}" style="width: 100%; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);" alt="Share card">`;
            }
        }

        function getShareText() {
            return `Unser Team hat ${currentProfile.totalScore}/100 bei der Team-Gesundheitsbewertung erreicht!

Level: ${currentProfile.levelText}

Basierend auf Patrick Lencionis 5 Dysfunktionen:
‚Ä¢ Vertrauen
‚Ä¢ Konfliktnavigation
‚Ä¢ Commitment
‚Ä¢ Verantwortlichkeit
‚Ä¢ Ergebnisorientierung

Kostenlose Bewertung, sofortige Erkenntnisse.

Wie gesund ist EUER Team?`;
        }

        function shareToLinkedIn() {
            const text = encodeURIComponent(getShareText());
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&summary=${text}`, "_blank");
            
            if (typeof gtag !== "undefined") {
                gtag("event", "share", {
                    "event_category": "Social",
                    "event_label": "LinkedIn_Team_DE",
                    "value": 1
                });
            }
        }

        function shareToTwitter() {
            const text = encodeURIComponent(getShareText());
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}&hashtags=TeamGesundheit,F√ºhrung`, "_blank");
            
            if (typeof gtag !== "undefined") {
                gtag("event", "share", {
                    "event_category": "Social",
                    "event_label": "Twitter_Team_DE",
                    "value": 1
                });
            }
        }

        function copyShareLink() {
            const shareText = getShareText() + '\n\n' + window.location.href;
            navigator.clipboard.writeText(shareText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = "‚úì Kopiert!";
                btn.style.background = "#10b981";
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = "rgba(255,255,255,0.2)";
                }, 2000);
                
                if (typeof gtag !== "undefined") {
                    gtag("event", "share", {
                        "event_category": "Social",
                        "event_label": "Copy_Link_Team_DE",
                        "value": 1
                    });
                }
            });
        }

        loadStats();
        renderQuestion();
    
    // Export Functions (Option 1: Client-Side CSV/XLSX)
    function addExportButtons(data) {
        const exportHTML = `
            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 30px; margin: 30px 0; text-align: center; border: 2px solid #e0e0e0;">
                <h3 style="color: #333; margin-bottom: 15px;">üìä Export Your Results</h3>
                <p style="color: #666; margin-bottom: 20px;">Download your complete assessment results for analysis, reporting, or personal records.</p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="exportToCSV()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                        üì• Download CSV
                    </button>
                    <button onclick="exportToExcel()" style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);">
                        üìä Download Excel
                    </button>
                    <button onclick="exportToJSON()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
                        üíæ Download JSON
                    </button>
                </div>
                <p style="color: #999; margin-top: 15px; font-size: 0.9em;">Your data stays private - all exports happen directly in your browser.</p>
            </div>
        `;
        const resultContainer = document.getElementById('resultContent') || document.querySelector('.result-display') || document.querySelector('.results-container');
        if (resultContainer) {
            resultContainer.insertAdjacentHTML('beforeend', exportHTML);
        }
    }
    
    function exportToCSV() {
        const data = gatherExportData();
        const csv = convertToCSV(data);
        downloadFile(csv, 'assessment-results-' + Date.now() + '.csv', 'text/csv');
        trackExport('CSV');
    }
    
    function exportToExcel() {
        const data = gatherExportData();
        const ws = XLSX.utils.json_to_sheet(data.details || [data]);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Assessment Results");
        
        // Add summary sheet if categories exist
        if (data.categories && data.categories.length > 0) {
            const summaryData = [{
                'Assessment Date': data.timestamp,
                'Overall Score': (data.totalScore || data.score) + '/' + (data.maxScore || 100),
                'Level': data.levelText || data.type || ''
            }];
            data.categories.forEach(cat => {
                summaryData[0][cat.name + ' Score'] = cat.score + '/' + cat.maxScore;
            });
            const summaryWs = XLSX.utils.json_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, summaryWs, "Summary");
        }
        
        XLSX.writeFile(wb, 'assessment-results-' + Date.now() + '.xlsx');
        trackExport('Excel');
    }
    
    function exportToJSON() {
        const data = gatherExportData();
        const json = JSON.stringify(data, null, 2);
        downloadFile(json, 'assessment-results-' + Date.now() + '.json', 'application/json');
        trackExport('JSON');
    }
    
    function convertToCSV(data) {
        let csv = (data.assessmentType || 'Assessment') + ' Results\n';
        csv += `Date,${data.timestamp}\n`;
        csv += `Score,${(data.totalScore || data.score)}/${(data.maxScore || 100)}\n`;
        csv += `Level,${data.levelText || data.type || ''}\n`;
        csv += '\n';
        
        if (data.categories && data.categories.length > 0) {
            csv += 'Category Scores\n';
            csv += 'Category,Score,Max,Percentage\n';
            data.categories.forEach(cat => {
                csv += `${cat.name},${cat.score},${cat.maxScore},${cat.percentage}%\n`;
            });
            csv += '\n';
        }
        
        if (data.details && data.details.length > 0) {
            csv += 'Detailed Responses\n';
            const headers = Object.keys(data.details[0]);
            csv += headers.join(',') + '\n';
            data.details.forEach(row => {
                const values = headers.map(h => {
                    let v = row[h];
                    if (typeof v === 'string') v = v.replace(/"/g, '""');
                    return `"${v}"`;
                });
                csv += values.join(',') + '\n';
            });
        }
        
        return csv;
    }
    
    function downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }
    
    function trackExport(format) {
        if (typeof gtag !== 'undefined') {
            gtag('event', 'export_data', {
                'event_category': 'Data Export',
                'event_label': format + '_Assessment',
                'value': 1
            });
        }
    }
    
    // Backend data collection (Google Sheets + Database)
    async function saveAssessmentData(data) {
        const GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE';
        
        try {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    ...data,
                    userAgent: navigator.userAgent,
                    language: navigator.language
                })
            });
        } catch (error) {
            console.log('Google Sheets not configured');
        }
        
        try {
            await fetch('/.netlify/functions/save-assessment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
        } catch (error) {
            console.log('Database not configured');
        }
        
        try {
            const existing = JSON.parse(localStorage.getItem('tap-in-assessments') || '[]');
            existing.push({ ...data, id: Date.now() });
            if (existing.length > 10) existing.shift();
            localStorage.setItem('tap-in-assessments', JSON.stringify(existing));
        } catch (e) {}
    }

    </script>
</body>
</html>

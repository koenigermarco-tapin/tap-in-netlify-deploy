<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#7c3aed">
    <title>üü£ Purple Belt Stripe 4: Results Focus - TAP-IN</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 25px; border-bottom: 3px solid #f0f0f0; }
        .header h1 { color: #6d28d9; font-size: 2.3em; margin-bottom: 15px; }
        .header .subtitle { color: #666; font-size: 1.1em; margin-bottom: 10px; }
        .header .duration { color: #999; font-size: 0.9em; font-style: italic; }
        
        .progress-bar { position: sticky; top: 10px; background: white; padding: 15px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; }
        .progress-text { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 8px; }
        .progress-fill { height: 8px; background: #e0e0e0; border-radius: 10px; overflow: hidden; }
        .progress-fill-bar { background: linear-gradient(90deg, #7c3aed 0%, #6d28d9 100%); height: 100%; width: 0%; transition: width 0.3s ease; }
        
        .section-header { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; }
        .section-header h3 { font-size: 1.2em; margin-bottom: 5px; }
        .section-header .section-desc { font-size: 0.9em; opacity: 0.95; font-style: italic; }
        
        .question-card { background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 20px; }
        .question-number { color: #6d28d9; font-weight: bold; font-size: 0.9em; margin-bottom: 10px; }
        .question-text { font-size: 1.2em; color: #333; margin-bottom: 25px; font-weight: 500; line-height: 1.5; }
        
        .scale-options { display: flex; justify-content: space-between; align-items: flex-end; gap: 2px; flex-wrap: nowrap; height: 140px; position: relative; background: linear-gradient(to top right, rgba(124, 58, 237, 0.1) 0%, rgba(109, 40, 217, 0.05) 50%, transparent 50%); border-radius: 8px; padding: 5px; cursor: pointer; user-select: none; }
        .scale-option { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; background: linear-gradient(135deg, rgba(124, 58, 237, 0.15) 0%, rgba(109, 40, 217, 0.1) 100%); border: 3px solid #cbd5e1; border-radius: 6px; transition: all 0.15s ease; position: relative; z-index: 1; padding: 10px 5px; }
        .scale-option:nth-child(1) { height: 50px; opacity: 0.15; }
        .scale-option:nth-child(2) { height: 70px; opacity: 0.35; }
        .scale-option:nth-child(3) { height: 90px; opacity: 0.55; }
        .scale-option:nth-child(4) { height: 110px; opacity: 0.75; }
        .scale-option:nth-child(5) { height: 130px; opacity: 0.85; }
        .scale-option span { font-size: 1.3em; font-weight: 800; color: #1e293b; opacity: 1; margin-bottom: 5px; }
        .scale-option small { font-size: 0.7em; color: #475569; font-weight: 600; opacity: 1; text-align: center; line-height: 1.2; }
        .scale-option:hover { transform: scale(1.05); border-color: #7c3aed; }
        .scale-option.active, .scale-option.selected { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; border-color: #5b21b6; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.4); }
        .scale-option.active ~ .scale-option { background: linear-gradient(135deg, rgba(124, 58, 237, 0.15) 0%, rgba(109, 40, 217, 0.1) 100%); color: #333; }
        .scale-option.active span, .scale-option.selected span { color: white; }
        .scale-option.active small, .scale-option.selected small { color: rgba(255,255,255,0.9); }
        
        .insight-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-left: 4px solid #7c3aed; padding: 20px; margin: 20px 0; border-radius: 10px; animation: slideIn 0.4s ease; }
        .insight-icon { font-size: 2rem; margin-bottom: 10px; }
        .insight-title { color: #6d28d9; font-size: 1.1em; font-weight: bold; margin-bottom: 12px; }
        .insight-content { color: #555; line-height: 1.7; margin-bottom: 12px; }
        .insight-quote { font-style: italic; color: #666; font-size: 0.95em; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 3px solid #7c3aed; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Scenario Question Styles */
        .scenario-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .scenario-option {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .scenario-option:hover {
            border-color: #667eea;
            background: #f0f0ff;
            transform: translateX(5px);
        }
        .scenario-option.selected {
            border-color: #667eea;
            background: #e8e8ff;
        }
        .scenario-option.correct {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        .scenario-option.correct .option-letter {
            background: #10b981;
        }
        .scenario-option.incorrect {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        }
        .scenario-option.incorrect .option-letter {
            background: #ef4444;
        }
        .scenario-option.neutral {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        .scenario-option.neutral .option-letter {
            background: #f59e0b;
        }
        .option-letter {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .option-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            padding-top: 8px;
        }
        .scenario-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .scenario-insight {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid #7c3aed;
        }
        
        /* Multiple Choice Styles */
        .mc-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .mc-option {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .mc-option:hover {
            border-color: #667eea;
            background: #fafbff;
            transform: translateX(3px);
        }
        .mc-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        .mc-radio {
            padding-top: 2px;
        }
        .mc-radio input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            cursor: pointer;
        }
        .mc-content {
            flex: 1;
        }
        .mc-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            margin-bottom: 6px;
        }
        .mc-type {
            color: #667eea;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .mc-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .mc-insight {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid #10b981;
        }
        .mc-type-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg) translateX(200px);
                opacity: 0;
            }
        }
        .milestone-content button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .fun-fact-box {
            animation: slideIn 0.4s ease;
        }
        
        @media (max-width: 768px) {
            .scenario-option {
                padding: 12px 15px;
                gap: 12px;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            .option-text {
                font-size: 0.9rem;
            }
            .mc-option {
                padding: 15px;
            }
            .mc-text {
                font-size: 0.9rem;
            }
        }
        
        .nav-buttons { display: flex; gap: 15px; justify-content: space-between; margin-top: 25px; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.2s; font-weight: 600; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-primary { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .results-container { display: none; }
        .results-container.active { display: block; }
        .overall-score { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; border-radius: 20px; padding: 40px; text-align: center; margin-bottom: 30px; }
        .score-number { font-size: 4em; font-weight: bold; margin-bottom: 10px; }
        .score-label { font-size: 1.3em; opacity: 0.95; }
        .type-card { background: #f8f9fa; padding: 30px; border-radius: 15px; margin: 20px 0; border-left: 4px solid #7c3aed; }
        .type-card h3 { color: #6d28d9; margin-bottom: 15px; font-size: 1.5em; }
        .type-card ul { list-style: none; padding-left: 0; }
        .type-card li { padding: 8px 0; padding-left: 25px; position: relative; color: #555; line-height: 1.7; }
        .type-card li:before { content: "‚Üí"; position: absolute; left: 0; color: #7c3aed; font-weight: bold; }
        .cta-box { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; border-radius: 15px; padding: 30px; text-align: center; margin-top: 30px; }
        .cta-box h3 { font-size: 1.6em; margin-bottom: 15px; }
        .cta-box p { font-size: 1em; margin-bottom: 20px; opacity: 0.95; }
        .cta-btn { background: white; color: #6d28d9; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: bold; display: inline-block; transition: all 0.2s; }
        .cta-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(255,255,255,0.3); }
        
        .tap-out-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
        }
        .tap-out-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.6);
        }
        @media (max-width: 768px) {
            .container { padding: 25px; }
            .header h1 { font-size: 2em; }
            .scale-option small { font-size: 0.65em; }
            .tap-out-button {
                top: 10px;
                right: 10px;
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }
        /* ============= NUMBERED OPTION BOX READABILITY FIX ============= */
        .scale-option,
        .rating-option,
        .numbered-option,
        .option-number,
        [data-value="1"],
        [data-value="2"],
        [data-value="3"],
        [data-value="4"],
        [data-value="5"] {
            color: #FFFFFF !important;
            font-weight: 700 !important;
            font-size: 1.1rem !important;
            background: #1e293b !important;
            border: 2px solid #475569 !important;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5) !important;
        }
        .scale-option:hover,
        .rating-option:hover,
        .numbered-option:hover,
        .option-number:hover,
        [data-value]:hover {
            background: #334155 !important;
            border-color: #667eea !important;
            color: #FFFFFF !important;
            transform: scale(1.05) !important;
        }
        .scale-option.selected,
        .rating-option.selected,
        .numbered-option.selected,
        .option-number.selected,
        [data-value].selected {
            background: #667eea !important;
            border-color: #818cf8 !important;
            color: #FFFFFF !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
        }
        .scale-label,
        .rating-label,
        .option-label {
            color: #FFFFFF !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
            text-align: center !important;
            margin-top: 0.5rem !important;
        }
        .scale-container,
        .rating-container,
        .options-row {
            display: flex !important;
            justify-content: space-between !important;
            gap: 0.75rem !important;
            margin: 1.5rem 0 !important;
        }
        .scale-container > *,
        .rating-container > *,
        .options-row > * {
            flex: 1 !important;
            min-width: 60px !important;
            text-align: center !important;
            padding: 1rem 0.5rem !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        @media (max-width: 768px) {
            .scale-option,
            .rating-option,
            .numbered-option,
            .option-number,
            [data-value] {
                font-size: 1rem !important;
                padding: 0.75rem 0.25rem !important;
                min-width: 50px !important;
            }
            .scale-label,
            .rating-label,
            .option-label {
                font-size: 0.75rem !important;
            }
        }
    </style>
</head>
<body>
    <!-- TAP OUT Button -->
    <button class="tap-out-button" onclick="tapOut()" id="tapOutBtn" style="display: none;">
        <div class="tap-icon">ü•ã</div>
        <div class="tap-text">TAP</div>
    </button>

    <div class="container">
        <!-- Assessment Form -->
        <div id="assessmentForm">
            <div class="header">
                <h1>üü£ Purple Belt - Stripe 4: Results Focus</h1>
                <p class="subtitle">Outcome Orientation, Metrics & Collective Results</p>
                <p class="duration">‚è±Ô∏è 8-10 Minutes ‚Ä¢ 18 Questions</p>
            </div>

            <!-- Intro Section -->
            <div id="introSection" style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #7c3aed;">
                <h3 style="color: #333; margin-bottom: 15px;">üéØ Results - The Ultimate Measure</h3>
                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>Purple Belt teaches you that results matter more than activity.</strong> This assessment reveals your ability to focus on outcomes, measure what matters, and prioritize collective results over individual success. The best teams focus on results.
                </p>
                
                <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #7c3aed;">
                    <p style="font-style: italic; color: #555; margin-bottom: 10px;">
                        "In BJJ, you don't win by looking good. You win by getting the tap. That's results focus."
                    </p>
                    <p style="text-align: right; color: #888; font-size: 0.9em;">‚Äî BJJ Wisdom</p>
                </div>

                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>Research from Patrick Lencioni</strong> shows that inattention to results is the fifth dysfunction. Teams that focus on collective results outperform others. This assessment helps you:
                </p>
                <ul style="color: #666; line-height: 1.8; margin-left: 20px; margin-bottom: 15px;">
                    <li>Assess your results orientation</li>
                    <li>Evaluate your metrics and measurement focus</li>
                    <li>Identify your collective vs individual results mindset</li>
                    <li>Recognize areas for growth in results culture</li>
                </ul>

                <p style="color: #666; line-height: 1.7; margin-top: 15px; padding: 15px; background: #f3e8ff; border-radius: 8px; font-size: 0.95em;">
                    <strong>ü•ã In BJJ:</strong> You don't win by looking good. You win by getting the tap. That's results focus. In BJJ, you measure results by taps, not by how good your technique looks. The best teams focus on collective results, not individual success.
                </p>
                
                <button onclick="startAssessment()" style="background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3); display: block; margin: 20px auto 0; width: auto;">
                    Start Assessment ‚Üí
                </button>
            </div>

            <div class="progress-bar" style="display: none;" id="progressBarContainer">
                <div class="progress-text"><span id="currentSection">Results Orientation</span> ‚Ä¢ Question <span id="currentQ">1</span> of 18</div>
                <div class="progress-fill">
                    <div class="progress-fill-bar" id="progressBar"></div>
                </div>
            </div>

            <div id="questionContainer" style="display: none;"></div>

            <div class="nav-buttons" style="display: none;" id="navButtons">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" disabled>‚Üê Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next ‚Üí</button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="results-container">
            <div class="header">
                <h1>üü£ Your Results Focus Profile</h1>
            </div>

            <div class="overall-score" id="typeResultCard">
                <div class="score-number" id="typeEmoji">üéØ</div>
                <div class="score-label" id="typeLabel">Calculating...</div>
            </div>

            <div id="typeDetails"></div>

            <div class="cta-box">
                <h3>üü£ Purple Belt Stripe 4 Complete!</h3>
                <p>You now understand your results focus capacity. Ready to take the Purple Belt Assessment?</p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                    <a href="purple-belt-assessment.html" class="cta-btn" style="margin: 0;">Take Purple Belt Assessment ‚Üí</a>
                    <a href="gym-dashboard.html" class="cta-btn" style="background: rgba(255,255,255,0.2); border: 2px solid white; margin: 0;">Back to The Gym</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            // RESULTS ORIENTATION (6 questions)
            {
                section: 'Results Orientation',
                sectionDesc: 'Your focus on outcomes vs activities',
                question: 'I focus on results and outcomes rather than just activities...',
                category: 'focus'
            },
            {
                question: 'I measure success by outcomes achieved, not hours worked...',
                category: 'measure'
            },
            {
                question: 'I prioritize what produces results over what feels good...',
                category: 'prioritize'
            },
            {
                question: 'I can distinguish between activity and achievement...',
                category: 'distinguish'
            },
            {
                question: 'I focus on what matters most for results...',
                category: 'matters'
            },
            {
                question: 'I avoid getting distracted by non-result activities...',
                category: 'distracted'
            },
            // METRICS & MEASUREMENT (6 questions)
            {
                section: 'Metrics & Measurement',
                sectionDesc: 'Your ability to measure what matters',
                question: 'I track metrics that actually matter for results...',
                category: 'track'
            },
            {
                question: 'I can identify leading vs lagging indicators...',
                category: 'indicators'
            },
            {
                question: 'I use data to make decisions about what to focus on...',
                category: 'data'
            },
            {
                question: 'I measure progress toward goals regularly...',
                category: 'progress'
            },
            {
                question: 'I can identify when metrics are misleading...',
                category: 'misleading'
            },
            {
                question: 'I focus on metrics that drive results, not vanity metrics...',
                category: 'vanity'
            },
            // COLLECTIVE RESULTS (6 questions)
            {
                section: 'Collective Results',
                sectionDesc: 'Your focus on team results vs individual success',
                question: 'I prioritize team results over individual success...',
                category: 'team'
            },
            {
                question: 'I celebrate collective wins more than individual wins...',
                category: 'celebrate'
            },
            {
                question: 'I can sacrifice individual recognition for team results...',
                category: 'sacrifice'
            },
            {
                question: 'I help others succeed even if it doesn\'t directly benefit me...',
                category: 'help'
            },
            {
                question: 'I measure team success, not just my own...',
                category: 'measure-team'
            },
            {
                question: 'I believe collective results matter more than individual achievement...',
                category: 'believe'
            }
        ];

        const insights = [
            // RESULTS ORIENTATION INSIGHTS (6)
            { icon: 'üéØ', title: 'Focus on Results, Not Activity', content: 'Results matter more than activity. <strong>Research shows</strong> teams that focus on outcomes outperform others. In BJJ: You don\'t win by looking good. You win by getting the tap. That\'s results focus.', quote: '"You don\'t win by looking good. You win by getting the tap." - BJJ Results' },
            { icon: 'üìä', title: 'Measure Outcomes, Not Hours', content: 'Measure success by outcomes achieved, not hours worked. <strong>Research shows</strong> outcome-focused teams are more effective. In BJJ: You measure results by taps, not by how long you train.', quote: '"You measure results by taps, not by how long you train." - BJJ Measurement' },
            { icon: '‚ö°', title: 'Prioritize Results Over Feelings', content: 'Prioritize what produces results over what feels good. <strong>Research shows</strong> results-focused teams make better decisions. In BJJ: You prioritize techniques that work, not techniques that feel good.', quote: '"You prioritize techniques that work, not techniques that feel good." - BJJ Priority' },
            { icon: 'üîç', title: 'Distinguish Activity from Achievement', content: 'You can distinguish between activity and achievement. <strong>Research shows</strong> activity doesn\'t equal results. In BJJ: You distinguish between training hard and training effectively. That\'s the difference.', quote: '"You distinguish between training hard and training effectively." - BJJ Distinction' },
            { icon: 'üíé', title: 'Focus on What Matters Most', content: 'Focus on what matters most for results. <strong>Research shows</strong> focus drives results. In BJJ: You focus on techniques that win, not techniques that look cool. That\'s what matters.', quote: '"You focus on techniques that win, not techniques that look cool." - BJJ Focus' },
            { icon: 'üö´', title: 'Avoid Non-Result Activities', content: 'Avoid getting distracted by non-result activities. <strong>Research shows</strong> focus prevents distraction. In BJJ: You avoid techniques that don\'t work, even if they\'re fun. That\'s discipline.', quote: '"You avoid techniques that don\'t work, even if they\'re fun." - BJJ Discipline' },
            // METRICS & MEASUREMENT INSIGHTS (6)
            { icon: 'üìà', title: 'Track Metrics That Matter', content: 'Track metrics that actually matter for results. <strong>Research shows</strong> the right metrics drive performance. In BJJ: You track taps, not hours. That\'s what matters.', quote: '"You track taps, not hours. That\'s what matters." - BJJ Metrics' },
            { icon: 'üîÆ', title: 'Identify Leading vs Lagging Indicators', content: 'You can identify leading vs lagging indicators. <strong>Research shows</strong> leading indicators predict results. In BJJ: You track technique improvement (leading) not just competition wins (lagging).', quote: '"You track technique improvement (leading) not just competition wins (lagging)." - BJJ Indicators' },
            { icon: 'üìä', title: 'Use Data for Decisions', content: 'Use data to make decisions about what to focus on. <strong>Research shows</strong> data-driven decisions are better. In BJJ: You use data from your rolls to decide what to work on. That\'s data-driven.', quote: '"You use data from your rolls to decide what to work on." - BJJ Data' },
            { icon: 'üìÖ', title: 'Measure Progress Regularly', content: 'Measure progress toward goals regularly. <strong>Research shows</strong> regular measurement drives results. In BJJ: You measure progress weekly, not just at competitions. That\'s regular measurement.', quote: '"You measure progress weekly, not just at competitions." - BJJ Regularity' },
            { icon: '‚ö†Ô∏è', title: 'Identify Misleading Metrics', content: 'You can identify when metrics are misleading. <strong>Research shows</strong> misleading metrics lead to bad decisions. In BJJ: You know when a metric doesn\'t reflect real progress. That\'s awareness.', quote: '"You know when a metric doesn\'t reflect real progress." - BJJ Awareness' },
            { icon: 'üíé', title: 'Focus on Results Metrics, Not Vanity', content: 'Focus on metrics that drive results, not vanity metrics. <strong>Research shows</strong> vanity metrics don\'t drive results. In BJJ: You focus on taps (results) not Instagram likes (vanity).', quote: '"You focus on taps (results) not Instagram likes (vanity)." - BJJ Real Metrics' },
            // COLLECTIVE RESULTS INSIGHTS (6)
            { icon: 'üë•', title: 'Prioritize Team Results', content: 'Prioritize team results over individual success. <strong>Research shows</strong> teams that prioritize collective results outperform. In BJJ: You prioritize team championships over individual medals. That\'s team focus.', quote: '"You prioritize team championships over individual medals." - BJJ Team Focus' },
            { icon: 'üéâ', title: 'Celebrate Collective Wins', content: 'Celebrate collective wins more than individual wins. <strong>Research shows</strong> celebrating collective wins builds culture. In BJJ: You celebrate when your team wins, not just when you win. That\'s collective celebration.', quote: '"You celebrate when your team wins, not just when you win." - BJJ Celebration' },
            { icon: 'ü§ù', title: 'Sacrifice Individual Recognition', content: 'You can sacrifice individual recognition for team results. <strong>Research shows</strong> sacrifice builds team culture. In BJJ: You sacrifice your own game to help your team win. That\'s sacrifice.', quote: '"You sacrifice your own game to help your team win." - BJJ Sacrifice' },
            { icon: 'üí™', title: 'Help Others Succeed', content: 'You help others succeed even if it doesn\'t directly benefit you. <strong>Research shows</strong> helping others drives collective results. In BJJ: You help your training partners get better, even if it makes them harder to beat. That\'s helping.', quote: '"You help your training partners get better, even if it makes them harder to beat." - BJJ Helping' },
            { icon: 'üìä', title: 'Measure Team Success', content: 'You measure team success, not just your own. <strong>Research shows</strong> team measurement drives collective results. In BJJ: You measure your team\'s performance, not just your own. That\'s team measurement.', quote: '"You measure your team\'s performance, not just your own." - BJJ Team Measurement' },
            { icon: 'üåü', title: 'Collective Results Matter More', content: 'You believe collective results matter more than individual achievement. <strong>Research shows</strong> this belief drives team performance. In BJJ: You believe team success matters more than individual success. That\'s the belief.', quote: '"You believe team success matters more than individual success." - BJJ Belief' }
        ];

        const sectionIntros = {
            'Results Orientation': 'Results matter more than activity. Teams that focus on outcomes outperform others. Research shows results-focused teams are more effective. In BJJ: You don\'t win by looking good. You win by getting the tap. That\'s results focus.',
            'Metrics & Measurement': 'Measure what matters. Track metrics that actually drive results. Research shows the right metrics drive performance. In BJJ: You track taps, not hours. That\'s what matters.',
            'Collective Results': 'Collective results matter more than individual success. Teams that prioritize team results outperform. Research shows collective focus drives team performance. In BJJ: You prioritize team championships over individual medals.'
        };

        let currentQuestionIndex = 0;
        let answers = {};
        const totalQuestions = questions.length;
        const currentStripeName = 'purpleBeltStripe4';

        function tapOut() {
            if (confirm('ü•ã TAP OUT?\n\nYour progress will be saved. Return to dashboard?')) {
                saveProgress();
                window.location.href = 'gym-dashboard.html';
            }
        }

        function checkForSavedProgress() {
            const saved = localStorage.getItem('currentProgress');
            if (!saved) return false;
            
            try {
                const progress = JSON.parse(saved);
                if (progress.stripe !== currentStripeName) return false;
                
                const daysSince = (Date.now() - progress.timestamp) / (1000 * 60 * 60 * 24);
                if (daysSince > 7) {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
                
                const resume = confirm(
                    "ü•ã WELCOME BACK!\n\n" +
                    "You were on Question " + progress.currentQuestion + " of " + (progress.totalQuestions || totalQuestions) + ".\n" +
                    "Resume where you left off?"
                );
                
                if (resume) {
                    currentQuestionIndex = progress.questionIndex || (progress.currentQuestion - 1);
                    answers = progress.answers || {};
                    return true;
                } else {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
            } catch (e) {
                console.error('Error loading saved progress:', e);
                return false;
            }
        }
        
        function saveProgress() {
            const progressData = {
                stripe: currentStripeName,
                currentQuestion: currentQuestionIndex + 1,
                questionIndex: currentQuestionIndex,
                answers: answers,
                timestamp: Date.now(),
                partialComplete: true,
                totalQuestions: totalQuestions
            };
            localStorage.setItem('currentProgress', JSON.stringify(progressData));
        }
        
        function clearProgress() {
            localStorage.removeItem('currentProgress');
        }
        
        function startAssessment() {
            // Check if Purple Belt Stripe 3 is complete
            if (localStorage.getItem('purpleBeltStripe3Complete') !== 'true') {
                alert('Please complete Purple Belt Stripe 3 first.');
                window.location.href = 'purple-belt.html';
                return;
            }

            // Track start time for speed achievements
            localStorage.setItem('assessmentStartTime', Date.now().toString());
            
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('progressBarContainer').style.display = 'block';
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('navButtons').style.display = 'flex';
            document.getElementById('tapOutBtn').style.display = 'flex';
            
            const resumed = checkForSavedProgress();
            if (resumed) {
                renderQuestion(currentQuestionIndex);
                updateProgress();
            } else {
                currentQuestionIndex = 0;
                answers = {};
                renderQuestion(0);
            }
        }

        let isDragging = false;

        function renderQuestion(index) {
            const q = questions[index];
            
            // Handle different question types
            if (q.type === 'scenario') {
                renderScenario(index, q);
            } else if (q.type === 'multiple-choice') {
                renderMultipleChoice(index, q);
            } else {
                // Existing Likert scale rendering
                renderLikertScale(index, q);
            }
            
            updateProgress();
        }
        
        function renderLikertScale(index, q) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (q.section) {
                html += `
                    <div class="section-header">
                        <h3>${q.section}</h3>
                        <div class="section-desc">${q.sectionDesc}</div>
                    </div>
                `;
                document.getElementById('currentSection').textContent = q.section;
                
                if (sectionIntros[q.section]) {
                    html += `
                        <div class="insight-card" style="margin-bottom: 25px;">
                            <div class="insight-icon">üí°</div>
                            <div class="insight-title">Why This Matters</div>
                            <div class="insight-content">${sectionIntros[q.section]}</div>
                        </div>
                    `;
                }
            }
            
            const options = getOptionsForQuestion(q);
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="scale-options" id="scaleContainer">
                        ${options.map((opt, idx) => `
                            <div class="scale-option ${answers[index] === opt.value ? 'selected' : ''}" data-value="${opt.value}" onclick="selectOption(event, ${opt.value})">
                                <span>${idx + 1}</span>
                                <small>${opt.text}</small>
                            </div>
                        `).join('')}
                    </div>
                    <div id="insightContainer"></div>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('currentQ').textContent = index + 1;
            setupDragHandlers();
            
            if (answers[index]) {
                showInsight(insights[index]);
            }
        }

        function getOptionsForQuestion(q) {
            const questionText = q.question.toLowerCase();
            
            // Default scale options
            const defaultOptions = [
                { text: 'Not at all', value: 1 },
                { text: 'Somewhat', value: 2 },
                { text: 'Moderately', value: 3 },
                { text: 'Well', value: 4 },
                { text: 'Perfectly', value: 5 }
            ];
            
            // Custom options for specific questions
            if (questionText.includes('focus on results') || questionText.includes('outcomes rather than')) {
                return [
                    { text: 'Never - focus on activity', value: 1 },
                    { text: 'Rarely - usually activity', value: 2 },
                    { text: 'Sometimes - depends', value: 3 },
                    { text: 'Often - usually results', value: 4 },
                    { text: 'Always - always results', value: 5 }
                ];
            } else if (questionText.includes('measure success by outcomes') || questionText.includes('not hours worked')) {
                return [
                    { text: 'Never - measure hours', value: 1 },
                    { text: 'Rarely - usually hours', value: 2 },
                    { text: 'Sometimes - both', value: 3 },
                    { text: 'Often - usually outcomes', value: 4 },
                    { text: 'Always - always outcomes', value: 5 }
                ];
            } else if (questionText.includes('prioritize team results') || questionText.includes('over individual success')) {
                return [
                    { text: 'Never - prioritize individual', value: 1 },
                    { text: 'Rarely - usually individual', value: 2 },
                    { text: 'Sometimes - depends', value: 3 },
                    { text: 'Often - usually team', value: 4 },
                    { text: 'Always - always team', value: 5 }
                ];
            } else if (questionText.includes('celebrate collective wins') || questionText.includes('more than individual')) {
                return [
                    { text: 'Never - celebrate individual', value: 1 },
                    { text: 'Rarely - usually individual', value: 2 },
                    { text: 'Sometimes - both', value: 3 },
                    { text: 'Often - usually collective', value: 4 },
                    { text: 'Always - always collective', value: 5 }
                ];
            }
            
            return defaultOptions;
        }
        
        function renderScenario(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Scenario ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="scenario-options">
                        ${question.options.map((opt, idx) => `
                            <div class="scenario-option" data-option="${idx}" onclick="selectScenario(${index}, ${idx})">
                                <div class="option-letter">${String.fromCharCode(65 + idx)}</div>
                                <div class="option-text">${opt.text}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="scenarioFeedback" class="scenario-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectScenario(index, selectedIdx);
                }
            }
        }
        
        function selectScenario(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback on options
            document.querySelectorAll('.scenario-option').forEach((opt, idx) => {
                opt.classList.remove('selected', 'correct', 'incorrect', 'neutral');
                
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    
                    // Color code based on value
                    if (selectedOption.value >= 4) {
                        opt.classList.add('correct');
                    } else if (selectedOption.value <= 2) {
                        opt.classList.add('incorrect');
                    } else {
                        opt.classList.add('neutral');
                    }
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('scenarioFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card scenario-insight">
                        <div class="insight-content">${selectedOption.feedback}</div>
                        ${selectedOption.insight ? `<div class="insight-quote">${selectedOption.insight}</div>` : ''}
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }
        
        function renderMultipleChoice(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="mc-options">
                        ${question.options.map((opt, idx) => `
                            <div class="mc-option" data-option="${idx}" onclick="selectMultipleChoice(${index}, ${idx})">
                                <div class="mc-radio">
                                    <input type="radio" name="mc${index}" value="${idx}">
                                </div>
                                <div class="mc-content">
                                    <div class="mc-text">${opt.text}</div>
                                    ${opt.type ? `<div class="mc-type">${opt.type}</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="mcFeedback" class="mc-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectMultipleChoice(index, selectedIdx);
                }
            }
        }
        
        function selectMultipleChoice(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback
            document.querySelectorAll('.mc-option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('mcFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card mc-insight">
                        ${selectedOption.type ? `<div class="mc-type-badge">${selectedOption.type}</div>` : ''}
                        <div class="insight-content">${selectedOption.feedback}</div>
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }

        function setupDragHandlers() {
            const scaleContainer = document.getElementById('scaleContainer');
            if (!scaleContainer) return;
            
            function handleInteraction(e) {
                const rect = scaleContainer.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const relativeX = Math.max(0, Math.min(1, x / rect.width));
                const value = Math.ceil(relativeX * 5) || 1;
                selectOption(e, value);
                updateSliderVisual(value);
            }

            scaleContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                handleInteraction(e);
            });

            scaleContainer.addEventListener('mousemove', (e) => {
                if (isDragging) handleInteraction(e);
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            scaleContainer.addEventListener('touchstart', (e) => {
                isDragging = true;
                handleInteraction(e);
            }, { passive: false });

            scaleContainer.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleInteraction(e);
                }
            }, { passive: false });

            scaleContainer.addEventListener('touchend', () => {
                isDragging = false;
            });
        }

        function updateSliderVisual(value) {
            const options = document.querySelectorAll('.scale-option');
            options.forEach((opt, idx) => {
                if (idx < value) {
                    opt.classList.add('active');
                } else {
                    opt.classList.remove('active');
                }
            });
        }

        function selectOption(e, value) {
            e.stopPropagation();
            answers[currentQuestionIndex] = value;
            
            document.querySelectorAll('.scale-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            const selectedOpt = document.querySelector(`[data-value="${value}"]`);
            if (selectedOpt) {
                selectedOpt.classList.add('selected');
            }
            
            updateSliderVisual(value);
            document.getElementById('nextBtn').disabled = false;
            showInsight(insights[currentQuestionIndex]);
            
            saveProgress();
        }

        function showInsight(insight) {
            const container = document.getElementById('insightContainer');
            container.innerHTML = `
                <div class="insight-card">
                    <div class="insight-icon">${insight.icon}</div>
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-content">${insight.content}</div>
                    <div class="insight-quote">${insight.quote}</div>
                </div>
            `;
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = false;
                document.getElementById('nextBtn').disabled = !answers[currentQuestionIndex];
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateProgress() {
            const answered = Object.keys(answers).length;
            const progress = (answered / questions.length) * 100;
            if (document.getElementById('progressBar')) {
                document.getElementById('progressBar').style.width = progress + '%';
            }
            
            // Milestone celebrations
            checkMilestones(progress);
            
            if (currentQuestionIndex === questions.length - 1) {
                if (document.getElementById('nextBtn')) {
                    document.getElementById('nextBtn').textContent = 'See Results üéØ';
                }
            }
        }
        
        // Milestone system
        function checkMilestones(progress) {
            if (!window.milestonesShown) {
                window.milestonesShown = [];
            }
            
            const milestones = [25, 50, 75, 100];
            const currentMilestone = Math.floor(progress / 25) * 25;
            
            if (milestones.includes(currentMilestone) && 
                !window.milestonesShown.includes(currentMilestone) &&
                progress >= currentMilestone) {
                
                window.milestonesShown.push(currentMilestone);
                showMilestoneCelebration(currentMilestone);
            }
        }
        
        function showMilestoneCelebration(percent) {
            const messages = {
                25: {
                    emoji: 'üéØ',
                    title: '25% Complete!',
                    message: 'You\'re building momentum! Great start!',
                    color: 'linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)'
                },
                50: {
                    emoji: 'üî•',
                    title: 'Halfway There!',
                    message: 'You\'re crushing it! Keep going!',
                    color: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'
                },
                75: {
                    emoji: 'üí™',
                    title: '75% Complete!',
                    message: 'Almost done! Finish strong!',
                    color: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)'
                },
                100: {
                    emoji: 'üéâ',
                    title: 'Assessment Complete!',
                    message: 'Amazing work! Time to see your results!',
                    color: 'linear-gradient(135deg, #10b981 0%, #059669 100%)'
                }
            };
            
            const milestone = messages[percent];
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'milestone-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.7); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div class="milestone-content" style="
                    background: ${milestone.color}; color: white;
                    padding: 50px; border-radius: 20px; text-align: center;
                    max-width: 500px; animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">${milestone.emoji}</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800;">${milestone.title}</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.95;">${milestone.message}</p>
                    <button onclick="this.closest('.milestone-modal').remove()" style="
                        background: white; color: #333; padding: 15px 30px;
                        border: none; border-radius: 10px; font-size: 1.1rem;
                        font-weight: 700; cursor: pointer; transition: all 0.2s;
                    ">
                        Continue ‚Üí
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Trigger confetti
            triggerConfetti();
            
            // Auto-close after 3 seconds if not dismissed
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.style.opacity = '0';
                    setTimeout(() => modal.remove(), 300);
                }
            }, 3000);
        }
        
        function triggerConfetti() {
            const emojis = ['üéâ', '‚≠ê', '‚ú®', 'üéä', 'üí´', 'üåü'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.cssText = `
                    position: fixed; font-size: 2rem; z-index: 9999;
                    left: ${Math.random() * 100}vw; top: -50px;
                    pointer-events: none;
                    animation: confettiFall ${2 + Math.random() * 2}s ease-out forwards;
                `;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 4000);
            }
        }
        
        function showAchievementBadge(badgeId, title, description, xpValue) {
            const badge = document.createElement('div');
            badge.className = 'achievement-modal';
            badge.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const badgeEmojis = {
                'first-stripe': 'üë£',
                'perfect-score': 'üéØ',
                'speed-demon': '‚ö°',
                'streak-3': 'üî•',
                'streak-7': 'üî•',
                'streak-30': 'üî•',
                'dedicated': 'üí™',
                'scholar': 'üìö',
                'master': 'üëë'
            };
            
            const emoji = badgeEmojis[badgeId] || 'üèÜ';
            
            badge.innerHTML = `
                <div class="achievement-content" style="
                    background: white; padding: 50px; border-radius: 20px;
                    text-align: center; max-width: 500px;
                    animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 6rem; margin-bottom: 1rem;">${emoji}</div>
                    <div style="
                        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                        color: white; display: inline-block; padding: 8px 20px;
                        border-radius: 20px; font-size: 0.9rem; font-weight: 700;
                        margin-bottom: 1rem; text-transform: uppercase;
                        letter-spacing: 1px;
                    ">Achievement Unlocked!</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800; color: #333;">${title}</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: #666; line-height: 1.6;">${description}</p>
                    <div style="
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white; display: inline-block; padding: 12px 24px;
                        border-radius: 12px; font-size: 1.2rem; font-weight: 700;
                        margin-bottom: 1.5rem;
                    ">+${xpValue} XP</div>
                    <div>
                        <button onclick="this.closest('.achievement-modal').remove()" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white; padding: 15px 30px; border: none;
                            border-radius: 10px; font-size: 1.1rem; font-weight: 700;
                            cursor: pointer; transition: all 0.2s;
                        ">
                            Awesome! ‚ú®
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(badge);
            triggerConfetti();
        }
        
        function checkAchievements() {
            // Perfect Score
            let perfectScore = true;
            for (let i = 0; i < questions.length; i++) {
                if (answers[i] < 4) {
                    perfectScore = false;
                    break;
                }
            }
            if (perfectScore) {
                showAchievementBadge('perfect-score', 'üéØ Perfect Score', 'You answered all questions at mastery level!', 50);
            }
            
            // Speed Demon
            const startTime = parseInt(localStorage.getItem('assessmentStartTime') || '0');
            const completionTime = (Date.now() - startTime) / 1000 / 60; // minutes
            if (completionTime < 5 && startTime > 0) {
                showAchievementBadge('speed-demon', '‚ö° Speed Demon', 'Completed in under 5 minutes!', 25);
            }
            
            // First Stripe
            const completedStripes = Object.keys(localStorage).filter(k => k.includes('Complete')).length;
            if (completedStripes === 1) {
                showAchievementBadge('first-stripe', 'üë£ First Steps', 'You completed your first stripe!', 25);
            }
        }

        function showResults() {
            // Check achievements before showing results
            checkAchievements();
            
            let orientationScore = 0;
            let metricsScore = 0;
            let collectiveScore = 0;
            
            // Results Orientation (questions 0-5)
            for (let i = 0; i < 6; i++) {
                if (answers[i]) orientationScore += answers[i];
            }
            
            // Metrics & Measurement (questions 6-11)
            for (let i = 6; i < 12; i++) {
                if (answers[i]) metricsScore += answers[i];
            }
            
            // Collective Results (questions 12-17)
            for (let i = 12; i < 18; i++) {
                if (answers[i]) collectiveScore += answers[i];
            }
            
            const avgOrientation = orientationScore / 6;
            const avgMetrics = metricsScore / 6;
            const avgCollective = collectiveScore / 6;
            const overallScore = (avgOrientation + avgMetrics + avgCollective) / 3;
            
            let resultsType = '';
            let typeEmoji = '';
            let typeLabel = '';
            let typeColor = '';
            let strengths = [];
            let challenges = [];
            let strategies = [];
            
            if (overallScore <= 2.0) {
                resultsType = 'Developing';
                typeEmoji = 'üå±';
                typeLabel = 'üå± Developing Results Focus';
                typeColor = '#f4a261';
                strengths = [
                    'Awareness is the first step to growth',
                    'You\'re honest about where you are',
                    'Every master was once a beginner',
                    'You have room to build strong foundations',
                    'Growth mindset is already present'
                ];
                challenges = [
                    'Results orientation needs development',
                    'Metrics focus requires practice',
                    'Collective results mindset needs cultivation',
                    'Focus on outcomes needs growth',
                    'Results culture needs building'
                ];
                strategies = [
                    'Start by focusing on one outcome this week',
                    'Track one metric that matters this week',
                    'Prioritize one team result over individual success',
                    'Measure progress toward one goal',
                    'Celebrate one collective win this week'
                ];
            } else if (overallScore <= 3.5) {
                resultsType = 'Building';
                typeEmoji = 'üèóÔ∏è';
                typeLabel = 'üèóÔ∏è Building Results Focus';
                typeColor = '#7c3aed';
                strengths = [
                    'You have some results orientation',
                    'You recognize areas that need work',
                    'You\'re building foundational skills',
                    'You have some effective strategies',
                    'You\'re committed to growth'
                ];
                challenges = [
                    'Consistency in practice is key',
                    'Some patterns still need attention',
                    'Metrics focus could be stronger',
                    'Collective results mindset needs refinement',
                    'Results culture could be more consistent'
                ];
                strategies = [
                    'Double down on what\'s working',
                    'Practice results focus weekly',
                    'Track metrics consistently',
                    'Prioritize collective results in one area',
                    'Build results culture in one process'
                ];
            } else {
                resultsType = 'Strong';
                typeEmoji = 'üí™';
                typeLabel = 'üí™ Strong Results Focus';
                typeColor = '#2a9d8f';
                strengths = [
                    'High results orientation',
                    'Strong metrics and measurement focus',
                    'Effective collective results mindset',
                    'Consistent results culture',
                    'Good results facilitation'
                ];
                challenges = [
                    'Maintain results focus during stress',
                    'Continue refining your approach',
                    'Support others in their results journey',
                    'Stay aware of changing results needs',
                    'Prevent complacency in good times'
                ];
                strategies = [
                    'Share your results strategies with others',
                    'Continue refining as goals evolve',
                    'Stay aware of changing results needs',
                    'Support others in building results focus',
                    'Use your strength to help build team results culture'
                ];
            }

            document.getElementById('assessmentForm').style.display = 'none';
            document.getElementById('resultsContainer').classList.add('active');
            
            document.getElementById('typeEmoji').textContent = typeEmoji;
            document.getElementById('typeLabel').textContent = typeLabel;
            document.getElementById('typeResultCard').style.background = `linear-gradient(135deg, ${typeColor} 0%, ${typeColor}dd 100%)`;
            
            const typeDetailsHTML = `
                <div class="type-card">
                    <h3>üí™ Your Strengths</h3>
                    <ul>
                        ${strengths.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #fff5f0; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">‚ö†Ô∏è Areas for Growth</h3>
                    <ul>
                        ${challenges.map(c => `<li>${c}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #f0f4ff; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">üéØ Recommended Strategies</h3>
                    <ul>
                        ${strategies.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="insight-card" style="margin-top: 30px;">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-title">The Key Insight</div>
                    <div class="insight-content">
                        <strong>Results matter more than activity.</strong> Just like in BJJ, where you don't win by looking good but by getting the tap, teams need to focus on outcomes, not just activities.
                        <br><br>
                        <strong>ü•ã BJJ Wisdom:</strong> "You don't win by looking good. You win by getting the tap. That's results focus. In BJJ, you measure results by taps, not by how good your technique looks. The best teams focus on collective results, not individual success."
                    </div>
                </div>
            `;
            
            document.getElementById('typeDetails').innerHTML = typeDetailsHTML;
            
            clearProgress();
            
            localStorage.setItem('purpleBeltStripe4Complete', 'true');
            localStorage.setItem('purpleBeltStripe4CompletedDate', new Date().toISOString());
            localStorage.setItem('resultsFocus', resultsType);
            
            const currentXP = parseInt(localStorage.getItem('totalXP') || '0');
            const xpReward = 200;
            localStorage.setItem('totalXP', (currentXP + xpReward).toString());
            
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #38a169 0%, #2f855a 100%); color: white; padding: 1rem 1.5rem; border-radius: 10px; box-shadow: 0 4px 20px rgba(56, 161, 105, 0.4); z-index: 1000; font-weight: 600;';
                notification.innerHTML = `‚úÖ Stripe 4 Complete! +${xpReward} XP`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }, 500);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
<!-- TAP-IN Utilities -->
<script src="js/shared-utilities.js"></script>
<script src="js/global-error-handler.js"></script>
<script src="js/storage-health.js"></script>
</body>
</html>



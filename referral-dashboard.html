<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•ã Your Gym | TAP-IN</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #1a365d 0%, #0f2744 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .header .subtitle {
            font-size: 1.1rem;
            color: #94a3b8;
        }

        .rank-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f6e05e 0%, #d69e2e 100%);
            color: #1a365d;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        .card {
            background: #252940;
            border: 2px solid #3d4466;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .card-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
        }

        .gym-overview {
            margin-bottom: 30px;
        }

        .gym-name-editable {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            align-items: center;
        }

        .gym-name-editable input {
            flex: 1;
            padding: 12px 20px;
            background: #1a1d2e;
            border: 2px solid #3d4466;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .gym-name-editable input:focus {
            outline: none;
            border-color: #4a7c9c;
        }

        .gym-name-editable button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #1a365d 0%, #0f2744 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .gym-name-editable button:hover {
            transform: scale(1.05);
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat {
            text-align: center;
            padding: 20px;
            background: #1a1d2e;
            border-radius: 12px;
            border: 2px solid #3d4466;
        }

        .stat .value {
            display: block;
            font-size: 2rem;
            font-weight: 800;
            color: #f6e05e;
            margin-bottom: 5px;
        }

        .stat .label {
            font-size: 0.9rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .invite-section {
            margin: 30px 0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1a365d 0%, #0f2744 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 20px rgba(26, 54, 93, 0.4);
        }

        .link-box {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .link-box input {
            flex: 1;
            padding: 15px;
            background: #1a1d2e;
            border: 2px solid #3d4466;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 0.95rem;
        }

        .link-box button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .link-box button:hover {
            transform: scale(1.05);
        }

        .qr-code {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #1a1d2e;
            border-radius: 12px;
        }

        .qr-code canvas {
            margin: 0 auto 15px;
            border: 4px solid #3d4466;
            border-radius: 8px;
            padding: 10px;
            background: white;
        }

        .qr-code button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #1a365d 0%, #0f2744 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .share-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .share-buttons button {
            padding: 12px;
            background: #1a1d2e;
            border: 2px solid #3d4466;
            border-radius: 8px;
            color: #e2e8f0;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .share-buttons button:hover {
            border-color: #4a7c9c;
            transform: translateY(-2px);
        }

        .recent-students {
            margin-top: 30px;
        }

        .recent-students h4 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #ffffff;
        }

        .students-list {
            display: grid;
            gap: 15px;
        }

        .student-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #1a1d2e;
            border: 2px solid #3d4466;
            border-radius: 10px;
        }

        .belt-icon {
            font-size: 2rem;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .student-details {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .student-xp {
            text-align: right;
            font-weight: 700;
            color: #f6e05e;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            box-shadow: 0 8px 25px rgba(56, 161, 105, 0.4);
            z-index: 10000;
            font-weight: 600;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .nav-links {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .nav-links a {
            color: #94a3b8;
            text-decoration: none;
            padding: 10px 20px;
            border: 2px solid #3d4466;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .nav-links a:hover {
            border-color: #4a7c9c;
            color: #e2e8f0;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .quick-stats { grid-template-columns: repeat(2, 1fr); }
            .gym-name-editable { flex-direction: column; }
            .link-box { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü•ã Your Gym</h1>
            <p class="subtitle">Build Your Lineage ‚Ä¢ Grow Your Team ‚Ä¢ Climb the Leaderboard</p>
            <div class="rank-badge" id="rankBadge">Loading rank...</div>
        </div>

        <!-- Gym Overview Card -->
        <div class="card">
            <div class="card-header">
                <h3>Gym Overview</h3>
            </div>

            <div class="gym-overview">
                <div class="gym-name-editable">
                    <input type="text" id="gymNameInput" placeholder="Name your gym...">
                    <button onclick="saveGymName()">Save</button>
                </div>

                <div class="quick-stats">
                    <div class="stat">
                        <span class="value" id="studentsCount">0</span>
                        <span class="label">Direct Students</span>
                    </div>
                    <div class="stat">
                        <span class="value" id="lineageCount">0</span>
                        <span class="label">Total Lineage</span>
                    </div>
                    <div class="stat">
                        <span class="value" id="teamXP">0</span>
                        <span class="label">Team XP</span>
                    </div>
                    <div class="stat">
                        <span class="value" id="lineageXP">0</span>
                        <span class="label">Lineage XP</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Invite Section -->
        <div class="card">
            <div class="card-header">
                <h3>Invite Students</h3>
            </div>

            <div class="invite-section">
                <div class="link-box">
                    <input type="text" id="referralLink" readonly>
                    <button onclick="copyReferralLink()">üìã Copy Link</button>
                </div>

                <div class="qr-code">
                    <canvas id="qrcode"></canvas>
                    <button onclick="downloadQR()">‚¨áÔ∏è Download QR</button>
                </div>

                <div class="share-buttons">
                    <button onclick="shareViaEmail()">üìß Email</button>
                    <button onclick="shareViaWhatsApp()">üí¨ WhatsApp</button>
                    <button onclick="shareViaLinkedIn()">üíº LinkedIn</button>
                    <button onclick="shareViaTwitter()">üê¶ Twitter</button>
                </div>
            </div>
        </div>

        <!-- Recent Students -->
        <div class="card">
            <div class="card-header">
                <h3>Your Students</h3>
            </div>

            <div class="recent-students">
                <div class="students-list" id="studentsList">
                    <p style="color: #94a3b8; text-align: center; padding: 20px;">
                        No students yet. Invite people to start building your gym!
                    </p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-links">
            <a href="leaderboard.html">üèÜ View Leaderboard</a>
            <a href="gym-dashboard.html">üè† Back to Gym</a>
        </div>
    </div>

    <script src="js/lineage-system.js"></script>
    <script>
        // Belt emoji mapping
        const beltEmojis = {
            'White': '‚ö™',
            'Blue': 'üîµ',
            'Purple': 'üü£',
            'Brown': 'üü§',
            'Black': '‚ö´'
        };

        // Initialize dashboard
        function initDashboard() {
            const stats = LineageSystem.getGymStats();
            if (!stats) {
                console.error('Failed to load gym stats');
                return;
            }

            // Update gym name
            document.getElementById('gymNameInput').value = stats.gymName;

            // Update stats
            document.getElementById('studentsCount').textContent = stats.studentsCount;
            document.getElementById('lineageCount').textContent = stats.lineageCount;
            document.getElementById('teamXP').textContent = formatNumber(stats.teamXP);
            document.getElementById('lineageXP').textContent = formatNumber(stats.lineageXP);

            // Update rank
            const rank = LineageSystem.getUserRank('teamXP');
            if (rank) {
                document.getElementById('rankBadge').textContent = `#${rank} Global`;
            } else {
                document.getElementById('rankBadge').textContent = 'Not Ranked Yet';
            }

            // Update referral link
            const referralLink = LineageSystem.createReferralLink();
            document.getElementById('referralLink').value = referralLink;

            // Generate QR code
            QRCode.toCanvas(
                document.getElementById('qrcode'),
                referralLink,
                { width: 200, margin: 2 }
            );

            // Load students
            loadStudents(stats.students);
        }

        function formatNumber(num) {
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'k';
            }
            return num.toString();
        }

        function loadStudents(students) {
            const list = document.getElementById('studentsList');
            if (!students || students.length === 0) {
                list.innerHTML = '<p style="color: #94a3b8; text-align: center; padding: 20px;">No students yet. Invite people to start building your gym!</p>';
                return;
            }

            list.innerHTML = students.slice(0, 10).map(student => `
                <div class="student-card">
                    <div class="belt-icon">${beltEmojis[student.currentBelt] || '‚ö™'}</div>
                    <div class="student-info">
                        <div class="student-name">${student.referralCode}</div>
                        <div class="student-details">
                            ${student.currentBelt} Belt ‚Ä¢ Joined ${formatDate(student.joinedDate)}
                        </div>
                    </div>
                    <div class="student-xp">${formatNumber(student.personalXP || 0)} XP</div>
                </div>
            `).join('');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));

            if (days === 0) return 'today';
            if (days === 1) return 'yesterday';
            if (days < 7) return `${days} days ago`;
            if (days < 30) return `${Math.floor(days / 7)} weeks ago`;
            return `${Math.floor(days / 30)} months ago`;
        }

        function saveGymName() {
            const name = document.getElementById('gymNameInput').value.trim();
            if (!name) {
                showToast('Please enter a gym name');
                return;
            }

            if (LineageSystem.setGymName(name)) {
                showToast('‚úÖ Gym name saved!');
            } else {
                showToast('‚ùå Failed to save gym name');
            }
        }

        function copyReferralLink() {
            const link = document.getElementById('referralLink');
            link.select();
            document.execCommand('copy');
            showToast('‚úÖ Link copied to clipboard!');
        }

        function downloadQR() {
            const canvas = document.getElementById('qrcode');
            const link = document.createElement('a');
            link.download = 'tap-in-referral-qr.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        function shareViaEmail() {
            const link = document.getElementById('referralLink').value;
            const subject = encodeURIComponent('Join my TAP-IN gym!');
            const body = encodeURIComponent(`I'm building my leadership gym on TAP-IN. Join me and start your journey!\n\n${link}`);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        function shareViaWhatsApp() {
            const link = document.getElementById('referralLink').value;
            const text = encodeURIComponent(`ü•ã Join my TAP-IN gym! Start your leadership journey: ${link}`);
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }

        function shareViaLinkedIn() {
            const link = document.getElementById('referralLink').value;
            const url = encodeURIComponent(link);
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
        }

        function shareViaTwitter() {
            const link = document.getElementById('referralLink').value;
            const text = encodeURIComponent(`ü•ã Join my TAP-IN gym! Start your leadership journey: ${link}`);
            window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDashboard);
        } else {
            initDashboard();
        }
    </script>
<!-- TAP-IN Utilities -->
<script src="js/shared-utilities.js"></script>
<script src="js/global-error-handler.js"></script>
<script src="js/storage-health.js"></script>
</body>
</html>



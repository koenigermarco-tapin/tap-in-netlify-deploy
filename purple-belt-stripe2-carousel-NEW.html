<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#7c3aed">
    <title>üü£ Purple Belt Stripe 2: Healthy Conflict - TAP-IN</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 25px; border-bottom: 3px solid #f0f0f0; }
        .header h1 { color: #6d28d9; font-size: 2.3em; margin-bottom: 15px; }
        .header .subtitle { color: #666; font-size: 1.1em; margin-bottom: 10px; }
        .header .duration { color: #999; font-size: 0.9em; font-style: italic; }
        
        .progress-bar { position: sticky; top: 10px; background: white; padding: 15px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; }
        .progress-text { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 8px; }
        .progress-fill { height: 8px; background: #e0e0e0; border-radius: 10px; overflow: hidden; }
        .progress-fill-bar { background: linear-gradient(90deg, #7c3aed 0%, #6d28d9 100%); height: 100%; width: 0%; transition: width 0.3s ease; }
        
        .section-header { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; }
        .section-header h3 { font-size: 1.2em; margin-bottom: 5px; }
        .section-header .section-desc { font-size: 0.9em; opacity: 0.95; font-style: italic; }
        
        .question-card { background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 20px; }
        .question-number { color: #6d28d9; font-weight: bold; font-size: 0.9em; margin-bottom: 10px; }
        .question-text { font-size: 1.2em; color: #333; margin-bottom: 25px; font-weight: 500; line-height: 1.5; }
        
        .scale-options { display: flex; justify-content: space-between; align-items: flex-end; gap: 2px; flex-wrap: nowrap; height: 140px; position: relative; background: linear-gradient(to top right, rgba(124, 58, 237, 0.1) 0%, rgba(109, 40, 217, 0.05) 50%, transparent 50%); border-radius: 8px; padding: 5px; cursor: pointer; user-select: none; }
        .scale-option { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; background: linear-gradient(135deg, rgba(124, 58, 237, 0.15) 0%, rgba(109, 40, 217, 0.1) 100%); border: 3px solid #cbd5e1; border-radius: 6px; transition: all 0.15s ease; position: relative; z-index: 1; padding: 10px 5px; }
        .scale-option:nth-child(1) { height: 50px; opacity: 0.15; }
        .scale-option:nth-child(2) { height: 70px; opacity: 0.35; }
        .scale-option:nth-child(3) { height: 90px; opacity: 0.55; }
        .scale-option:nth-child(4) { height: 110px; opacity: 0.75; }
        .scale-option:nth-child(5) { height: 130px; opacity: 0.85; }
        .scale-option span { font-size: 1.3em; font-weight: 800; color: #1e293b; opacity: 1; margin-bottom: 5px; }
        .scale-option small { font-size: 0.7em; color: #475569; font-weight: 600; opacity: 1; text-align: center; line-height: 1.2; }
        .scale-option:hover { transform: scale(1.05); border-color: #7c3aed; }
        .scale-option.active, .scale-option.selected { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; border-color: #5b21b6; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.4); }
        .scale-option.active ~ .scale-option { background: linear-gradient(135deg, rgba(124, 58, 237, 0.15) 0%, rgba(109, 40, 217, 0.1) 100%); color: #333; }
        .scale-option.active span, .scale-option.selected span { color: white; }
        .scale-option.active small, .scale-option.selected small { color: rgba(255,255,255,0.9); }
        
        .insight-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-left: 4px solid #7c3aed; padding: 20px; margin: 20px 0; border-radius: 10px; animation: slideIn 0.4s ease; }
        .insight-icon { font-size: 2rem; margin-bottom: 10px; }
        .insight-title { color: #6d28d9; font-size: 1.1em; font-weight: bold; margin-bottom: 12px; }
        .insight-content { color: #555; line-height: 1.7; margin-bottom: 12px; }
        .insight-quote { font-style: italic; color: #666; font-size: 0.95em; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 3px solid #7c3aed; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Scenario Question Styles */
        .scenario-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .scenario-option {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .scenario-option:hover {
            border-color: #667eea;
            background: #f0f0ff;
            transform: translateX(5px);
        }
        .scenario-option.selected {
            border-color: #667eea;
            background: #e8e8ff;
        }
        .scenario-option.correct {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        .scenario-option.correct .option-letter {
            background: #10b981;
        }
        .scenario-option.incorrect {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        }
        .scenario-option.incorrect .option-letter {
            background: #ef4444;
        }
        .scenario-option.neutral {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        .scenario-option.neutral .option-letter {
            background: #f59e0b;
        }
        .option-letter {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .option-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            padding-top: 8px;
        }
        .scenario-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .scenario-insight {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid #7c3aed;
        }
        
        /* Multiple Choice Styles */
        .mc-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .mc-option {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .mc-option:hover {
            border-color: #667eea;
            background: #fafbff;
            transform: translateX(3px);
        }
        .mc-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        .mc-radio {
            padding-top: 2px;
        }
        .mc-radio input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            cursor: pointer;
        }
        .mc-content {
            flex: 1;
        }
        .mc-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            margin-bottom: 6px;
        }
        .mc-type {
            color: #667eea;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .mc-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .mc-insight {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid #10b981;
        }
        .mc-type-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg) translateX(200px);
                opacity: 0;
            }
        }
        .milestone-content button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .fun-fact-box {
            animation: slideIn 0.4s ease;
        }
        
        @media (max-width: 768px) {
            .scenario-option {
                padding: 12px 15px;
                gap: 12px;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            .option-text {
                font-size: 0.9rem;
            }
            .mc-option {
                padding: 15px;
            }
            .mc-text {
                font-size: 0.9rem;
            }
        }
        
        .nav-buttons { display: flex; gap: 15px; justify-content: space-between; margin-top: 25px; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.2s; font-weight: 600; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-primary { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .results-container { display: none; }
        .results-container.active { display: block; }
        .overall-score { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; border-radius: 20px; padding: 40px; text-align: center; margin-bottom: 30px; }
        .score-number { font-size: 4em; font-weight: bold; margin-bottom: 10px; }
        .score-label { font-size: 1.3em; opacity: 0.95; }
        .type-card { background: #f8f9fa; padding: 30px; border-radius: 15px; margin: 20px 0; border-left: 4px solid #7c3aed; }
        .type-card h3 { color: #6d28d9; margin-bottom: 15px; font-size: 1.5em; }
        .type-card ul { list-style: none; padding-left: 0; }
        .type-card li { padding: 8px 0; padding-left: 25px; position: relative; color: #555; line-height: 1.7; }
        .type-card li:before { content: "‚Üí"; position: absolute; left: 0; color: #7c3aed; font-weight: bold; }
        .cta-box { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; border-radius: 15px; padding: 30px; text-align: center; margin-top: 30px; }
        .cta-box h3 { font-size: 1.6em; margin-bottom: 15px; }
        .cta-box p { font-size: 1em; margin-bottom: 20px; opacity: 0.95; }
        .cta-btn { background: white; color: #6d28d9; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: bold; display: inline-block; transition: all 0.2s; }
        .cta-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(255,255,255,0.3); }
        
        .tap-out-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
        }
        .tap-out-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.6);
        }
        @media (max-width: 768px) {
            .container { padding: 25px; }
            .header h1 { font-size: 2em; }
            .scale-option small { font-size: 0.65em; }
            .tap-out-button {
                top: 10px;
                right: 10px;
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }
    
        /* ============= NUMBERED OPTION BOX READABILITY FIX ============= */
        .scale-option,
        .rating-option,
        .numbered-option,
        .option-number,
        [data-value="1"],
        [data-value="2"],
        [data-value="3"],
        [data-value="4"],
        [data-value="5"] {
            color: #FFFFFF !important;
            font-weight: 700 !important;
            font-size: 1.1rem !important;
            background: #1e293b !important;
            border: 2px solid #475569 !important;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5) !important;
        }
        .scale-option:hover,
        .rating-option:hover,
        .numbered-option:hover,
        .option-number:hover,
        [data-value]:hover {
            background: #334155 !important;
            border-color: #667eea !important;
            color: #FFFFFF !important;
            transform: scale(1.05) !important;
        }
        .scale-option.selected,
        .rating-option.selected,
        .numbered-option.selected,
        .option-number.selected,
        [data-value].selected {
            background: #667eea !important;
            border-color: #818cf8 !important;
            color: #FFFFFF !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
        }
        .scale-label,
        .rating-label,
        .option-label {
            color: #FFFFFF !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
            text-align: center !important;
            margin-top: 0.5rem !important;
        }
        .scale-container,
        .rating-container,
        .options-row {
            display: flex !important;
            justify-content: space-between !important;
            gap: 0.75rem !important;
            margin: 1.5rem 0 !important;
        }
        .scale-container > *,
        .rating-container > *,
        .options-row > * {
            flex: 1 !important;
            min-width: 60px !important;
            text-align: center !important;
            padding: 1rem 0.5rem !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        @media (max-width: 768px) {
            .scale-option,
            .rating-option,
            .numbered-option,
            .option-number,
            [data-value] {
                font-size: 1rem !important;
                padding: 0.75rem 0.25rem !important;
                min-width: 50px !important;
            }
            .scale-label,
            .rating-label,
            .option-label {
                font-size: 0.75rem !important;
            }
        }
        input[type="range"] {
            -webkit-appearance: none !important;
            width: 100% !important;
            height: 8px !important;
            background: #334155 !important;
            border-radius: 5px !important;
            outline: none !important;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none !important;
            width: 24px !important;
            height: 24px !important;
            background: #667eea !important;
            cursor: pointer !important;
            border-radius: 50% !important;
            border: 3px solid #FFFFFF !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px !important;
            height: 24px !important;
            background: #667eea !important;
            cursor: pointer !important;
            border-radius: 50% !important;
            border: 3px solid #FFFFFF !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
        .slider-value,
        .range-value {
            display: block !important;
            text-align: center !important;
            font-size: 1.5rem !important;
            font-weight: 700 !important;
            color: #667eea !important;
            margin-top: 1rem !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2) !important;
        }
        .slider-labels {
            display: flex !important;
            justify-content: space-between !important;
            margin-top: 0.5rem !important;
        }
        .slider-labels span {
            font-size: 0.85rem !important;
            color: #cbd5e1 !important;
            font-weight: 600 !important;
        }

    </style>
</head>
<body>
    <!-- TAP OUT Button -->
    <button class="tap-out-button" onclick="tapOut()" id="tapOutBtn" style="display: none;">
        <div class="tap-icon">ü•ã</div>
        <div class="tap-text">TAP</div>
    </button>

    <div class="container">
        <!-- Assessment Form -->
        <div id="assessmentForm">
            <div class="header">
                <h1>üü£ Purple Belt - Stripe 2: Healthy Conflict</h1>
                <p class="subtitle">Conflict Engagement, Debate Skills & Healthy Tension</p>
                <p class="duration">‚è±Ô∏è 8-10 Minutes ‚Ä¢ 18 Questions</p>
            </div>

            <!-- Intro Section -->
            <div id="introSection" style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #7c3aed;">
                <h3 style="color: #333; margin-bottom: 15px;">‚öîÔ∏è Conflict - The Path to Better Decisions</h3>
                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>Purple Belt teaches you that conflict isn't bad‚Äîabsence of conflict is.</strong> This assessment reveals your ability to engage in productive conflict, facilitate healthy debate, and navigate team dynamics. The best teams don't avoid conflict‚Äîthey embrace it.
                </p>
                
                <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #7c3aed;">
                    <p style="font-style: italic; color: #555; margin-bottom: 10px;">
                        "Rolling IS controlled conflict. You can't get better without engaging. You don't learn by avoiding hard rolls."
                    </p>
                    <p style="text-align: right; color: #888; font-size: 0.9em;">‚Äî BJJ Wisdom</p>
                </div>

                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>Research from Patrick Lencioni</strong> shows that fear of conflict is the second dysfunction. Teams that engage in healthy conflict make better decisions. This assessment helps you:
                </p>
                <ul style="color: #666; line-height: 1.8; margin-left: 20px; margin-bottom: 15px;">
                    <li>Assess your comfort with conflict engagement</li>
                    <li>Evaluate your debate vs. argument skills</li>
                    <li>Identify your ability to create healthy tension</li>
                    <li>Recognize areas for growth in conflict facilitation</li>
                </ul>

                <p style="color: #666; line-height: 1.7; margin-top: 15px; padding: 15px; background: #f3e8ff; border-radius: 8px; font-size: 0.95em;">
                    <strong>ü•ã In BJJ:</strong> Rolling IS controlled conflict. You can't get better without engaging. You don't learn by avoiding hard rolls. The best training partners push you, not coddle you. Tap or snap‚Äîaddress problems directly.
                </p>
                
                <button onclick="startAssessment()" style="background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3); display: block; margin: 20px auto 0; width: auto;">
                    Start Assessment ‚Üí
                </button>
            </div>

            <div class="progress-bar" style="display: none;" id="progressBarContainer">
                <div class="progress-text"><span id="currentSection">Conflict Engagement</span> ‚Ä¢ Question <span id="currentQ">1</span> of 18</div>
                <div class="progress-fill">
                    <div class="progress-fill-bar" id="progressBar"></div>
                </div>
            </div>

            <div id="questionContainer" style="display: none;"></div>

            <div class="nav-buttons" style="display: none;" id="navButtons">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" disabled>‚Üê Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next ‚Üí</button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="results-container">
            <div class="header">
                <h1>üü£ Your Healthy Conflict Profile</h1>
            </div>

            <div class="overall-score" id="typeResultCard">
                <div class="score-number" id="typeEmoji">‚öîÔ∏è</div>
                <div class="score-label" id="typeLabel">Calculating...</div>
            </div>

            <div id="typeDetails"></div>

            <div class="cta-box">
                <h3>üü£ Purple Belt Stripe 2 Complete!</h3>
                <p>You now understand your healthy conflict capacity. Ready to continue your journey?</p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                    <a href="purple-belt-stripe3-carousel-NEW.html" class="cta-btn" style="margin: 0;">Continue to Stripe 3 ‚Üí</a>
                    <a href="gym-dashboard.html" class="cta-btn" style="background: rgba(255,255,255,0.2); border: 2px solid white; margin: 0;">Back to The Gym</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            // CONFLICT ENGAGEMENT (6 questions)
            {
                section: 'Conflict Engagement',
                sectionDesc: 'Your comfort with engaging in disagreement and conflict',
                question: 'I feel comfortable engaging in disagreement and conflict...',
                category: 'engagement'
            },
            {
                question: 'When I disagree with someone, I typically...',
                category: 'speaking'
            },
            {
                question: 'I challenge ideas respectfully, even when they come from authority...',
                category: 'challenging'
            },
            {
                question: 'I avoid conflict and prefer to keep the peace...',
                category: 'avoidance'
            },
            {
                question: 'I engage in conflict rather than withdrawing or shutting down...',
                category: 'withdrawing'
            },
            {
                question: 'I can "fight fair" - disagree without being disagreeable...',
                category: 'fair'
            },
            // DEBATE VS ARGUMENT (6 questions)
            {
                section: 'Debate vs Argument',
                sectionDesc: 'Your ability to engage in productive debate vs destructive argument',
                question: 'I can engage in productive debate focused on ideas, not personalities...',
                category: 'productive'
            },
            {
                question: 'I listen actively during disagreement, seeking to understand...',
                category: 'listening'
            },
            {
                question: 'I stay focused on the issue, not making it personal...',
                category: 'focused'
            },
            {
                question: 'I can control my emotional reactions during conflict...',
                category: 'emotional'
            },
            {
                question: 'I look for common ground even when disagreeing...',
                category: 'common'
            },
            {
                question: 'I can compromise effectively when needed...',
                category: 'compromise'
            },
            // HEALTHY TENSION (6 questions)
            {
                section: 'Healthy Tension',
                sectionDesc: 'Your ability to create and maintain productive tension',
                question: 'I view conflict as healthy and necessary for good decisions...',
                category: 'view'
            },
            {
                question: 'I welcome different perspectives and viewpoints...',
                category: 'welcome'
            },
            {
                question: 'I believe testing ideas through discussion makes them better...',
                category: 'testing'
            },
            {
                question: 'I can create productive disagreement in my team...',
                category: 'creating'
            },
            {
                question: 'I approach conflict resolution with a learning mindset...',
                category: 'learning'
            },
            {
                question: 'I can learn and grow from conflict situations...',
                category: 'growing'
            }
        ];

        const insights = [
            // CONFLICT ENGAGEMENT INSIGHTS (6)
            { icon: '‚öîÔ∏è', title: 'Conflict is Necessary', content: 'Conflict isn\'t bad‚Äîabsence of conflict is. <strong>Lencioni\'s research</strong> shows teams that avoid conflict make worse decisions. In BJJ: Rolling IS controlled conflict. You can\'t get better without engaging.', quote: '"You don\'t learn by avoiding hard rolls." - BJJ Philosophy' },
            { icon: 'üí¨', title: 'Speak Up When You Disagree', content: 'Speaking up when you disagree is a sign of respect, not disrespect. <strong>Research shows</strong> teams that engage in conflict outperform others. In BJJ: You tap when you\'re caught. That\'s engaging with the problem.', quote: '"The best training partners push you, not coddle you." - BJJ Wisdom' },
            { icon: 'üéØ', title: 'Challenge Ideas, Not People', content: 'You can challenge ideas respectfully, even from authority. <strong>Research shows</strong> respectful challenge improves decisions. In BJJ: You can question technique respectfully. That\'s how you learn.', quote: '"Question technique respectfully. That\'s how you learn." - BJJ Practice' },
            { icon: 'üö´', title: 'Avoidance Creates Problems', content: 'Avoiding conflict creates bigger problems later. <strong>Research shows</strong> unaddressed conflict escalates. In BJJ: You can\'t avoid hard rolls forever. Eventually you have to engage.', quote: '"You can\'t avoid hard rolls forever. Eventually you have to engage." - BJJ Truth' },
            { icon: 'üí™', title: 'Engage, Don\'t Withdraw', content: 'Engaging in conflict is better than withdrawing. <strong>Research shows</strong> engagement leads to better outcomes. In BJJ: You engage on the mat. You don\'t walk away when it gets hard.', quote: '"You engage on the mat. You don\'t walk away when it gets hard." - BJJ Commitment' },
            { icon: 'ü§ù', title: 'Fight Fair', content: 'You can disagree without being disagreeable. <strong>Research shows</strong> fair fighting improves relationships. In BJJ: You roll hard but respectfully. That\'s fighting fair.', quote: '"You roll hard but respectfully. That\'s fighting fair." - BJJ Respect' },
            // DEBATE VS ARGUMENT INSIGHTS (6)
            { icon: 'üß†', title: 'Productive Debate Focuses on Ideas', content: 'Productive debate focuses on ideas, not personalities. <strong>Research shows</strong> idea-focused debate improves decisions. In BJJ: You debate technique, not the person.', quote: '"You debate technique, not the person." - BJJ Focus' },
            { icon: 'üëÇ', title: 'Listen During Disagreement', content: 'Active listening during disagreement is essential. <strong>Research shows</strong> listening improves conflict resolution. In BJJ: You listen to feedback, even when it\'s hard to hear.', quote: '"You listen to feedback, even when it\'s hard to hear." - BJJ Learning' },
            { icon: 'üéØ', title: 'Stay Issue-Focused', content: 'Staying focused on the issue, not the person, improves outcomes. <strong>Research shows</strong> issue-focused conflict resolves faster. In BJJ: You focus on the technique, not who\'s doing it.', quote: '"You focus on the technique, not who\'s doing it." - BJJ Focus' },
            { icon: 'üòå', title: 'Control Emotional Reactions', content: 'Controlling emotional reactions during conflict is a skill. <strong>Research shows</strong> emotional control improves conflict outcomes. In BJJ: You stay calm under pressure. That\'s emotional control.', quote: '"You stay calm under pressure. That\'s emotional control." - BJJ Discipline' },
            { icon: 'ü§ù', title: 'Find Common Ground', content: 'Looking for common ground even when disagreeing builds relationships. <strong>Research shows</strong> common ground improves collaboration. In BJJ: You find common techniques. That\'s common ground.', quote: '"You find common techniques. That\'s common ground." - BJJ Connection' },
            { icon: '‚öñÔ∏è', title: 'Compromise When Needed', content: 'Effective compromise is a strength, not a weakness. <strong>Research shows</strong> strategic compromise improves outcomes. In BJJ: You adjust your game. That\'s compromise.', quote: '"You adjust your game. That\'s compromise." - BJJ Adaptation' },
            // HEALTHY TENSION INSIGHTS (6)
            { icon: 'üí°', title: 'Conflict is Healthy', content: 'Viewing conflict as healthy and necessary changes everything. <strong>Research shows</strong> teams that embrace conflict make better decisions. In BJJ: You embrace hard rolls. That\'s healthy conflict.', quote: '"You embrace hard rolls. That\'s healthy conflict." - BJJ Growth' },
            { icon: 'üåà', title: 'Welcome Different Perspectives', content: 'Welcoming different perspectives improves decisions. <strong>Research shows</strong> diverse perspectives lead to better outcomes. In BJJ: You learn from different styles. That\'s welcoming perspectives.', quote: '"You learn from different styles. That\'s welcoming perspectives." - BJJ Diversity' },
            { icon: 'üî¨', title: 'Test Ideas Through Discussion', content: 'Testing ideas through discussion makes them better. <strong>Research shows</strong> discussion improves ideas. In BJJ: You test techniques in rolling. That\'s testing through practice.', quote: '"You test techniques in rolling. That\'s testing through practice." - BJJ Testing' },
            { icon: 'üèóÔ∏è', title: 'Create Productive Disagreement', content: 'Creating productive disagreement is a leadership skill. <strong>Research shows</strong> productive disagreement improves decisions. In BJJ: You create challenging scenarios. That\'s productive disagreement.', quote: '"You create challenging scenarios. That\'s productive disagreement." - BJJ Training' },
            { icon: 'üìö', title: 'Learning Mindset in Conflict', content: 'Approaching conflict with a learning mindset improves outcomes. <strong>Research shows</strong> learning mindset improves conflict resolution. In BJJ: You learn from every roll. That\'s learning mindset.', quote: '"You learn from every roll. That\'s learning mindset." - BJJ Growth' },
            { icon: 'üå±', title: 'Grow From Conflict', content: 'You can learn and grow from conflict situations. <strong>Research shows</strong> conflict is a growth opportunity. In BJJ: You grow from hard rolls. That\'s learning from conflict.', quote: '"You grow from hard rolls. That\'s learning from conflict." - BJJ Development' }
        ];

        const sectionIntros = {
            'Conflict Engagement': 'Conflict engagement is the foundation of healthy conflict. Teams that engage in conflict make better decisions. Research shows teams that avoid conflict make worse decisions. In BJJ: Rolling IS controlled conflict. You can\'t get better without engaging.',
            'Debate vs Argument': 'Productive debate focuses on ideas, not personalities. It\'s about finding truth, not winning. Research shows idea-focused debate improves decisions. In BJJ: You debate technique, not the person. That\'s productive debate.',
            'Healthy Tension': 'Healthy tension is necessary for good decisions. It\'s the productive friction that creates better outcomes. Research shows teams that embrace healthy tension outperform others. In BJJ: You embrace hard rolls. That\'s healthy tension.'
        };

        let currentQuestionIndex = 0;
        let answers = {};
        const totalQuestions = questions.length;
        const currentStripeName = 'purpleBeltStripe2';

        function tapOut() {
            if (confirm('ü•ã TAP OUT?\n\nYour progress will be saved. Return to dashboard?')) {
                saveProgress();
                window.location.href = 'gym-dashboard.html';
            }
        }

        function checkForSavedProgress() {
            const saved = localStorage.getItem('currentProgress');
            if (!saved) return false;
            
            try {
                const progress = JSON.parse(saved);
                if (progress.stripe !== currentStripeName) return false;
                
                const daysSince = (Date.now() - progress.timestamp) / (1000 * 60 * 60 * 24);
                if (daysSince > 7) {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
                
                const resume = confirm(
                    "ü•ã WELCOME BACK!\n\n" +
                    "You were on Question " + progress.currentQuestion + " of " + (progress.totalQuestions || totalQuestions) + ".\n" +
                    "Resume where you left off?"
                );
                
                if (resume) {
                    currentQuestionIndex = progress.questionIndex || (progress.currentQuestion - 1);
                    answers = progress.answers || {};
                    return true;
                } else {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
            } catch (e) {
                console.error('Error loading saved progress:', e);
                return false;
            }
        }
        
        function saveProgress() {
            const progressData = {
                stripe: currentStripeName,
                currentQuestion: currentQuestionIndex + 1,
                questionIndex: currentQuestionIndex,
                answers: answers,
                timestamp: Date.now(),
                partialComplete: true,
                totalQuestions: totalQuestions
            };
            localStorage.setItem('currentProgress', JSON.stringify(progressData));
        }
        
        function clearProgress() {
            localStorage.removeItem('currentProgress');
        }
        
        function startAssessment() {
            // Check if Purple Belt Stripe 1 is complete
            if (localStorage.getItem('purpleBeltStripe1Complete') !== 'true') {
                alert('Please complete Purple Belt Stripe 1 first.');
                window.location.href = 'purple-belt.html';
                return;
            }

            // Track start time for speed achievements
            localStorage.setItem('assessmentStartTime', Date.now().toString());
            
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('progressBarContainer').style.display = 'block';
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('navButtons').style.display = 'flex';
            document.getElementById('tapOutBtn').style.display = 'flex';
            
            const resumed = checkForSavedProgress();
            if (resumed) {
                renderQuestion(currentQuestionIndex);
                updateProgress();
            } else {
                currentQuestionIndex = 0;
                answers = {};
                renderQuestion(0);
            }
        }

        let isDragging = false;

        function renderQuestion(index) {
            const q = questions[index];
            
            // Handle different question types
            if (q.type === 'scenario') {
                renderScenario(index, q);
            } else if (q.type === 'multiple-choice') {
                renderMultipleChoice(index, q);
            } else {
                // Existing Likert scale rendering
                renderLikertScale(index, q);
            }
            
            updateProgress();
        }
        
        function renderLikertScale(index, q) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (q.section) {
                html += `
                    <div class="section-header">
                        <h3>${q.section}</h3>
                        <div class="section-desc">${q.sectionDesc}</div>
                    </div>
                `;
                document.getElementById('currentSection').textContent = q.section;
                
                if (sectionIntros[q.section]) {
                    html += `
                        <div class="insight-card" style="margin-bottom: 25px;">
                            <div class="insight-icon">üí°</div>
                            <div class="insight-title">Why This Matters</div>
                            <div class="insight-content">${sectionIntros[q.section]}</div>
                        </div>
                    `;
                }
            }
            
            const options = getOptionsForQuestion(q);
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="scale-options" id="scaleContainer">
                        ${options.map((opt, idx) => `
                            <div class="scale-option ${answers[index] === opt.value ? 'selected' : ''}" data-value="${opt.value}" onclick="selectOption(event, ${opt.value})">
                                <span>${idx + 1}</span>
                                <small>${opt.text}</small>
                            </div>
                        `).join('')}
                    </div>
                    <div id="insightContainer"></div>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('currentQ').textContent = index + 1;
            setupDragHandlers();
            
            if (answers[index]) {
                showInsight(insights[index]);
            }
        }

        function getOptionsForQuestion(q) {
            const questionText = q.question.toLowerCase();
            
            // Default scale options
            const defaultOptions = [
                { text: 'Not at all', value: 1 },
                { text: 'Somewhat', value: 2 },
                { text: 'Moderately', value: 3 },
                { text: 'Well', value: 4 },
                { text: 'Perfectly', value: 5 }
            ];
            
            // Custom options for specific questions
            if (questionText.includes('comfortable engaging') || questionText.includes('feel comfortable')) {
                return [
                    { text: 'Never - very uncomfortable', value: 1 },
                    { text: 'Rarely - only when necessary', value: 2 },
                    { text: 'Sometimes - depends on situation', value: 3 },
                    { text: 'Often - comfortable engaging', value: 4 },
                    { text: 'Always - very comfortable', value: 5 }
                ];
            } else if (questionText.includes('when i disagree')) {
                return [
                    { text: 'Stay silent and avoid', value: 1 },
                    { text: 'Mention it privately later', value: 2 },
                    { text: 'Speak up sometimes', value: 3 },
                    { text: 'Speak up directly', value: 4 },
                    { text: 'Always speak up immediately', value: 5 }
                ];
            } else if (questionText.includes('avoid conflict') || questionText.includes('prefer to keep the peace')) {
                return [
                    { text: 'Always - avoid at all costs', value: 1 },
                    { text: 'Often - prefer peace', value: 2 },
                    { text: 'Sometimes - depends', value: 3 },
                    { text: 'Rarely - engage when needed', value: 4 },
                    { text: 'Never - always engage', value: 5 }
                ];
            } else if (questionText.includes('withdrawing') || questionText.includes('shutting down')) {
                return [
                    { text: 'Always - withdraw immediately', value: 1 },
                    { text: 'Often - usually withdraw', value: 2 },
                    { text: 'Sometimes - depends', value: 3 },
                    { text: 'Rarely - usually engage', value: 4 },
                    { text: 'Never - always engage', value: 5 }
                ];
            } else if (questionText.includes('productive debate') || questionText.includes('focused on ideas')) {
                return [
                    { text: 'Never - always personal', value: 1 },
                    { text: 'Rarely - usually personal', value: 2 },
                    { text: 'Sometimes - mix of both', value: 3 },
                    { text: 'Often - usually idea-focused', value: 4 },
                    { text: 'Always - always idea-focused', value: 5 }
                ];
            } else if (questionText.includes('listen actively') || questionText.includes('seeking to understand')) {
                return [
                    { text: 'Never - don\'t listen', value: 1 },
                    { text: 'Rarely - mostly defend', value: 2 },
                    { text: 'Sometimes - try to listen', value: 3 },
                    { text: 'Often - actively listen', value: 4 },
                    { text: 'Always - always listen first', value: 5 }
                ];
            } else if (questionText.includes('view conflict as healthy') || questionText.includes('necessary for good decisions')) {
                return [
                    { text: 'Never - see it as bad', value: 1 },
                    { text: 'Rarely - usually avoid', value: 2 },
                    { text: 'Sometimes - depends', value: 3 },
                    { text: 'Often - see it as useful', value: 4 },
                    { text: 'Always - see it as essential', value: 5 }
                ];
            } else if (questionText.includes('welcome different perspectives')) {
                return [
                    { text: 'Never - prefer agreement', value: 1 },
                    { text: 'Rarely - tolerate differences', value: 2 },
                    { text: 'Sometimes - accept differences', value: 3 },
                    { text: 'Often - welcome differences', value: 4 },
                    { text: 'Always - actively seek differences', value: 5 }
                ];
            }
            
            return defaultOptions;
        }
        
        function renderScenario(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Scenario ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="scenario-options">
                        ${question.options.map((opt, idx) => `
                            <div class="scenario-option" data-option="${idx}" onclick="selectScenario(${index}, ${idx})">
                                <div class="option-letter">${String.fromCharCode(65 + idx)}</div>
                                <div class="option-text">${opt.text}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="scenarioFeedback" class="scenario-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectScenario(index, selectedIdx);
                }
            }
        }
        
        function selectScenario(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback on options
            document.querySelectorAll('.scenario-option').forEach((opt, idx) => {
                opt.classList.remove('selected', 'correct', 'incorrect', 'neutral');
                
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    
                    // Color code based on value
                    if (selectedOption.value >= 4) {
                        opt.classList.add('correct');
                    } else if (selectedOption.value <= 2) {
                        opt.classList.add('incorrect');
                    } else {
                        opt.classList.add('neutral');
                    }
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('scenarioFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card scenario-insight">
                        <div class="insight-content">${selectedOption.feedback}</div>
                        ${selectedOption.insight ? `<div class="insight-quote">${selectedOption.insight}</div>` : ''}
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }
        
        function renderMultipleChoice(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="mc-options">
                        ${question.options.map((opt, idx) => `
                            <div class="mc-option" data-option="${idx}" onclick="selectMultipleChoice(${index}, ${idx})">
                                <div class="mc-radio">
                                    <input type="radio" name="mc${index}" value="${idx}">
                                </div>
                                <div class="mc-content">
                                    <div class="mc-text">${opt.text}</div>
                                    ${opt.type ? `<div class="mc-type">${opt.type}</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="mcFeedback" class="mc-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectMultipleChoice(index, selectedIdx);
                }
            }
        }
        
        function selectMultipleChoice(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback
            document.querySelectorAll('.mc-option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('mcFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card mc-insight">
                        ${selectedOption.type ? `<div class="mc-type-badge">${selectedOption.type}</div>` : ''}
                        <div class="insight-content">${selectedOption.feedback}</div>
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }

        function setupDragHandlers() {
            const scaleContainer = document.getElementById('scaleContainer');
            if (!scaleContainer) return;
            
            function handleInteraction(e) {
                const rect = scaleContainer.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const relativeX = Math.max(0, Math.min(1, x / rect.width));
                const value = Math.ceil(relativeX * 5) || 1;
                selectOption(e, value);
                updateSliderVisual(value);
            }

            scaleContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                handleInteraction(e);
            });

            scaleContainer.addEventListener('mousemove', (e) => {
                if (isDragging) handleInteraction(e);
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            scaleContainer.addEventListener('touchstart', (e) => {
                isDragging = true;
                handleInteraction(e);
            }, { passive: false });

            scaleContainer.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleInteraction(e);
                }
            }, { passive: false });

            scaleContainer.addEventListener('touchend', () => {
                isDragging = false;
            });
        }

        function updateSliderVisual(value) {
            const options = document.querySelectorAll('.scale-option');
            options.forEach((opt, idx) => {
                if (idx < value) {
                    opt.classList.add('active');
                } else {
                    opt.classList.remove('active');
                }
            });
        }

        function selectOption(e, value) {
            e.stopPropagation();
            answers[currentQuestionIndex] = value;
            
            document.querySelectorAll('.scale-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            const selectedOpt = document.querySelector(`[data-value="${value}"]`);
            if (selectedOpt) {
                selectedOpt.classList.add('selected');
            }
            
            updateSliderVisual(value);
            document.getElementById('nextBtn').disabled = false;
            showInsight(insights[currentQuestionIndex]);
            
            saveProgress();
        }

        function showInsight(insight) {
            const container = document.getElementById('insightContainer');
            container.innerHTML = `
                <div class="insight-card">
                    <div class="insight-icon">${insight.icon}</div>
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-content">${insight.content}</div>
                    <div class="insight-quote">${insight.quote}</div>
                </div>
            `;
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = false;
                document.getElementById('nextBtn').disabled = !answers[currentQuestionIndex];
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateProgress() {
            const answered = Object.keys(answers).length;
            const progress = (answered / questions.length) * 100;
            if (document.getElementById('progressBar')) {
                document.getElementById('progressBar').style.width = progress + '%';
            }
            
            // Milestone celebrations
            checkMilestones(progress);
            
            if (currentQuestionIndex === questions.length - 1) {
                if (document.getElementById('nextBtn')) {
                    document.getElementById('nextBtn').textContent = 'See Results üéØ';
                }
            }
        }
        
        // Milestone system
        function checkMilestones(progress) {
            if (!window.milestonesShown) {
                window.milestonesShown = [];
            }
            
            const milestones = [25, 50, 75, 100];
            const currentMilestone = Math.floor(progress / 25) * 25;
            
            if (milestones.includes(currentMilestone) && 
                !window.milestonesShown.includes(currentMilestone) &&
                progress >= currentMilestone) {
                
                window.milestonesShown.push(currentMilestone);
                showMilestoneCelebration(currentMilestone);
            }
        }
        
        function showMilestoneCelebration(percent) {
            const messages = {
                25: {
                    emoji: 'üéØ',
                    title: '25% Complete!',
                    message: 'You\'re building momentum! Great start!',
                    color: 'linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)'
                },
                50: {
                    emoji: 'üî•',
                    title: 'Halfway There!',
                    message: 'You\'re crushing it! Keep going!',
                    color: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'
                },
                75: {
                    emoji: 'üí™',
                    title: '75% Complete!',
                    message: 'Almost done! Finish strong!',
                    color: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)'
                },
                100: {
                    emoji: 'üéâ',
                    title: 'Assessment Complete!',
                    message: 'Amazing work! Time to see your results!',
                    color: 'linear-gradient(135deg, #10b981 0%, #059669 100%)'
                }
            };
            
            const milestone = messages[percent];
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'milestone-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.7); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div class="milestone-content" style="
                    background: ${milestone.color}; color: white;
                    padding: 50px; border-radius: 20px; text-align: center;
                    max-width: 500px; animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">${milestone.emoji}</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800;">${milestone.title}</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.95;">${milestone.message}</p>
                    <button onclick="this.closest('.milestone-modal').remove()" style="
                        background: white; color: #333; padding: 15px 30px;
                        border: none; border-radius: 10px; font-size: 1.1rem;
                        font-weight: 700; cursor: pointer; transition: all 0.2s;
                    ">
                        Continue ‚Üí
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Trigger confetti
            triggerConfetti();
            
            // Auto-close after 3 seconds if not dismissed
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.style.opacity = '0';
                    setTimeout(() => modal.remove(), 300);
                }
            }, 3000);
        }
        
        function triggerConfetti() {
            const emojis = ['üéâ', '‚≠ê', '‚ú®', 'üéä', 'üí´', 'üåü'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.cssText = `
                    position: fixed; font-size: 2rem; z-index: 9999;
                    left: ${Math.random() * 100}vw; top: -50px;
                    pointer-events: none;
                    animation: confettiFall ${2 + Math.random() * 2}s ease-out forwards;
                `;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 4000);
            }
        }
        
        function showAchievementBadge(badgeId, title, description, xpValue) {
            const badge = document.createElement('div');
            badge.className = 'achievement-modal';
            badge.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const badgeEmojis = {
                'first-stripe': 'üë£',
                'perfect-score': 'üéØ',
                'speed-demon': '‚ö°',
                'streak-3': 'üî•',
                'streak-7': 'üî•',
                'streak-30': 'üî•',
                'dedicated': 'üí™',
                'scholar': 'üìö',
                'master': 'üëë'
            };
            
            const emoji = badgeEmojis[badgeId] || 'üèÜ';
            
            badge.innerHTML = `
                <div class="achievement-content" style="
                    background: white; padding: 50px; border-radius: 20px;
                    text-align: center; max-width: 500px;
                    animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 6rem; margin-bottom: 1rem;">${emoji}</div>
                    <div style="
                        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                        color: white; display: inline-block; padding: 8px 20px;
                        border-radius: 20px; font-size: 0.9rem; font-weight: 700;
                        margin-bottom: 1rem; text-transform: uppercase;
                        letter-spacing: 1px;
                    ">Achievement Unlocked!</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800; color: #333;">${title}</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: #666; line-height: 1.6;">${description}</p>
                    <div style="
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white; display: inline-block; padding: 12px 24px;
                        border-radius: 12px; font-size: 1.2rem; font-weight: 700;
                        margin-bottom: 1.5rem;
                    ">+${xpValue} XP</div>
                    <div>
                        <button onclick="this.closest('.achievement-modal').remove()" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white; padding: 15px 30px; border: none;
                            border-radius: 10px; font-size: 1.1rem; font-weight: 700;
                            cursor: pointer; transition: all 0.2s;
                        ">
                            Awesome! ‚ú®
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(badge);
            triggerConfetti();
        }
        
        function checkAchievements() {
            // Perfect Score
            let perfectScore = true;
            for (let i = 0; i < questions.length; i++) {
                if (answers[i] < 4) {
                    perfectScore = false;
                    break;
                }
            }
            if (perfectScore) {
                showAchievementBadge('perfect-score', 'üéØ Perfect Score', 'You answered all questions at mastery level!', 50);
            }
            
            // Speed Demon
            const startTime = parseInt(localStorage.getItem('assessmentStartTime') || '0');
            const completionTime = (Date.now() - startTime) / 1000 / 60; // minutes
            if (completionTime < 5 && startTime > 0) {
                showAchievementBadge('speed-demon', '‚ö° Speed Demon', 'Completed in under 5 minutes!', 25);
            }
            
            // First Stripe
            const completedStripes = Object.keys(localStorage).filter(k => k.includes('Complete')).length;
            if (completedStripes === 1) {
                showAchievementBadge('first-stripe', 'üë£ First Steps', 'You completed your first stripe!', 25);
            }
        }

        function showResults() {
            // Check achievements before showing results
            checkAchievements();
            
            let engagementScore = 0;
            let debateScore = 0;
            let tensionScore = 0;
            
            // Conflict Engagement (questions 0-5)
            for (let i = 0; i < 6; i++) {
                if (answers[i]) engagementScore += answers[i];
            }
            
            // Debate vs Argument (questions 6-11)
            for (let i = 6; i < 12; i++) {
                if (answers[i]) debateScore += answers[i];
            }
            
            // Healthy Tension (questions 12-17)
            for (let i = 12; i < 18; i++) {
                if (answers[i]) tensionScore += answers[i];
            }
            
            const avgEngagement = engagementScore / 6;
            const avgDebate = debateScore / 6;
            const avgTension = tensionScore / 6;
            const overallScore = (avgEngagement + avgDebate + avgTension) / 3;
            
            let conflictType = '';
            let typeEmoji = '';
            let typeLabel = '';
            let typeColor = '';
            let strengths = [];
            let challenges = [];
            let strategies = [];
            
            if (overallScore <= 2.0) {
                conflictType = 'Developing';
                typeEmoji = 'üå±';
                typeLabel = 'üå± Developing Conflict Capacity';
                typeColor = '#f4a261';
                strengths = [
                    'Awareness is the first step to growth',
                    'You\'re honest about where you are',
                    'Every master was once a beginner',
                    'You have room to build strong foundations',
                    'Growth mindset is already present'
                ];
                challenges = [
                    'Conflict engagement needs development',
                    'Debate skills require practice',
                    'Healthy tension creation needs cultivation',
                    'Comfort with disagreement needs growth',
                    'Conflict facilitation needs building'
                ];
                strategies = [
                    'Start by speaking up once this week when you disagree',
                    'Practice engaging in one debate this week',
                    'Ask for different perspectives in one meeting',
                    'Challenge one idea respectfully this week',
                    'Practice "fighting fair" in one conflict'
                ];
            } else if (overallScore <= 3.5) {
                conflictType = 'Building';
                typeEmoji = 'üèóÔ∏è';
                typeLabel = 'üèóÔ∏è Building Conflict Capacity';
                typeColor = '#7c3aed';
                strengths = [
                    'You have some comfort with conflict',
                    'You recognize areas that need work',
                    'You\'re building foundational skills',
                    'You have some effective strategies',
                    'You\'re committed to growth'
                ];
                challenges = [
                    'Consistency in practice is key',
                    'Some patterns still need attention',
                    'Debate skills could be stronger',
                    'Healthy tension creation needs refinement',
                    'Conflict facilitation could be more consistent'
                ];
                strategies = [
                    'Double down on what\'s working',
                    'Practice conflict engagement weekly',
                    'Facilitate one productive debate this month',
                    'Create healthy tension in one discussion',
                    'Build your conflict facilitation skills'
                ];
            } else {
                conflictType = 'Strong';
                typeEmoji = 'üí™';
                typeLabel = 'üí™ Strong Conflict Capacity';
                typeColor = '#2a9d8f';
                strengths = [
                    'High comfort with conflict engagement',
                    'Strong debate vs argument skills',
                    'Effective healthy tension creation',
                    'Consistent conflict facilitation',
                    'Good learning from conflict'
                ];
                challenges = [
                    'Maintain conflict capacity during stress',
                    'Continue refining your approach',
                    'Support others in their conflict journey',
                    'Stay aware of changing conflict needs',
                    'Prevent complacency in good times'
                ];
                strategies = [
                    'Share your conflict strategies with others',
                    'Continue refining as relationships evolve',
                    'Stay aware of changing conflict needs',
                    'Support others in building conflict capacity',
                    'Use your strength to help build team conflict capacity'
                ];
            }

            document.getElementById('assessmentForm').style.display = 'none';
            document.getElementById('resultsContainer').classList.add('active');
            
            document.getElementById('typeEmoji').textContent = typeEmoji;
            document.getElementById('typeLabel').textContent = typeLabel;
            document.getElementById('typeResultCard').style.background = `linear-gradient(135deg, ${typeColor} 0%, ${typeColor}dd 100%)`;
            
            const typeDetailsHTML = `
                <div class="type-card">
                    <h3>üí™ Your Strengths</h3>
                    <ul>
                        ${strengths.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #fff5f0; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">‚ö†Ô∏è Areas for Growth</h3>
                    <ul>
                        ${challenges.map(c => `<li>${c}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #f0f4ff; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">üéØ Recommended Strategies</h3>
                    <ul>
                        ${strategies.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="insight-card" style="margin-top: 30px;">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-title">The Key Insight</div>
                    <div class="insight-content">
                        <strong>Conflict isn't bad‚Äîabsence of conflict is.</strong> Just like in BJJ, where rolling IS controlled conflict and you can't get better without engaging, teams need healthy conflict to make better decisions.
                        <br><br>
                        <strong>ü•ã BJJ Wisdom:</strong> "Rolling IS controlled conflict. You can't get better without engaging. You don't learn by avoiding hard rolls. The best training partners push you, not coddle you."
                    </div>
                </div>
            `;
            
            document.getElementById('typeDetails').innerHTML = typeDetailsHTML;
            
            clearProgress();
            
            localStorage.setItem('purpleBeltStripe2Complete', 'true');
            localStorage.setItem('purpleBeltStripe2CompletedDate', new Date().toISOString());
            localStorage.setItem('conflictCapacity', conflictType);
            
            const currentXP = parseInt(localStorage.getItem('totalXP') || '0');
            const xpReward = 200;
            localStorage.setItem('totalXP', (currentXP + xpReward).toString());
            
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #38a169 0%, #2f855a 100%); color: white; padding: 1rem 1.5rem; border-radius: 10px; box-shadow: 0 4px 20px rgba(56, 161, 105, 0.4); z-index: 1000; font-weight: 600;';
                notification.innerHTML = `‚úÖ Stripe 2 Complete! +${xpReward} XP`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }, 500);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
<!-- TAP-IN Utilities -->
<script src="js/shared-utilities.js"></script>
<script src="js/global-error-handler.js"></script>
<script src="js/storage-health.js"></script>
</body>
</html>



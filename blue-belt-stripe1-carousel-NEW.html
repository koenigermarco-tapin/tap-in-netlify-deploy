<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#3b82f6">
    <title>üîµ Blue Belt Stripe 1: Trust Foundations - TAP-IN</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 25px; border-bottom: 3px solid #f0f0f0; }
        .header h1 { color: #1d4ed8; font-size: 2.3em; margin-bottom: 15px; }
        .header .subtitle { color: #666; font-size: 1.1em; margin-bottom: 10px; }
        .header .duration { color: #999; font-size: 0.9em; font-style: italic; }
        
        .progress-bar { position: sticky; top: 10px; background: white; padding: 15px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; }
        .progress-text { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 8px; }
        .progress-fill { height: 8px; background: #e0e0e0; border-radius: 10px; overflow: hidden; }
        .progress-fill-bar { background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%); height: 100%; width: 0%; transition: width 0.3s ease; }
        
        .section-header { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; }
        .section-header h3 { font-size: 1.2em; margin-bottom: 5px; }
        .section-header .section-desc { font-size: 0.9em; opacity: 0.95; font-style: italic; }
        
        .question-card { background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 20px; }
        .question-number { color: #1d4ed8; font-weight: bold; font-size: 0.9em; margin-bottom: 10px; }
        .question-text { font-size: 1.2em; color: #333; margin-bottom: 25px; font-weight: 500; line-height: 1.5; }
        
        .scale-options { display: flex; justify-content: space-between; align-items: flex-end; gap: 2px; flex-wrap: nowrap; height: 140px; position: relative; background: linear-gradient(to top right, rgba(59, 130, 246, 0.1) 0%, rgba(29, 78, 216, 0.05) 50%, transparent 50%); border-radius: 8px; padding: 5px; cursor: pointer; user-select: none; }
        .scale-option { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(29, 78, 216, 0.1) 100%); border: 3px solid #cbd5e1; border-radius: 6px; transition: all 0.15s ease; position: relative; z-index: 1; padding: 10px 5px; }
        .scale-option:nth-child(1) { height: 50px; opacity: 0.15; }
        .scale-option:nth-child(2) { height: 70px; opacity: 0.35; }
        .scale-option:nth-child(3) { height: 90px; opacity: 0.55; }
        .scale-option:nth-child(4) { height: 110px; opacity: 0.75; }
        .scale-option:nth-child(5) { height: 130px; opacity: 0.85; }
        .scale-option span { font-size: 1.3em; font-weight: 800; color: #1e293b; opacity: 1; margin-bottom: 5px; }
        .scale-option small { font-size: 0.7em; color: #475569; font-weight: 600; opacity: 1; text-align: center; line-height: 1.2; }
        .scale-option:hover { transform: scale(1.05); border-color: #3b82f6; }
        .scale-option.active, .scale-option.selected { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border-color: #1e40af; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4); }
        .scale-option.active ~ .scale-option { background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(29, 78, 216, 0.1) 100%); color: #333; }
        .scale-option.active span, .scale-option.selected span { color: white; }
        .scale-option.active small, .scale-option.selected small { color: rgba(255,255,255,0.9); }
        
        .insight-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-left: 4px solid #3b82f6; padding: 20px; margin: 20px 0; border-radius: 10px; animation: slideIn 0.4s ease; }
        .insight-icon { font-size: 2rem; margin-bottom: 10px; }
        .insight-title { color: #1d4ed8; font-size: 1.1em; font-weight: bold; margin-bottom: 12px; }
        .insight-content { color: #555; line-height: 1.7; margin-bottom: 12px; }
        .insight-quote { font-style: italic; color: #666; font-size: 0.95em; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 3px solid #3b82f6; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Scenario Question Styles */
        .scenario-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .scenario-option {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .scenario-option:hover {
            border-color: #667eea;
            background: #f0f0ff;
            transform: translateX(5px);
        }
        .scenario-option.selected {
            border-color: #667eea;
            background: #e8e8ff;
        }
        .scenario-option.correct {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        .scenario-option.correct .option-letter {
            background: #10b981;
        }
        .scenario-option.incorrect {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        }
        .scenario-option.incorrect .option-letter {
            background: #ef4444;
        }
        .scenario-option.neutral {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        .scenario-option.neutral .option-letter {
            background: #f59e0b;
        }
        .option-letter {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .option-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            padding-top: 8px;
        }
        .scenario-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .scenario-insight {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid #3b82f6;
        }
        
        /* Multiple Choice Styles */
        .mc-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .mc-option {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .mc-option:hover {
            border-color: #667eea;
            background: #fafbff;
            transform: translateX(3px);
        }
        .mc-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        .mc-radio {
            padding-top: 2px;
        }
        .mc-radio input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            cursor: pointer;
        }
        .mc-content {
            flex: 1;
        }
        .mc-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            margin-bottom: 6px;
        }
        .mc-type {
            color: #667eea;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .mc-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .mc-insight {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid #10b981;
        }
        .mc-type-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg) translateX(200px);
                opacity: 0;
            }
        }
        .milestone-content button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .fun-fact-box {
            animation: slideIn 0.4s ease;
        }
        
        @media (max-width: 768px) {
            .scenario-option {
                padding: 12px 15px;
                gap: 12px;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            .option-text {
                font-size: 0.9rem;
            }
            .mc-option {
                padding: 15px;
            }
            .mc-text {
                font-size: 0.9rem;
            }
        }
        
        .nav-buttons { display: flex; gap: 15px; justify-content: space-between; margin-top: 25px; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.2s; font-weight: 600; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .results-container { display: none; }
        .results-container.active { display: block; }
        .overall-score { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border-radius: 20px; padding: 40px; text-align: center; margin-bottom: 30px; }
        .score-number { font-size: 4em; font-weight: bold; margin-bottom: 10px; }
        .score-label { font-size: 1.3em; opacity: 0.95; }
        .type-card { background: #f8f9fa; padding: 30px; border-radius: 15px; margin: 20px 0; border-left: 4px solid #3b82f6; }
        .type-card h3 { color: #1d4ed8; margin-bottom: 15px; font-size: 1.5em; }
        .type-card ul { list-style: none; padding-left: 0; }
        .type-card li { padding: 8px 0; padding-left: 25px; position: relative; color: #555; line-height: 1.7; }
        .type-card li:before { content: "‚Üí"; position: absolute; left: 0; color: #3b82f6; font-weight: bold; }
        .cta-box { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border-radius: 15px; padding: 30px; text-align: center; margin-top: 30px; }
        .cta-box h3 { font-size: 1.6em; margin-bottom: 15px; }
        .cta-box p { font-size: 1em; margin-bottom: 20px; opacity: 0.95; }
        .cta-btn { background: white; color: #1d4ed8; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: bold; display: inline-block; transition: all 0.2s; }
        .cta-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(255,255,255,0.3); }
        
        .tap-out-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
        }
        .tap-out-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.6);
        }
        @media (max-width: 768px) {
            .container { padding: 25px; }
            .header h1 { font-size: 2em; }
            .scale-option small { font-size: 0.65em; }
            .tap-out-button {
                top: 10px;
                right: 10px;
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }
    
        /* ============= NUMBERED OPTION BOX READABILITY FIX ============= */
        .scale-option,
        .rating-option,
        .numbered-option,
        .option-number,
        [data-value="1"],
        [data-value="2"],
        [data-value="3"],
        [data-value="4"],
        [data-value="5"] {
            color: #FFFFFF !important;
            font-weight: 700 !important;
            font-size: 1.1rem !important;
            background: #1e293b !important;
            border: 2px solid #475569 !important;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5) !important;
        }
        .scale-option:hover,
        .rating-option:hover,
        .numbered-option:hover,
        .option-number:hover,
        [data-value]:hover {
            background: #334155 !important;
            border-color: #667eea !important;
            color: #FFFFFF !important;
            transform: scale(1.05) !important;
        }
        .scale-option.selected,
        .rating-option.selected,
        .numbered-option.selected,
        .option-number.selected,
        [data-value].selected {
            background: #667eea !important;
            border-color: #818cf8 !important;
            color: #FFFFFF !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
        }
        .scale-label,
        .rating-label,
        .option-label {
            color: #FFFFFF !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
            text-align: center !important;
            margin-top: 0.5rem !important;
        }
        .scale-container,
        .rating-container,
        .options-row {
            display: flex !important;
            justify-content: space-between !important;
            gap: 0.75rem !important;
            margin: 1.5rem 0 !important;
        }
        .scale-container > *,
        .rating-container > *,
        .options-row > * {
            flex: 1 !important;
            min-width: 60px !important;
            text-align: center !important;
            padding: 1rem 0.5rem !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        @media (max-width: 768px) {
            .scale-option,
            .rating-option,
            .numbered-option,
            .option-number,
            [data-value] {
                font-size: 1rem !important;
                padding: 0.75rem 0.25rem !important;
                min-width: 50px !important;
            }
            .scale-label,
            .rating-label,
            .option-label {
                font-size: 0.75rem !important;
            }
        }
        input[type="range"] {
            -webkit-appearance: none !important;
            width: 100% !important;
            height: 8px !important;
            background: #334155 !important;
            border-radius: 5px !important;
            outline: none !important;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none !important;
            width: 24px !important;
            height: 24px !important;
            background: #667eea !important;
            cursor: pointer !important;
            border-radius: 50% !important;
            border: 3px solid #FFFFFF !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px !important;
            height: 24px !important;
            background: #667eea !important;
            cursor: pointer !important;
            border-radius: 50% !important;
            border: 3px solid #FFFFFF !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
        .slider-value,
        .range-value {
            display: block !important;
            text-align: center !important;
            font-size: 1.5rem !important;
            font-weight: 700 !important;
            color: #667eea !important;
            margin-top: 1rem !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2) !important;
        }
        .slider-labels {
            display: flex !important;
            justify-content: space-between !important;
            margin-top: 0.5rem !important;
        }
        .slider-labels span {
            font-size: 0.85rem !important;
            color: #cbd5e1 !important;
            font-weight: 600 !important;
        }

    </style>
</head>
<body>
    <!-- TAP OUT Button -->
    <button class="tap-out-button" onclick="tapOut()" id="tapOutBtn" style="display: none;">
        <div class="tap-icon">ü•ã</div>
        <div class="tap-text">TAP</div>
    </button>
    
    <!-- Language Switcher -->
    <div style="position:fixed;top:16px;right:16px;z-index:1200;">
        <div style="background:white;border-radius:999px;padding:8px 12px;box-shadow:0 6px 20px rgba(0,0,0,0.15);font-size:0.95em;">
            <a href="blue-belt-stripe1-carousel-NEW.html" style="color:#1d4ed8;text-decoration:none;font-weight:700;margin-right:10px;">EN</a>
            <a href="blue-belt-stripe1-carousel-NEW-de.html" style="color:#333;text-decoration:none;font-weight:700;border-left:1px solid #eee;padding-left:10px;margin-left:10px;">DE</a>
        </div>
    </div>

    <div class="container">
        <!-- Assessment Form -->
        <div id="assessmentForm">
            <div class="header">
                <h1>üîµ Blue Belt - Stripe 1: Trust Foundations</h1>
                <p class="subtitle">Vulnerability, Psychological Safety & Opening Up</p>
                <p class="duration">‚è±Ô∏è 7-10 Minutes ‚Ä¢ 18 Questions</p>
            </div>

            <!-- Intro Section -->
            <div id="introSection" style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #3b82f6;">
                <h3 style="color: #333; margin-bottom: 15px;">üîì Trust - The Foundation of All Relationships</h3>
                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>You can't have real relationships without vulnerability.</strong> This assessment reveals your comfort with showing vulnerability, creating psychological safety, and building trust. Trust isn't built through competence‚Äîit's built through vulnerability.
                </p>
                
                <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #3b82f6;">
                    <p style="font-style: italic; color: #555; margin-bottom: 10px;">
                        "You literally can't practice BJJ without being vulnerable‚Äîyou let someone try to choke you. Tapping is trust. You trust your partner to let go."
                    </p>
                    <p style="text-align: right; color: #888; font-size: 0.9em;">‚Äî BJJ Wisdom</p>
                </div>

                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>Research from Patrick Lencioni</strong> shows that trust is the foundation of all team performance. Teams that build vulnerability-based trust outperform others by 50%. This assessment helps you:
                </p>
                <ul style="color: #666; line-height: 1.8; margin-left: 20px; margin-bottom: 15px;">
                    <li>Understand your comfort with vulnerability</li>
                    <li>Assess your ability to create psychological safety</li>
                    <li>Identify trust-building behaviors you use</li>
                    <li>Recognize areas for growth in trust capacity</li>
                </ul>

                <p style="color: #666; line-height: 1.7; margin-top: 15px; padding: 15px; background: #eff6ff; border-radius: 8px; font-size: 0.95em;">
                    <strong>ü•ã In BJJ:</strong> You literally can't practice BJJ without being vulnerable‚Äîyou let someone try to choke you. Showing your back is ultimate vulnerability. Tapping is trust. You trust your partner to let go. Can't learn without admitting you don't know.
                </p>
                
                <button onclick="startAssessment()" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); display: block; margin: 20px auto 0; width: auto;">
                    Start Assessment ‚Üí
                </button>
            </div>

            <div class="progress-bar" style="display: none;" id="progressBarContainer">
                <div class="progress-text"><span id="currentSection">Vulnerability & Trust</span> ‚Ä¢ Question <span id="currentQ">1</span> of 18</div>
                <div class="progress-fill">
                    <div class="progress-fill-bar" id="progressBar"></div>
                </div>
            </div>

            <div id="questionContainer" style="display: none;"></div>

            <div class="nav-buttons" style="display: none;" id="navButtons">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" disabled>‚Üê Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next ‚Üí</button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="results-container">
            <div class="header">
                <h1>üîµ Your Trust Foundations Profile</h1>
            </div>

            <div class="overall-score" id="typeResultCard">
                <div class="score-number" id="typeEmoji">üîì</div>
                <div class="score-label" id="typeLabel">Calculating...</div>
            </div>

            <div id="typeDetails"></div>

            <div class="cta-box">
                <h3>üîµ Blue Belt Stripe 1 Complete!</h3>
                <p>You now understand your trust foundations. Ready to continue your journey?</p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                    <a href="blue-belt-stripe2-carousel-NEW.html" class="cta-btn" style="margin: 0;">Continue to Stripe 2 ‚Üí</a>
                    <a href="gym-dashboard.html" class="cta-btn" style="background: rgba(255,255,255,0.2); border: 2px solid white; margin: 0;">Back to The Gym</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            // VULNERABILITY & TRUST (6 questions)
            {
                section: 'Vulnerability & Trust',
                sectionDesc: 'Your comfort with showing vulnerability and being authentic',
                question: 'I feel comfortable showing vulnerability in my relationships...',
                category: 'vulnerability'
            },
            {
                question: 'When I make a mistake, I typically...',
                category: 'mistakes'
            },
            {
                question: 'I ask for help when I need it...',
                category: 'help'
            },
            {
                question: 'I show my weaknesses or uncertainty to others...',
                category: 'weakness'
            },
            {
                question: 'I can be authentic rather than performing for others...',
                category: 'authenticity'
            },
            {
                question: 'I trust others in my relationships...',
                category: 'trust'
            },
            // PSYCHOLOGICAL SAFETY (6 questions)
            {
                section: 'Psychological Safety',
                sectionDesc: 'Your ability to create and feel safe in relationships',
                question: 'I feel safe to speak up and share my thoughts...',
                category: 'speakup'
            },
            {
                question: 'I fear judgment when I share my concerns...',
                category: 'judgment'
            },
            {
                question: 'I can be myself without pretending...',
                category: 'yourself'
            },
            {
                question: 'I take risks in relationships (sharing concerns, asking for help)...',
                category: 'risks'
            },
            {
                question: 'I share my concerns and fears openly...',
                category: 'concerns'
            },
            {
                question: 'I'm open about my struggles and challenges...',
                category: 'struggles'
            },
            // BUILDING TRUST (6 questions)
            {
                section: 'Building Trust',
                sectionDesc: 'Your trust-building behaviors and reliability',
                question: 'I engage in trust-building behaviors (admitting mistakes, asking for help)...',
                category: 'behaviors'
            },
            {
                question: 'I follow through on commitments I make...',
                category: 'followthrough'
            },
            {
                question: 'My actions align with my words and values...',
                category: 'integrity'
            },
            {
                question: 'I communicate transparently, even when it\'s difficult...',
                category: 'transparency'
            },
            {
                question: 'I give trust first, before others earn it...',
                category: 'giving'
            },
            {
                question: 'When trust is broken, I work to repair it...',
                category: 'repair'
            }
        ];

        const insights = [
            // VULNERABILITY & TRUST INSIGHTS (6)
            { icon: 'üîì', title: 'Vulnerability is Strength', content: 'Vulnerability is the birthplace of trust. <strong>Bren√© Brown\'s research</strong> shows that vulnerability is courage, not weakness. In BJJ: You literally can\'t practice without being vulnerable‚Äîyou let someone try to choke you.', quote: '"Vulnerability is not winning or losing. It\'s having the courage to show up when you can\'t control the outcome." - Bren√© Brown' },
            { icon: 'üí™', title: 'Admitting Mistakes Builds Trust', content: 'Admitting mistakes builds trust faster than competence. <strong>Lencioni\'s research</strong> shows teams that admit mistakes outperform others. In BJJ: You tap when you\'re caught. That\'s admitting you made a mistake. It builds trust.', quote: '"Tapping is trust. You trust your partner to let go." - BJJ Philosophy' },
            { icon: 'ü§ù', title: 'Asking for Help is Strength', content: 'Asking for help is perceived as confidence, not weakness. <strong>Research shows</strong> people who ask for help are rated as more competent. In BJJ: You can\'t learn without asking for help. White belts ask constantly‚Äîthat\'s how they grow.', quote: '"The best fighters ask for help constantly. That\'s how they become the best." - BJJ Wisdom' },
            { icon: 'üé≠', title: 'Showing Weakness is Authentic', content: 'Showing weakness is authentic, not weak. <strong>Research shows</strong> people who show vulnerability are more trusted. In BJJ: Showing your back is ultimate vulnerability. You can\'t hide on the mat.', quote: '"You can\'t hide on the mat. Your weaknesses show. That\'s how you grow." - BJJ Philosophy' },
            { icon: '‚ú®', title: 'Authenticity Over Performance', content: 'Authenticity builds trust; performance builds distance. <strong>Research shows</strong> people prefer authentic leaders. In BJJ: You can\'t fake technique. Either you know it or you don\'t. Same with authenticity.', quote: '"You can\'t fake technique. Either you know it or you don\'t. Same with authenticity." - BJJ Wisdom' },
            { icon: 'üíé', title: 'Trust is Reciprocal', content: 'Trust is reciprocal‚Äîyou give it to get it. <strong>Research shows</strong> trust builds through mutual vulnerability. In BJJ: You trust your partner not to hurt you. They trust you not to hurt them. That\'s the foundation.', quote: '"You trust your partner not to hurt you. They trust you not to hurt them." - BJJ Trust' },
            
            // PSYCHOLOGICAL SAFETY INSIGHTS (6)
            { icon: 'üõ°Ô∏è', title: 'Safety Enables Risk-Taking', content: 'Psychological safety enables risk-taking and innovation. <strong>Amy Edmondson\'s research</strong> shows safety is the #1 predictor of team performance. In BJJ: You can\'t try new techniques without safety. Same with relationships.', quote: '"You can\'t try new techniques without safety. Same with relationships." - BJJ Philosophy' },
            { icon: 'üò∞', title: 'Fear of Judgment Blocks Growth', content: 'Fear of judgment blocks growth and connection. <strong>Research shows</strong> judgment creates distance. In BJJ: Fear of looking bad prevents you from trying new techniques. Same with relationships.', quote: '"Fear of looking bad prevents growth. Let go of judgment." - BJJ Wisdom' },
            { icon: 'üéØ', title: 'Being Yourself is Freedom', content: 'Being yourself is freedom; pretending is a prison. <strong>Research shows</strong> authenticity reduces stress and increases connection. In BJJ: You can\'t pretend you know a technique. Either you do or you don\'t.', quote: '"You can\'t pretend on the mat. Either you know it or you don\'t." - BJJ Authenticity' },
            { icon: '‚ö°', title: 'Risk-Taking Builds Connection', content: 'Risk-taking in relationships builds deeper connection. <strong>Research shows</strong> vulnerability creates intimacy. In BJJ: You can\'t get better without taking risks. Same with relationships.', quote: '"You can\'t get better without taking risks. Same with relationships." - BJJ Growth' },
            { icon: 'üí¨', title: 'Sharing Concerns Creates Safety', content: 'Sharing concerns creates safety for others to share theirs. <strong>Research shows</strong> vulnerability is contagious. In BJJ: When you admit you don\'t know, others feel safe to admit they don\'t know.', quote: '"When you admit you don\'t know, others feel safe to admit they don\'t know." - BJJ Safety' },
            { icon: 'üå±', title: 'Openness About Struggles Builds Trust', content: 'Openness about struggles builds trust and connection. <strong>Research shows</strong> sharing struggles creates empathy. In BJJ: Everyone struggles. Admitting it builds connection.', quote: '"Everyone struggles. Admitting it builds connection." - BJJ Connection' },
            
            // BUILDING TRUST INSIGHTS (6)
            { icon: 'üèóÔ∏è', title: 'Trust-Building Behaviors Matter', content: 'Trust-building behaviors matter more than words. <strong>Research shows</strong> actions build trust faster than promises. In BJJ: You build trust through consistent behavior, not talk.', quote: '"You build trust through consistent behavior, not talk." - BJJ Trust' },
            { icon: '‚úÖ', title: 'Follow-Through is Reliability', content: 'Follow-through is reliability; reliability builds trust. <strong>Research shows</strong> reliability is the foundation of trust. In BJJ: You show up consistently. That builds trust.', quote: '"You show up consistently. That builds trust." - BJJ Reliability' },
            { icon: 'üéØ', title: 'Integrity Alignment Builds Trust', content: 'Integrity alignment builds trust; misalignment breaks it. <strong>Research shows</strong> integrity is essential for trust. In BJJ: Your technique matches your words. That\'s integrity.', quote: '"Your technique matches your words. That\'s integrity." - BJJ Integrity' },
            { icon: 'üíé', title: 'Transparency Creates Trust', content: 'Transparency creates trust; secrecy destroys it. <strong>Research shows</strong> transparency builds trust faster. In BJJ: You can\'t hide your technique. Transparency is built in.', quote: '"You can\'t hide your technique. Transparency is built in." - BJJ Transparency' },
            { icon: 'ü§≤', title: 'Giving Trust First', content: 'Giving trust first creates trust; waiting destroys it. <strong>Research shows</strong> trust begets trust. In BJJ: You trust your partner first. That creates trust.', quote: '"You trust your partner first. That creates trust." - BJJ Trust' },
            { icon: 'üîß', title: 'Repairing Trust is Possible', content: 'Repairing trust is possible through consistent action. <strong>Research shows</strong> trust can be rebuilt. In BJJ: You tap, reset, and try again. That\'s repair.', quote: '"You tap, reset, and try again. That\'s repair." - BJJ Repair' }
        ];

        const sectionIntros = {
            'Vulnerability & Trust': `
                <strong>Why vulnerability and trust matter:</strong> Research from Bren√© Brown and Patrick Lencioni shows that <strong>vulnerability is the foundation of all trust</strong>. You can't have real relationships without being vulnerable. Trust isn't built through competence‚Äîit's built through vulnerability.
                <br><br>
                <strong>The key insight:</strong> You literally can't practice BJJ without being vulnerable‚Äîyou let someone try to choke you. Showing your back is ultimate vulnerability. Tapping is trust. You trust your partner to let go.
                <br><br>
                <strong>ü•ã In BJJ:</strong> Can't learn without admitting you don't know. Can't grow without showing your weaknesses. Can't build trust without being vulnerable.
            `,
            'Psychological Safety': `
                <strong>Why psychological safety matters:</strong> Research from Amy Edmondson (Harvard) shows that <strong>psychological safety is the #1 predictor of team performance</strong>. You can't take risks, innovate, or grow without feeling safe.
                <br><br>
                <strong>The key insight:</strong> Safety enables risk-taking. Fear of judgment blocks growth. Being yourself is freedom; pretending is a prison.
                <br><br>
                <strong>ü•ã In BJJ:</strong> You can't try new techniques without safety. You can't grow without taking risks. You can't be yourself if you're afraid of judgment.
            `,
            'Building Trust': `
                <strong>Why building trust matters:</strong> Research shows that <strong>trust-building behaviors matter more than words</strong>. Trust is built through consistent action, not promises. Reliability, integrity, and transparency create trust.
                <br><br>
                <strong>The key insight:</strong> Follow-through is reliability. Integrity alignment builds trust. Transparency creates trust. Giving trust first creates trust.
                <br><br>
                <strong>ü•ã In BJJ:</strong> You build trust through consistent behavior. You show up. You follow through. You repair when trust is broken.
            `
        };

        // TAP OUT Configuration
        const currentStripeName = 'blueBeltStripe1';
        const totalQuestions = 18;
        
        let currentQuestionIndex = 0;
        let answers = {};
        
        // TAP OUT function
        function tapOut() {
            const confirmed = confirm(
                "ü•ã TAP OUT\n\n" +
                "Your progress will be saved.\n" +
                "You can continue from Question " + (currentQuestionIndex + 1) + " anytime.\n\n" +
                "Return to Gym Dashboard?"
            );
            
            if (!confirmed) return;
            
            const progressData = {
                stripe: currentStripeName,
                currentQuestion: currentQuestionIndex + 1,
                questionIndex: currentQuestionIndex,
                answers: answers,
                timestamp: Date.now(),
                partialComplete: true,
                totalQuestions: totalQuestions
            };
            
            localStorage.setItem('currentProgress', JSON.stringify(progressData));
            showToast("‚úÖ Progress saved! See you soon.");
            
            setTimeout(() => {
                window.location.href = 'gym-dashboard.html';
            }, 1000);
        }
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 16px 32px;
                border-radius: 50px;
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
                z-index: 10000;
                font-weight: 600;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        function checkForSavedProgress() {
            const saved = localStorage.getItem('currentProgress');
            if (!saved) return false;
            
            try {
                const progress = JSON.parse(saved);
                if (progress.stripe !== currentStripeName) return false;
                
                const daysSince = (Date.now() - progress.timestamp) / (1000 * 60 * 60 * 24);
                if (daysSince > 7) {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
                
                const resume = confirm(
                    "ü•ã WELCOME BACK!\n\n" +
                    "You were on Question " + progress.currentQuestion + " of " + (progress.totalQuestions || totalQuestions) + ".\n" +
                    "Resume where you left off?"
                );
                
                if (resume) {
                    currentQuestionIndex = progress.questionIndex || (progress.currentQuestion - 1);
                    answers = progress.answers || {};
                    return true;
                } else {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
            } catch (e) {
                console.error('Error loading saved progress:', e);
                return false;
            }
        }
        
        function saveProgress() {
            const progressData = {
                stripe: currentStripeName,
                currentQuestion: currentQuestionIndex + 1,
                questionIndex: currentQuestionIndex,
                answers: answers,
                timestamp: Date.now(),
                partialComplete: true,
                totalQuestions: totalQuestions
            };
            localStorage.setItem('currentProgress', JSON.stringify(progressData));
        }
        
        function clearProgress() {
            localStorage.removeItem('currentProgress');
        }
        
        function startAssessment() {
            // Check if Blue Belt is unlocked
            if (localStorage.getItem('blueBeltUnlocked') !== 'true') {
                alert('Please complete White Belt graduation first.');
                window.location.href = 'white-belt.html';
                return;
            }

            // Track start time for speed achievements
            localStorage.setItem('assessmentStartTime', Date.now().toString());
            
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('progressBarContainer').style.display = 'block';
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('navButtons').style.display = 'flex';
            document.getElementById('tapOutBtn').style.display = 'flex';
            
            const resumed = checkForSavedProgress();
            if (resumed) {
                renderQuestion(currentQuestionIndex);
                updateProgress();
            } else {
                currentQuestionIndex = 0;
                answers = {};
                renderQuestion(0);
            }
        }

        let isDragging = false;

        function renderQuestion(index) {
            const q = questions[index];
            
            // Handle different question types
            if (q.type === 'scenario') {
                renderScenario(index, q);
            } else if (q.type === 'multiple-choice') {
                renderMultipleChoice(index, q);
            } else {
                // Existing Likert scale rendering
                renderLikertScale(index, q);
            }
            
            updateProgress();
        }
        
        function renderLikertScale(index, q) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (q.section) {
                html += `
                    <div class="section-header">
                        <h3>${q.section}</h3>
                        <div class="section-desc">${q.sectionDesc}</div>
                    </div>
                `;
                document.getElementById('currentSection').textContent = q.section;
                
                if (sectionIntros[q.section]) {
                    html += `
                        <div class="insight-card" style="margin-bottom: 25px;">
                            <div class="insight-icon">üí°</div>
                            <div class="insight-title">Why This Matters</div>
                            <div class="insight-content">${sectionIntros[q.section]}</div>
                        </div>
                    `;
                }
            }
            
            const options = getOptionsForQuestion(q);
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="scale-options" id="scaleContainer">
                        ${options.map((opt, idx) => `
                            <div class="scale-option ${answers[index] === opt.value ? 'selected' : ''}" data-value="${opt.value}" onclick="selectOption(event, ${opt.value})">
                                <span>${idx + 1}</span>
                                <small>${opt.text}</small>
                            </div>
                        `).join('')}
                    </div>
                    <div id="insightContainer"></div>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('currentQ').textContent = index + 1;
            setupDragHandlers();
            
            if (answers[index]) {
                showInsight(insights[index]);
            }
        }
        
        function renderScenario(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Scenario ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="scenario-options">
                        ${question.options.map((opt, idx) => `
                            <div class="scenario-option" data-option="${idx}" onclick="selectScenario(${index}, ${idx})">
                                <div class="option-letter">${String.fromCharCode(65 + idx)}</div>
                                <div class="option-text">${opt.text}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="scenarioFeedback" class="scenario-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectScenario(index, selectedIdx);
                }
            }
        }
        
        function selectScenario(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback on options
            document.querySelectorAll('.scenario-option').forEach((opt, idx) => {
                opt.classList.remove('selected', 'correct', 'incorrect', 'neutral');
                
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    
                    // Color code based on value
                    if (selectedOption.value >= 4) {
                        opt.classList.add('correct');
                    } else if (selectedOption.value <= 2) {
                        opt.classList.add('incorrect');
                    } else {
                        opt.classList.add('neutral');
                    }
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('scenarioFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card scenario-insight">
                        <div class="insight-content">${selectedOption.feedback}</div>
                        ${selectedOption.insight ? `<div class="insight-quote">${selectedOption.insight}</div>` : ''}
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }
        
        function renderMultipleChoice(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="mc-options">
                        ${question.options.map((opt, idx) => `
                            <div class="mc-option" data-option="${idx}" onclick="selectMultipleChoice(${index}, ${idx})">
                                <div class="mc-radio">
                                    <input type="radio" name="mc${index}" value="${idx}">
                                </div>
                                <div class="mc-content">
                                    <div class="mc-text">${opt.text}</div>
                                    ${opt.type ? `<div class="mc-type">${opt.type}</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="mcFeedback" class="mc-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectMultipleChoice(index, selectedIdx);
                }
            }
        }
        
        function selectMultipleChoice(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback
            document.querySelectorAll('.mc-option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('mcFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card mc-insight">
                        ${selectedOption.type ? `<div class="mc-type-badge">${selectedOption.type}</div>` : ''}
                        <div class="insight-content">${selectedOption.feedback}</div>
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }

        function getOptionsForQuestion(q) {
            const questionText = q.question.toLowerCase();
            
            if (questionText.includes('comfortable showing vulnerability')) {
                return [
                    { text: 'Never - very uncomfortable', value: 1 },
                    { text: 'Rarely - only with close people', value: 2 },
                    { text: 'Sometimes - depends on situation', value: 3 },
                    { text: 'Often - with most people', value: 4 },
                    { text: 'Always - very comfortable', value: 5 }
                ];
            } else if (questionText.includes('make a mistake')) {
                return [
                    { text: 'Hide it and hope no one notices', value: 1 },
                    { text: 'Admit it only if caught', value: 2 },
                    { text: 'Admit it when asked', value: 3 },
                    { text: 'Admit it proactively', value: 4 },
                    { text: 'Admit it immediately and openly', value: 5 }
                ];
            } else if (questionText.includes('ask for help')) {
                return [
                    { text: 'Never - try to figure it out alone', value: 1 },
                    { text: 'Rarely - only when desperate', value: 2 },
                    { text: 'Sometimes - when really stuck', value: 3 },
                    { text: 'Often - when I need support', value: 4 },
                    { text: 'Always - comfortable asking', value: 5 }
                ];
            } else if (questionText.includes('show my weaknesses')) {
                return [
                    { text: 'Never - hide weaknesses', value: 1 },
                    { text: 'Rarely - only with trusted people', value: 2 },
                    { text: 'Sometimes - when appropriate', value: 3 },
                    { text: 'Often - share openly', value: 4 },
                    { text: 'Always - very open about weaknesses', value: 5 }
                ];
            } else if (questionText.includes('authentic rather than performing')) {
                return [
                    { text: 'Always performing for others', value: 1 },
                    { text: 'Mostly performing, sometimes authentic', value: 2 },
                    { text: 'Balance of both', value: 3 },
                    { text: 'Mostly authentic, sometimes performing', value: 4 },
                    { text: 'Always authentic, never performing', value: 5 }
                ];
            } else if (questionText.includes('trust others')) {
                return [
                    { text: 'Never - don\'t trust easily', value: 1 },
                    { text: 'Rarely - trust very few people', value: 2 },
                    { text: 'Sometimes - trust some people', value: 3 },
                    { text: 'Often - trust most people', value: 4 },
                    { text: 'Always - trust easily', value: 5 }
                ];
            } else if (questionText.includes('feel safe to speak up')) {
                return [
                    { text: 'Never - feel unsafe', value: 1 },
                    { text: 'Rarely - only in safe situations', value: 2 },
                    { text: 'Sometimes - depends on context', value: 3 },
                    { text: 'Often - feel mostly safe', value: 4 },
                    { text: 'Always - feel very safe', value: 5 }
                ];
            } else if (questionText.includes('fear judgment')) {
                return [
                    { text: 'Always - constant fear', value: 1 },
                    { text: 'Often - frequent fear', value: 2 },
                    { text: 'Sometimes - occasional fear', value: 3 },
                    { text: 'Rarely - minimal fear', value: 4 },
                    { text: 'Never - no fear of judgment', value: 5 }
                ];
            } else if (questionText.includes('be myself without pretending')) {
                return [
                    { text: 'Always pretending', value: 1 },
                    { text: 'Often pretending', value: 2 },
                    { text: 'Sometimes pretending', value: 3 },
                    { text: 'Rarely pretending', value: 4 },
                    { text: 'Never pretending - always myself', value: 5 }
                ];
            } else if (questionText.includes('take risks in relationships')) {
                return [
                    { text: 'Never - avoid risks', value: 1 },
                    { text: 'Rarely - only safe risks', value: 2 },
                    { text: 'Sometimes - calculated risks', value: 3 },
                    { text: 'Often - comfortable with risks', value: 4 },
                    { text: 'Always - very comfortable with risks', value: 5 }
                ];
            } else if (questionText.includes('share my concerns and fears')) {
                return [
                    { text: 'Never - keep them private', value: 1 },
                    { text: 'Rarely - only with close people', value: 2 },
                    { text: 'Sometimes - when appropriate', value: 3 },
                    { text: 'Often - share openly', value: 4 },
                    { text: 'Always - very open about concerns', value: 5 }
                ];
            } else if (questionText.includes('open about my struggles')) {
                return [
                    { text: 'Never - hide struggles', value: 1 },
                    { text: 'Rarely - only with trusted people', value: 2 },
                    { text: 'Sometimes - when asked', value: 3 },
                    { text: 'Often - share struggles', value: 4 },
                    { text: 'Always - very open about struggles', value: 5 }
                ];
            } else if (questionText.includes('trust-building behaviors')) {
                return [
                    { text: 'Never - don\'t engage in them', value: 1 },
                    { text: 'Rarely - only when necessary', value: 2 },
                    { text: 'Sometimes - when appropriate', value: 3 },
                    { text: 'Often - actively engage', value: 4 },
                    { text: 'Always - consistently engage', value: 5 }
                ];
            } else if (questionText.includes('follow through on commitments')) {
                return [
                    { text: 'Rarely - often don\'t follow through', value: 1 },
                    { text: 'Sometimes - follow through inconsistently', value: 2 },
                    { text: 'Often - follow through most of the time', value: 3 },
                    { text: 'Usually - follow through consistently', value: 4 },
                    { text: 'Always - always follow through', value: 5 }
                ];
            } else if (questionText.includes('actions align with my words')) {
                return [
                    { text: 'Rarely - often misaligned', value: 1 },
                    { text: 'Sometimes - sometimes aligned', value: 2 },
                    { text: 'Often - mostly aligned', value: 3 },
                    { text: 'Usually - consistently aligned', value: 4 },
                    { text: 'Always - perfectly aligned', value: 5 }
                ];
            } else if (questionText.includes('communicate transparently')) {
                return [
                    { text: 'Never - avoid transparency', value: 1 },
                    { text: 'Rarely - only when necessary', value: 2 },
                    { text: 'Sometimes - when appropriate', value: 3 },
                    { text: 'Often - communicate transparently', value: 4 },
                    { text: 'Always - very transparent', value: 5 }
                ];
            } else if (questionText.includes('give trust first')) {
                return [
                    { text: 'Never - wait for others to earn it', value: 1 },
                    { text: 'Rarely - only with certain people', value: 2 },
                    { text: 'Sometimes - depends on situation', value: 3 },
                    { text: 'Often - give trust first', value: 4 },
                    { text: 'Always - give trust first always', value: 5 }
                ];
            } else if (questionText.includes('trust is broken')) {
                return [
                    { text: 'Never - don\'t try to repair', value: 1 },
                    { text: 'Rarely - only if important', value: 2 },
                    { text: 'Sometimes - try to repair', value: 3 },
                    { text: 'Often - actively work to repair', value: 4 },
                    { text: 'Always - always work to repair', value: 5 }
                ];
            } else {
                return [
                    { text: 'Not at all', value: 1 },
                    { text: 'Somewhat', value: 2 },
                    { text: 'Moderately', value: 3 },
                    { text: 'Well', value: 4 },
                    { text: 'Perfectly', value: 5 }
                ];
            }
        }

        function setupDragHandlers() {
            const scaleContainer = document.getElementById('scaleContainer');
            if (!scaleContainer) return;
            
            function handleInteraction(e) {
                const rect = scaleContainer.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const relativeX = Math.max(0, Math.min(1, x / rect.width));
                const value = Math.ceil(relativeX * 5) || 1;
                selectOption(e, value);
                updateSliderVisual(value);
            }

            scaleContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                handleInteraction(e);
            });

            scaleContainer.addEventListener('mousemove', (e) => {
                if (isDragging) handleInteraction(e);
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            scaleContainer.addEventListener('touchstart', (e) => {
                isDragging = true;
                handleInteraction(e);
            }, { passive: false });

            scaleContainer.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleInteraction(e);
                }
            }, { passive: false });

            scaleContainer.addEventListener('touchend', () => {
                isDragging = false;
            });
        }

        function updateSliderVisual(value) {
            const options = document.querySelectorAll('.scale-option');
            options.forEach((opt, idx) => {
                if (idx < value) {
                    opt.classList.add('active');
                } else {
                    opt.classList.remove('active');
                }
            });
        }

        function selectOption(e, value) {
            e.stopPropagation();
            answers[currentQuestionIndex] = value;
            
            document.querySelectorAll('.scale-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            const selectedOpt = document.querySelector(`[data-value="${value}"]`);
            if (selectedOpt) {
                selectedOpt.classList.add('selected');
            }
            
            updateSliderVisual(value);
            document.getElementById('nextBtn').disabled = false;
            showInsight(insights[currentQuestionIndex]);
            
            saveProgress();
        }

        function showInsight(insight) {
            const container = document.getElementById('insightContainer');
            container.innerHTML = `
                <div class="insight-card">
                    <div class="insight-icon">${insight.icon}</div>
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-content">${insight.content}</div>
                    <div class="insight-quote">${insight.quote}</div>
                </div>
            `;
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = false;
                document.getElementById('nextBtn').disabled = !answers[currentQuestionIndex];
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateProgress() {
            const answered = Object.keys(answers).length;
            const progress = (answered / questions.length) * 100;
            if (document.getElementById('progressBar')) {
                document.getElementById('progressBar').style.width = progress + '%';
            }
            
            // Milestone celebrations
            checkMilestones(progress);
            
            if (currentQuestionIndex === questions.length - 1) {
                if (document.getElementById('nextBtn')) {
                    document.getElementById('nextBtn').textContent = 'See Results üéØ';
                }
            }
        }
        
        // Milestone system
        function checkMilestones(progress) {
            if (!window.milestonesShown) {
                window.milestonesShown = [];
            }
            
            const milestones = [25, 50, 75, 100];
            const currentMilestone = Math.floor(progress / 25) * 25;
            
            if (milestones.includes(currentMilestone) && 
                !window.milestonesShown.includes(currentMilestone) &&
                progress >= currentMilestone) {
                
                window.milestonesShown.push(currentMilestone);
                showMilestoneCelebration(currentMilestone);
            }
        }
        
        function showMilestoneCelebration(percent) {
            const messages = {
                25: {
                    emoji: 'üéØ',
                    title: '25% Complete!',
                    message: 'You\'re building momentum! Great start!',
                    color: 'linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)'
                },
                50: {
                    emoji: 'üî•',
                    title: 'Halfway There!',
                    message: 'You\'re crushing it! Keep going!',
                    color: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'
                },
                75: {
                    emoji: 'üí™',
                    title: '75% Complete!',
                    message: 'Almost done! Finish strong!',
                    color: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)'
                },
                100: {
                    emoji: 'üéâ',
                    title: 'Assessment Complete!',
                    message: 'Amazing work! Time to see your results!',
                    color: 'linear-gradient(135deg, #10b981 0%, #059669 100%)'
                }
            };
            
            const milestone = messages[percent];
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'milestone-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.7); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div class="milestone-content" style="
                    background: ${milestone.color}; color: white;
                    padding: 50px; border-radius: 20px; text-align: center;
                    max-width: 500px; animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">${milestone.emoji}</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800;">${milestone.title}</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.95;">${milestone.message}</p>
                    <button onclick="this.closest('.milestone-modal').remove()" style="
                        background: white; color: #333; padding: 15px 30px;
                        border: none; border-radius: 10px; font-size: 1.1rem;
                        font-weight: 700; cursor: pointer; transition: all 0.2s;
                    ">
                        Continue ‚Üí
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Trigger confetti
            triggerConfetti();
            
            // Auto-close after 3 seconds if not dismissed
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.style.opacity = '0';
                    setTimeout(() => modal.remove(), 300);
                }
            }, 3000);
        }
        
        function triggerConfetti() {
            const emojis = ['üéâ', '‚≠ê', '‚ú®', 'üéä', 'üí´', 'üåü'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.cssText = `
                    position: fixed; font-size: 2rem; z-index: 9999;
                    left: ${Math.random() * 100}vw; top: -50px;
                    pointer-events: none;
                    animation: confettiFall ${2 + Math.random() * 2}s ease-out forwards;
                `;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 4000);
            }
        }
        
        function showAchievementBadge(badgeId, title, description, xpValue) {
            const badge = document.createElement('div');
            badge.className = 'achievement-modal';
            badge.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const badgeEmojis = {
                'first-stripe': 'üë£',
                'perfect-score': 'üéØ',
                'speed-demon': '‚ö°',
                'streak-3': 'üî•',
                'streak-7': 'üî•',
                'streak-30': 'üî•',
                'dedicated': 'üí™',
                'scholar': 'üìö',
                'master': 'üëë'
            };
            
            const emoji = badgeEmojis[badgeId] || 'üèÜ';
            
            badge.innerHTML = `
                <div class="achievement-content" style="
                    background: white; padding: 50px; border-radius: 20px;
                    text-align: center; max-width: 500px;
                    animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 6rem; margin-bottom: 1rem;">${emoji}</div>
                    <div style="
                        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                        color: white; display: inline-block; padding: 8px 20px;
                        border-radius: 20px; font-size: 0.9rem; font-weight: 700;
                        margin-bottom: 1rem; text-transform: uppercase;
                        letter-spacing: 1px;
                    ">Achievement Unlocked!</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800; color: #333;">${title}</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: #666; line-height: 1.6;">${description}</p>
                    <div style="
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white; display: inline-block; padding: 12px 24px;
                        border-radius: 12px; font-size: 1.2rem; font-weight: 700;
                        margin-bottom: 1.5rem;
                    ">+${xpValue} XP</div>
                    <div>
                        <button onclick="this.closest('.achievement-modal').remove()" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white; padding: 15px 30px; border: none;
                            border-radius: 10px; font-size: 1.1rem; font-weight: 700;
                            cursor: pointer; transition: all 0.2s;
                        ">
                            Awesome! ‚ú®
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(badge);
            triggerConfetti();
        }
        
        function checkAchievements() {
            // Perfect Score
            let perfectScore = true;
            for (let i = 0; i < questions.length; i++) {
                if (answers[i] < 4) {
                    perfectScore = false;
                    break;
                }
            }
            if (perfectScore) {
                showAchievementBadge('perfect-score', 'üéØ Perfect Score', 'You answered all questions at mastery level!', 50);
            }
            
            // Speed Demon
            const startTime = parseInt(localStorage.getItem('assessmentStartTime') || '0');
            const completionTime = (Date.now() - startTime) / 1000 / 60; // minutes
            if (completionTime < 5 && startTime > 0) {
                showAchievementBadge('speed-demon', '‚ö° Speed Demon', 'Completed in under 5 minutes!', 25);
            }
            
            // First Stripe
            const completedStripes = Object.keys(localStorage).filter(k => k.includes('Complete')).length;
            if (completedStripes === 1) {
                showAchievementBadge('first-stripe', 'üë£ First Steps', 'You completed your first stripe!', 25);
            }
        }

        function showResults() {
            // Check achievements before showing results
            checkAchievements();
            
            let vulnerabilityScore = 0;
            let safetyScore = 0;
            let buildingScore = 0;
            
            // Vulnerability & Trust (questions 0-5)
            for (let i = 0; i < 6; i++) {
                if (answers[i]) vulnerabilityScore += answers[i];
            }
            
            // Psychological Safety (questions 6-11)
            for (let i = 6; i < 12; i++) {
                if (answers[i]) safetyScore += answers[i];
            }
            
            // Building Trust (questions 12-17)
            for (let i = 12; i < 18; i++) {
                if (answers[i]) buildingScore += answers[i];
            }
            
            const avgVulnerability = vulnerabilityScore / 6;
            const avgSafety = safetyScore / 6;
            const avgBuilding = buildingScore / 6;
            const overallScore = (avgVulnerability + avgSafety + avgBuilding) / 3;
            
            let trustType = '';
            let typeEmoji = '';
            let typeLabel = '';
            let typeColor = '';
            let strengths = [];
            let challenges = [];
            let strategies = [];
            
            if (overallScore <= 2.0) {
                trustType = 'Developing';
                typeEmoji = 'üå±';
                typeLabel = 'üå± Developing Trust Capacity';
                typeColor = '#f4a261';
                strengths = [
                    'Awareness is the first step to growth',
                    'You\'re honest about where you are',
                    'Every master was once a beginner',
                    'You have room to build strong foundations',
                    'Growth mindset is already present'
                ];
                challenges = [
                    'Vulnerability comfort needs development',
                    'Safety creation requires practice',
                    'Trust-building behaviors need cultivation',
                    'Openness needs to be built',
                    'Risk-taking in relationships needs growth'
                ];
                strategies = [
                    'Start by admitting one mistake this week',
                    'Ask for help from someone you trust',
                    'Share one concern or fear with a safe person',
                    'Practice following through on small commitments',
                    'Give trust first in one relationship'
                ];
            } else if (overallScore <= 3.5) {
                trustType = 'Building';
                typeEmoji = 'üèóÔ∏è';
                typeLabel = 'üèóÔ∏è Building Trust Capacity';
                typeColor = '#457b9d';
                strengths = [
                    'You have some comfort with vulnerability',
                    'You recognize areas that need work',
                    'You\'re building foundational skills',
                    'You have some effective strategies',
                    'You\'re committed to growth'
                ];
                challenges = [
                    'Consistency in practice is key',
                    'Some patterns still need attention',
                    'Safety creation could be stronger',
                    'Trust-building needs refinement',
                    'Openness could be more consistent'
                ];
                strategies = [
                    'Double down on what\'s working',
                    'Practice vulnerability daily with safe people',
                    'Create safety for others by being vulnerable first',
                    'Build trust through consistent follow-through',
                    'Give trust first more often'
                ];
            } else {
                trustType = 'Strong';
                typeEmoji = 'üí™';
                typeLabel = 'üí™ Strong Trust Capacity';
                typeColor = '#2a9d8f';
                strengths = [
                    'High comfort with vulnerability',
                    'Strong ability to create safety',
                    'Effective trust-building behaviors',
                    'Consistent openness and transparency',
                    'Good trust repair skills'
                ];
                challenges = [
                    'Maintain trust during stress',
                    'Continue refining your approach',
                    'Support others in their trust journey',
                    'Stay aware of trust patterns',
                    'Prevent complacency in good times'
                ];
                strategies = [
                    'Share your trust-building strategies with others',
                    'Continue refining as relationships evolve',
                    'Stay aware of changing trust needs',
                    'Support others in building trust',
                    'Use your strength to help build team trust'
                ];
            }

            document.getElementById('assessmentForm').style.display = 'none';
            document.getElementById('resultsContainer').classList.add('active');
            
            document.getElementById('typeEmoji').textContent = typeEmoji;
            document.getElementById('typeLabel').textContent = typeLabel;
            document.getElementById('typeResultCard').style.background = `linear-gradient(135deg, ${typeColor} 0%, ${typeColor}dd 100%)`;
            
            const typeDetailsHTML = `
                <div class="type-card">
                    <h3>üí™ Your Strengths</h3>
                    <ul>
                        ${strengths.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #fff5f0; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">‚ö†Ô∏è Areas for Growth</h3>
                    <ul>
                        ${challenges.map(c => `<li>${c}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #f0f4ff; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">üéØ Recommended Strategies</h3>
                    <ul>
                        ${strategies.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="insight-card" style="margin-top: 30px;">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-title">The Key Insight</div>
                    <div class="insight-content">
                        <strong>Trust isn't built through competence‚Äîit's built through vulnerability.</strong> Just like in BJJ, where you literally can't practice without being vulnerable, you can't build real relationships without opening up. Tapping is trust. Showing your back is vulnerability. Can't learn without admitting you don't know.
                        <br><br>
                        <strong>ü•ã BJJ Wisdom:</strong> "You literally can't practice BJJ without being vulnerable‚Äîyou let someone try to choke you. Tapping is trust. You trust your partner to let go."
                    </div>
                </div>
            `;
            
            document.getElementById('typeDetails').innerHTML = typeDetailsHTML;
            
            clearProgress();
            
            localStorage.setItem('blueBeltStripe1Complete', 'true');
            localStorage.setItem('blueBeltStripe1CompletedDate', new Date().toISOString());
            localStorage.setItem('trustCapacity', trustType);
            
            const currentXP = parseInt(localStorage.getItem('totalXP') || '0');
            const xpReward = 150;
            localStorage.setItem('totalXP', (currentXP + xpReward).toString());
            
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #38a169 0%, #2f855a 100%); color: white; padding: 1rem 1.5rem; border-radius: 10px; box-shadow: 0 4px 20px rgba(56, 161, 105, 0.4); z-index: 1000; font-weight: 600;';
                notification.innerHTML = `‚úÖ Stripe 1 Complete! +${xpReward} XP`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }, 500);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
<!-- TAP-IN Utilities -->
<script src="js/shared-utilities.js"></script>
<script src="js/global-error-handler.js"></script>
<script src="js/storage-health.js"></script>
</body>
</html>


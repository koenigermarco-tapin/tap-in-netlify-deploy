<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#1a365d">
    <title>ü§ç White Belt Stripe 3: What Do You Value? - Values & Life Alignment - TAP-IN</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a365d 0%, #7c3aed 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 25px; border-bottom: 3px solid #f0f0f0; }
        .header h1 { color: #1a365d; font-size: 2.3em; margin-bottom: 15px; }
        .header .subtitle { color: #666; font-size: 1.1em; margin-bottom: 10px; }
        .header .duration { color: #999; font-size: 0.9em; font-style: italic; }
        
        .progress-bar { position: sticky; top: 10px; background: white; padding: 15px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; }
        .progress-text { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 8px; }
        .progress-fill { height: 8px; background: #e0e0e0; border-radius: 10px; overflow: hidden; }
        .progress-fill-bar { background: linear-gradient(90deg, #1a365d 0%, #7c3aed 100%); height: 100%; width: 0%; transition: width 0.3s ease; }
        
        .section-header { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; }
        .section-header h3 { font-size: 1.2em; margin-bottom: 5px; }
        .section-header .section-desc { font-size: 0.9em; opacity: 0.95; font-style: italic; }
        
        .question-card { background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 20px; }
        .question-number { color: #1a365d; font-weight: bold; font-size: 0.9em; margin-bottom: 10px; }
        .question-text { font-size: 1.2em; color: #333; margin-bottom: 25px; font-weight: 500; line-height: 1.5; }
        
        .scale-options { display: flex; justify-content: space-between; align-items: flex-end; gap: 2px; flex-wrap: nowrap; height: 140px; position: relative; background: linear-gradient(to top right, rgba(26, 54, 93, 0.1) 0%, rgba(124, 58, 237, 0.05) 50%, transparent 50%); border-radius: 8px; padding: 5px; cursor: pointer; user-select: none; }
        .scale-option { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; background: linear-gradient(135deg, rgba(26, 54, 93, 0.15) 0%, rgba(124, 58, 237, 0.1) 100%); border: 3px solid #cbd5e1; border-radius: 6px; transition: all 0.15s ease; position: relative; z-index: 1; padding: 10px 5px; }
        .scale-option:nth-child(1) { height: 50px; opacity: 0.15; }
        .scale-option:nth-child(2) { height: 70px; opacity: 0.35; }
        .scale-option:nth-child(3) { height: 90px; opacity: 0.55; }
        .scale-option:nth-child(4) { height: 110px; opacity: 0.75; }
        .scale-option:nth-child(5) { height: 130px; opacity: 0.85; }
        .scale-option span { font-size: 1.3em; font-weight: 800; color: #1e293b; opacity: 1; margin-bottom: 5px; }
        .scale-option small { font-size: 0.7em; color: #475569; font-weight: 600; opacity: 1; text-align: center; line-height: 1.2; }
        .scale-option:hover { transform: scale(1.05); border-color: #1a365d; }
        .scale-option.active, .scale-option.selected { background: linear-gradient(135deg, #1a365d 0%, #7c3aed 100%); color: white; border-color: #0f1f3d; box-shadow: 0 2px 8px rgba(26, 54, 93, 0.4); }
        .scale-option.active ~ .scale-option { background: linear-gradient(135deg, rgba(26, 54, 93, 0.15) 0%, rgba(124, 58, 237, 0.1) 100%); color: #333; }
        .scale-option.active span, .scale-option.selected span { color: white; }
        .scale-option.active small, .scale-option.selected small { color: rgba(255,255,255,0.9); }
        
        .insight-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-left: 4px solid #1a365d; padding: 20px; margin: 20px 0; border-radius: 10px; animation: slideIn 0.4s ease; }
        .insight-icon { font-size: 2rem; margin-bottom: 10px; }
        .insight-title { color: #1a365d; font-size: 1.1em; font-weight: bold; margin-bottom: 12px; }
        .insight-content { color: #555; line-height: 1.7; margin-bottom: 12px; }
        .insight-quote { font-style: italic; color: #666; font-size: 0.95em; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 3px solid #1a365d; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Scenario Question Styles */
        .scenario-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .scenario-option {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .scenario-option:hover {
            border-color: #667eea;
            background: #f0f0ff;
            transform: translateX(5px);
        }
        .scenario-option.selected {
            border-color: #667eea;
            background: #e8e8ff;
        }
        .scenario-option.correct {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        .scenario-option.correct .option-letter {
            background: #10b981;
        }
        .scenario-option.incorrect {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        }
        .scenario-option.incorrect .option-letter {
            background: #ef4444;
        }
        .scenario-option.neutral {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        .scenario-option.neutral .option-letter {
            background: #f59e0b;
        }
        .option-letter {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .option-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            padding-top: 8px;
        }
        .scenario-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .scenario-insight {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid #3b82f6;
        }
        
        /* Multiple Choice Styles */
        .mc-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .mc-option {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        .mc-option:hover {
            border-color: #667eea;
            background: #fafbff;
            transform: translateX(3px);
        }
        .mc-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        .mc-radio {
            padding-top: 2px;
        }
        .mc-radio input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            cursor: pointer;
        }
        .mc-content {
            flex: 1;
        }
        .mc-text {
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
            margin-bottom: 6px;
        }
        .mc-type {
            color: #667eea;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .mc-feedback {
            margin-top: 20px;
            animation: fadeIn 0.3s ease;
        }
        .mc-insight {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid #10b981;
        }
        .mc-type-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg) translateX(200px);
                opacity: 0;
            }
        }
        .milestone-content button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .fun-fact-box {
            animation: slideIn 0.4s ease;
        }
        
        @media (max-width: 768px) {
            .scenario-option {
                padding: 12px 15px;
                gap: 12px;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            .option-text {
                font-size: 0.9rem;
            }
            .mc-option {
                padding: 15px;
            }
            .mc-text {
                font-size: 0.9rem;
            }
        }
        
        .nav-buttons { display: flex; gap: 15px; justify-content: space-between; margin-top: 25px; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.2s; font-weight: 600; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-primary { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(26, 54, 93, 0.4); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .results-container { display: none; }
        .results-container.active { display: block; }
        .overall-score { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border-radius: 20px; padding: 40px; text-align: center; margin-bottom: 30px; }
        .score-number { font-size: 4em; font-weight: bold; margin-bottom: 10px; }
        .score-label { font-size: 1.3em; opacity: 0.95; }
        .type-card { background: #f8f9fa; padding: 30px; border-radius: 15px; margin: 20px 0; border-left: 4px solid #1a365d; }
        .type-card h3 { color: #1a365d; margin-bottom: 15px; font-size: 1.5em; }
        .type-card ul { list-style: none; padding-left: 0; }
        .type-card li { padding: 8px 0; padding-left: 25px; position: relative; color: #555; line-height: 1.7; }
        .type-card li:before { content: "‚Üí"; position: absolute; left: 0; color: #1a365d; font-weight: bold; }
        .cta-box { background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border-radius: 15px; padding: 30px; text-align: center; margin-top: 30px; }
        .cta-box h3 { font-size: 1.6em; margin-bottom: 15px; }
        .cta-box p { font-size: 1em; margin-bottom: 20px; opacity: 0.95; }
        .cta-btn { background: white; color: #1a365d; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: bold; display: inline-block; transition: all 0.2s; }
        .cta-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(255,255,255,0.3); }
        
        .tap-out-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
        }
        .tap-out-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.6);
        }
        @media (max-width: 768px) {
            .container { padding: 25px; }
            .header h1 { font-size: 2em; }
            .scale-option small { font-size: 0.65em; }
            .tap-out-button {
                top: 10px;
                right: 10px;
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }
    
        /* ============= NUMBERED OPTION BOX READABILITY FIX ============= */
        .scale-option,
        .rating-option,
        .numbered-option,
        .option-number,
        [data-value="1"],
        [data-value="2"],
        [data-value="3"],
        [data-value="4"],
        [data-value="5"] {
            color: #FFFFFF !important;
            font-weight: 700 !important;
            font-size: 1.1rem !important;
            background: #1e293b !important;
            border: 2px solid #475569 !important;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5) !important;
        }
        .scale-option:hover,
        .rating-option:hover,
        .numbered-option:hover,
        .option-number:hover,
        [data-value]:hover {
            background: #334155 !important;
            border-color: #667eea !important;
            color: #FFFFFF !important;
            transform: scale(1.05) !important;
        }
        .scale-option.selected,
        .rating-option.selected,
        .numbered-option.selected,
        .option-number.selected,
        [data-value].selected {
            background: #667eea !important;
            border-color: #818cf8 !important;
            color: #FFFFFF !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
        }
        .scale-label,
        .rating-label,
        .option-label {
            color: #FFFFFF !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
            text-align: center !important;
            margin-top: 0.5rem !important;
        }
        .scale-container,
        .rating-container,
        .options-row {
            display: flex !important;
            justify-content: space-between !important;
            gap: 0.75rem !important;
            margin: 1.5rem 0 !important;
        }
        .scale-container > *,
        .rating-container > *,
        .options-row > * {
            flex: 1 !important;
            min-width: 60px !important;
            text-align: center !important;
            padding: 1rem 0.5rem !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        @media (max-width: 768px) {
            .scale-option,
            .rating-option,
            .numbered-option,
            .option-number,
            [data-value] {
                font-size: 1rem !important;
                padding: 0.75rem 0.25rem !important;
                min-width: 50px !important;
            }
            .scale-label,
            .rating-label,
            .option-label {
                font-size: 0.75rem !important;
            }
        }
        input[type="range"] {
            -webkit-appearance: none !important;
            width: 100% !important;
            height: 8px !important;
            background: #334155 !important;
            border-radius: 5px !important;
            outline: none !important;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none !important;
            width: 24px !important;
            height: 24px !important;
            background: #667eea !important;
            cursor: pointer !important;
            border-radius: 50% !important;
            border: 3px solid #FFFFFF !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px !important;
            height: 24px !important;
            background: #667eea !important;
            cursor: pointer !important;
            border-radius: 50% !important;
            border: 3px solid #FFFFFF !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
        .slider-value,
        .range-value {
            display: block !important;
            text-align: center !important;
            font-size: 1.5rem !important;
            font-weight: 700 !important;
            color: #667eea !important;
            margin-top: 1rem !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2) !important;
        }
        .slider-labels {
            display: flex !important;
            justify-content: space-between !important;
            margin-top: 0.5rem !important;
        }
        .slider-labels span {
            font-size: 0.85rem !important;
            color: #cbd5e1 !important;
            font-weight: 600 !important;
        }

    </style>
</head>
<body>
    <!-- TAP OUT Button -->
    <button class="tap-out-button" onclick="tapOut()" id="tapOutBtn" style="display: none;">
        <div class="tap-icon">ü•ã</div>
        <div class="tap-text">TAP</div>
    </button>
    
    <!-- Language Switcher -->
    <div style="position:fixed;top:16px;right:16px;z-index:1200;">
        <div style="background:white;border-radius:999px;padding:8px 12px;box-shadow:0 6px 20px rgba(0,0,0,0.15);font-size:0.95em;">
            <a href="white-belt-stripe3-carousel-NEW.html" style="color:#1a365d;text-decoration:none;font-weight:700;margin-right:10px;">EN</a>
            <a href="white-belt-stripe3-carousel-NEW-de.html" style="color:#333;text-decoration:none;font-weight:700;border-left:1px solid #eee;padding-left:10px;margin-left:10px;">DE</a>
        </div>
    </div>

    <div class="container">
        <!-- Assessment Form -->
        <div id="assessmentForm">
            <div class="header">
                <h1>ü§ç White Belt - Stripe 3: What Do You Value?</h1>
                <p class="subtitle">Discover Your Core Values & Life Alignment</p>
                <p class="duration">‚è±Ô∏è 5-7 Minutes ‚Ä¢ 15 Questions</p>
            </div>

            <!-- Intro Section -->
            <div id="introSection" style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #1a365d;">
                <h3 style="color: #333; margin-bottom: 15px;">üíé Values - The Compass for Your Decisions</h3>
                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>You can't set boundaries if you don't know what matters most.</strong> This assessment reveals your core values, how aligned your life is with those values, and how you make trade-offs when values conflict. Understanding your values is the foundation for making decisions that feel right, not just look right.
                </p>
                
                <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #1a365d;">
                    <p style="font-style: italic; color: #555; margin-bottom: 10px;">
                        "Position before submission. Priorities before goals. You can't be good at everything‚Äîyou must choose your values."
                    </p>
                    <p style="text-align: right; color: #888; font-size: 0.9em;">‚Äî BJJ Wisdom</p>
                </div>

                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">
                    <strong>Research from Harvard Business Review</strong> shows that people who live in alignment with their values have 50% higher life satisfaction and 40% better decision-making. This assessment helps you:
                </p>
                <ul style="color: #666; line-height: 1.8; margin-left: 20px; margin-bottom: 15px;">
                    <li>Identify your top 3-5 core values</li>
                    <li>See where your life aligns (or doesn't) with your values</li>
                    <li>Understand how you make trade-offs when values conflict</li>
                    <li>Make decisions that feel authentic, not just strategic</li>
                </ul>

                <p style="color: #666; line-height: 1.7; margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px; font-size: 0.95em;">
                    <strong>ü•ã In BJJ:</strong> Just like fighters must choose their position before attempting a submission, leaders must choose their priorities before setting goals. You can't be good at everything‚Äîyou must choose your values. This assessment helps you identify what truly matters to you.
                </p>
                
                <button onclick="startAssessment()" style="background: linear-gradient(135deg, #1a365d 0%, #0f1f3d 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(26, 54, 93, 0.3); display: block; margin: 20px auto 0; width: auto;">
                    Start Assessment ‚Üí
                </button>
            </div>

            <div class="progress-bar" style="display: none;" id="progressBarContainer">
                <div class="progress-text"><span id="currentSection">Core Values</span> ‚Ä¢ Question <span id="currentQ">1</span> of 15</div>
                <div class="progress-fill">
                    <div class="progress-fill-bar" id="progressBar"></div>
                </div>
            </div>

            <div id="questionContainer" style="display: none;"></div>

            <div class="nav-buttons" style="display: none;" id="navButtons">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" disabled>‚Üê Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next ‚Üí</button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="results-container">
            <div class="header">
                <h1>ü§ç Your Values & Alignment Profile</h1>
            </div>

            <div class="overall-score" id="typeResultCard">
                <div class="score-number" id="typeEmoji">üíé</div>
                <div class="score-label" id="typeLabel">Calculating...</div>
            </div>

            <div id="typeDetails"></div>

            <div class="cta-box">
                <h3>ü§ç White Belt Stripe 3 Complete!</h3>
                <p>You now understand your core values and life alignment. Ready to continue your journey?</p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                    <a href="white-belt-stripe4-carousel-NEW.html" class="cta-btn" style="margin: 0;">Continue to Stripe 4 ‚Üí</a>
                    <a href="gym-dashboard.html" class="cta-btn" style="background: rgba(255,255,255,0.2); border: 2px solid white; margin: 0;">Back to The Gym</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            // CORE VALUES (5 questions)
            {
                section: 'Core Values',
                sectionDesc: 'What truly matters to you at your core',
                question: 'When making a major life decision, the most important factor is...',
                category: 'values'
            },
            {
                question: 'You feel most fulfilled when you\'re...',
                category: 'values'
            },
            {
                question: 'If you had to choose one thing to protect above all else, it would be...',
                category: 'values'
            },
            {
                question: 'Your ideal day is one where you...',
                category: 'values'
            },
            {
                question: 'When you look back on your life, you want to be remembered for...',
                category: 'values'
            },
            // LIFE ALIGNMENT (5 questions)
            {
                section: 'Life Alignment',
                sectionDesc: 'How well your life matches your values',
                question: 'Your current work/career aligns with your values...',
                category: 'alignment'
            },
            {
                question: 'Your relationships reflect your core values...',
                category: 'alignment'
            },
            {
                question: 'How you spend your time matches what you say matters most...',
                category: 'alignment'
            },
            {
                question: 'Your financial decisions align with your values...',
                category: 'alignment'
            },
            {
                question: 'Your daily habits support your core values...',
                category: 'alignment'
            },
            // PRIORITIES & TRADE-OFFS (5 questions)
            {
                section: 'Priorities & Trade-offs',
                sectionDesc: 'How you choose when values conflict',
                question: 'When work and family conflict, you typically...',
                category: 'tradeoffs'
            },
            {
                question: 'When money and meaning conflict, you choose...',
                category: 'tradeoffs'
            },
            {
                question: 'When security and growth conflict, you prioritize...',
                category: 'tradeoffs'
            },
            {
                question: 'When comfort and challenge conflict, you lean toward...',
                category: 'tradeoffs'
            },
            {
                question: 'When saying yes to one thing means saying no to another, you...',
                category: 'tradeoffs'
            }
        ];

        const insights = [
            // CORE VALUES INSIGHTS (5)
            { icon: 'üíé', title: 'Decision-Making Compass', content: 'Your values are your decision-making compass. <strong>Research shows</strong> that people who make decisions aligned with their values have 50% higher life satisfaction. In BJJ, you must know your position before attempting a submission‚Äîsame with values and decisions.', quote: '"Position before submission. Priorities before goals." - BJJ Wisdom' },
            { icon: 'üåü', title: 'Fulfillment Source', content: 'What fulfills you reveals your core values. <strong>Studies show</strong> that people who understand their fulfillment sources have 40% better work-life balance. In BJJ, you can\'t be good at everything‚Äîyou must choose your focus. Same with values.', quote: '"You can\'t be good at everything‚Äîyou must choose your values." - BJJ Philosophy' },
            { icon: 'üõ°Ô∏è', title: 'What You Protect', content: 'What you protect above all else reveals your deepest values. <strong>Research shows</strong> that people who know what they protect make better boundaries. In BJJ, you protect your position‚Äîsame with your values.', quote: '"Know what you\'re protecting. That\'s your foundation." - BJJ Strategy' },
            { icon: 'üìÖ', title: 'Ideal Day Vision', content: 'Your ideal day reveals your values in action. <strong>Research shows</strong> that people who design their days around their values have 60% higher daily satisfaction. In BJJ, you train for the match‚Äîsame with designing your life.', quote: '"Design your days around your values, not your goals." - Life Design' },
            { icon: 'üèÜ', title: 'Legacy Aspiration', content: 'How you want to be remembered reveals your values. <strong>Studies show</strong> that people who clarify their legacy make better long-term decisions. In BJJ, you train for mastery‚Äîsame with building your legacy.', quote: '"The best fighters train for mastery, not just wins. Same with life." - BJJ Wisdom' },
            
            // LIFE ALIGNMENT INSIGHTS (5)
            { icon: '‚öñÔ∏è', title: 'Work-Values Alignment', content: 'Your work alignment reveals whether you\'re living your values. <strong>Research shows</strong> that people whose work aligns with their values have 50% higher job satisfaction. In BJJ, you must align your technique with your position‚Äîsame with work and values.', quote: '"Alignment isn\'t optional‚Äîit\'s essential for performance." - BJJ Philosophy' },
            { icon: 'üë•', title: 'Relationship Alignment', content: 'Your relationships reflect your values. <strong>Studies show</strong> that people whose relationships align with their values have 40% better relationship satisfaction. In BJJ, you train with people who share your values‚Äîsame in life.', quote: '"Your training partners reflect your values. Choose wisely." - BJJ Wisdom' },
            { icon: '‚è∞', title: 'Time-Values Alignment', content: 'How you spend your time reveals your true values. <strong>Research shows</strong> that people whose time matches their values have 60% higher life satisfaction. In BJJ, you invest time in what matters‚Äîsame with values.', quote: '"Your calendar is your values in action. Does it match?" - Time Management' },
            { icon: 'üí∞', title: 'Financial Alignment', content: 'Your financial decisions reveal your values. <strong>Research shows</strong> that people whose spending aligns with their values have 50% better financial satisfaction. In BJJ, you invest in what matters‚Äîsame with money and values.', quote: '"Where your money goes, your values show." - Financial Wisdom' },
            { icon: 'üîÑ', title: 'Habit-Values Alignment', content: 'Your daily habits reveal whether you\'re living your values. <strong>Studies show</strong> that people whose habits support their values have 40% better consistency. In BJJ, daily practice builds mastery‚Äîsame with values and habits.', quote: '"Your habits are your values in practice. Make them match." - Habit Design' },
            
            // PRIORITIES & TRADE-OFFS INSIGHTS (5)
            { icon: '‚öñÔ∏è', title: 'Work-Family Trade-offs', content: 'How you handle work-family conflicts reveals your priorities. <strong>Research shows</strong> that people who clarify their priorities make better trade-offs. In BJJ, you can\'t defend everything‚Äîyou must choose your position. Same with priorities.', quote: '"You can\'t defend everything. Choose your position, then commit." - BJJ Strategy' },
            { icon: 'üíµ', title: 'Money-Meaning Trade-offs', content: 'How you choose between money and meaning reveals your values. <strong>Studies show</strong> that people who clarify this trade-off have 50% better decision-making. In BJJ, you can\'t chase every opportunity‚Äîyou must choose your focus.', quote: '"You can\'t chase everything. Choose your values, then commit." - BJJ Philosophy' },
            { icon: 'üîí', title: 'Security-Growth Trade-offs', content: 'How you balance security and growth reveals your risk tolerance. <strong>Research shows</strong> that people who understand this trade-off make better long-term decisions. In BJJ, you balance defense and offense‚Äîsame with security and growth.', quote: '"Balance defense and offense. Security and growth. Both matter." - BJJ Strategy' },
            { icon: 'üõãÔ∏è', title: 'Comfort-Challenge Trade-offs', content: 'How you choose between comfort and challenge reveals your growth mindset. <strong>Studies show</strong> that people who embrace challenge have 40% better growth. In BJJ, you must leave your comfort zone to grow‚Äîsame in life.', quote: '"Growth happens outside your comfort zone. Embrace the challenge." - BJJ Wisdom' },
            { icon: '‚úã', title: 'Saying No Strategy', content: 'How you say no reveals your priorities. <strong>Research shows</strong> that people who can say no have 60% better focus. In BJJ, you can\'t accept every position‚Äîyou must choose. Same with opportunities.', quote: '"Saying no to good things lets you say yes to great things." - Priority Management' }
        ];

        const sectionIntros = {
            'Core Values': `
                <strong>Why core values matter:</strong> Research from Harvard Business Review shows that <strong>people who live in alignment with their values have 50% higher life satisfaction</strong>. Your values are your decision-making compass. Without them, you're navigating blind.
                <br><br>
                <strong>The key insight:</strong> You can't set boundaries if you don't know what matters most. You can't make authentic decisions if you don't know your values. Values aren't what you say‚Äîthey're what you do.
                <br><br>
                <strong>ü•ã In BJJ:</strong> Just like fighters must know their position before attempting a submission, leaders must know their values before making decisions. Position before submission. Priorities before goals.
            `,
            'Life Alignment': `
                <strong>Why life alignment matters:</strong> Research shows that <strong>people whose lives align with their values have 60% higher satisfaction</strong>. Alignment isn't about perfection‚Äîit's about direction. Are you moving toward your values or away from them?
                <br><br>
                <strong>The key insight:</strong> Your calendar is your values in action. Your spending is your values in action. Your relationships are your values in action. If they don't match, you're out of alignment.
                <br><br>
                <strong>ü•ã In BJJ:</strong> Just like fighters must align their technique with their position, leaders must align their actions with their values. Alignment isn't optional‚Äîit's essential for performance.
            `,
            'Priorities & Trade-offs': `
                <strong>Why priorities and trade-offs matter:</strong> Research shows that <strong>people who clarify their priorities make 50% better decisions</strong>. You can't have everything‚Äîyou must choose. Every yes is a no to something else.
                <br><br>
                <strong>The key insight:</strong> You can't be good at everything‚Äîyou must choose your values. You can't defend everything‚Äîyou must choose your position. Trade-offs aren't failures‚Äîthey're choices.
                <br><br>
                <strong>ü•ã In BJJ:</strong> Just like fighters can't defend every position, leaders can't pursue every opportunity. You must choose your focus, then commit. Saying no to good things lets you say yes to great things.
            `
        };

        // TAP OUT Configuration
        const currentStripeName = 'whiteBeltStripe3';
        const totalQuestions = 15;
        
        let currentQuestionIndex = 0;
        let answers = {};
        
        // TAP OUT function
        function tapOut() {
            const confirmed = confirm(
                "ü•ã TAP OUT\n\n" +
                "Your progress will be saved.\n" +
                "You can continue from Question " + (currentQuestionIndex + 1) + " anytime.\n\n" +
                "Return to Gym Dashboard?"
            );
            
            if (!confirmed) return;
            
            // Save progress
            const progressData = {
                stripe: currentStripeName,
                currentQuestion: currentQuestionIndex + 1,
                questionIndex: currentQuestionIndex,
                answers: answers,
                timestamp: Date.now(),
                partialComplete: true,
                totalQuestions: totalQuestions
            };
            
            localStorage.setItem('currentProgress', JSON.stringify(progressData));
            
            // Show toast
            showToast("‚úÖ Progress saved! See you soon.");
            
            // Redirect to gym
            setTimeout(() => {
                window.location.href = 'gym-dashboard.html';
            }, 1000);
        }
        
        // Toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 16px 32px;
                border-radius: 50px;
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
                z-index: 10000;
                font-weight: 600;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }
        
        // Check for saved progress on load
        function checkForSavedProgress() {
            const saved = localStorage.getItem('currentProgress');
            if (!saved) return false;
            
            try {
                const progress = JSON.parse(saved);
                
                // Check if this is the right stripe
                if (progress.stripe !== currentStripeName) return false;
                
                // Check if recent (within 7 days)
                const daysSince = (Date.now() - progress.timestamp) / (1000 * 60 * 60 * 24);
                if (daysSince > 7) {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
                
                // Ask to resume
                const resume = confirm(
                    "ü•ã WELCOME BACK!\n\n" +
                    "You were on Question " + progress.currentQuestion + " of " + (progress.totalQuestions || totalQuestions) + ".\n" +
                    "Resume where you left off?"
                );
                
                if (resume) {
                    currentQuestionIndex = progress.questionIndex || (progress.currentQuestion - 1);
                    answers = progress.answers || {};
                    return true;
                } else {
                    localStorage.removeItem('currentProgress');
                    return false;
                }
            } catch (e) {
                console.error('Error loading saved progress:', e);
                return false;
            }
        }
        
        // Save progress after each answer
        function saveProgress() {
            const progressData = {
                stripe: currentStripeName,
                currentQuestion: currentQuestionIndex + 1,
                questionIndex: currentQuestionIndex,
                answers: answers,
                timestamp: Date.now(),
                partialComplete: true,
                totalQuestions: totalQuestions
            };
            localStorage.setItem('currentProgress', JSON.stringify(progressData));
        }
        
        // Clear progress on completion
        function clearProgress() {
            localStorage.removeItem('currentProgress');
        }
        
        function startAssessment() {
            // Track start time for speed achievements
            localStorage.setItem('assessmentStartTime', Date.now().toString());
            
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('progressBarContainer').style.display = 'block';
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('navButtons').style.display = 'flex';
            document.getElementById('tapOutBtn').style.display = 'flex';
            
            // Check for saved progress
            const resumed = checkForSavedProgress();
            if (resumed) {
                renderQuestion(currentQuestionIndex);
                updateProgress();
            } else {
                currentQuestionIndex = 0;
                answers = {};
                renderQuestion(0);
            }
        }

        let isDragging = false;

        function renderQuestion(index) {
            const q = questions[index];
            
            // Handle different question types
            if (q.type === 'scenario') {
                renderScenario(index, q);
            } else if (q.type === 'multiple-choice') {
                renderMultipleChoice(index, q);
            } else {
                // Existing Likert scale rendering
                renderLikertScale(index, q);
            }
            
            updateProgress();
        }
        
        function renderLikertScale(index, q) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (q.section) {
                html += `
                    <div class="section-header">
                        <h3>${q.section}</h3>
                        <div class="section-desc">${q.sectionDesc}</div>
                    </div>
                `;
                document.getElementById('currentSection').textContent = q.section;
                
                if (sectionIntros[q.section]) {
                    html += `
                        <div class="insight-card" style="margin-bottom: 25px;">
                            <div class="insight-icon">üí°</div>
                            <div class="insight-title">Why This Matters</div>
                            <div class="insight-content">${sectionIntros[q.section]}</div>
                        </div>
                    `;
                }
            }
            
            // Create answer options based on question type
            const options = getOptionsForQuestion(q);
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="scale-options" id="scaleContainer">
                        ${options.map((opt, idx) => `
                            <div class="scale-option ${answers[index] === opt.value ? 'selected' : ''}" data-value="${opt.value}" onclick="selectOption(event, ${opt.value})">
                                <span>${idx + 1}</span>
                                <small>${opt.text}</small>
                            </div>
                        `).join('')}
                    </div>
                    <div id="insightContainer"></div>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('currentQ').textContent = index + 1;
            setupDragHandlers();
            
            if (answers[index]) {
                showInsight(insights[index]);
            }
        }
        
        function renderScenario(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Scenario ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="scenario-options">
                        ${question.options.map((opt, idx) => `
                            <div class="scenario-option" data-option="${idx}" onclick="selectScenario(${index}, ${idx})">
                                <div class="option-letter">${String.fromCharCode(65 + idx)}</div>
                                <div class="option-text">${opt.text}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="scenarioFeedback" class="scenario-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectScenario(index, selectedIdx);
                }
            }
        }
        
        function selectScenario(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback on options
            document.querySelectorAll('.scenario-option').forEach((opt, idx) => {
                opt.classList.remove('selected', 'correct', 'incorrect', 'neutral');
                
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    
                    // Color code based on value
                    if (selectedOption.value >= 4) {
                        opt.classList.add('correct');
                    } else if (selectedOption.value <= 2) {
                        opt.classList.add('incorrect');
                    } else {
                        opt.classList.add('neutral');
                    }
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('scenarioFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card scenario-insight">
                        <div class="insight-content">${selectedOption.feedback}</div>
                        ${selectedOption.insight ? `<div class="insight-quote">${selectedOption.insight}</div>` : ''}
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }
        
        function renderMultipleChoice(index, question) {
            const container = document.getElementById('questionContainer');
            
            let html = '';
            
            if (question.section) {
                html += `
                    <div class="section-header">
                        <h3>${question.section}</h3>
                        <div class="section-desc">${question.sectionDesc || ''}</div>
                    </div>
                `;
                if (document.getElementById('currentSection')) {
                    document.getElementById('currentSection').textContent = question.section;
                }
            }
            
            html += `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1} of ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="mc-options">
                        ${question.options.map((opt, idx) => `
                            <div class="mc-option" data-option="${idx}" onclick="selectMultipleChoice(${index}, ${idx})">
                                <div class="mc-radio">
                                    <input type="radio" name="mc${index}" value="${idx}">
                                </div>
                                <div class="mc-content">
                                    <div class="mc-text">${opt.text}</div>
                                    ${opt.type ? `<div class="mc-type">${opt.type}</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="mcFeedback" class="mc-feedback" style="display: none;"></div>
                </div>
                <div id="insightContainer"></div>
            `;
            
            container.innerHTML = html;
            if (document.getElementById('currentQ')) {
                document.getElementById('currentQ').textContent = index + 1;
            }
            
            if (answers[index] !== undefined) {
                const selectedIdx = question.options.findIndex(opt => opt.value === answers[index]);
                if (selectedIdx >= 0) {
                    selectMultipleChoice(index, selectedIdx);
                }
            }
        }
        
        function selectMultipleChoice(questionIndex, optionIndex) {
            const q = questions[questionIndex];
            const selectedOption = q.options[optionIndex];
            
            // Store answer
            answers[questionIndex] = selectedOption.value;
            
            // Visual feedback
            document.querySelectorAll('.mc-option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
            
            // Show feedback
            const feedbackDiv = document.getElementById('mcFeedback');
            if (feedbackDiv && selectedOption.feedback) {
                feedbackDiv.innerHTML = `
                    <div class="insight-card mc-insight">
                        ${selectedOption.type ? `<div class="mc-type-badge">${selectedOption.type}</div>` : ''}
                        <div class="insight-content">${selectedOption.feedback}</div>
                    </div>
                `;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Enable next button
            if (document.getElementById('nextBtn')) {
                document.getElementById('nextBtn').disabled = false;
            }
            
            // Save progress
            saveProgress();
        }

        function getOptionsForQuestion(q) {
            const questionText = q.question.toLowerCase();
            
            // Core Values questions
            if (questionText.includes('major life decision')) {
                return [
                    { text: 'What others expect of me', value: 1 },
                    { text: 'What seems most practical', value: 2 },
                    { text: 'What feels right to me', value: 3 },
                    { text: 'What aligns with my values', value: 4 },
                    { text: 'What serves my deepest purpose', value: 5 }
                ];
            } else if (questionText.includes('most fulfilled')) {
                return [
                    { text: 'Achieving external success', value: 1 },
                    { text: 'Meeting others\' expectations', value: 2 },
                    { text: 'Doing meaningful work', value: 3 },
                    { text: 'Living in alignment with values', value: 4 },
                    { text: 'Serving something greater than myself', value: 5 }
                ];
            } else if (questionText.includes('protect above all else')) {
                return [
                    { text: 'My reputation or image', value: 1 },
                    { text: 'My comfort or security', value: 2 },
                    { text: 'My relationships', value: 3 },
                    { text: 'My integrity and values', value: 4 },
                    { text: 'My purpose and legacy', value: 5 }
                ];
            } else if (questionText.includes('ideal day')) {
                return [
                    { text: 'Getting things done efficiently', value: 1 },
                    { text: 'Avoiding stress and conflict', value: 2 },
                    { text: 'Making progress on goals', value: 3 },
                    { text: 'Living in alignment with values', value: 4 },
                    { text: 'Serving others and growing', value: 5 }
                ];
            } else if (questionText.includes('be remembered for')) {
                return [
                    { text: 'My achievements or success', value: 1 },
                    { text: 'Being liked or popular', value: 2 },
                    { text: 'My contributions', value: 3 },
                    { text: 'Living my values authentically', value: 4 },
                    { text: 'The impact I had on others', value: 5 }
                ];
            
            // Life Alignment questions
            } else if (questionText.includes('work/career aligns')) {
                return [
                    { text: 'Not at all - completely misaligned', value: 1 },
                    { text: 'Somewhat - partially aligned', value: 2 },
                    { text: 'Moderately - mostly aligned', value: 3 },
                    { text: 'Well - strongly aligned', value: 4 },
                    { text: 'Perfectly - fully aligned', value: 5 }
                ];
            } else if (questionText.includes('relationships reflect')) {
                return [
                    { text: 'Not at all - relationships don\'t reflect values', value: 1 },
                    { text: 'Somewhat - partially reflect values', value: 2 },
                    { text: 'Moderately - mostly reflect values', value: 3 },
                    { text: 'Well - strongly reflect values', value: 4 },
                    { text: 'Perfectly - fully reflect values', value: 5 }
                ];
            } else if (questionText.includes('spend your time matches')) {
                return [
                    { text: 'Not at all - time doesn\'t match values', value: 1 },
                    { text: 'Somewhat - partially matches', value: 2 },
                    { text: 'Moderately - mostly matches', value: 3 },
                    { text: 'Well - strongly matches', value: 4 },
                    { text: 'Perfectly - fully matches', value: 5 }
                ];
            } else if (questionText.includes('financial decisions align')) {
                return [
                    { text: 'Not at all - spending doesn\'t reflect values', value: 1 },
                    { text: 'Somewhat - partially aligned', value: 2 },
                    { text: 'Moderately - mostly aligned', value: 3 },
                    { text: 'Well - strongly aligned', value: 4 },
                    { text: 'Perfectly - fully aligned', value: 5 }
                ];
            } else if (questionText.includes('daily habits support')) {
                return [
                    { text: 'Not at all - habits conflict with values', value: 1 },
                    { text: 'Somewhat - partially support values', value: 2 },
                    { text: 'Moderately - mostly support values', value: 3 },
                    { text: 'Well - strongly support values', value: 4 },
                    { text: 'Perfectly - fully support values', value: 5 }
                ];
            
            // Priorities & Trade-offs questions
            } else if (questionText.includes('work and family conflict')) {
                return [
                    { text: 'Always choose work', value: 1 },
                    { text: 'Usually choose work', value: 2 },
                    { text: 'Balance both equally', value: 3 },
                    { text: 'Usually choose family', value: 4 },
                    { text: 'Always choose family', value: 5 }
                ];
            } else if (questionText.includes('money and meaning conflict')) {
                return [
                    { text: 'Always choose money', value: 1 },
                    { text: 'Usually choose money', value: 2 },
                    { text: 'Balance both equally', value: 3 },
                    { text: 'Usually choose meaning', value: 4 },
                    { text: 'Always choose meaning', value: 5 }
                ];
            } else if (questionText.includes('security and growth conflict')) {
                return [
                    { text: 'Always choose security', value: 1 },
                    { text: 'Usually choose security', value: 2 },
                    { text: 'Balance both equally', value: 3 },
                    { text: 'Usually choose growth', value: 4 },
                    { text: 'Always choose growth', value: 5 }
                ];
            } else if (questionText.includes('comfort and challenge conflict')) {
                return [
                    { text: 'Always choose comfort', value: 1 },
                    { text: 'Usually choose comfort', value: 2 },
                    { text: 'Balance both equally', value: 3 },
                    { text: 'Usually choose challenge', value: 4 },
                    { text: 'Always choose challenge', value: 5 }
                ];
            } else if (questionText.includes('saying yes to one thing means saying no')) {
                return [
                    { text: 'Struggle to say no, try to do everything', value: 1 },
                    { text: 'Say yes to most things, rarely say no', value: 2 },
                    { text: 'Balance yes and no based on situation', value: 3 },
                    { text: 'Say no often, protect my priorities', value: 4 },
                    { text: 'Say no easily, very clear on priorities', value: 5 }
                ];
            } else {
                // Default 5-point scale
                return [
                    { text: 'Not at all', value: 1 },
                    { text: 'Somewhat', value: 2 },
                    { text: 'Moderately', value: 3 },
                    { text: 'Well', value: 4 },
                    { text: 'Perfectly', value: 5 }
                ];
            }
        }

        function setupDragHandlers() {
            const scaleContainer = document.getElementById('scaleContainer');
            if (!scaleContainer) return;
            
            function handleInteraction(e) {
                const rect = scaleContainer.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const relativeX = Math.max(0, Math.min(1, x / rect.width));
                const value = Math.ceil(relativeX * 5) || 1;
                selectOption(e, value);
                updateSliderVisual(value);
            }

            scaleContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                handleInteraction(e);
            });

            scaleContainer.addEventListener('mousemove', (e) => {
                if (isDragging) handleInteraction(e);
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            scaleContainer.addEventListener('touchstart', (e) => {
                isDragging = true;
                handleInteraction(e);
            }, { passive: false });

            scaleContainer.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleInteraction(e);
                }
            }, { passive: false });

            scaleContainer.addEventListener('touchend', () => {
                isDragging = false;
            });
        }

        function updateSliderVisual(value) {
            const options = document.querySelectorAll('.scale-option');
            options.forEach((opt, idx) => {
                if (idx < value) {
                    opt.classList.add('active');
                } else {
                    opt.classList.remove('active');
                }
            });
        }

        function selectOption(e, value) {
            e.stopPropagation();
            answers[currentQuestionIndex] = value;
            
            document.querySelectorAll('.scale-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            const selectedOpt = document.querySelector(`[data-value="${value}"]`);
            if (selectedOpt) {
                selectedOpt.classList.add('selected');
            }
            
            updateSliderVisual(value);
            document.getElementById('nextBtn').disabled = false;
            showInsight(insights[currentQuestionIndex]);
            
            // Save progress after each answer
            saveProgress();
        }

        function showInsight(insight) {
            const container = document.getElementById('insightContainer');
            container.innerHTML = `
                <div class="insight-card">
                    <div class="insight-icon">${insight.icon}</div>
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-content">${insight.content}</div>
                    <div class="insight-quote">${insight.quote}</div>
                </div>
            `;
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = false;
                document.getElementById('nextBtn').disabled = !answers[currentQuestionIndex];
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
                document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateProgress() {
            const answered = Object.keys(answers).length;
            const progress = (answered / questions.length) * 100;
            if (document.getElementById('progressBar')) {
                document.getElementById('progressBar').style.width = progress + '%';
            }
            
            // Milestone celebrations
            checkMilestones(progress);
            
            if (currentQuestionIndex === questions.length - 1) {
                if (document.getElementById('nextBtn')) {
                    document.getElementById('nextBtn').textContent = 'See Results üéØ';
                }
            }
        }
        
        // Milestone system
        function checkMilestones(progress) {
            if (!window.milestonesShown) {
                window.milestonesShown = [];
            }
            
            const milestones = [25, 50, 75, 100];
            const currentMilestone = Math.floor(progress / 25) * 25;
            
            if (milestones.includes(currentMilestone) && 
                !window.milestonesShown.includes(currentMilestone) &&
                progress >= currentMilestone) {
                
                window.milestonesShown.push(currentMilestone);
                showMilestoneCelebration(currentMilestone);
            }
        }
        
        function showMilestoneCelebration(percent) {
            const messages = {
                25: {
                    emoji: 'üéØ',
                    title: '25% Complete!',
                    message: 'You\'re building momentum! Great start!',
                    color: 'linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)'
                },
                50: {
                    emoji: 'üî•',
                    title: 'Halfway There!',
                    message: 'You\'re crushing it! Keep going!',
                    color: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'
                },
                75: {
                    emoji: 'üí™',
                    title: '75% Complete!',
                    message: 'Almost done! Finish strong!',
                    color: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)'
                },
                100: {
                    emoji: 'üéâ',
                    title: 'Assessment Complete!',
                    message: 'Amazing work! Time to see your results!',
                    color: 'linear-gradient(135deg, #10b981 0%, #059669 100%)'
                }
            };
            
            const milestone = messages[percent];
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'milestone-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.7); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div class="milestone-content" style="
                    background: ${milestone.color}; color: white;
                    padding: 50px; border-radius: 20px; text-align: center;
                    max-width: 500px; animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">${milestone.emoji}</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800;">${milestone.title}</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.95;">${milestone.message}</p>
                    <button onclick="this.closest('.milestone-modal').remove()" style="
                        background: white; color: #333; padding: 15px 30px;
                        border: none; border-radius: 10px; font-size: 1.1rem;
                        font-weight: 700; cursor: pointer; transition: all 0.2s;
                    ">
                        Continue ‚Üí
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Trigger confetti
            triggerConfetti();
            
            // Auto-close after 3 seconds if not dismissed
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.style.opacity = '0';
                    setTimeout(() => modal.remove(), 300);
                }
            }, 3000);
        }
        
        function triggerConfetti() {
            const emojis = ['üéâ', '‚≠ê', '‚ú®', 'üéä', 'üí´', 'üåü'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.cssText = `
                    position: fixed; font-size: 2rem; z-index: 9999;
                    left: ${Math.random() * 100}vw; top: -50px;
                    pointer-events: none;
                    animation: confettiFall ${2 + Math.random() * 2}s ease-out forwards;
                `;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 4000);
            }
        }
        
        function showAchievementBadge(badgeId, title, description, xpValue) {
            const badge = document.createElement('div');
            badge.className = 'achievement-modal';
            badge.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const badgeEmojis = {
                'first-stripe': 'üë£',
                'perfect-score': 'üéØ',
                'speed-demon': '‚ö°',
                'streak-3': 'üî•',
                'streak-7': 'üî•',
                'streak-30': 'üî•',
                'dedicated': 'üí™',
                'scholar': 'üìö',
                'master': 'üëë'
            };
            
            const emoji = badgeEmojis[badgeId] || 'üèÜ';
            
            badge.innerHTML = `
                <div class="achievement-content" style="
                    background: white; padding: 50px; border-radius: 20px;
                    text-align: center; max-width: 500px;
                    animation: scaleIn 0.3s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 6rem; margin-bottom: 1rem;">${emoji}</div>
                    <div style="
                        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                        color: white; display: inline-block; padding: 8px 20px;
                        border-radius: 20px; font-size: 0.9rem; font-weight: 700;
                        margin-bottom: 1rem; text-transform: uppercase;
                        letter-spacing: 1px;
                    ">Achievement Unlocked!</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; font-weight: 800; color: #333;">${title}</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: #666; line-height: 1.6;">${description}</p>
                    <div style="
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white; display: inline-block; padding: 12px 24px;
                        border-radius: 12px; font-size: 1.2rem; font-weight: 700;
                        margin-bottom: 1.5rem;
                    ">+${xpValue} XP</div>
                    <div>
                        <button onclick="this.closest('.achievement-modal').remove()" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white; padding: 15px 30px; border: none;
                            border-radius: 10px; font-size: 1.1rem; font-weight: 700;
                            cursor: pointer; transition: all 0.2s;
                        ">
                            Awesome! ‚ú®
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(badge);
            triggerConfetti();
        }
        
        function checkAchievements() {
            // Perfect Score
            let perfectScore = true;
            for (let i = 0; i < questions.length; i++) {
                if (answers[i] < 4) {
                    perfectScore = false;
                    break;
                }
            }
            if (perfectScore) {
                showAchievementBadge('perfect-score', 'üéØ Perfect Score', 'You answered all questions at mastery level!', 50);
            }
            
            // Speed Demon
            const startTime = parseInt(localStorage.getItem('assessmentStartTime') || '0');
            const completionTime = (Date.now() - startTime) / 1000 / 60; // minutes
            if (completionTime < 5 && startTime > 0) {
                showAchievementBadge('speed-demon', '‚ö° Speed Demon', 'Completed in under 5 minutes!', 25);
            }
            
            // First Stripe
            const completedStripes = Object.keys(localStorage).filter(k => k.includes('Complete')).length;
            if (completedStripes === 1) {
                showAchievementBadge('first-stripe', 'üë£ First Steps', 'You completed your first stripe!', 25);
            }
        }

        function showResults() {
            // Check achievements before showing results
            checkAchievements();
            
            // Calculate values and alignment scores
            let valuesScore = 0;
            let alignmentScore = 0;
            let tradeoffsScore = 0;
            
            // Core Values (questions 0-4)
            for (let i = 0; i < 5; i++) {
                if (answers[i]) valuesScore += answers[i];
            }
            
            // Life Alignment (questions 5-9)
            for (let i = 5; i < 10; i++) {
                if (answers[i]) alignmentScore += answers[i];
            }
            
            // Priorities & Trade-offs (questions 10-14)
            for (let i = 10; i < 15; i++) {
                if (answers[i]) tradeoffsScore += answers[i];
            }
            
            const avgValues = valuesScore / 5;
            const avgAlignment = alignmentScore / 5;
            const avgTradeoffs = tradeoffsScore / 5;
            const overallScore = (avgValues + avgAlignment + avgTradeoffs) / 3;
            
            let alignmentType = '';
            let typeEmoji = '';
            let typeLabel = '';
            let typeColor = '';
            let strengths = [];
            let challenges = [];
            let strategies = [];
            
            if (overallScore <= 2.0) {
                alignmentType = 'Discovering';
                typeEmoji = 'üîç';
                typeLabel = 'üîç Discovering Your Values';
                typeColor = '#f4a261';
                strengths = [
                    'Awareness is the first step to alignment',
                    'You\'re honest about where you are',
                    'Every master was once a beginner',
                    'You have room to build strong foundations',
                    'Growth mindset is already present'
                ];
                challenges = [
                    'Core values need clarification',
                    'Life alignment needs improvement',
                    'Priorities need to be defined',
                    'Trade-off decisions need practice',
                    'Values-action gap needs to be closed'
                ];
                strategies = [
                    'Start by identifying your top 3-5 core values',
                    'Track where your time and money actually go',
                    'Practice saying no to align with yes',
                    'Make one decision per week based on values',
                    'Review your values monthly and adjust'
                ];
            } else if (overallScore <= 3.5) {
                alignmentType = 'Aligning';
                typeEmoji = '‚öñÔ∏è';
                typeLabel = '‚öñÔ∏è Aligning Your Life';
                typeColor = '#457b9d';
                strengths = [
                    'You have some clarity on your values',
                    'You recognize areas that need alignment',
                    'You\'re building foundational awareness',
                    'You have some effective strategies',
                    'You\'re committed to growth'
                ];
                challenges = [
                    'Some values still need clarification',
                    'Life alignment could be stronger',
                    'Priorities need more definition',
                    'Trade-off decisions need refinement',
                    'Values-action gap needs attention'
                ];
                strategies = [
                    'Double down on your top 3 values',
                    'Audit your calendar and spending monthly',
                    'Practice saying no to protect your yes',
                    'Make daily decisions aligned with values',
                    'Review and refine your values quarterly'
                ];
            } else {
                alignmentType = 'Aligned';
                typeEmoji = 'üíé';
                typeLabel = 'üíé Living in Alignment';
                typeColor = '#2a9d8f';
                strengths = [
                    'High clarity on your core values',
                    'Strong life alignment with values',
                    'Clear priorities and trade-off strategy',
                    'Consistent values-based decision-making',
                    'Good values-action alignment'
                ];
                challenges = [
                    'Maintain alignment during stress',
                    'Continue refining as life changes',
                    'Support others in their alignment journey',
                    'Stay aware of values drift',
                    'Prevent complacency in good times'
                ];
                strategies = [
                    'Share your values clarity with others',
                    'Continue refining as life evolves',
                    'Stay aware of changing priorities',
                    'Support others in their values journey',
                    'Use your alignment to help build team values'
                ];
            }

            document.getElementById('assessmentForm').style.display = 'none';
            document.getElementById('resultsContainer').classList.add('active');
            
            document.getElementById('typeEmoji').textContent = typeEmoji;
            document.getElementById('typeLabel').textContent = typeLabel;
            document.getElementById('typeResultCard').style.background = `linear-gradient(135deg, ${typeColor} 0%, ${typeColor}dd 100%)`;
            
            const typeDetailsHTML = `
                <div class="type-card">
                    <h3>üí™ Your Strengths</h3>
                    <ul>
                        ${strengths.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #fff5f0; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">‚ö†Ô∏è Areas for Growth</h3>
                    <ul>
                        ${challenges.map(c => `<li>${c}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="type-card" style="background: #f0f4ff; border-left-color: ${typeColor};">
                    <h3 style="color: ${typeColor};">üéØ Recommended Strategies</h3>
                    <ul>
                        ${strategies.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="insight-card" style="margin-top: 30px;">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-title">The Key Insight</div>
                    <div class="insight-content">
                        <strong>Values aren't what you say‚Äîthey're what you do.</strong> Just like in BJJ, where you must secure your position before attempting a submission, you must secure your values before making decisions. Position before submission. Priorities before goals.
                        <br><br>
                        <strong>ü•ã BJJ Wisdom:</strong> "You can't be good at everything‚Äîyou must choose your values. You can't defend everything‚Äîyou must choose your position. Same with life."
                    </div>
                </div>
            `;
            
            document.getElementById('typeDetails').innerHTML = typeDetailsHTML;
            
            // Clear partial progress
            clearProgress();
            
            // Save completion to localStorage
            localStorage.setItem('whiteBeltStripe3Complete', 'true');
            localStorage.setItem('whiteBeltStripe3CompletedDate', new Date().toISOString());
            localStorage.setItem('valuesAlignment', alignmentType);
            
            // Award XP
            const currentXP = parseInt(localStorage.getItem('totalXP') || '0');
            const xpReward = 100; // +100 XP for completing Stripe 3
            localStorage.setItem('totalXP', (currentXP + xpReward).toString());
            
            // Show completion notification
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #38a169 0%, #2f855a 100%); color: white; padding: 1rem 1.5rem; border-radius: 10px; box-shadow: 0 4px 20px rgba(56, 161, 105, 0.4); z-index: 1000; font-weight: 600;';
                notification.innerHTML = `‚úÖ Stripe 3 Complete! +${xpReward} XP`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }, 500);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
<!-- TAP-IN Utilities -->
<script src="js/shared-utilities.js"></script>
<script src="js/global-error-handler.js"></script>
<script src="js/storage-health.js"></script>
</body>
</html>

